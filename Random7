ì•„ë˜ ê¸°ëŠ¥ë“¤ì´ ì¶”ê°€ë©ë‹ˆë‹¤.

ë¡œì»¬/ì›ê²© ìë™ êµ¬ë¶„: ë‚´ IPì™€ DBì˜ IPê°€ ê°™ìœ¼ë©´ SSH ì—†ì´ ë°”ë¡œ í´ë”ë¥¼ ì—½ë‹ˆë‹¤.

--no-sandbox ì¶”ê°€: ìš”ì²­í•˜ì‹  ì˜µì…˜ì„ ê¸°ë³¸ ì ìš©í•©ë‹ˆë‹¤.

ì‹¤í–‰ ì‹ ë¢°ì„± í–¥ìƒ (--new-window):

ì‹¤í–‰ì´ ì•ˆ ë˜ë˜ ì´ìœ  ì¶”ì¸¡: ë³´í†µ ê¸°ì¡´ì— ì—´ë ¤ ìˆëŠ” VS Code ì°½ì´ ëª…ë ¹ì„ "ë¨¹ì–´ë²„ë¦¬ê±°ë‚˜(Silent)", ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ í™”ë©´(DISPLAY)ì„ ì°¾ì§€ ëª»í•´ì„œ ê·¸ë ‡ìŠµë‹ˆë‹¤.

í•´ê²°: --new-window ì˜µì…˜ì„ ë„£ì–´ ê°•ì œë¡œ ìƒˆ ì°½ì„ ë„ìš°ê²Œ í•˜ê³ , í™˜ê²½ë³€ìˆ˜ DISPLAY=:0ì„ ëª…ì‹œí•˜ì—¬ ëª¨ë‹ˆí„°ì— ì°½ì„ ë„ìš°ë„ë¡ ê°•ì œí–ˆìŠµë‹ˆë‹¤.

update_app.py
ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ generate_project.pyê°€ ìˆë˜ ìœ„ì¹˜ì™€ ê°™ì€ ê³³ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.

Python

import os

# app.pyì˜ ë‚´ìš©ì„ ìƒˆë¡œ ì‘ì„±í•©ë‹ˆë‹¤.
new_app_code = r"""from flask import Flask, render_template, request, jsonify
import pymssql
import subprocess
import os
import socket

app = Flask(__name__)

# ================= CONFIGURATION =================
DB_HOST = '192.168.0.10'
DB_USER = 'sa'
DB_PASSWORD = 'password'
DB_NAME = 'MyDatabase'
# =================================================

def get_db_connection():
    return pymssql.connect(server=DB_HOST, user=DB_USER, password=DB_PASSWORD, database=DB_NAME)

def get_local_ip():
    """í˜„ì¬ PCì˜ IP ì£¼ì†Œë¥¼ í™•ì¸í•©ë‹ˆë‹¤."""
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        # ì™¸ë¶€ë§ì— ì—°ê²° ì‹œë„ (ì‹¤ì œ íŒ¨í‚· ì „ì†¡ X)í•˜ì—¬ IP í™•ì¸
        s.connect(('10.255.255.255', 1))
        IP = s.getsockname()[0]
    except Exception:
        IP = '127.0.0.1'
    finally:
        s.close()
    return IP

@app.route('/')
def index():
    conn = get_db_connection()
    cursor = conn.cursor(as_dict=True)
    cursor.execute("SELECT IPAddress, Account, DisplayName, FullPath, CONVERT(VARCHAR, LastUpdated, 120) as LastUpdated FROM FolderIndex ORDER BY LastUpdated DESC")
    rows = cursor.fetchall()
    conn.close()
    return render_template('index.html', folders=rows)

@app.route('/open_vscode', methods=['POST'])
def open_vscode():
    data = request.json
    target_ip = data.get('ip')
    user = data.get('account')
    path = data.get('path')

    local_ip = get_local_ip()
    
    # 1. ê¸°ë³¸ ëª…ë ¹ì–´ ë° ì˜µì…˜ ì„¤ì •
    # --no-sandbox: ìƒŒë“œë°•ìŠ¤ ë¹„í™œì„±í™” (ê¶Œí•œ ë¬¸ì œ ì™„í™”)
    # --new-window: ê¸°ì¡´ ì°½ì— ë¬»íˆì§€ ì•Šê³  ê°•ì œë¡œ ìƒˆ ì°½ì„ ë„ì›€ (ì‹¤í–‰ í™•ì¸ ìš©ì´)
    # ë§Œì•½ ê¸°ì¡´ ì°½ì„ ì¬ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ --reuse-window ë¡œ ë³€ê²½í•˜ë©´ ë˜ì§€ë§Œ, 
    # í™•ì‹¤í•œ ì‹¤í–‰ì„ ìœ„í•´ --new-windowë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.
    cmd = ['code', '--no-sandbox', '--new-window']

    # 2. ë¡œì»¬ vs ì›ê²© íŒë‹¨ ë¡œì§
    # ëŒ€ìƒ IPê°€ ë¡œì»¬ IPì™€ ê°™ê±°ë‚˜ localhostì¸ ê²½ìš° SSHë¥¼ íƒ€ì§€ ì•ŠìŒ
    if target_ip == local_ip or target_ip in ['127.0.0.1', 'localhost']:
        print(f"Adding Local Path: {path}")
        cmd.append(path)
        mode_msg = "Local Direct"
    else:
        # ì›ê²©ì§€ì¸ ê²½ìš° SSH Remote ì‚¬ìš©
        remote_arg = f"ssh-remote+{user}@{target_ip}"
        print(f"Adding Remote Path: {remote_arg} {path}")
        cmd.extend(['--remote', remote_arg, path])

    try:
        # 3. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì‹¤í–‰ì´ ì•ˆ ë˜ëŠ” ë¬¸ì œ í•´ê²°ì˜ í•µì‹¬)
        # ì›¹ ì„œë²„(íŒŒì´ì¬)ê°€ ë°±ê·¸ë¼ìš´ë“œë‚˜ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰ë  ë•Œ,
        # GUIë¥¼ ì–´ë””ì— ë„ìš¸ì§€ ëª°ë¼ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ.
        # DISPLAY=:0 ì„ ê°•ì œí•˜ì—¬ í˜„ì¬ ëª¨ë‹ˆí„°ì— ë„ìš°ë„ë¡ í•¨.
        my_env = os.environ.copy()
        if 'DISPLAY' not in my_env:
            my_env['DISPLAY'] = ':0'

        # ì„œë¸Œí”„ë¡œì„¸ìŠ¤ë¡œ VS Code ì‹¤í–‰
        subprocess.Popen(cmd, env=my_env)
        
        return jsonify({
            'status': 'success', 
            'message': f'[{mode_msg}] Opening {path} on {target_ip}'
        })
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 500

if __name__ == '__main__':
    # ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ì˜ ë‹¤ë¥¸ PCì—ì„œë„ ì ‘ì† ê°€ëŠ¥í•˜ë„ë¡ 0.0.0.0 ì„¤ì •
    app.run(host='0.0.0.0', port=5000, debug=True)
"""

def update_app():
    target_path = os.path.join("NetworkFolderIndexer", "app.py")
    
    if not os.path.exists("NetworkFolderIndexer"):
        print("âŒ ì˜¤ë¥˜: 'NetworkFolderIndexer' í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. generate_project.pyë¥¼ ë¨¼ì € ì‹¤í–‰í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.")
        return

    with open(target_path, "w", encoding="utf-8") as f:
        f.write(new_app_code)
        
    print(f"âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ: {target_path}")
    print("ğŸ‘‰ ì´ì œ 'python3 app.py'ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ì ìš©ë©ë‹ˆë‹¤.")

if __name__ == "__main__":
    update_app()
ì¶”ê°€ ì„¤ëª… ë° ì˜µì…˜ ê°€ì´ë“œ
1. ì‹¤í–‰ì´ ì˜ ì•ˆ ë˜ë˜ ì´ìœ ì™€ í•´ê²°ì±… ì›¹ ì„œë²„(íŒŒì´ì¬)ê°€ ì‹¤í–‰ë  ë•Œ, ë¦¬ëˆ…ìŠ¤ëŠ” ì´ í”„ë¡œê·¸ë¨ì´ í™”ë©´(GUI)ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ ëª¨ë¥´ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

í•´ê²°: ì½”ë“œ ë‚´ì— my_env['DISPLAY'] = ':0' ë¶€ë¶„ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ê±´ "ì§€ê¸ˆ ë³´ê³  ìˆëŠ” 0ë²ˆ ëª¨ë‹ˆí„°ì— ì°½ì„ ë„ì›Œë¼"ë¼ëŠ” ê°•ì œ ëª…ë ¹ì…ë‹ˆë‹¤.

2. VS Code ì°½ ê´€ë¦¬ ì˜µì…˜ (ì·¨í–¥ì— ë”°ë¼ ë³€ê²½ ê°€ëŠ¥) ì½”ë“œ ì¤‘ê°„ì˜ cmd = ['code', ...] ë¶€ë¶„ì—ì„œ ì˜µì…˜ì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

--new-window: (í˜„ì¬ ì ìš©ë¨) ë¬´ì¡°ê±´ ìƒˆ ì°½ì„ ë„ì›ë‹ˆë‹¤. ì‹¤í–‰ ì—¬ë¶€ê°€ ê°€ì¥ í™•ì‹¤í•˜ê²Œ ë³´ì…ë‹ˆë‹¤.

--reuse-window: ì´ë¯¸ ì—´ë¦° VS Code ì°½ì´ ìˆë‹¤ë©´ ê·¸ ì°½ì˜ ë‚´ìš©ì„ ë°”ê¿‰ë‹ˆë‹¤. ì°½ì´ ë„ˆë¬´ ë§ì´ ëœ¨ëŠ” ê²Œ ì‹«ë‹¤ë©´ ì´ ì˜µì…˜ìœ¼ë¡œ ë°”ê¿”ë³´ì„¸ìš”.

--goto: íŒŒì¼ì´ ì´ë¯¸ ì—´ë ¤ìˆë‹¤ë©´ ê·¸ íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤(íŒŒì¼ ë‹¨ìœ„ ì—´ê¸° ì‹œ ìœ ìš©).

3. ë¡œì»¬ ì‹¤í–‰ ë¡œì§ ì´ì œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‚´ë¶€ì ìœ¼ë¡œ IPë¥¼ ë¹„êµí•˜ì—¬ 127.0.0.1ì´ê±°ë‚˜ í˜„ì¬ PC IPì™€ ê°™ìœ¼ë©´ ssh-remote+... ëª…ë ¹ì–´ë¥¼ ë¹¼ê³ , ë‹¨ìˆœíˆ code /ê²½ë¡œ í˜•ì‹ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì†ë„ê°€ í›¨