1. 파일 생성: app.py
/home/kw/dify_bridge 폴더(없으면 만드세요) 안에 app.py를 만들고 아래 코드를 붙여넣으세요.

Python
# 파일명: app.py
from flask import Flask, request, jsonify
import requests
import time
import json

app = Flask(__name__)

# ==============================================================================
# [설정] 회사 API 정보 (여기를 수정하세요)
# ==============================================================================
COMPANY_API_URL = "http://YOUR_COMPANY_API_URL_HERE"   # 회사 API 주소
COMPANY_API_KEY = "YOUR_API_KEY_HERE"                  # 회사 API 키 (없으면 "")
PORT = 5077                                            # 실행할 포트 번호
# ==============================================================================

@app.route('/v1/chat/completions', methods=['POST'])
def proxy_chat():
    print(f"\n[LOG] Dify 요청 수신 (Port {PORT})")
    try:
        # 1. Dify에서 보낸 질문 받기
        dify_data = request.json
        messages = dify_data.get('messages', [])
        user_input = messages[-1]['content'] if messages else ""
        
        print(f"[LOG] 질문 내용: {user_input}")

        # 2. 회사 API 전송 데이터 구성
        payload = {
            "input_type": "chat",
            "output_type": "chat",
            "input_value": user_input
        }
        
        headers = {}
        if COMPANY_API_KEY:
            headers["x-api-key"] = COMPANY_API_KEY

        # 3. 회사 API 호출
        response = requests.post(
            COMPANY_API_URL, headers=headers, json=payload, timeout=120
        )
        
        # 4. 응답 처리 (JSON이든 텍스트든 알아서 처리)
        if response.status_code == 200:
            try:
                ai_answer = str(response.json()) # JSON이면 문자열로 변환
            except:
                ai_answer = response.text        # 텍스트면 그대로 사용
        else:
            ai_answer = f"Error: {response.status_code} - {response.text}"

        print(f"[LOG] 답변 반환 완료")

        # 5. Dify 표준 포맷으로 반환
        return jsonify({
            "id": "chatcmpl-" + str(int(time.time())),
            "object": "chat.completion",
            "created": int(time.time()),
            "model": "smd-ai",
            "choices": [{"index": 0, "message": {"role": "assistant", "content": ai_answer}, "finish_reason": "stop"}],
            "usage": {"prompt_tokens": len(user_input), "completion_tokens": len(ai_answer), "total_tokens": 0}
        })

    except Exception as e:
        print(f"[ERROR] {e}")
        return jsonify({"error": str(e)}), 500

@app.route('/v1/models', methods=['GET'])
def list_models():
    return jsonify({"object": "list", "data": [{"id": "smd-ai", "object": "model"}]})

if __name__ == '__main__':
    # 0.0.0.0으로 열어야 도커에서 접속 가능
    app.run(host='0.0.0.0', port=PORT)
2. 실행 방법 (터미널)
사용하시는 가상환경(myvenv1)을 활성화하고 실행하면 끝입니다.

Bash
# 1. 폴더로 이동
cd /home/kw/dify_bridge

# 2. 가상환경 활성화 (경로는 본인 환경에 맞게)
source /home/kw/myvenv1/bin/activate

# 3. 필수 라이브러리 설치 (딱 한 번만 하면 됨)
pip install flask requests

# 4. 서버 실행
python3 app.py
이제 5077 포트가 열렸습니다. Dify 설정에서 http://host.docker.internal:5077/v1 로 연결해서 쓰시면 됩니다!