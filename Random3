1. 로그 회전(Log Rotation) 명령 가이드
AI에게 로그 관련 코드를 짜달라고 할 때, 아래와 같이 명확하게 제약 조건을 설명하면 정확한 코드를 얻을 수 있습니다.

설명 예시: "파이썬 logging 라이브러리의 TimedRotatingFileHandler를 사용하여 로그 시스템을 만들어줘. 로그는 매일 자정(midnight)에 한 번 회전하고, 보관 주기(backupCount)는 1일로 설정해서 딱 하루치 데이터만 남기고 이전 로그는 삭제되게 해줘. 로그 파일 경로는 ./logs/app_name.log 형식이면 좋겠어."

2. PM2를 이용한 관리 및 로그 제어
PM2 자체 기능을 사용하여 로그 용량과 보관 기간을 관리하는 것이 가장 깔끔합니다.

① PM2 로그 로테이트 설치 터미널에서 아래 명령어를 입력하면 PM2가 알아서 로그를 쪼개고 오래된 것을 지워줍니다.

Bash

pm2 install pm2-logrotate
② 하루치만 보관하도록 설정

Bash

# 최대 보관 파일 수를 1개로 제한 (당일 로그 + 전날 로그 1개)
pm2 set pm2-logrotate:retain 1
# 파일 하나당 용량 제한 (예: 10MB)
pm2 set pm2-logrotate:max_size 10M
③ 앱 등록 예시

Bash

pm2 start script.py --name "my-app-01" --log ./logs/my-app-01.log
3. 실시간 로그 뷰어 Flask 앱 (Port: 30000)
PM2에 등록된 앱 리스트를 불러오고, 해당 앱의 로그를 실시간으로 확인할 수 있는 '다크 모드' 테마의 Flask 앱입니다.

Python

import os
import subprocess
import json
from flask import Flask, render_template_string, jsonify

app = Flask(__name__)

# CSS 및 HTML 템플릿 (개까리한 다크 테마)
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM2 Log Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .log-container { background-color: #020617; border: 1px solid #1e293b; height: 600px; overflow-y: auto; font-family: 'Courier New', Courier, monospace; }
        .app-card:hover { background-color: #1e293b; cursor: pointer; transition: 0.3s; }
        .active-app { border-left: 4px solid #38bdf8; background-color: #1e293b; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-8 border-b border-slate-700 pb-4">
            <h1 class="text-3xl font-bold text-sky-400">PM2 LOG MONITOR</h1>
            <p class="text-slate-400">실시간 프로세스 로그 대시보드 (Port 30000)</p>
        </header>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-4 bg-slate-900 rounded-lg p-4 border border-slate-800">
                <h2 class="text-xl font-semibold mb-4 text-slate-200">Registered Apps</h2>
                <div id="app-list" class="space-y-2">
                    </div>
            </div>

            <div class="col-span-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="current-app-name" class="text-xl font-semibold text-sky-300">앱을 선택하세요</h2>
                    <button onclick="fetchLogs()" class="bg-sky-600 hover:bg-sky-500 text-white px-4 py-1 rounded text-sm transition">새로고침</button>
                </div>
                <div id="log-window" class="log-container p-4 rounded-lg text-sm leading-relaxed">
                    로그를 보려면 왼쪽 리스트에서 앱을 클릭하세요...
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedApp = "";

        async function loadApps() {
            const res = await fetch('/api/apps');
            const apps = await res.json();
            const listDiv = document.getElementById('app-list');
            listDiv.innerHTML = apps.map(app => `
                <div onclick="selectApp('${app.name}')" class="app-card p-3 rounded border border-slate-800 flex justify-between items-center">
                    <span>${app.name}</span>
                    <span class="text-xs ${app.status === 'online' ? 'text-green-400' : 'text-red-400'}">● ${app.status}</span>
                </div>
            `).join('');
        }

        async function selectApp(name) {
            selectedApp = name;
            document.getElementById('current-app-name').innerText = name + " Logs";
            fetchLogs();
        }

        async function fetchLogs() {
            if (!selectedApp) return;
            const logWindow = document.getElementById('log-window');
            const res = await fetch(`/api/logs/${selectedApp}`);
            const data = await res.json();
            logWindow.innerHTML = data.logs.replace(/\\n/g, '<br>');
            logWindow.scrollTop = logWindow.scrollHeight;
        }

        setInterval(loadApps, 5000);
        loadApps();
    </script>
</body>
</html>
"""

@app.route('/')
def index():
    return render_template_string(HTML_TEMPLATE)

@app.route('/api/apps')
def get_apps():
    # PM2 리스트 가져오기
    result = subprocess.run(['pm2', 'jlist'], capture_output=True, text=True)
    apps_data = json.loads(result.stdout)
    apps = [{"name": app['name'], "status": app['pm2_env']['status']} for app in apps_data]
    return jsonify(apps)

@app.route('/api/logs/<app_name>')
def get_logs(app_name):
    # PM2 로그 경로 찾기
    result = subprocess.run(['pm2', 'describe', app_name], capture_output=True, text=True)
    # 실제 환경에서는 pm2 jlist의 log 경로를 사용하는 것이 더 정확함
    # 여기서는 간단히 tail 명령어로 마지막 100줄만 가져옴
    log_proc = subprocess.run(['pm2', 'logs', app_name, '--raw', '--lines', '100', '--err', '--out'], 
                              capture_output=True, text=True, timeout=2)
    return jsonify({"logs": log_proc.stdout if log_proc.stdout else "No logs found."})

if __name__ == '__main__':
    # 30000번 포트로 실행
    app.run(host='0.0.0.0', port=30000)
실행 가이드
위 Flask 코드를 viewer.py로 저장합니다.

pip install flask 명령어로 플라스크를 설치합니다.

python viewer.py를 실행하거나, 이 뷰어 자체도 pm2 start viewer.py --name "Log-Viewer"로 등록해 버리세요.