ì „ ì¤€ë¹„ (MSSQL í…Œì´ë¸” ìƒì„±)
ë¨¼ì € MSSQL 2014 ë°ì´í„°ë² ì´ìŠ¤ì— ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì—¬ í…Œì´ë¸”ì„ ìƒì„±í•´ ì£¼ì„¸ìš”.

SQL

CREATE TABLE FolderIndex (
    IPAddress NVARCHAR(50),
    Account NVARCHAR(50),
    DisplayName NVARCHAR(255), -- ì ‘ë‘ì–´_í´ë”ëª…
    FullPath NVARCHAR(500),
    LastUpdated DATETIME DEFAULT GETDATE(),
    PRIMARY KEY (IPAddress, FullPath)
);
2. í”„ë¡œì íŠ¸ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ (Generate_Project.py)
ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ generate_project.pyë¡œ ì €ì¥ í›„ í•œ ë²ˆë§Œ ì‹¤í–‰í•˜ì„¸ìš”. ê·¸ëŸ¬ë©´ í•„ìš”í•œ ëª¨ë“  í”„ë¡œê·¸ë¨ì´ ì‘ì„±ë©ë‹ˆë‹¤.

Python

import os

# --- ì„¤ì •: íŒŒì¼ ë‚´ìš© ì •ì˜ ---

# 1. Scanner Script (ëª¨ë“  ìš°ë¶„íˆ¬ PCì— ë°°í¬ìš©)
scanner_code = r"""import os
import socket
import pymssql
import datetime
import sys

# ================= CONFIGURATION =================
DB_HOST = '192.168.0.10'  # MSSQL ì„œë²„ IP
DB_USER = 'sa'            # DB ì•„ì´ë””
DB_PASSWORD = 'password'  # DB ë¹„ë°€ë²ˆí˜¸
DB_NAME = 'MyDatabase'    # DB ì´ë¦„

# ìŠ¤ìº”í•  ëŒ€ìƒ ìƒìœ„ ê²½ë¡œ ëª©ë¡
TARGET_PATHS = [
    '/home/username/projects',
    '/var/www/html'
]

# ì„¤ì •í•œ ì ‘ë‘ì–´
PREFIX = "MYPRJ_" 
# =================================================

def get_ip_address():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        s.connect(('10.255.255.255', 1))
        IP = s.getsockname()[0]
    except Exception:
        IP = '127.0.0.1'
    finally:
        s.close()
    return IP

def scan_and_update():
    current_ip = get_ip_address()
    current_user = os.getenv('USER')
    
    conn = None
    try:
        conn = pymssql.connect(server=DB_HOST, user=DB_USER, password=DB_PASSWORD, database=DB_NAME)
        cursor = conn.cursor()
        
        print(f"[{datetime.datetime.now()}] Start Scanning...")

        for base_path in TARGET_PATHS:
            if not os.path.exists(base_path):
                continue
                
            # ë°”ë¡œ ì•„ë˜ í•˜ìœ„ í´ë”ë§Œ ê²€ìƒ‰
            try:
                subfolders = [f for f in os.listdir(base_path) if os.path.isdir(os.path.join(base_path, f))]
            except PermissionError:
                print(f"Permission denied: {base_path}")
                continue

            for folder in subfolders:
                full_path = os.path.join(base_path, folder)
                display_name = f"{PREFIX}{folder}" # ì ‘ë‘ì–´_í´ë”ëª…
                
                # MERGE ì¿¼ë¦¬ (MSSQL 2008+ ì§€ì›)
                sql = \"\"\"
                MERGE FolderIndex AS target
                USING (SELECT %s as IP, %s as Path) AS source
                ON (target.IPAddress = source.IP AND target.FullPath = source.Path)
                WHEN MATCHED THEN
                    UPDATE SET DisplayName = %s, Account = %s, LastUpdated = GETDATE()
                WHEN NOT MATCHED THEN
                    INSERT (IPAddress, Account, DisplayName, FullPath, LastUpdated)
                    VALUES (%s, %s, %s, %s, GETDATE());
                \"\"\"
                
                cursor.execute(sql, (
                    current_ip, full_path,           # Source
                    display_name, current_user,      # Update
                    current_ip, current_user, display_name, full_path # Insert
                ))
        
        conn.commit()
        print("Update Completed.")

    except Exception as e:
        print(f"Error: {e}")
    finally:
        if conn: conn.close()

if __name__ == "__main__":
    scan_and_update()
"""

# 2. Web Viewer App (ë©”ì¸ PCìš© - VS Code ì‹¤í–‰ ê¸°ëŠ¥ í¬í•¨)
app_code = r"""from flask import Flask, render_template, request, jsonify
import pymssql
import subprocess
import os

app = Flask(__name__)

# ================= CONFIGURATION =================
DB_HOST = '192.168.0.10'
DB_USER = 'sa'
DB_PASSWORD = 'password'
DB_NAME = 'MyDatabase'
# =================================================

def get_db_connection():
    return pymssql.connect(server=DB_HOST, user=DB_USER, password=DB_PASSWORD, database=DB_NAME)

@app.route('/')
def index():
    conn = get_db_connection()
    cursor = conn.cursor(as_dict=True)
    cursor.execute("SELECT IPAddress, Account, DisplayName, FullPath, CONVERT(VARCHAR, LastUpdated, 120) as LastUpdated FROM FolderIndex ORDER BY LastUpdated DESC")
    rows = cursor.fetchall()
    conn.close()
    return render_template('index.html', folders=rows)

@app.route('/open_vscode', methods=['POST'])
def open_vscode():
    data = request.json
    ip = data.get('ip')
    user = data.get('account')
    path = data.get('path')

    # VS Code Remote SSH ëª…ë ¹ì–´ êµ¬ì„±
    # í˜•ì‹: code --remote ssh-remote+user@ip /path
    remote_arg = f"ssh-remote+{user}@{ip}"
    cmd = ['code', '--remote', remote_arg, path]

    try:
        # ì„œë¸Œí”„ë¡œì„¸ìŠ¤ë¡œ VS Code ì‹¤í–‰ (Non-blocking)
        subprocess.Popen(cmd)
        return jsonify({'status': 'success', 'message': f'Opening {path} on {ip}'})
    except Exception as e:
        return jsonify({'status': 'error', 'message': str(e)}), 500

if __name__ == '__main__':
    # ë¡œì»¬ì—ì„œë§Œ ì ‘ê·¼ (ë³´ì•ˆ)
    app.run(host='0.0.0.0', port=5000, debug=True)
"""

# 3. HTML Template (ê²€ìƒ‰ ê¸°ëŠ¥ í¬í•¨)
html_code = r"""<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Ubuntu Folder Indexer</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input[type="text"] { width: 100%; padding: 10px; margin-bottom: 20px; box-sizing: border-box; font-size: 16px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #333; color: white; cursor: pointer; }
        tr:hover { background-color: #f1f1f1; }
        .btn-open { background-color: #007acc; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; }
        .btn-open:hover { background-color: #005f9e; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ“‚ Network Folder Indexer</h2>
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ (IP, ê³„ì •, í´ë”ëª…, ì ‘ë‘ì–´ ë“±)..." onkeyup="filterTable()">
        
        <table id="folderTable">
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>Account</th>
                    <th>Folder Name (Prefix_)</th>
                    <th>Full Path</th>
                    <th>Last Updated</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for folder in folders %}
                <tr>
                    <td>{{ folder.IPAddress }}</td>
                    <td>{{ folder.Account }}</td>
                    <td>{{ folder.DisplayName }}</td>
                    <td>{{ folder.FullPath }}</td>
                    <td>{{ folder.LastUpdated }}</td>
                    <td>
                        <button class="btn-open" onclick="openVsCode('{{ folder.IPAddress }}', '{{ folder.Account }}', '{{ folder.FullPath }}')">
                            Open VS Code
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        function filterTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("folderTable");
            tr = table.getElementsByTagName("tr");

            for (i = 1; i < tr.length; i++) {
                var display = false;
                // ëª¨ë“  ì»¬ëŸ¼ ê²€ìƒ‰
                for(var j=0; j<5; j++) {
                    td = tr[i].getElementsByTagName("td")[j];
                    if (td) {
                        txtValue = td.textContent || td.innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            display = true;
                            break;
                        }
                    }
                }
                tr[i].style.display = display ? "" : "none";
            }
        }

        function openVsCode(ip, account, path) {
            fetch('/open_vscode', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ip: ip, account: account, path: path })
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    console.log(data.message);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
"""

# 4. Requirements.txt
req_code = """flask
pymssql
"""

# --- íŒŒì¼ ìƒì„± ë¡œì§ ---

def create_project():
    base_dir = "NetworkFolderIndexer"
    templates_dir = os.path.join(base_dir, "templates")

    if not os.path.exists(templates_dir):
        os.makedirs(templates_dir)

    # Write scanner.py
    with open(os.path.join(base_dir, "scanner.py"), "w", encoding="utf-8") as f:
        f.write(scanner_code)

    # Write app.py
    with open(os.path.join(base_dir, "app.py"), "w", encoding="utf-8") as f:
        f.write(app_code)

    # Write templates/index.html
    with open(os.path.join(templates_dir, "index.html"), "w", encoding="utf-8") as f:
        f.write(html_code)

    # Write requirements.txt
    with open(os.path.join(base_dir, "requirements.txt"), "w", encoding="utf-8") as f:
        f.write(req_code)

    print(f"âœ… í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ: ./{base_dir}")
    print(f"ğŸ‘‰ 1. {base_dir}/scanner.py ë° app.py ë‚´ë¶€ì˜ DB ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.")
    print(f"ğŸ‘‰ 2. {base_dir}/scanner.py ë‚´ë¶€ì˜ TARGET_PATHS(ìŠ¤ìº” ê²½ë¡œ) ë° PREFIX(ì ‘ë‘ì–´)ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”.")

if __name__ == "__main__":
    create_project()
3. ì‚¬ìš© ë°©ë²•
A. ê° ìš°ë¶„íˆ¬ PCì—ì„œ (ë°ì´í„° ìˆ˜ì§‘)
ìƒì„±ëœ scanner.pyë¥¼ ê° ìš°ë¶„íˆ¬ PCë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.

íŒŒì¼ ë‚´ DB_HOST, TARGET_PATHS, PREFIX ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

ë°±ê·¸ë¼ìš´ë“œ ì¼íšŒì„± ì‹¤í–‰ (í„°ë¯¸ë„): ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ í„°ë¯¸ë„ì„ ë‹«ì•„ë„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ë˜ì–´ DB ì—…ë°ì´íŠ¸ í›„ ì¢…ë£Œë©ë‹ˆë‹¤.

Bash

nohup python3 scanner.py > scanner.log 2>&1 &
B. ë©”ì¸ ìš°ë¶„íˆ¬ PCì—ì„œ (ì›¹ ë·°ì–´ ì‹¤í–‰)
app.pyê°€ ìˆëŠ” í´ë”ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

Bash

pip install -r requirements.txt
ì›¹ ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

Bash

python3 app.py
ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:5000ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤.

í…Œì´ë¸”ì—ì„œ ì›í•˜ëŠ” í–‰ì„ ê²€ìƒ‰í•˜ê³  "Open VS Code" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, í˜„ì¬ PCì˜ VS Codeê°€ ì‹¤í–‰ë˜ë©° í•´ë‹¹ ì›ê²© ê²½ë¡œë¥¼ ì—½ë‹ˆë‹¤.

ìš”ì•½
Scanner: ì§€ì •ëœ ê²½ë¡œ ë°”ë¡œ ì•„ë˜ í´ë”ë¥¼ ì ‘ë‘ì–´_í´ë”ëª…ìœ¼ë¡œ ê°€ê³µí•˜ì—¬ IP, ê³„ì •, ì‹œê°„ê³¼ í•¨ê»˜ DBì— ì €ì¥ (Duplicate Key ë°©ì§€ ë¡œì§ í¬í•¨).

Web App: 5ê°œ ì»¬ëŸ¼(IP, ê³„ì •, ë³€í™˜ëœ ì´ë¦„, ì „ì²´ê²½ë¡œ, ì‹œê°„)ì„ ë³´ì—¬ì£¼ê³  ì‹¤ì‹œê°„ ê²€ìƒ‰(í•„í„°ë§) ì œê³µ. í´ë¦­ ì‹œ code --remote ëª…ë ¹ì–´ë¡œ ì¦‰ì‹œ ì—°ê²°.