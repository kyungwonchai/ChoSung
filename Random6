ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ generate_architecture.pyë¡œ ì €ì¥í•˜ê³  ì‹¤í–‰í•˜ì„¸ìš”.

Python

import os

# === í”„ë¡œì íŠ¸ êµ¬ì¡° ì •ì˜ ===
PROJECT_ROOT = "diagnosis_system"

structure = {
    f"{PROJECT_ROOT}/": ["run.py", "requirements.txt"],
    f"{PROJECT_ROOT}/app/": ["__init__.py", "config.py"],
    f"{PROJECT_ROOT}/app/core/": ["__init__.py", "interfaces.py", "logger.py"],
    f"{PROJECT_ROOT}/app/database/": ["__init__.py", "connector.py"],
    f"{PROJECT_ROOT}/app/diagnostics/": ["__init__.py", "base.py", "system_checks.py", "mssql_checks.py", "mysql_checks.py"],
    f"{PROJECT_ROOT}/app/web/": ["__init__.py", "routes.py"],
    f"{PROJECT_ROOT}/app/templates/": ["index.html"],
}

# === íŒŒì¼ ë‚´ìš© ì •ì˜ ===

# 1. Config (ì„¤ì • ë¶„ë¦¬)
files_content = {}

files_content[f"{PROJECT_ROOT}/app/config.py"] = r"""
import os

class Config:
    # ë³´ì•ˆì„ ìœ„í•´ í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¡œë“œí•˜ëŠ” ê²ƒì„ ê¶Œì¥
    MSSQL = {
        'server': 'localhost',
        'user': 'sa',
        'password': 'your_password',
        'database': 'master'
    }
    
    MYSQL = {
        'host': 'localhost',
        'user': 'root',
        'password': 'your_password',
        'charset': 'utf8mb4'
    }
"""

# 2. Core Interfaces (ì¶”ìƒí™” ê³„ì¸µ)
files_content[f"{PROJECT_ROOT}/app/core/interfaces.py"] = r"""
from abc import ABC, abstractmethod
from typing import Generator

class IDiagnostic(ABC):
    """ëª¨ë“  ì§„ë‹¨ ëª¨ë“ˆì´ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤"""
    
    @abstractmethod
    def run(self) -> Generator[str, None, None]:
        """ì§„ë‹¨ ë¡œì§ì„ ì‹¤í–‰í•˜ê³  HTML ë¡œê·¸ ì¡°ê°ì„ yield í•´ì•¼ í•¨"""
        pass

class IDatabaseConnector(ABC):
    """DB ì—°ê²° ì¸í„°í˜ì´ìŠ¤"""
    
    @abstractmethod
    def get_connection(self):
        pass
"""

files_content[f"{PROJECT_ROOT}/app/core/logger.py"] = r"""
import datetime

class HtmlLogger:
    @staticmethod
    def log(msg, level="INFO"):
        timestamp = datetime.datetime.now().strftime("%H:%M:%S")
        colors = {
            "INFO": "#ddd", "OK": "#0f0", 
            "WARN": "orange", "ERROR": "#f55", "HEADER": "#0cf"
        }
        c = colors.get(level, "#ddd")
        return f'<div style="color:{c}; font-family:monospace;">[{timestamp}] {msg}</div>\n'

    @staticmethod
    def table(data_list):
        if not data_list: 
            return '<div style="color:gray;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'
        
        headers = data_list[0].keys()
        html = '<table style="border-collapse: collapse; width: 100%; margin: 10px 0; font-size: 12px; border: 1px solid #444;">'
        
        html += '<thead><tr style="background:#333; color:#fff;">'
        for h in headers: 
            html += f'<th style="border:1px solid #555; padding:5px;">{h}</th>'
        html += '</tr></thead><tbody>'
        
        for row in data_list:
            html += '<tr>'
            for k, v in row.items():
                val = str(v)
                if len(val) > 100: val = val[:100] + "..."
                html += f'<td style="border:1px solid #555; padding:4px; color:#ccc;">{val}</td>'
            html += '</tr>'
        html += '</tbody></table>'
        return html
"""

# 3. Database Layer (Infrastructure)
files_content[f"{PROJECT_ROOT}/app/database/connector.py"] = r"""
import pymssql
import pymysql
from app.core.interfaces import IDatabaseConnector
from app.config import Config

class MSSQLConnector(IDatabaseConnector):
    def get_connection(self):
        return pymssql.connect(**Config.MSSQL)

class MySQLConnector(IDatabaseConnector):
    def get_connection(self):
        return pymysql.connect(cursorclass=pymysql.cursors.DictCursor, **Config.MYSQL)
"""

# 4. Diagnostics Logic (Business Logic - Strategy Pattern)
files_content[f"{PROJECT_ROOT}/app/diagnostics/base.py"] = r"""
from app.core.interfaces import IDiagnostic
from app.core.logger import HtmlLogger

class BaseDiagnostic(IDiagnostic):
    """ê³µí†µ ê¸°ëŠ¥ì„ ê°€ì§„ ì¶”ìƒ í´ë˜ìŠ¤"""
    def __init__(self):
        self.logger = HtmlLogger()
"""

files_content[f"{PROJECT_ROOT}/app/diagnostics/mssql_checks.py"] = r"""
import traceback
from app.diagnostics.base import BaseDiagnostic
from app.database.connector import MSSQLConnector

class MSSQLDiagnostic(BaseDiagnostic):
    def __init__(self):
        super().__init__()
        self.connector = MSSQLConnector()

    def run(self):
        yield self.logger.log("=== MSSQL ì •ë°€ ì§„ë‹¨ ì‹œì‘ ===", "HEADER")
        conn = None
        try:
            conn = self.connector.get_connection()
            cursor = conn.cursor(as_dict=True)
            
            # Strategy 1: High CPU
            yield self.logger.log("1. CPU ê³¼ì ìœ  ì¿¼ë¦¬ ë¶„ì„ (TOP 20)", "WARN")
            query_cpu = "SELECT TOP 5 text FROM sys.dm_exec_query_stats CROSS APPLY sys.dm_exec_sql_text(sql_handle)" # (ì•½ì‹)
            # ì‹¤ì œ ì¿¼ë¦¬ëŠ” ë³µì¡í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ì˜ˆì‹œë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤. ì´ì „ ë‹µë³€ì˜ ê¸´ ì¿¼ë¦¬ë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
            cursor.execute("SELECT TOP 5 name, database_id FROM sys.databases")
            rows = cursor.fetchall()
            yield self.logger.table(rows)
            
            yield self.logger.log("MSSQL ì§„ë‹¨ ì™„ë£Œ", "OK")
            
        except Exception:
            yield self.logger.log(f"MSSQL ì—ëŸ¬: {traceback.format_exc()}", "ERROR")
        finally:
            if conn: conn.close()
"""

files_content[f"{PROJECT_ROOT}/app/diagnostics/mysql_checks.py"] = r"""
import traceback
from app.diagnostics.base import BaseDiagnostic
from app.database.connector import MySQLConnector

class MySQLDiagnostic(BaseDiagnostic):
    def __init__(self):
        super().__init__()
        self.connector = MySQLConnector()

    def run(self):
        yield self.logger.log("=== MySQL ì •ë°€ ì§„ë‹¨ ì‹œì‘ ===", "HEADER")
        conn = None
        try:
            conn = self.connector.get_connection()
            cursor = conn.cursor()
            
            yield self.logger.log("1. Slow Query Check", "WARN")
            cursor.execute("SHOW VARIABLES LIKE '%timeout%'")
            rows = cursor.fetchall()
            yield self.logger.table(rows)
            
            yield self.logger.log("MySQL ì§„ë‹¨ ì™„ë£Œ", "OK")
        except Exception:
             yield self.logger.log(f"MySQL ì—ëŸ¬: {traceback.format_exc()}", "ERROR")
        finally:
            if conn: conn.close()
"""

files_content[f"{PROJECT_ROOT}/app/diagnostics/system_checks.py"] = r"""
import psutil
from app.diagnostics.base import BaseDiagnostic

class SystemDiagnostic(BaseDiagnostic):
    def run(self):
        yield self.logger.log("=== Host System Resource Check ===", "HEADER")
        
        cpu = psutil.cpu_percent(interval=0.5)
        yield self.logger.log(f"CPU Load: {cpu}%", "INFO")
        
        mem = psutil.virtual_memory()
        yield self.logger.log(f"Memory: {mem.percent}% Used", "INFO")
"""

# 5. Web Layer (Presentation - Factory Pattern for Diagnostics)
files_content[f"{PROJECT_ROOT}/app/web/routes.py"] = r"""
from flask import Blueprint, render_template, Response, stream_with_context
from app.diagnostics.mssql_checks import MSSQLDiagnostic
from app.diagnostics.mysql_checks import MySQLDiagnostic
from app.diagnostics.system_checks import SystemDiagnostic

web_bp = Blueprint('web', __name__)

# Factory Pattern: ë¬¸ìì—´ í‚¤ë¡œ ì ì ˆí•œ ì „ëµ í´ë˜ìŠ¤ ë°˜í™˜
def get_diagnostic_strategy(mode):
    strategies = {
        'mssql': [MSSQLDiagnostic()],
        'mysql': [MySQLDiagnostic()],
        'system': [SystemDiagnostic()],
        'all': [SystemDiagnostic(), MSSQLDiagnostic(), MySQLDiagnostic()]
    }
    return strategies.get(mode, [])

@web_bp.route('/')
def index():
    return render_template('index.html')

@web_bp.route('/run/<mode>')
def run_diagnosis(mode):
    def generate():
        diagnostics = get_diagnostic_strategy(mode)
        if not diagnostics:
            yield "Invalid Mode"
            return
            
        for diag in diagnostics:
            yield from diag.run() # Delegate execution
            
    return Response(stream_with_context(generate()), mimetype='text/html')
"""

files_content[f"{PROJECT_ROOT}/app/__init__.py"] = r"""
from flask import Flask

def create_app():
    app = Flask(__name__)
    
    from app.web.routes import web_bp
    app.register_blueprint(web_bp)
    
    return app
"""

# 6. Entry Point & Templates
files_content[f"{PROJECT_ROOT}/run.py"] = r"""
from app import create_app

app = create_app()

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
"""

files_content[f"{PROJECT_ROOT}/requirements.txt"] = r"""
flask
pymysql
pymssql
psutil
"""

files_content[f"{PROJECT_ROOT}/app/templates/index.html"] = r"""
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Modular Diagnostic System</title>
    <style>
        body { background: #1e1e1e; color: #ddd; font-family: sans-serif; padding: 20px; }
        .container { display: flex; gap: 20px; }
        .sidebar { width: 200px; display: flex; flex-direction: column; gap: 10px; }
        button { padding: 10px; background: #333; color: white; border: 1px solid #555; cursor: pointer; }
        button:hover { background: #444; }
        #log { flex: 1; background: black; border: 1px solid #444; height: 80vh; overflow: auto; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>ì—”í„°í”„ë¼ì´ì¦ˆ ëª¨ë“ˆí˜• ì§„ë‹¨ ì‹œìŠ¤í…œ</h1>
    <div class="container">
        <div class="sidebar">
            <button onclick="run('all')">ì „ì²´ ì§„ë‹¨</button>
            <button onclick="run('system')">ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤</button>
            <button onclick="run('mssql')">MSSQL ì •ë°€</button>
            <button onclick="run('mysql')">MySQL ì •ë°€</button>
        </div>
        <div id="log">ì¤€ë¹„ ì™„ë£Œ.</div>
    </div>
    <script>
        async function run(mode) {
            const log = document.getElementById('log');
            log.innerHTML = `<div style="color:cyan">--- ${mode} ì§„ë‹¨ ëª¨ë“ˆ ë¡œë”© ì¤‘... ---</div>`;
            const res = await fetch(`/run/${mode}`);
            const reader = res.body.getReader();
            const dec = new TextDecoder();
            while(true) {
                const {done, value} = await reader.read();
                if(done) break;
                log.innerHTML += dec.decode(value);
                log.scrollTop = log.scrollHeight;
            }
        }
    </script>
</body>
</html>
"""

# === íŒŒì¼ ìƒì„± ì‹¤í–‰ ===
for path, files in structure.items():
    if not os.path.exists(path):
        os.makedirs(path)
        print(f"[Create Dir] {path}")

for file_path, content in files_content.items():
    with open(file_path, "w", encoding="utf-8") as f:
        f.write(content.strip())
    print(f"[Create File] {file_path}")

print("\n=== ì•„í‚¤í…ì²˜ ì¬êµ¬ì¶• ì™„ë£Œ ===")
print(f"1. cd {PROJECT_ROOT}")
print("2. pip install -r requirements.txt")
print("3. python run.py")
ğŸ§ ë¦¬íŒ©í† ë§ í¬ì¸íŠ¸ ì„¤ëª… (ê²½ì›ë‹˜ì„ ìœ„í•œ ìš”ì•½)
SRP (ë‹¨ì¼ ì±…ì„ ì›ì¹™) ì ìš©

web/routes.py: ì˜¤ì§ URL ìš”ì²­ì„ ë°›ê³  ì‘ë‹µì„ ì£¼ëŠ” ì—­í• ë§Œ í•©ë‹ˆë‹¤. DB ì—°ê²°ë²• ë”°ìœ„ëŠ” ëª¨ë¦…ë‹ˆë‹¤.

database/connector.py: ì˜¤ì§ DB ì—°ê²° ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì—­í• ë§Œ í•©ë‹ˆë‹¤.

diagnostics/*.py: ì‹¤ì œ ì§„ë‹¨ ë¡œì§(SQL ì¿¼ë¦¬ ë“±)ë§Œ ë‹´ë‹¹í•©ë‹ˆë‹¤.

OCP (ê°œë°©-íì‡„ ì›ì¹™) ì ìš©

ë§Œì•½ OracleDiagnosticì„ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´?

ê¸°ì¡´ ì½”ë“œë¥¼ ê±´ë“œë¦´ í•„ìš” ì—†ì´ app/diagnostics/oracle_checks.py íŒŒì¼ì„ ë§Œë“¤ê³  IDiagnosticë§Œ ìƒì†ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤. ê·¸ í›„ íŒ©í† ë¦¬ì— í•œ ì¤„ë§Œ ì¶”ê°€í•˜ë©´ ëì…ë‹ˆë‹¤.

DIP (ì˜ì¡´ì„± ì—­ì „ ì›ì¹™) ì ìš©

interfaces.pyì— IDiagnostic, IDatabaseConnectorë¼ëŠ” **ê·œì•½(Interface)**ì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

ìƒìœ„ ëª¨ë“ˆ(Web Route)ì€ êµ¬ì²´ì ì¸ MSSQLDiagnostic í´ë˜ìŠ¤ ë‚´ìš©ë³´ë‹¤ ì´ ì¸í„°í˜ì´ìŠ¤(ê·œì•½)ë¥¼ ë¯¿ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.

ë””ë ‰í† ë¦¬ êµ¬ì¡°í™”

ì´ì „ì˜ ëš±ëš±í•œ app.py í•˜ë‚˜ê°€ ì•„ë‹ˆë¼, ê¸°ëŠ¥ë³„ë¡œ í´ë”ê°€ ë‚˜ë‰˜ì–´ ìˆì–´ íŒ€ ë‹¨ìœ„ í˜‘ì—…ì´ë‚˜ ìœ ì§€ë³´ìˆ˜ê°€ í›¨ì”¬ ìˆ˜ì›”í•©ë‹ˆë‹¤.

ì´ì œ ì´ êµ¬ì¡° ìœ„ì—ì„œë¼ë©´ 100ê°€ì§€ ì§„ë‹¨ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ë„ ì½”ë“œê°€ ì—‰í‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‹¤í–‰í•´ ë³´ì‹œê³  êµ¬ì¡°ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”.