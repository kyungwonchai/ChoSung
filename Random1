물을 가까이 가져갔을 때도 잘 인식되지 않거나 초점 조정이 느린 문제는 주로 다음과 같은 이유로 발생할 수 있습니다:

카메라 하드웨어의 한계: 스마트폰 카메라의 경우 초점 조정 능력이 제한적일 수 있으며, 특히 저가형 장치에서는 가까운 거리에 대한 초점 조정이 어렵습니다.
초점 조정 간격: 초점 조정이 자주 일어나지 않으면, 초점이 맞지 않게 되어 인식 속도가 느려질 수 있습니다.
이 문제를 개선하기 위해 몇 가지 조정을 할 수 있습니다.

1. 초점 조정 간격 단축:
초점 조정 간격을 더 짧게 설정하여 초점이 더욱 빠르게 조정되도록 할 수 있습니다.

2. 수동으로 초점 조정을 반복:
초점 조정을 더 빈번하게 하여 가까운 거리에서의 인식 성능을 개선합니다.

최종 수정된 MainActivity.kt
kotlin
코드 복사
package com.dxmxsmd.mobilechecker

import android.Manifest
import android.content.pm.PackageManager
import android.os.Bundle
import android.os.Handler
import android.os.Looper
import android.widget.TextView
import androidx.activity.ComponentActivity
import androidx.activity.result.contract.ActivityResultContracts
import androidx.core.content.ContextCompat
import com.google.zxing.BarcodeFormat
import com.google.zxing.ResultPoint
import com.journeyapps.barcodescanner.CameraSettings
import com.journeyapps.barcodescanner.DecoratedBarcodeView
import com.journeyapps.barcodescanner.BarcodeCallback
import com.journeyapps.barcodescanner.BarcodeResult
import com.journeyapps.barcodescanner.DefaultDecoderFactory

class MainActivity : ComponentActivity() {

    private lateinit var barcodeView: DecoratedBarcodeView
    private val focusHandler = Handler(Looper.getMainLooper())
    private val focusInterval: Long = 50 // 초점 조정 간격 (밀리초)

    private val requestPermissionLauncher =
        registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted: Boolean ->
            if (isGranted) {
                setupBarcodeView()
            } else {
                // 권한이 거부된 경우 처리
            }
        }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
            != PackageManager.PERMISSION_GRANTED) {
            requestPermissionLauncher.launch(Manifest.permission.CAMERA)
        } else {
            setupBarcodeView()
        }
    }

    private fun setupBarcodeView() {
        barcodeView = findViewById(R.id.camera_preview)

        // 카메라 설정: 자동 초점 및 프리뷰 활성화
        val cameraSettings = CameraSettings().apply {
            isAutoFocusEnabled = true
            focusMode = CameraSettings.FocusMode.CONTINUOUS // 연속 초점 모드 사용
        }
        barcodeView.barcodeView.cameraSettings = cameraSettings

        // 실시간 초점 조정(가능한 경우)
        focusHandler.postDelayed(object : Runnable {
            override fun run() {
                barcodeView.barcodeView.cameraInstance?.autoFocus() // 가능한 경우 수동으로 초점 재조정
                focusHandler.postDelayed(this, focusInterval)
            }
        }, focusInterval)

        // QR 코드와 바코드를 모두 인식할 수 있도록 설정
        val formats = listOf(BarcodeFormat.QR_CODE, BarcodeFormat.CODE_39, BarcodeFormat.CODE_128)
        barcodeView.barcodeView.decoderFactory = DefaultDecoderFactory(formats)

        barcodeView.decodeContinuous(object : BarcodeCallback {
            override fun barcodeResult(result: BarcodeResult?) {
                result?.let {
                    findViewById<TextView>(R.id.text_view_result).text =
                        "Scanned: ${it.text} (${it.barcodeFormat})"
                }
            }

            override fun possibleResultPoints(resultPoints: List<ResultPoint>) {
                // Optional: handle potential result points here
            }
        })
    }

    override fun onResume() {
        super.onResume()
        barcodeView.resume()
    }

    override fun onPause() {
        super.onPause()
        barcodeView.pause()
        focusHandler.removeCallbacksAndMessages(null)  // 초점 조정 중지
    }
}
주요 변경 사항:
초점 조정 간격을 50밀리초로 단축: 초점 조정이 더 자주 일어나도록 간격을 줄였습니다. 이는 하드웨어의 성능에 따라 초점 조정 속도를 더욱 빠르게 만들어줍니다.

카메라 하드웨어 제약을 고려: 저가형 카메라 모듈에서는 가까운 거리에서 초점이 잘 맞지 않는 경우가 있습니다. 이 경우, 최적의 거리에서 인식될 수 있도록 조정이 필요합니다.

추가 사항:
카메라와 QR 코드 간 거리 조정: 카메라 모듈에 따라 일정 거리를 유지해야만 초점이 맞을 수 있습니다. 너무 가까운 거리에서는 초점이 제대로 맞지 않아 인식이 어려울 수 있습니다.
환경 조명: 조명이 어두운 경우 초점 조정이 더욱 어려워질 수 있으니, 적절한 조명이 있는 환경에서 테스트를 권장합니다.
이 코드로 카메라가 더 자주 초점을 조정하며, 가까운 거리에서도 초점을 빠르게 맞출 수 있도록 개선하였습니다