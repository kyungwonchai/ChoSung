성했던 Flask 코드는 아래와 같습니다:

python

from flask import Flask, request, send_file
from flask_cors import CORS
from werkzeug.utils import secure_filename
import pymssql
import os

app = Flask(__name__)
CORS(app)

def allowed_file(filename):
    ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

@app.route('/upload', methods=['POST'])
def upload_file():
    password = request.form['password']
    imageTitle = request.form['imageTitle']
    image = request.files['image']

    if image and allowed_file(image.filename):
        filename = secure_filename(image.filename)
        image.save(os.path.join("/image_dir", filename))

        # Connect to your database
        conn = pymssql.connect(server='localhost', port='1433', user='your_username', password='your_password', database='your_database')
        cursor = conn.cursor()

        # Execute stored procedure
        cursor.execute("EXEC InsertImage @password=%s, @imageTitle=%s, @imagePath=%s", (password, imageTitle, "/image_dir/" + filename))

        # Check if operation was successful
        if cursor.rowcount == 0:
            return '', 404

        conn.commit()
        cursor.close()
        conn.close()

    return '', 204

@app.route('/images', methods=['GET'])
def get_images():
    password = request.args.get('password')

    # Connect to your database
    conn = pymssql.connect(server='localhost', port='1433', user='your_username', password='your_password', database='your_database')
    cursor = conn.cursor()

    # Execute stored procedure
    cursor.execute("EXEC GetImages @password=%s", (password,))

    images = [dict((cursor.description[i][0], value) for i, value in enumerate(row)) for row in cursor.fetchall()]

    cursor.close()
    conn.close()

    return {'images': images}

@app.route('/image/<imageTitle>', methods=['GET'])
def get_image(imageTitle):
    # Connect to your database
    conn = pymssql.connect(server='localhost', port='1433', user='your_username', password='your_password', database='your_database')
    cursor = conn.cursor()

    # Execute stored procedure
    cursor.execute("EXEC GetImagePath @imageTitle=%s", (imageTitle,))

    row = cursor.fetchone()

    cursor.close()
    conn.close()

    if row:
        return send_file(row[0], mimetype='image/png')

    return '', 404

이 코드는 Flask를 이용해 웹 애플리케이션을 구축하였으며, 이미지 파일을 업로드하고, 이미지를 조회하며, 특정 이미지를 불러오는 기능을 수행합니다. pymssql 패키지를 이용해 MS SQL Server와의 연동을 구현하였습니다. 이 때 비밀번호와 이미지 파일, 이미지 제목을 함께 업로드하고, 해당 비밀번호에 해당하는 이미지 목록을 조회하는 기능을 구현하였습니다. 각 요청은 서로 다른 경로(/upload, /images, /image/<imageTitle>)로 구분하였습니다. 이미지 파일은 서버의 지정된 디렉토리(/image_dir)에 저장됩니다.