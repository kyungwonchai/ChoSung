래는 요청한 기능을 수행하는 VBA 매크로입니다. 이 코드는 A와 B 엑셀 파일을 열어 필요한 데이터를 처리하고 복사하는 작업을 수행합니다.

A 파일에서 S1 시트의 데이터를 읽습니다.
특정 조건을 만족하는 데이터를 찾고 y1, y2로 정의합니다.
B 파일의 SH1 시트에 데이터를 복사합니다.
VBA 매크로 코드
vba
코드 복사
Sub ProcessExcelFiles()
    Dim wbA As Workbook, wbB As Workbook
    Dim wsS1 As Worksheet, wsB As Worksheet
    Dim rng As Range, cell As Range
    Dim CH1 As String, SH1 As String
    Dim y1 As Range, y2 As Range
    Dim z1 As Range, z2 As Range
    Dim targetRow As Long
    Dim wsTarget As Worksheet

    ' A 파일 열기
    Set wbA = Workbooks.Open("A.xlsx") ' A 파일 경로 입력
    Set wsS1 = wbA.Sheets("사내 외주") ' S1 시트 이름 정확히 입력

    ' 150행 이후 C열에서 조건 만족하는 데이터 찾기
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If InStr(cell.Value, "W") > 0 And IsNumeric(Mid(cell.Value, 2, 2)) And InStr(cell.Value, "일별 생산계획") > 0 Then
            CH1 = Left(cell.Value, 3) ' W55 추출
            SH1 = Mid(CH1, 2, 2) & "주차" ' 주차 생성
            Exit For
        End If
    Next cell

    If CH1 = "" Or SH1 = "" Then
        MsgBox "CH1 또는 SH1 값을 찾을 수 없습니다."
        Exit Sub
    End If

    ' 병합된 D열 데이터와 E~K열 복사
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If cell.MergeArea.Columns.Count > 1 Then
            Dim mergeRow As Long
            mergeRow = cell.Row
            If InStr(wsS1.Cells(mergeRow, "E").Value, "SM-") > 0 Then
                ' y1, y2 정의
                Set y1 = wsS1.Cells(mergeRow, "E")
                Set y2 = wsS1.Range(wsS1.Cells(mergeRow, "F"), wsS1.Cells(mergeRow, "K"))
                Exit For
            End If
        End If
    Next cell

    If y1 Is Nothing Or y2 Is Nothing Then
        MsgBox "y1 또는 y2 값을 찾을 수 없습니다."
        Exit Sub
    End If

    ' B 파일 열기
    Set wbB = Workbooks.Open("B.xlsx") ' B 파일 경로 입력
    For Each wsB In wbB.Worksheets
        If InStr(wsB.Name, SH1) > 0 Then
            Set wsTarget = wsB
            Exit For
        End If
    Next wsB

    If wsTarget Is Nothing Then
        MsgBox "SH1 시트를 찾을 수 없습니다."
        Exit Sub
    End If

    ' B 파일의 D, F~K 열에 데이터 복사
    targetRow = wsTarget.Cells(wsTarget.Rows.Count, "D").End(xlUp).Row + 1
    wsTarget.Cells(targetRow, "D").Value = y1.Value ' z1에 복사
    wsTarget.Range(wsTarget.Cells(targetRow, "F"), wsTarget.Cells(targetRow, "K")).Value = y2.Value ' z2에 복사

    ' 완료 메시지
    MsgBox "데이터 복사가 완료되었습니다."

    ' 파일 저장 및 닫기
    wbA.Close SaveChanges:=False
    wbB.Save
    wbB.Close SaveChanges:=True
End Sub
매크로 사용법
VBA 편집기 열기: Alt + F11 키를 눌러 VBA 편집기를 엽니다.
모듈 추가: 삽입 > 모듈을 선택한 후 위 코드를 붙여넣습니다.
파일 경로 수정: 코드에서 Workbooks.Open("A.xlsx") 및 Workbooks.Open("B.xlsx") 부분에 A와 B 파일의 실제 경로를 입력합니다.
매크로 실행: F5 키를 눌러 매크로를 실행합니다.
주의 사항
A와 B 파일의 정확한 경로와 파일명을 지정해야 합니다.
S1 시트와 B 파일의 SH1 이름이 일치해야 합니다.