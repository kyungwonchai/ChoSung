using System;
using System.Collections.Generic;
using System.Threading.Tasks;

/// <summary>
/// TaskQueue는 작업을 순차적으로 실행하고, 작업이 완료되면 다음 작업을 실행하는 대기열입니다.
/// </summary>
public class TaskQueue
{
    private Queue<Func<Task>> _taskQueue = new Queue<Func<Task>>();
    private bool _isRunning = false;

    /// <summary>
    /// 작업을 대기열에 추가합니다. 작업이 실행 중이면 대기열에 쌓이고, 실행 중이 아니면 즉시 실행됩니다.
    /// </summary>
    public void EnqueueTask(Func<Task> task)
    {
        _taskQueue.Enqueue(task);

        if (!_isRunning)
        {
            RunNextTask();
        }
    }

    /// <summary>
    /// 대기열에서 작업을 하나씩 실행합니다.
    /// </summary>
    private async void RunNextTask()
    {
        if (_taskQueue.Count == 0)
        {
            _isRunning = false;
            return;
        }

        _isRunning = true;

        var task = _taskQueue.Dequeue();
        await task(); // 큐에서 작업을 꺼내어 실행

        _isRunning = false;
        RunNextTask(); // 다음 작업 실행
    }
}
