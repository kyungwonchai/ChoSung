using System;
using System.Runtime.InteropServices;
using System.Windows.Forms;

public class MainForm : Form
{
    [DllImport("user32.dll")]
    static extern IntPtr GetForegroundWindow();

    [DllImport("user32.dll")]
    static extern uint GetWindowThreadProcessId(IntPtr hWnd, IntPtr ProcessId);

    [DllImport("user32.dll")]
    static extern IntPtr GetKeyboardLayout(uint idThread);

    Label lblLanguage;

    public MainForm()
    {
        lblLanguage = new Label();
        lblLanguage.Location = new System.Drawing.Point(10, 10);
        lblLanguage.Text = "현재 언어: ";
        Controls.Add(lblLanguage);

        Timer timer = new Timer();
        timer.Interval = 300;
        timer.Tick += Timer_Tick;
        timer.Start();
    }

    private void Timer_Tick(object sender, EventArgs e)
    {
        IntPtr foregroundWindow = GetForegroundWindow();
        uint threadID = GetWindowThreadProcessId(foregroundWindow, IntPtr.Zero);
        IntPtr keyboardLayout = GetKeyboardLayout(threadID);
        int layout = (int)keyboardLayout & 0xFFFF;

        if (layout == 0x0412) // 0x0412는 한국어를 의미
        {
            lblLanguage.Text = "현재 언어: 한글";
        }
        else
        {
            lblLanguage.Text = "현재 언어: 영어";
        }
    }
}
