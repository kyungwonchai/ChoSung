는 수정된 VBA 코드로, 두 가지 작업을 수행합니다.

Summary 시트에 전체 데이터를 날짜와 Shift1별로 집계한 차트 하나를 생성합니다.
각 Line1 값에 대해 개별 시트를 만들고, 해당 시트에서 날짜별 day와 night 횟수를 포함하는 차트를 가로로 배치합니다.
이 코드로 각 Line1에 대해 개별 시트가 생성되며, 각 시트에는 날짜별 day와 night 횟수를 가로로 나열하는 방식으로 차트가 배치됩니다.

VBA 코드
vba
코드 복사
Sub CreateSummaryAndLineCharts()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim lineData As Object
    Dim i As Long
    Dim dateVal As String, shiftVal As String, lineVal As String
    Dim rowCounter As Long
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    ' Line1별로 날짜와 Shift1별 개수를 저장할 딕셔너리 생성
    Set lineData = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            lineVal = ws.Cells(i, 1).Value
            
            ' Line1, Date1, Shift1 기준으로 개수 누적
            If Not lineData.exists(lineVal) Then
                Set lineData(lineVal) = CreateObject("Scripting.Dictionary")
            End If
            
            If Not lineData(lineVal).exists(dateVal) Then
                Set lineData(lineVal)(dateVal) = CreateObject("Scripting.Dictionary")
                lineData(lineVal)(dateVal)("day") = 0
                lineData(lineVal)(dateVal)("night") = 0
            End If
            
            lineData(lineVal)(dateVal)(shiftVal) = lineData(lineVal)(dateVal)(shiftVal) + 1
        End If
    Next i
    
    ' Summary 시트에 전체 Date1, Shift1 차트 기록 및 생성
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    rowCounter = 2
    Dim uniqueDates As Object
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    
    ' 날짜별 및 Shift1별 데이터 수집
    For Each lineKey In lineData.keys
        For Each dateKey In lineData(lineKey).keys
            shiftVal = "day"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
            
            shiftVal = "night"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
        Next dateKey
    Next lineKey
    
    ' Summary 시트에 데이터 작성
    For Each key In uniqueDates.keys
        summaryWs.Cells(rowCounter, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(rowCounter, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(rowCounter, 3).Value = uniqueDates(key)   ' Count 값
        rowCounter = rowCounter + 1
    Next key
    
    ' 전체 Date1, Shift1 차트 생성
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "전체 Date1별 Day/Night 횟수"
        .Axes(xlCategory).Title.Caption = "Date1"
        .Axes(xlValue).Title.Caption = "Count"
    End With
    
    ' 각 Line1에 대해 개별 시트를 만들고 차트를 가로로 배치
    Dim dateKey As Variant
    Dim lineIndex As Integer
    
    For Each lineKey In lineData.keys
        ' Line1마다 개별 시트 생성
        Dim lineWs As Worksheet
        Set lineWs = ThisWorkbook.Sheets.Add
        lineWs.Name = "Line_" & lineKey
        
        lineWs.Range("A1").Value = "Date1"
        lineWs.Range("B1").Value = "Day Count"
        lineWs.Range("C1").Value = "Night Count"
        
        rowCounter = 2
        
        ' Line1 시트에 날짜별 데이터 기록
        For Each dateKey In lineData(lineKey).keys
            lineWs.Cells(rowCounter, 1).Value = dateKey
            lineWs.Cells(rowCounter, 2).Value = lineData(lineKey)(dateKey)("day")
            lineWs.Cells(rowCounter, 3).Value = lineData(lineKey)(dateKey)("night")
            rowCounter = rowCounter + 1
        Next dateKey
        
        ' 날짜별로 차트를 가로로 배치
        Set chart = lineWs.ChartObjects.Add(Left:=50 + (lineIndex - 1) * 400, Width:=375, Top:=50, Height:=300)
        With chart.Chart
            .SetSourceData Source:=lineWs.Range("A1:C" & lineWs.Cells(lineWs.Rows.Count, "A").End(xlUp).Row)
            .ChartType = xlColumnClustered
            .HasTitle = True
            .ChartTitle.Text = "Line1: " & lineKey & "의 Date1별 Day/Night 횟수"
            .Axes(xlCategory).Title.Caption = "Date1"
            .Axes(xlValue).Title.Caption = "Count"
        End With
        
        lineIndex = lineIndex + 1
    Next lineKey
End Sub
코드 설명
Summary 시트 생성:

Summary 시트에 전체 Date1 및 Shift1(day와 night)별 집계 데이터를 추가하고, 차트를 생성합니다.
각 Line1별 시트 생성:

각 Line1 값에 대해 새로운 시트를 생성하고, 시트 이름을 Line_과 Line1 값으로 설정합니다.
Line1 시트에 날짜별 day와 night 개수 기록:

각 Line1 시트에 날짜별로 day와 night 횟수를 기록합니다.
차트를 가로로 배치:
