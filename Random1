래는 요청하신 조건을 정확히 이해한 후 작성한 VBA 코드입니다. 딕셔너리 dict를 활용하여, 지정된 조건에 따라 C열 값을 처리하고, 병합된 셀에서 키를 생성한 뒤, 딕셔너리에서 해당 키의 값을 합산하여 출력하는 작업을 수행합니다.

코드
vba
코드 복사
Sub ProcessDictAndFillMergedCells()
    Dim lastRow As Long
    Dim currentRow As Long
    Dim cv1 As String
    Dim b4Color As Long
    Dim dict As Object
    Dim mergeCValue As String
    Dim splitValues() As String
    Dim combinedKey As String
    Dim partKey As String
    Dim totalArr(0 To 5) As Double
    Dim col As Integer
    Dim dictKey As Variant

    ' B4의 배경색 가져오기
    b4Color = 주차2_시트.Range("B4").Interior.Color

    ' 마지막 행 계산 (B열 값이 있는 행까지)
    lastRow = 주차2_시트.Cells(주차2_시트.Rows.Count, "B").End(xlUp).Row

    ' For 루프 시작
    For currentRow = 4 To lastRow
        ' C열 값 가져오기
        Dim cValue As String
        cValue = Trim(주차2_시트.Cells(currentRow, "C").Value)

        ' C열 값이 있으면 cv1에 저장
        If cValue <> "" Then
            cv1 = cValue
        End If

        ' 병합 셀인지 확인
        If 주차2_시트.Cells(currentRow, "C").MergeCells Then
            ' C열 배경색이 B4와 같다면 처리
            If 주차2_시트.Cells(currentRow, "C").Interior.Color = b4Color Then
                ' 병합된 C열 값 가져오기
                mergeCValue = Trim(주차2_시트.Cells(currentRow, "C").Value)

                ' 기호 변환: ) -> "", ( -> "/", + -> "/"
                mergeCValue = Replace(mergeCValue, ")", "")
                mergeCValue = Replace(mergeCValue, "(", "/")
                mergeCValue = Replace(mergeCValue, "+", "/")

                ' /로 Split하여 개별 키 생성
                splitValues = Split(mergeCValue, "/")

                ' Total 배열 초기화
                For col = 0 To 5
                    totalArr(col) = 0
                Next col

                ' Split된 각 값 처리
                For Each partKey In splitValues
                    partKey = Trim(partKey)
                    If partKey <> "" Then
                        ' cv1과 partKey를 결합하여 딕셔너리 키 생성
                        combinedKey = cv1 & "_" & partKey

                        ' 딕셔너리에서 해당 키 확인 및 값 합산
                        If dict.exists(combinedKey) Then
                            For col = 0 To 5
                                totalArr(col) = totalArr(col) + dict(combinedKey)(col)
                            Next col
                        End If
                    End If
                Next partKey

                ' 결과를 F~K 열 다음의 우측 열 (L~Q로 가정)에 출력
                For col = 0 To 5
                    주차2_시트.Cells(currentRow, 12 + col).Value = totalArr(col)
                Next col
            End If
        End If
    Next currentRow

    MsgBox "작업 완료!", vbInformation
End Sub

' 키를 추출하는 함수
Function GetKey(value As String) As String
    Dim i As Long
    Dim char As String
    Dim keyStart As Long
    Dim keyEnd As Long

    keyStart = 0
    keyEnd = InStr(1, value, "/") - 1 ' / 위치 전까지

    If keyEnd > 0 Then
        For i = keyEnd To 1 Step -1
            char = Mid(value, i, 1)
            ' 첫 번째 영어 문자를 발견한 위치
            If char Like "[A-Za-z]" Then
                keyStart = i
                Exit For
            End If
        Next i
    End If

    ' 키 추출
    If keyStart > 0 And keyEnd > 0 Then
        GetKey = Mid(value, keyStart, keyEnd - keyStart + 1)
    Else
        GetKey = "" ' 키가 없으면 빈 문자열 반환
    End If
End Function
코드 설명
C열 값 저장:

C열 값이 있으면 cv1에 저장하고, 값이 없으면 cv1을 유지.
병합 셀 및 조건 확인:

C열이 병합된 셀인지 확인 (MergeCells).
C열 배경색이 B4와 같은 경우만 처리.
키 생성:

)는 빈 값으로, (와 +는 /로 변경.
/로 분리하여 각 값에 대해 cv1과 _를 결합한 키를 생성.
딕셔너리 값 합산:

생성된 키를 딕셔너리에서 확인 (dict.exists).
키가 존재하면 F~K 값을 totalArr에 합산.
결과 출력:

합산된 값을 병합 셀의 F~K 열 다음 열(기본 L~Q)에 출력.
루프 종료:

모든 행을 순회하며 조건을 처리.
사용 방법
딕셔너리 준비:

dict는 이미 값이 설정된 상태여야 합니다.
각 키는 cv1_키 형식이고, 값은 F~K 열의 숫자 배열.
코드 실행:

Excel VBA 편집기에서 코드를 붙여넣고 실행합니다.
결과 확인:
