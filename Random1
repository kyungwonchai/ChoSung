는 수정된 VBA 코드입니다. 이 코드는 다음 요구사항을 반영합니다:

Summary 시트의 전체 차트는 Y축의 제한을 제거합니다.
각 Line1별 개별 차트는 Y축 최대값을 200으로 설정하고, 차트의 크기와 Y 위치는 동일하게 유지하며 X축 간격을 약간 띄워 배치합니다.
VBA 코드
vba
코드 복사
Sub CreateSummaryAndLineDetailsChartsWithCustomYAxis()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim lineDetailsWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim lineData As Object
    Dim i As Long
    Dim dateVal As String, shiftVal As String, lineVal As String
    Dim rowCounter As Long, colCounter As Long
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트(Summary) 및 라인별 시트(LineDetails)가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    Set lineDetailsWs = ThisWorkbook.Sheets("LineDetails")
    If Not lineDetailsWs Is Nothing Then lineDetailsWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    Set lineDetailsWs = ThisWorkbook.Sheets.Add
    lineDetailsWs.Name = "LineDetails"
    
    ' Line1별로 날짜와 Shift1별 개수를 저장할 딕셔너리 생성
    Set lineData = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            lineVal = CStr(ws.Cells(i, 1).Value)  ' 숫자를 문자열로 변환하여 Dictionary 키로 사용
            
            ' Line1, Date1, Shift1 기준으로 개수 누적
            If Not lineData.exists(lineVal) Then
                Set lineData(lineVal) = CreateObject("Scripting.Dictionary")
            End If
            
            If Not lineData(lineVal).exists(dateVal) Then
                Set lineData(lineVal)(dateVal) = CreateObject("Scripting.Dictionary")
                lineData(lineVal)(dateVal)("day") = 0
                lineData(lineVal)(dateVal)("night") = 0
            End If
            
            lineData(lineVal)(dateVal)(shiftVal) = lineData(lineVal)(dateVal)(shiftVal) + 1
        End If
    Next i
    
    ' Summary 시트에 전체 Date1, Shift1 차트 기록 및 생성
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    rowCounter = 2
    Dim uniqueDates As Object
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    
    ' 날짜별 및 Shift1별 데이터 수집
    For Each lineKey In lineData.keys
        For Each dateKey In lineData(lineKey).keys
            shiftVal = "day"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
            
            shiftVal = "night"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
        Next dateKey
    Next lineKey
    
    ' Summary 시트에 데이터 작성
    For Each key In uniqueDates.keys
        summaryWs.Cells(rowCounter, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(rowCounter, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(rowCounter, 3).Value = uniqueDates(key)   ' Count 값
        rowCounter = rowCounter + 1
    Next key
    
    ' 전체 Date1, Shift1 차트 생성 - Y축 제한 없음
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "전체 Date1별 Day/Night 횟수"
        .Axes(xlCategory).Title.Caption = "Date1"
        .Axes(xlValue).Title.Caption = "Count"
    End With
    
    ' LineDetails 시트에 각 Line1별 날짜와 Shift1 개수 가로 배치 및 차트 생성
    lineDetailsWs.Cells(1, 1).Value = "Line별 날짜별 Day/Night 횟수"
    
    ' Line1 값 순서대로 정렬
    Dim sortedKeys As Collection
    Set sortedKeys = New Collection
    Dim lineKey As Variant
    For Each lineKey In lineData.keys
        Dim idx As Long
        For idx = 1 To sortedKeys.Count
            If CLng(lineKey) < CLng(sortedKeys(idx)) Then Exit For
        Next idx
        If idx > sortedKeys.Count Then
            sortedKeys.Add lineKey
        Else
            sortedKeys.Add lineKey, , idx
        End If
    Next lineKey
    
    colCounter = 1
    For Each lineKey In sortedKeys
        lineDetailsWs.Cells(2, colCounter).Value = "Line1: " & lineKey
        lineDetailsWs.Cells(3, colCounter).Value = "Date1"
        lineDetailsWs.Cells(3, colCounter + 1).Value = "Day Count"
        lineDetailsWs.Cells(3, colCounter + 2).Value = "Night Count"
        
        rowCounter = 4
        
        ' 날짜별 데이터 기록
        For Each dateKey In lineData(lineKey).keys
            lineDetailsWs.Cells(rowCounter, colCounter).Value = dateKey
            lineDetailsWs.Cells(rowCounter, colCounter + 1).Value = lineData(lineKey)(dateKey)("day")
            lineDetailsWs.Cells(rowCounter, colCounter + 2).Value = lineData(lineKey)(dateKey)("night")
            rowCounter = rowCounter + 1
        Next dateKey
        
        ' 각 Line1의 차트를 동일한 Y 위치, 약간의 X 간격으로 배치하고 Y축 최대값 200 설정
        Set chart = lineDetailsWs.ChartObjects.Add(Left:=colCounter * 150 + 50, Width:=375, Top:=50, Height:=300)
        With chart.Chart
            .SetSourceData Source:=lineDetailsWs.Range(lineDetailsWs.Cells(3, colCounter), _
                                                      lineDetailsWs.Cells(rowCounter - 1, colCounter + 2))
            .ChartType = xlColumnClustered
            .HasTitle = True
            .ChartTitle.Text = "Line1: " & lineKey & "의 Date1별 Day/Night 횟수"
            .Axes(xlCategory).Title.Caption = "Date1"
            .Axes(xlValue).Title.Caption = "Count"
            .Axes(xlValue).MaximumScale = 200
            .Axes(xlValue).MajorUnit = 100
            .Axes(xlValue).MajorGridlines.Format.Line.Weight = 1
        End With
        
        colCounter = colCounter + 4 ' 다음 Line1 데이터 및 차트를 위한 간격 설정
    Next lineKey
End Sub
수정 내용
Summary 시트의 전체 차트: Y축에 제한을 두지 않도록 설정했습니다.
LineDetails 시트의 개별 차트:
각 차트의 Y축을 200으로 제한하고, 주요 단위로 100을 설정하여 가로선을 표시합니다.