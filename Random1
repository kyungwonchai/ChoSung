MSSQL 2014 í”„ë¡œì‹œì € ìƒì„± ì½”ë“œ
ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ ìµœê·¼ ë‚ ì§œì— ìˆëŠ” ëª¨ë¸(ì¤‘ë³µ ì—†ì´) ëª©ë¡ì„ ê°€ì ¸ì˜¤ê³ ,
ğŸ“Œ ê° ëª¨ë¸ë³„ ìµœê·¼ 10ê°œ ë°ì´í„°ì—ì„œ ê° ì»¬ëŸ¼ì˜ ìµœì†Œê°’ì„ ì¡°íšŒ
âœ… ğŸ”¹ 1. í”„ë¡œì‹œì € ìƒì„± (MSSQL 2014)
sql
ì½”ë“œ ë³µì‚¬
CREATE PROCEDURE Get_Min_Data_By_Recent_Models
    @ë¼ì¸ëª… NVARCHAR(50)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @ìµœì‹ ë‚ ì§œ DATE;

    -- ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ ê°€ì¥ ìµœì‹  ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
    SELECT TOP 1 @ìµœì‹ ë‚ ì§œ = CAST(time1 AS DATE)
    FROM dbo.ExcelData
    WHERE ë¼ì¸ = @ë¼ì¸ëª…
    ORDER BY time1 DESC;

    -- ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ í•´ë‹¹ ë‚ ì§œì— ë“±ë¡ëœ ìœ ë‹ˆí¬í•œ ëª¨ë¸ ëª©ë¡ ì¡°íšŒ
    WITH LatestModels AS (
        SELECT DISTINCT ëª¨ë¸
        FROM dbo.ExcelData
        WHERE ë¼ì¸ = @ë¼ì¸ëª… AND CAST(time1 AS DATE) = @ìµœì‹ ë‚ ì§œ
    )

    -- ğŸ“Œ ê° ëª¨ë¸ë³„ ìµœê·¼ 10ê°œ ë°ì´í„° ì¤‘ ê° ì»¬ëŸ¼ì˜ ìµœì†Œê°’ ì¡°íšŒ
    SELECT 
        e.ëª¨ë¸,
        MAX(e.time1) AS ìµœì‹ ì‹œê°„,
        ISNULL(MIN(CASE WHEN BCT1_1 >= 1 THEN BCT1_1 ELSE NULL END), 0) AS BCT1_1,
        ISNULL(MIN(CASE WHEN BCT1_2 >= 1 THEN BCT1_2 ELSE NULL END), 0) AS BCT1_2,
        ISNULL(MIN(CASE WHEN BCT1_3 >= 1 THEN BCT1_3 ELSE NULL END), 0) AS BCT1_3,
        ISNULL(MIN(CASE WHEN BCT1_4 >= 1 THEN BCT1_4 ELSE NULL END), 0) AS BCT1_4,
        ISNULL(MIN(CASE WHEN BCT1_5 >= 1 THEN BCT1_5 ELSE NULL END), 0) AS BCT1_5,
        ISNULL(MIN(CASE WHEN BCT1_6 >= 1 THEN BCT1_6 ELSE NULL END), 0) AS BCT1_6,
        ISNULL(MIN(CASE WHEN BCT1_7 >= 1 THEN BCT1_7 ELSE NULL END), 0) AS BCT1_7,
        ISNULL(MIN(CASE WHEN BCT1_8 >= 1 THEN BCT1_8 ELSE NULL END), 0) AS BCT1_8,

        ISNULL(MIN(CASE WHEN TCT1_1 >= 1 THEN TCT1_1 ELSE NULL END), 0) AS TCT1_1,
        ISNULL(MIN(CASE WHEN TCT1_2 >= 1 THEN TCT1_2 ELSE NULL END), 0) AS TCT1_2,
        ISNULL(MIN(CASE WHEN TCT1_3 >= 1 THEN TCT1_3 ELSE NULL END), 0) AS TCT1_3,
        ISNULL(MIN(CASE WHEN TCT1_4 >= 1 THEN TCT1_4 ELSE NULL END), 0) AS TCT1_4,
        ISNULL(MIN(CASE WHEN TCT1_5 >= 1 THEN TCT1_5 ELSE NULL END), 0) AS TCT1_5,
        ISNULL(MIN(CASE WHEN TCT1_6 >= 1 THEN TCT1_6 ELSE NULL END), 0) AS TCT1_6,
        ISNULL(MIN(CASE WHEN TCT1_7 >= 1 THEN TCT1_7 ELSE NULL END), 0) AS TCT1_7,
        ISNULL(MIN(CASE WHEN TCT1_8 >= 1 THEN TCT1_8 ELSE NULL END), 0) AS TCT1_8

    FROM dbo.ExcelData e
    INNER JOIN LatestModels lm ON e.ëª¨ë¸ = lm.ëª¨ë¸
    WHERE e.ë¼ì¸ = @ë¼ì¸ëª… 
        AND CAST(e.time1 AS DATE) = @ìµœì‹ ë‚ ì§œ
    GROUP BY e.ëª¨ë¸;
END;
âœ… ğŸ”¹ 2. í”„ë¡œì‹œì € ì‹¤í–‰ ë°©ë²•
sql
ì½”ë“œ ë³µì‚¬
EXEC Get_Min_Data_By_Recent_Models @ë¼ì¸ëª… = 'L1';
âœ… ğŸ”¹ 3. í”„ë¡œì‹œì € ì„¤ëª…
íŠ¹ì • ë¼ì¸ì˜ ìµœì‹  ë‚ ì§œ(time1ì˜ ë‚ ì§œ)ë¥¼ ì¡°íšŒ
í•´ë‹¹ ë‚ ì§œì— í¬í•¨ëœ ëª¨ë¸ ëª©ë¡(ì¤‘ë³µ ì œê±°)ì„ ê°€ì ¸ì˜´
ê° ëª¨ë¸ë³„ ìµœê·¼ 10ê°œ ë°ì´í„°ì—ì„œ ê° ì»¬ëŸ¼(BCT1_1 ~ TCT1_8)ì˜ ìµœì†Œê°’ì„ ê³„ì‚°
ëª¨ë¸ë³„ ìµœì‹  ì‹œê°„(MAX(time1)) í¬í•¨
âœ… Streamlitì—ì„œ í”„ë¡œì‹œì € í˜¸ì¶œí•˜ì—¬ í‘œì‹œ
python
ì½”ë“œ ë³µì‚¬
import streamlit as st
import pymssql
import pandas as pd

# ğŸ“Œ MSSQL ì—°ê²° ì„¤ì •
DB_CONFIG = {
    "server": "ì„œë²„ì£¼ì†Œ",
    "user": "ì‚¬ìš©ìëª…",
    "password": "ë¹„ë°€ë²ˆí˜¸",
    "database": "DBì´ë¦„"
}

# ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ ìµœì‹  ë‚ ì§œ ëª¨ë¸ë³„ ìµœì†Œê°’ ì¡°íšŒ
def get_recent_models_min_data(line_name):
    conn = pymssql.connect(**DB_CONFIG)
    cursor = conn.cursor(as_dict=True)

    cursor.execute("EXEC Get_Min_Data_By_Recent_Models %s", (line_name,))
    data = cursor.fetchall()
    conn.close()

    return data

# ğŸ“Œ ë¼ì¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
def get_lines():
    conn = pymssql.connect(**DB_CONFIG)
    cursor = conn.cursor()
    cursor.execute("SELECT DISTINCT ë¼ì¸ FROM ExcelData ORDER BY ë¼ì¸")
    lines = [row[0] for row in cursor.fetchall()]
    conn.close()
    return lines

# ğŸ“Œ Streamlit UI
st.title("ë¼ì¸ë³„ ëª¨ë¸ ë°ì´í„° ì¡°íšŒ")

# ğŸ“Œ ë¼ì¸ ì„ íƒ
lines = get_lines()
selected_line = st.sidebar.selectbox("ë¼ì¸ ì„ íƒ", lines)

# ğŸ“Œ ë°ì´í„° ì¡°íšŒ
if selected_line:
    data = get_recent_models_min_data(selected_line)

    if data:
        df = pd.DataFrame(data)
        st.table(df)
    else:
        st.warning("í•´ë‹¹ ë¼ì¸ì— ëŒ€í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")
âœ… ì„¤ì¹˜ ë° ì‹¤í–‰
bash
ì½”ë“œ ë³µì‚¬
pip install streamlit pymssql pandas
streamlit run app.py
âœ… ì¶œë ¥ ì˜ˆì‹œ
ëª¨ë¸	ìµœì‹ ì‹œê°„	1í˜¸ê¸°	2í˜¸ê¸°	3í˜¸ê¸°	4í˜¸ê¸°	5í˜¸ê¸°	6í˜¸ê¸°	7í˜¸ê¸°	8í˜¸ê¸°
A100	2025-03-18 14:10	9	4	6	7	10	4	7	6