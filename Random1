MSSQL 2014에서 특정 테이블 이름이 트리거에서 사용되고 있는지 전 데이터베이스에서 검색하는 쿼리를 작성하려면 sys.triggers와 sys.sql_modules를 활용해야 합니다. 다음은 트리거에서 특정 테이블명을 검색하는 SQL 코드입니다.

코드
sql
코드 복사
-- 검색할 테이블 이름 설정
DECLARE @TableName NVARCHAR(MAX) = '테이블_이름' -- 확인하려는 테이블 이름

-- 모든 데이터베이스에서 트리거 참조 검색
DECLARE @SQL NVARCHAR(MAX) = '';

-- 동적 SQL 생성
SELECT @SQL = @SQL + 
    'USE [' + name + ']; ' +
    'SELECT ''' + name + ''' AS DatabaseName, ' +
    '       OBJECT_NAME(m.object_id) AS TriggerName, ' +
    '       m.definition AS TriggerDefinition ' +
    'FROM sys.triggers t ' +
    'INNER JOIN sys.sql_modules m ON t.object_id = m.object_id ' +
    'WHERE m.definition LIKE ''%' + @TableName + '%'';' +
    CHAR(13) + CHAR(10)
FROM sys.databases
WHERE state_desc = 'ONLINE'; -- 오프라인 상태 DB 제외

-- 동적 SQL 실행
EXEC sp_executesql @SQL;
설명
@TableName: 검색할 테이블 이름을 지정합니다. 스키마 이름까지 포함해야 정확한 결과를 얻을 수 있습니다.
예: 'dbo.MyTable'
sys.triggers: 데이터베이스의 모든 트리거를 확인합니다.
sys.sql_modules.definition: 트리거의 SQL 정의를 가져옵니다.
LIKE 연산자: 트리거 SQL 정의에서 특정 테이블 이름이 포함되어 있는지 검색합니다.
sys.databases: 모든 데이터베이스를 탐색합니다.
결과 컬럼:
DatabaseName: 트리거가 있는 데이터베이스 이름
TriggerName: 트리거 이름
TriggerDefinition: 트리거의 SQL 정의 (참조된 테이블 포함)
결과 예시
DatabaseName	TriggerName	TriggerDefinition
MyDatabase	trg_MyTable	CREATE TRIGGER ... ON dbo.MyTable
주의사항
성능: 모든 데이터베이스와 모든 트리거를 검색하기 때문에 시간이 걸릴 수 있습니다.
테이블 이름 구체화: 테이블 이름이 다른 문자열과 중복될 가능성을 방지하려면 dbo.와 같은 스키마 이름을 포함하여 검색하는 것이 좋습니다.