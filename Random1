import win32com.client
import pymssql
import re
from datetime import datetime

# Initialize Excel
xlApp = win32com.client.Dispatch("Excel.Application")
xlWorkbook = xlApp.Workbooks.Open(r"C:\path\to\your\file.xlsx")
xlWorksheet = xlWorkbook.Worksheets[1]

# Regular Expression pattern
pattern = "[some_regex_pattern_here]"

# Read column names from Excel
columns = []
for i in range(2, 11):  # Assuming 10 columns
    cellValue = xlWorksheet.Cells(2, i).Value
    result = re.sub(pattern, '-', cellValue)
    column_name = "C_" + result
    if column_name.startswith("C_"):
        columns.append(column_name)

# SQL Connection
conn = pymssql.connect('your_connection_string_here')
cursor = conn.cursor()

current_time = datetime.now()
formatted_time = current_time.strftime("%Y-%m-%d %H:%M:%S")
numbb = 1

for row in range(3, 11):  # Assuming 10 rows
    row_values = []
    for col in range(2, 11):  # Assuming 10 columns
        row_values.append(xlWorksheet.Cells(row, col).Value)
        
    if row_values[2] == '':
        continue

    data = dict(zip(columns, row_values))
    data_with_quotes = [f"'{value}'" for value in data.values()]
    data_with_quotes.append(str(numbb))
    data_with_quotes.append(f"'{formatted_time}'")
    
    insert_query = f"INSERT INTO T_메인확정 ({','.join(columns)}, N_number, N_time) VALUES ({','.join(data_with_quotes)})"
    cursor.execute(insert_query)
    numbb += 1

conn.commit()

# Close Excel
xlWorkbook.Close()
xlApp.Quit()
