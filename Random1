 드려 죄송합니다. 다시 한 번 전체 경로에서 해당 패턴을 정확히 매칭하도록 코드를 수정해 보겠습니다. 정규식을 사용하여 전체 경로에서 "B?SM-.+.+.+_.+" 패턴이 포함된 파일을 찾는 방식으로 진행하겠습니다.

아래는 코드 예제입니다:

csharp
코드 복사
using System;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Timers;
using System.Windows;

namespace FolderCheckApp
{
    public partial class MainWindow : Window
    {
        private Timer timer;
        private readonly string[] folderPaths = {
            @"C:\Folder1",
            @"C:\Folder2",
            @"D:\Folder3",
            @"E:\Folder4",
            @"F:\Folder5"
        };
        private readonly Regex filePathPattern = new Regex(@"B?SM-.+_.+_.+_.+.*\.jpg$", RegexOptions.IgnoreCase);

        public MainWindow()
        {
            InitializeComponent();
            InitializeTimer();
        }

        private void InitializeTimer()
        {
            timer = new Timer(3600000); // 1 hour interval in milliseconds
            timer.Elapsed += OnTimerElapsed;
            timer.AutoReset = true;
            timer.Start();
        }

        private void OnTimerElapsed(object sender, ElapsedEventArgs e)
        {
            foreach (var folderPath in folderPaths)
            {
                if (Directory.Exists(folderPath))
                {
                    var jpgFiles = Directory.GetFiles(folderPath, "*.jpg", SearchOption.AllDirectories)
                                            .Where(file => filePathPattern.IsMatch(file));
                    if (jpgFiles.Count() >= 20)
                    {
                        var recentFiles = jpgFiles.Where(file => File.GetCreationTime(file) > DateTime.Now.AddHours(-1));
                        if (recentFiles.Any())
                        {
                            // Folder is selected
                            Dispatcher.Invoke(() => PerformNextAction(folderPath));
                            return;
                        }
                    }
                }
            }
        }

        private void PerformNextAction(string selectedFolderPath)
        {
            // Implement the next action to be performed on the selected folder
            MessageBox.Show($"Selected Folder: {selectedFolderPath}");
        }
    }
}
정규식 패턴을 다시 한 번 설명드리겠습니다:

B?SM-: "B"는 선택적으로 포함될 수 있고, "SM-"는 반드시 포함됩니다.
.+_: 임의의 문자로 채워진 하나의 블록이 밑줄로 구분됩니다.
.+_.+_.+_: 위와 같은 블록이 세 번 반복됩니다.
.*\.jpg$: 마지막으로 ".jpg"로 끝나는 패턴입니다.
이 코드는 주어진 폴더 경로에서 "B?SM-.+.+.+_.+.*.jpg$" 패턴을 포함하는 파일을 찾고, 조건에 맞는 파일이 20개 이상이며, 최근 1시간 이내에 생성된 파일이 있는 폴더를 선택합니다.

정규식을 통해 정확히 파일 경로를 매칭하도록 하였으니, 이번에는 제대로 작동할 것입니다.






