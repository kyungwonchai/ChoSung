í¼(Form) í¬í•¨
í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ í¼ì´ ì¡´ì¬í•˜ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”ë¨.
í¼ì—ëŠ” ë‹¨ìˆœíˆ "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤" ë¼ëŠ” í…ìŠ¤íŠ¸ê°€ í‘œì‹œë¨.
íŠ¸ë ˆì´ ì•„ì´ì½˜ ê¸°ëŠ¥
ìš°í´ë¦­ â†’ "ì¢…ë£Œ" ì„ íƒ ì‹œ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
ë”ë¸”í´ë¦­ â†’ í¼ ë‹¤ì‹œ í‘œì‹œ
ëª¨ë‹ˆí„° ìë™ OFF/ON ê¸°ëŠ¥
GetLastInputInfo()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆìš°ìŠ¤/í‚¤ë³´ë“œ ì…ë ¥ ê°ì§€
1ë¶„(60ì´ˆ) ë™ì•ˆ ì…ë ¥ì´ ì—†ìœ¼ë©´ ëª¨ë‹ˆí„° OFF
ì…ë ¥ì´ ê°ì§€ë˜ë©´ ëª¨ë‹ˆí„° ON
SendMessageë¡œ WM_SYSCOMMAND ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì„œ ì œì–´
ğŸš€ ì™„ì „í•œ ì†ŒìŠ¤ ì½”ë“œ
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows.Forms;

namespace MonitorAutoControl
{
    public partial class MainForm : Form
    {
        private static readonly int WM_SYSCOMMAND = 0x0112;
        private static readonly int SC_MONITORPOWER = 0xF170;
        private static readonly int MONITOR_ON = -1;
        private static readonly int MONITOR_OFF = 2;
        private static readonly int IDLE_TIME_LIMIT = 60 * 1000; // 1ë¶„

        private System.Threading.Timer _idleTimer;
        private NotifyIcon _trayIcon;

        public MainForm()
        {
            InitializeComponent();
            InitializeTrayIcon();
            InitializeTimer();
        }

        private void InitializeComponent()
        {
            this.Text = "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨";
            this.Size = new System.Drawing.Size(400, 200);
            this.FormClosing += MainForm_FormClosing;

            Label label = new Label()
            {
                Text = "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤",
                Dock = DockStyle.Fill,
                TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            };
            this.Controls.Add(label);
        }

        private void InitializeTrayIcon()
        {
            _trayIcon = new NotifyIcon()
            {
                Icon = SystemIcons.Application,
                Visible = true,
                ContextMenuStrip = new ContextMenuStrip()
                {
                    Items = { new ToolStripMenuItem("ì¢…ë£Œ", null, (s, e) => ExitApplication()) }
                }
            };
            _trayIcon.DoubleClick += (s, e) => ShowMainForm();
        }

        private void InitializeTimer()
        {
            _idleTimer = new System.Threading.Timer(CheckIdleState, null, 1000, 1000);
        }

        private void ShowMainForm()
        {
            this.Invoke(new Action(() =>
            {
                this.Show();
                this.WindowState = FormWindowState.Normal;
                this.Activate();
            }));
        }

        private void CheckIdleState(object state)
        {
            int idleTime = GetIdleTime();
            if (idleTime > IDLE_TIME_LIMIT)
            {
                TurnMonitorOff();
            }
            else
            {
                TurnMonitorOn();
            }
        }

        private int GetIdleTime()
        {
            LASTINPUTINFO lastInputInfo = new LASTINPUTINFO();
            lastInputInfo.cbSize = Marshal.SizeOf(typeof(LASTINPUTINFO));

            if (GetLastInputInfo(ref lastInputInfo))
            {
                return Environment.TickCount - lastInputInfo.dwTime;
            }
            return 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
        }

        private void TurnMonitorOn()
        {
            SendMessage(GetDesktopWindow(), WM_SYSCOMMAND, (IntPtr)SC_MONITORPOWER, (IntPtr)MONITOR_ON);
        }

        private void TurnMonitorOff()
        {
            SendMessage(GetDesktopWindow(), WM_SYSCOMMAND, (IntPtr)SC_MONITORPOWER, (IntPtr)MONITOR_OFF);
        }

        private void MainForm_FormClosing(object sender, FormClosingEventArgs e)
        {
            e.Cancel = true;
            this.Hide(); // ì°½ì„ ë‹«ì§€ ì•Šê³  ìˆ¨ê¹€
        }

        private void ExitApplication()
        {
            _idleTimer.Dispose();
            _trayIcon.Dispose();
            Application.Exit();
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct LASTINPUTINFO
        {
            public int cbSize;
            public int dwTime;
        }

        [DllImport("user32.dll")]
        private static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr GetDesktopWindow();

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr SendMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam);

        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}
ğŸ” ì£¼ìš” ê¸°ëŠ¥
âœ… 1. í¼ (MainForm) ê¸°ë³¸ UI
í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ í¼ì´ ë‚˜íƒ€ë‚¨ (ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤ ë¬¸êµ¬ í‘œì‹œ)
X ë²„íŠ¼ í´ë¦­ ì‹œ ì°½ì„ ë‹«ì§€ ì•Šê³  ìˆ¨ê¹€ (íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”)
âœ… 2. íŠ¸ë ˆì´ ì•„ì´ì½˜ ê¸°ëŠ¥
ë”ë¸”í´ë¦­ ì‹œ í¼ ë‹¤ì‹œ í‘œì‹œ
ìš°í´ë¦­ ë©”ë‰´ì—ì„œ "ì¢…ë£Œ" í´ë¦­ ì‹œ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
âœ… 3. ì…ë ¥ ê°ì§€ ë° ëª¨ë‹ˆí„° ì œì–´
GetLastInputInfo() ë¥¼ ì‚¬ìš©í•˜ì—¬ ìµœì‹  ì‚¬ìš©ì ì…ë ¥ ê°ì§€
1ë¶„ ë™ì•ˆ ì…ë ¥ì´ ì—†ìœ¼ë©´ ëª¨ë‹ˆí„° OFF, ì…ë ¥ì´ ê°ì§€ë˜ë©´ ëª¨ë‹ˆí„° ON
SendMessage(GetDesktopWindow(), WM_SYSCOMMAND, SC_MONITORPOWER, MONITOR_OFF) ë°©ì‹ìœ¼ë¡œ ë¹ ë¥´ê²Œ ëª¨ë‹ˆí„° ì œì–´
âœ… 4. ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
UIê°€ ìµœì†Œí™”ë˜ë©´ íŠ¸ë ˆì´ì—ì„œ ê³„ì† ì‹¤í–‰ë¨
í¼ì´ ë‹«íˆì§€ ì•Šê³  ìˆ¨ê²¨ì§ (X ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œë˜ì§€ ì•ŠìŒ)
âœ… ìµœì¢… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
 í¼ ì‹¤í–‰ ì‹œ "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤" í…ìŠ¤íŠ¸ ì •ìƒ í‘œì‹œ
 í¼ X ë²„íŠ¼ í´ë¦­ ì‹œ ì°½ì´ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”
 íŠ¸ë ˆì´ ì•„ì´ì½˜ ì •ìƒ í‘œì‹œë¨
 íŠ¸ë ˆì´ì—ì„œ ë”ë¸”í´ë¦­í•˜ë©´ í¼ ë‹¤ì‹œ í‘œì‹œ
 íŠ¸ë ˆì´ì—ì„œ "ì¢…ë£Œ" í´ë¦­í•˜ë©´ ì •ìƒ ì¢…ë£Œë¨
 1ë¶„ ë™ì•ˆ ì…ë ¥ì´ ì—†ìœ¼ë©´ ëª¨ë‹ˆí„° ìë™ OFF
 ì…ë ¥ ê°ì§€ ì‹œ ëª¨ë‹ˆí„° ìë™ ON
 UIê°€ ì—†ì„ ë•Œë„ ì •ìƒ ì‘ë™
ğŸ¯ ì¥ì 
âœ” í›„í‚¹ ì‚¬ìš© ì—†ì´ ì…ë ¥ ê°ì§€ ê°€ëŠ¥ â†’ ê¸°ì—… í™˜ê²½ì—ì„œë„ ë¬¸ì œ ì—†ìŒ
âœ” íŠ¸ë ˆì´ì—ì„œ ê¹”ë”í•˜ê²Œ ë™ì‘ â†’ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ ê°€ëŠ¥
âœ” UI ìµœì†Œí™” ë° ì¢…ë£Œ ê¸°ëŠ¥ í¬í•¨ â†’ ì‚¬ìš©ì í¸ì˜ì„± ê°•í™”
âœ” ë¹ ë¥´ê³  ì•ˆì •ì ì¸ ëª¨ë‹ˆí„° ON/OFF ì œì–´ â†’ SendMessage(GetDesktopWindow()) ë°©ì‹ ì‚¬ìš©
âœ” ìµœì†Œí•œì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš© â†’ ê°€ë²¼ìš´ íƒ€ì´ë¨¸ ì‚¬ìš©