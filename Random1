니다. 각 시트의 데이터를 실제 값으로 변환하여 새로운 시트에 날짜와 B열 구분 값에 따라 C열의 값을 그대로 옮겨주는 매크로를 제공해 드리겠습니다. 이렇게 하면 각 시트의 데이터를 순회하면서 원래 피벗 테이블의 소스가 되는 세부 데이터를 다시 추출하여 한 시트에 집합적으로 저장할 수 있습니다.

아래는 해당 요구 사항을 구현한 VBA 매크로 코드입니다.

vba
코드 복사
Sub UnpivotToDetailedDataSheet()
    Dim ws As Worksheet
    Dim outputWs As Worksheet
    Dim lastRow As Long
    Dim currentRow As Long
    Dim outputRow As Long
    Dim dateValue As Variant
    Dim wsName As String
    Dim i As Long
    
    ' 요약 데이터를 넣을 새 시트를 생성
    On Error Resume Next ' 같은 이름 시트가 있을 경우 오류 방지
    Set outputWs = ThisWorkbook.Sheets("DetailedData")
    On Error GoTo 0
    
    If outputWs Is Nothing Then
        Set outputWs = ThisWorkbook.Sheets.Add
        outputWs.Name = "DetailedData"
    Else
        outputWs.Cells.Clear ' 기존 데이터가 있을 경우 초기화
    End If
    
    ' 헤더 생성
    outputWs.Range("A1").Value = "Sheet Name"
    outputWs.Range("B1").Value = "Date"
    outputWs.Range("C1").Value = "Type"
    outputWs.Range("D1").Value = "Value"
    outputRow = 2
    
    ' 모든 시트를 순회하며 데이터를 추출
    For Each ws In ThisWorkbook.Sheets
        ' 요약 시트와 동일하지 않은 시트만 작업
        If ws.Name <> outputWs.Name Then
            ' 날짜 가져오기 (D열 2행)
            dateValue = ws.Cells(2, 4).Value ' 2행 D열의 날짜 값
            
            ' 데이터의 마지막 행 찾기
            lastRow = ws.Cells(ws.Rows.Count, 2).End(xlUp).Row
            
            ' Temperature와 Humidity 데이터를 순서대로 개별 값으로 복사
            For i = 4 To lastRow
                If ws.Cells(i, 2).Value = "Temperature" Or ws.Cells(i, 2).Value = "Humidity" Then
                    ' 시트 이름, 날짜, 구분값, 실제 C열 값을 상세 시트에 추가
                    outputWs.Cells(outputRow, 1).Value = ws.Name ' 시트 이름
                    outputWs.Cells(outputRow, 2).Value = dateValue ' 날짜
                    outputWs.Cells(outputRow, 3).Value = ws.Cells(i, 2).Value ' Type (Temperature or Humidity)
                    outputWs.Cells(outputRow, 4).Value = ws.Cells(i, 3).Value ' 실제 C열 값
                    outputRow = outputRow + 1 ' 다음 행으로 이동
                End If
            Next i
        End If
    Next ws
    
    ' 사용자에게 완료 메시지 출력
    MsgBox "모든 시트의 Temperature와 Humidity 데이터를 세부 데이터로 복사하여 DetailedData 시트에 추가 완료했습니다.", vbInformation
End Sub
코드 설명
새 시트 생성: DetailedData라는 이름의 새로운 시트를 생성하여 모든 데이터를 수집합니다. 만약 DetailedData 시트가 이미 있다면 해당 시트를 초기화하여 기존 데이터를 지웁니다.

헤더 생성: 네 가지 열 Sheet Name, Date, Type, Value로 구성하여 각 시트에서 수집한 데이터를 저장합니다.

시트 순회: 모든 시트를 순회하며 DetailedData 시트는 제외하고, 나머지 시트에서 데이터를 추출합니다.

데이터 수집: 각 시트에서 B열이 Temperature 또는 Humidity인 경우, 해당 C열의 실제 값을 수집하여 새로운 시트에 추가합니다. 날짜는 각 시트의 D2 셀에서 읽어옵니다.

출력: 최종 데이터를 DetailedData 시트에 추가하고, 각 행은 시트 이름, 날짜, 타입, 실제 측정값을 포함합니다.

완료 메시지: 작업 완료 후 메시지를 통해 사용자에게 알립니다.