using Excel = Microsoft.Office.Interop.Excel;
using System.Data;

// 엑셀 파일 경로
string filePath = "경로\\파일이름.xlsx";

// Excel Application 인스턴스 생성
Excel.Application excelApp = new Excel.Application();

// Workbook 열기
Excel.Workbook workbook = excelApp.Workbooks.Open(filePath);

// 마스터 시트 읽기
Excel.Worksheet masterSheet = workbook.Sheets["마스터 시트명"];
Excel.Range masterRange = masterSheet.UsedRange;

// 데이터 테이블 생성
DataTable masterTB = new DataTable();

// 컬럼 생성
for (int col = 1; col <= masterRange.Columns.Count; col++)
{
    string columnName = masterRange.Cells[1, col].Value2.ToString();
    masterTB.Columns.Add(columnName);
}

// 데이터 행 추가
for (int row = 2; row <= masterRange.Rows.Count; row++)
{
    DataRow dataRow = masterTB.NewRow();
    for (int col = 1; col <= masterRange.Columns.Count; col++)
    {
        dataRow[col - 1] = masterRange.Cells[row, col].Value2 != null ? masterRange.Cells[row, col].Value2.ToString() : string.Empty;
    }
    masterTB.Rows.Add(dataRow);
}

// 불출 시트 읽기
Excel.Worksheet bulSheet = workbook.Sheets["불출 시트명"];
Excel.Range bulRange = bulSheet.UsedRange;

// 데이터 테이블 생성
DataTable bulTB = new DataTable();

// 컬럼 생성
for (int col = 1; col <= bulRange.Columns.Count; col++)
{
    string columnName = bulRange.Cells[1, col].Value2.ToString();
    bulTB.Columns.Add(columnName);
}

// 데이터 행 추가
for (int row = 2; row <= bulRange.Rows.Count; row++)
{
    DataRow dataRow = bulTB.NewRow();
    for (int col = 1; col <= bulRange.Columns.Count; col++)
    {
        dataRow[col - 1] = bulRange.Cells[row, col].Value2 != null ? bulRange.Cells[row, col].Value2.ToString() : string.Empty;
    }
    bulTB.Rows.Add(dataRow);
}

// Excel 파일과 관련된 리소스 해제
workbook.Close();
excelApp.Quit();
System.Runtime.InteropServices.Marshal.ReleaseComObject(workbook);
System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);

// 사용이 완료된 COM 개체를 제거
GC.Collect();
