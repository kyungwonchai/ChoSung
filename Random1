T
알겠습니다. Microsoft.Office.Interop.Excel 라이브러리를 사용하여 요구사항에 맞는 C# 코드를 제공하겠습니다. 이 라이브러리는 Office와 직접 상호작용하기 때문에 Office가 설치된 Windows 환경에서만 사용할 수 있습니다.

아래는 수정된 코드 예시입니다:

csharp
Copy code
using System;
using Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Application excelApp = new Application();
        Workbook workbook = excelApp.Workbooks.Open("path/to/your/excel.xlsx");
        Worksheet worksheet = workbook.Worksheets["Data"];

        Range usedRange = worksheet.UsedRange;
        int totalColumns = usedRange.Columns.Count;

        for (int col = 2; col <= totalColumns; col++)
        {
            var cellColor = worksheet.Cells[2, col].Interior.Color;
            if (cellColor == XlRgbColor.rgbWhite || cellColor == XlRgbColor.rgbTransparent)
            {
                if (double.TryParse((worksheet.Cells[3, col] as Range).Text, out double currentValue) && currentValue <= 500)
                {
                    if (col < totalColumns && string.IsNullOrEmpty((worksheet.Cells[3, col + 1] as Range).Text))
                    {
                        if (double.TryParse((worksheet.Cells[3, col - 1] as Range).Text, out double previousValue))
                        {
                            worksheet.Cells[3, col] = currentValue + previousValue;
                        }
                    }
                    else if (col < totalColumns)
                    {
                        int nextCol = col + 1;
                        if (double.TryParse((worksheet.Cells[3, nextCol] as Range).Text, out double nextValue))
                        {
                            worksheet.Cells[3, nextCol] = currentValue + nextValue;
                        }
                    }
                }
            }
        }

        workbook.Save();
        workbook.Close();
        excelApp.Quit();
    }
}
이 코드는 다음과 같은 작업을 수행합니다:

지정된 엑셀 파일을 엽니다.
"Data" 시트를 선택합니다.
2열부터 마지막 열까지 반복합니다.
2행의 셀 배경색이 흰색이거나 투명색인 경우에만 조건을 체크합니다.
3행의 값이 500 이하인 숫자인 경우, 다음 열의 3행에 숫자가 없으면 현재 값과 이전 열의 값을 더합니다.
다음 열의 3행에 숫자가 있으면, 그 숫자에 현재 값을 더합니다.
변경된 내용을 저장하고 엑셀을 닫습니다.
참고사항:

path/to/your/excel.xlsx는 실제 엑셀 파일의 경로로 변경해야 합니다.
엑셀 파일의 구조(셀의 배경색, 데이터 형식 등)에 따라 코드를 조정해야 할 수 있습니다.
Microsoft.Office.Interop.Excel은 Office가 설치된 Windows 환경에서만 사용할 수 있습니다.
이 코드는 C# 최신 버전과 호환되며, Microsoft.Office.Inte