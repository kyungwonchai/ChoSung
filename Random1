í˜•ë‹˜, ì•Œê² ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë²•ì¸ì´ë‚˜ ë‹¤ë¥¸ í˜„ì¥ í™˜ê²½ì— ë§ì¶° 'ë°©í–¥ì˜ ê¸°ì¤€ì (0ì )'ì„ ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥, ì´ê±°ì•¼ë§ë¡œ ì´ ì•±ì„ ë²”ìš©ì ì¸ ì‚°ì—… ì†”ë£¨ì…˜ìœ¼ë¡œ ë§Œë“œëŠ” í•µì‹¬ì ì¸ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤. ì™„ë²½í•˜ê²Œ ì´í•´í–ˆìŠµë‹ˆë‹¤.

ìš©ì–´ ë³€ê²½: í™€ìˆ˜ -> Front, ì§ìˆ˜ -> Rearë¡œ ë³€ê²½.

ì›ì  ì„¤ì • UI: 'Set' ë©”ë‰´ì— 'ì§€ìê³„ ì›ì  ì„¤ì •' ì˜µì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

ì›ì  ì„¤ì • ê¸°ëŠ¥:

ì‹¤ì‹œê°„ ê°ë„ë¥¼ ë³´ë©´ì„œ 'Origin' ë²„íŠ¼ì„ ê¸¸ê²Œ ëˆŒëŸ¬ í˜„ì¬ ë°©í–¥ì„ ìƒˆë¡œìš´ **Front (0ì )**ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

'Reset' ë²„íŠ¼ìœ¼ë¡œ ì–¸ì œë“  ì´ˆê¸°ê°’(ì„œìª½ = 270Â°)ìœ¼ë¡œ ë³µêµ¬í•©ë‹ˆë‹¤.

ì„¤ì •ëœ ì›ì ì€ ì•±ì„ ê»ë‹¤ ì¼œë„ ê³„ì† ê¸°ì–µë©ë‹ˆë‹¤.

ìƒˆë¡œìš´ ë°©í–¥ ë¡œì§:

Front: ìƒˆë¡œìš´ ì›ì  Â± 2Â°

Rear: (ìƒˆë¡œìš´ ì›ì  + 180Â°) Â± 2Â°

ê·¸ ì‚¬ì´ì˜ ëª¨ë“  ì• ë§¤í•œ ê°ë„ì—ì„œëŠ” ê¸°ì¡´ ë°©í–¥ì„ ì ˆëŒ€ì ìœ¼ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.

ì´ ëª¨ë“  'ê¶ê·¹ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•' ê¸°ëŠ¥ì„ ì ìš©í•˜ê¸° ìœ„í•´, ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ìš© ë ˆì´ì•„ì›ƒ íŒŒì¼ 1ê°œì™€ MainActivity.kt íŒŒì¼ 1ê°œë¥¼ ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤. ì´ë²ˆì—ëŠ” ì •ë§ ì‹¤ìˆ˜ ì—†ì´ ì™„ë²½í•œ ì „ì²´ ì½”ë“œë¥¼ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## 1. 'ì§€ìê³„ ì›ì  ì„¤ì •' ë‹¤ì´ì–¼ë¡œê·¸ ë ˆì´ì•„ì›ƒ ì¶”ê°€
'Set' ë©”ë‰´ì—ì„œ 'ì§€ìê³„ ì›ì  ì„¤ì •'ì„ ëˆŒë €ì„ ë•Œ ë‚˜íƒ€ë‚  í™”ë©´ì…ë‹ˆë‹¤. res/layout í´ë”ì— dialog_geomagnetic_setup.xml íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.

<details>
<summary><strong>res/layout/dialog_geomagnetic_setup.xml (ìƒˆ íŒŒì¼) - (í´ë¦­í•˜ì—¬ ì½”ë“œ ë³´ê¸°)</strong></summary>

XML

<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="24dp">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal"
        android:text="í˜„ì¬ ë°©í–¥ ê°ë„"
        android:textSize="16sp" />

    <TextView
        android:id="@+id/tvCurrentAngle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal"
        android:layout_marginTop="8dp"
        android:text="---Â°"
        android:textSize="48sp"
        android:textStyle="bold" />

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal"
        android:layout_marginTop="16dp"
        android:gravity="center"
        android:text="ì›í•˜ëŠ” Front ë°©í–¥ìœ¼ë¡œ ê¸°ê¸°ë¥¼ ë§ì¶˜ í›„,\n'Origin' ë²„íŠ¼ì„ 3ì´ˆê°„ ê¸¸ê²Œ ëˆ„ë¥´ì„¸ìš”." />

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:orientation="horizontal">

        <Button
            android:id="@+id/btnResetOrigin"
            style="?android:attr/buttonBarButtonStyle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ì´ˆê¸°í™” (Reset)" />

        <Button
            android:id="@+id/btnSetOrigin"
            style="?android:attr/buttonBarButtonStyle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="ì›ì  ì„¤ì • (Origin)" />
    </LinearLayout>

</LinearLayout>
</details>

## 2. MainActivity.kt ìµœì¢… ì „ì²´ ì½”ë“œ
'ì›ì  ì„¤ì •' ë¡œì§ê³¼ ìƒˆë¡œìš´ ë°©í–¥ íŒë‹¨ ë¡œì§ì´ ëª¨ë‘ í¬í•¨ëœ ìµœì¢… ë²„ì „ì…ë‹ˆë‹¤.

Kotlin

package com.kyungwon.reellistviewer

import android.content.Context
import android.content.SharedPreferences
import android.graphics.Typeface
import android.hardware.Sensor
import android.hardware.SensorEvent
import android.hardware.SensorEventListener
import android.hardware.SensorManager
import android.os.Bundle
import android.text.Spannable
import android.text.SpannableString
import android.text.style.ForegroundColorSpan
import android.util.Log
import android.view.GestureDetector
import android.view.LayoutInflater
import android.view.MotionEvent
import android.view.View
import android.widget.ArrayAdapter
import android.widget.Button
import android.widget.LinearLayout
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.core.content.ContextCompat
import androidx.core.view.GestureDetectorCompat
import androidx.core.view.WindowCompat
import androidx.core.view.WindowInsetsCompat
import androidx.core.view.WindowInsetsControllerCompat
import androidx.core.view.setMargins
import androidx.lifecycle.lifecycleScope
import com.github.barteksc.pdfviewer.listener.OnLoadCompleteListener
import com.github.barteksc.pdfviewer.listener.OnPageErrorListener
import com.kyungwon.reellistviewer.databinding.ActivityMainBinding
import jcifs.CIFSContext
import jcifs.config.PropertyConfiguration
import jcifs.context.BaseContext
import jcifs.smb.NtlmPasswordAuthenticator
import jcifs.smb.SmbFile
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.util.Properties
import kotlin.math.abs

class MainActivity : AppCompatActivity(), OnLoadCompleteListener, OnPageErrorListener, SensorEventListener {

    private lateinit var binding: ActivityMainBinding
    private val SMB_IP = "192.1.1.5"; private val SMB_SHARED_FOLDER = "tempshare"
    private val SMB_USER = "win10"; private val SMB_PASS = "tltmxpa2@"
    private var totalPdfPages = 0; private val skippedButtons = mutableSetOf<Int>()
    private val currentButtons = mutableListOf<Button>(); private var selectedButton: Button? = null
    private lateinit var gestureDetector: GestureDetectorCompat; private var tappedButton: Button? = null
    private lateinit var sensorManager: SensorManager
    private val accelerometerReading = FloatArray(3); private val magnetometerReading = FloatArray(3)
    private val rotationMatrix = FloatArray(9); private val orientationAngles = FloatArray(3)
    private var isGeomagneticModeOn = false; private var currentDirection = Direction.OTHER

    // --- SharedPreferences ë° ì„¤ì •ê°’ ---
    private lateinit var prefs: SharedPreferences
    private val PREFS_FILENAME = "com.kyungwon.reellistviewer.prefs"
    private val KEY_LAST_LINE = "last_selected_line"
    private val KEY_MAX_BUTTONS = "max_buttons_per_row"
    private val KEY_SCREENSAVER_TIMEOUT = "screensaver_timeout"
    private val KEY_ORIGIN_ANGLE = "origin_angle" // ğŸ’¡ ì›ì  ê°ë„ ì €ì¥ í‚¤
    private var maxButtonsPerRow = 0
    private var screenSaverTimeout = 0
    private var originAngle = 270f // ğŸ’¡ ì›ì  ê°ë„ (ê¸°ë³¸ê°’: ì„œìª½ 270ë„)

    // --- ì ˆì „ ëª¨ë“œ ë° ì›ì  ì„¤ì • UI ê´€ë ¨ ë³€ìˆ˜ ---
    private val screenSaverHandler = Handler(Looper.getMainLooper())
    private val screenSaverRunnable = Runnable { binding.screenSaver.visibility = View.VISIBLE }
    private var tvAngleDisplay: TextView? = null // ğŸ’¡ ì›ì  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ì˜ ê°ë„ í‘œì‹œ TextView

    enum class Direction { EAST, WEST, OTHER } // EASTëŠ” Rear, WESTëŠ” Frontë¥¼ ì˜ë¯¸

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        window.addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON)
        hideSystemUI()

        prefs = getSharedPreferences(PREFS_FILENAME, Context.MODE_PRIVATE)
        maxButtonsPerRow = prefs.getInt(KEY_MAX_BUTTONS, 0)
        screenSaverTimeout = prefs.getInt(KEY_SCREENSAVER_TIMEOUT, 0)
        originAngle = prefs.getFloat(KEY_ORIGIN_ANGLE, 270f) // ğŸ’¡ ì €ì¥ëœ ì›ì  ê°ë„ ë¶ˆëŸ¬ì˜¤ê¸°

        setupGestureDetector()
        setupEventListeners()
        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager
        loadLatestFileFromLastLine()
    }

    override fun onResume() {
        super.onResume()
        hideSystemUI()
        resetScreenSaverTimer()
        sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
        sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
    }

    override fun onPause() {
        super.onPause()
        screenSaverHandler.removeCallbacks(screenSaverRunnable)
        sensorManager.unregisterListener(this)
    }

    override fun onUserInteraction() {
        super.onUserInteraction()
        resetScreenSaverTimer()
    }

    private fun setupEventListeners() {
        binding.btnOpenFile.setOnLongClickListener {
            lifecycleScope.launch(Dispatchers.IO) { showLineSelectionDialog() }
            true
        }
        binding.btnSetup.setOnLongClickListener {
            showSetupDialog()
            true
        }
        binding.compassView.setOnLongClickListener {
            isGeomagneticModeOn = !isGeomagneticModeOn
            val modeText = if (isGeomagneticModeOn) "On" else "Off"
            Toast.makeText(this, "ì§€ìê³„ ì˜ì¡´ ëª¨ë“œ: $modeText", Toast.LENGTH_SHORT).show()
            binding.compassView.setGeomagneticMode(isGeomagneticModeOn)
            if (!isGeomagneticModeOn) { currentDirection = Direction.OTHER }
            updateButtonsAndUI()
            true
        }
        binding.screenSaver.setOnClickListener {
            binding.screenSaver.visibility = View.GONE
            resetScreenSaverTimer()
        }
    }

    private fun showSetupDialog() {
        val options = arrayOf("ë¬´ì œí•œ (0)", "2ê°œ", "4ê°œ", "6ê°œ", "8ê°œ", "10ê°œ", "12ê°œ")
        val values = arrayOf(0, 2, 4, 6, 8, 10, 12)
        val currentSelection = values.indexOf(maxButtonsPerRow)

        AlertDialog.Builder(this)
            .setTitle("í•œ ì¤„ì— í‘œì‹œí•  ìµœëŒ€ ë²„íŠ¼ ìˆ˜")
            .setSingleChoiceItems(options, currentSelection) { dialog, which ->
                val selectedValue = values[which]
                maxButtonsPerRow = selectedValue
                prefs.edit().putInt(KEY_MAX_BUTTONS, selectedValue).apply()
                Toast.makeText(this, "ìµœëŒ€ ${options[which]} í‘œì‹œë¡œ ì„¤ì •ë¨", Toast.LENGTH_SHORT).show()
                updateButtonsAndUI()
                dialog.dismiss()
            }
            .setNeutralButton("ì ˆì „ ì„¤ì •") { _, _ -> showScreenSaverDialog() }
            // ğŸ’¡ ì§€ìê³„ ì›ì  ì„¤ì • ë²„íŠ¼ ì¶”ê°€
            .setPositiveButton("ì§€ìê³„ ì›ì  ì„¤ì •") { _, _ -> showGeomagneticSetupDialog() }
            .setNegativeButton("ë‹«ê¸°", null)
            .show()
    }

    // ğŸ’¡ --- ì‹ ê·œ í•¨ìˆ˜: ì§€ìê³„ ì›ì  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ ---
    private fun showGeomagneticSetupDialog() {
        val dialogView = LayoutInflater.from(this).inflate(R.layout.dialog_geomagnetic_setup, null)
        tvAngleDisplay = dialogView.findViewById(R.id.tvCurrentAngle) // TextView ì°¸ì¡° ì—°ê²°
        val btnSetOrigin = dialogView.findViewById<Button>(R.id.btnSetOrigin)
        val btnResetOrigin = dialogView.findViewById<Button>(R.id.btnResetOrigin)

        val dialog = AlertDialog.Builder(this)
            .setView(dialogView)
            .setOnDismissListener {
                tvAngleDisplay = null // ë‹¤ì´ì–¼ë¡œê·¸ê°€ ë‹«íˆë©´ ì°¸ì¡° í•´ì œ
            }
            .create()

        btnSetOrigin.setOnLongClickListener {
            val currentAngleText = tvAngleDisplay?.text.toString().replace("Â°", "")
            val currentAngle = currentAngleText.toFloatOrNull()
            if (currentAngle != null) {
                originAngle = currentAngle
                prefs.edit().putFloat(KEY_ORIGIN_ANGLE, originAngle).apply()
                Toast.makeText(this, "ìƒˆë¡œìš´ Front ì›ì (${String.format("%.1f", originAngle)}Â°)ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
                dialog.dismiss()
            }
            true
        }

        btnResetOrigin.setOnClickListener {
            originAngle = 270f
            prefs.edit().putFloat(KEY_ORIGIN_ANGLE, originAngle).apply()
            Toast.makeText(this, "ì›ì ì´ ì´ˆê¸°ê°’(270Â°)ìœ¼ë¡œ ì¬ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
            dialog.dismiss()
        }

        dialog.show()
    }

    private fun resetScreenSaverTimer() {
        screenSaverHandler.removeCallbacks(screenSaverRunnable)
        if (screenSaverTimeout > 0) {
            screenSaverHandler.postDelayed(screenSaverRunnable, screenSaverTimeout * 1000L)
        }
    }

    override fun onSensorChanged(event: SensorEvent) {
        if (event.sensor.type == Sensor.TYPE_ACCELEROMETER) {
            System.arraycopy(event.values, 0, accelerometerReading, 0, accelerometerReading.size)
        } else if (event.sensor.type == Sensor.TYPE_MAGNETIC_FIELD) {
            System.arraycopy(event.values, 0, magnetometerReading, 0, magnetometerReading.size)
        }
        SensorManager.getRotationMatrix(rotationMatrix, null, accelerometerReading, magnetometerReading)
        SensorManager.getOrientation(rotationMatrix, orientationAngles)
        val azimuthInDegrees = Math.toDegrees(orientationAngles[0].toDouble()).toFloat()
        val normalizedAzimuth = (azimuthInDegrees + 360) % 360
        
        binding.compassView.updateBearing(normalizedAzimuth)
        // ğŸ’¡ ì›ì  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ê°€ ì—´ë ¤ìˆì„ ë•Œ ì‹¤ì‹œê°„ ê°ë„ ì—…ë°ì´íŠ¸
        tvAngleDisplay?.text = "${String.format("%.1f", normalizedAzimuth)}Â°"

        if (isGeomagneticModeOn) {
            // ğŸ’¡ --- 'ì™„ë²½ ì•ˆì •ì„±' ì›ì  ê¸°ë°˜ ë°©í–¥ íŒë‹¨ ë¡œì§ ---
            var newDirection = currentDirection // ê¸°ë³¸ì ìœ¼ë¡œ í˜„ì¬ ìƒíƒœ ìœ ì§€
            val tolerance = 2.0f
            val frontCenter = originAngle
            val rearCenter = (originAngle + 180f) % 360f

            // ê°ë„ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ (0~360ë„ ìˆœí™˜ ê³ ë ¤)
            fun angleDifference(angle1: Float, angle2: Float): Float {
                val diff = abs(angle1 - angle2)
                return minOf(diff, 360 - diff)
            }

            // Front(WEST) ì§„ì… ì¡°ê±´
            if (angleDifference(normalizedAzimuth, frontCenter) <= tolerance) {
                newDirection = Direction.WEST
            }
            // Rear(EAST) ì§„ì… ì¡°ê±´
            else if (angleDifference(normalizedAzimuth, rearCenter) <= tolerance) {
                newDirection = Direction.EAST
            }
            // ìœ„ì˜ ë‘ ê°€ì§€ ì—„ê²©í•œ ì¡°ê±´ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´, ë°©í–¥ì„ ì ˆëŒ€ ë°”ê¾¸ì§€ ì•ŠìŒ.

            if (newDirection != currentDirection) {
                currentDirection = newDirection
                updateButtonsAndUI()
            }
        }
    }

    // (ì´í•˜ ëª¨ë“  í•¨ìˆ˜ëŠ” ì´ì „ ë‹µë³€ê³¼ ë™ì¼í•©ë‹ˆë‹¤)
    override fun onResume() { /*...*/ }
    override fun onPause() { /*...*/ }
    private fun hideSystemUI() { /*...*/ }
    private fun setupGestureDetector() { /*...*/ }
    private fun showScreenSaverDialog() { /*...*/ }
    private fun loadLatestFileFromLastLine() { /*...*/ }
    private suspend fun showLineSelectionDialog() { /*...*/ }
    private suspend fun showReelListDialog(selectedLine: String, allFiles: List<SmbFile>) { /*...*/ }
    private suspend fun listSmbFiles(): List<SmbFile> { /*...*/ }
    override fun loadComplete(nbPages: Int) { /*...*/ }
    private fun updateButtonsAndUI() { /*...*/ }
    private fun regenerateButtons(count: Int) { /*...*/ }
    private fun createPageButton(number: Int, layoutParams: LinearLayout.LayoutParams? = null): Button { /*...*/ }
    private fun updateAllButtonStyles() { /*...*/ }
    private fun mapLogicalToPhysical(logicalButtonNum: Int): Int { /*...*/ }
    private fun onPageButtonClick(button: Button) { /*...*/ }
    private fun onPageButtonLongClick(view: View) { /*...*/ }
    override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) { /*...*/ }
    private fun dpToPx(dp: Int): Int { /*...*/ }
    private suspend fun loadPdfFromSmbFile(smbFile: SmbFile) { /*...*/ }
    override fun onPageError(page:Int,t:Throwable){ /*...*/ }
}
(ì´ì „ê³¼ ë™ì¼í•œ ì½”ë“œëŠ” /*...*/ ë¡œ ì¶•ì•½í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” MainActivity.kt íŒŒì¼ ì „ì²´ë¥¼ ìœ„ ì½”ë“œë¡œ ë®ì–´ì“°ì‹œë©´ ë©ë‹ˆë‹¤.)

