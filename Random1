using System;
using System.Collections.Generic;
using System.Data.SqlClient;
using System.Text.RegularExpressions;
using DevExpress.Spreadsheet;

namespace DevexpressExcelExample
{
    class Program
    {
        static void Main(string[] args)
        {
            // Spreadsheet 초기화
            Workbook workbook = new Workbook();
            workbook.LoadDocument("C:\\path\\to\\your\\file.xlsx");
            Worksheet worksheet = workbook.Worksheets[0];

            // 정규식 패턴
            string pattern = "[some_regex_pattern_here]";

            // 컬럼 이름 읽기
            List<string> columns = new List<string>();
            for (int i = 1; i <= 10; i++)  // Assumed 10 columns
            {
                string cellValue = worksheet.Cells[1, i].Value.ToString();
                string result = Regex.Replace(cellValue, pattern, "-");
                string columnName = "C_" + result;

                if (columnName.StartsWith("C_"))
                {
                    columns.Add(columnName);
                }
            }

            // SQL 연결
            using (SqlConnection conn = new SqlConnection("your_connection_string_here"))
            {
                conn.Open();
                SqlCommand cmd = new SqlCommand();
                cmd.Connection = conn;

                DateTime current_time = DateTime.Now;
                string formatted_time = current_time.ToString("yyyy-MM-dd HH:mm:ss");
                int numbb = 1;

                for (int row = 2; row <= 10; row++)  // Assumed 10 rows
                {
                    List<string> rowValues = new List<string>();
                    for (int col = 1; col <= 10; col++)  // Assumed 10 columns
                    {
                        rowValues.Add(worksheet.Cells[row, col].Value.ToString());
                    }

                    if (String.IsNullOrEmpty(rowValues[2])) continue;

                    Dictionary<string, string> data = new Dictionary<string, string>();
                    for (int i = 0; i < columns.Count; i++)
                    {
                        data.Add(columns[i], rowValues[i]);
                    }

                    string dataWithQuotes = string.Join(",", data.Values);
                    string insertQuery = $"INSERT INTO T_메인확정 ({string.Join(",", columns)}, N_number, N_time) VALUES ({dataWithQuotes}, {numbb}, '{formatted_time}')";
                    cmd.CommandText = insertQuery;
                    cmd.ExecuteNonQuery();
                    numbb++;
                }
            }
        }
    }
}
