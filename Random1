using System;
using System.Drawing;
using System.IO;
using System.Runtime.InteropServices;
using System.Windows.Forms;

public partial class MainForm : Form
{
    // 트레이 아이콘을 위한 필드
    private NotifyIcon trayIcon;
    private ContextMenu trayMenu;

    // 나머지 필드와 코드는 이전 코드와 동일하므로 생략합니다.

    public MainForm()
    {
        InitializeComponent();

        // 이전 코드는 여기에 있습니다.

        // 트레이 메뉴를 만듭니다.
        trayMenu = new ContextMenu();
        trayMenu.MenuItems.Add("Exit", OnExit);

        // 트레이 아이콘을 만듭니다.
        trayIcon = new NotifyIcon()
        {
            Text = "My Application",
            Icon = new Icon(SystemIcons.Application, 40, 40),
            ContextMenu = trayMenu,
            Visible = true
        };
    }

    protected override void OnLoad(EventArgs e)
    {
        Visible = false;  // Hide form window.
        ShowInTaskbar = false;  // Remove from taskbar.

        base.OnLoad(e);
    }

    private void OnExit(object sender, EventArgs e)
    {
        // 사용자에게 종료 확인 메시지를 표시합니다.
        var result = MessageBox.Show("정말로 종료하시겠습니까?", "확인", MessageBoxButtons.YesNo, MessageBoxIcon.Question);
        if (result == DialogResult.Yes)
        {
            Application.Exit();
        }
    }

    protected override void Dispose(bool isDisposing)
    {
        if (isDisposing)
        {
            // Release the icon resource.
            trayIcon.Dispose();
        }

        base.Dispose(isDisposing);
    }
}
