using System.Data.SqlClient;

// 데이터베이스 연결 문자열
string connectionString = "Data Source=서버주소;Initial Catalog=데이터베이스명;User ID=사용자ID;Password=비밀번호;";

// 저장 버튼 클릭 이벤트 핸들러
private void btnSave_Click(object sender, EventArgs e)
{
    string ipAdd1 = "값을 가져올 파라미터"; // 파라미터로 전달된 값

    string troubleText = txtTrouble.Text; // TextBox의 값

    // 줄바꿈 처리
    troubleText = troubleText.Replace(Environment.NewLine, "<br>"); // 줄바꿈 문자를 <br> 태그로 대체

    // 데이터베이스 연결
    using (SqlConnection connection = new SqlConnection(connectionString))
    {
        connection.Open();

        // SQL 쿼리 준비
        string query = "UPDATE iptbl1 SET trouble1 = @troubleText WHERE ipadd1 = @ipAdd1";
        SqlCommand command = new SqlCommand(query, connection);
        command.Parameters.AddWithValue("@troubleText", troubleText);
        command.Parameters.AddWithValue("@ipAdd1", ipAdd1);

        // SQL 쿼리 실행
        int rowsAffected = command.ExecuteNonQuery();

        // 저장 성공 여부 확인
        if (rowsAffected > 0)
        {
            MessageBox.Show("저장되었습니다.");
        }
        else
        {
            MessageBox.Show("저장에 실패했습니다.");
        }
    }
}

// 불러오기 버튼 클릭 이벤트 핸들러
private void btnLoad_Click(object sender, EventArgs e)
{
    string ipAdd1 = "값을 가져올 파라미터"; // 파라미터로 전달된 값

    // 데이터베이스 연결
    using (SqlConnection connection = new SqlConnection(connectionString))
    {
        connection.Open();

        // SQL 쿼리 준비
        string query = "SELECT trouble1 FROM iptbl1 WHERE ipadd1 = @ipAdd1";
        SqlCommand command = new SqlCommand(query, connection);
        command.Parameters.AddWithValue("@ipAdd1", ipAdd1);

        // SQL 쿼리 실행 및 결과 가져오기
        string troubleText = command.ExecuteScalar()?.ToString();

        // 줄바꿈 처리
        troubleText = troubleText?.Replace("<br>", Environment.NewLine); // <br> 태그를 줄바꿈 문자로 대체

        // TextBox에 표시
        txtTrouble.Text = troubleText;
    }
}
