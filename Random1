import pyodbc

# MSSQL 데이터베이스 연결 설정
conn = pyodbc.connect('DRIVER={SQL Server};SERVER=<서버주소>;DATABASE=<데이터베이스명>;UID=<사용자명>;PWD=<비밀번호>')

def find_similar_parts(input_str, top_n=10):
    input_vec = tfidf.transform([input_str])
    cosine_similarities = linear_kernel(input_vec, tfidf_matrix).flatten()
    related_docs_indices = cosine_similarities.argsort()[:-top_n-1:-1]
    similar_parts = data.iloc[related_docs_indices]

    cursor = conn.cursor()
    query = "INSERT INTO 검색결과 (업체PN, 부품코드, 유사도) VALUES (?, ?, ?)"

    for i, row in similar_parts.iterrows():
        company_pn = row['업체PN']
        part_code = row['부품코드']
        similarity = cosine_similarities[i]

        cursor.execute(query, (company_pn, part_code, similarity))
    
    conn.commit()

    # 검색 결과 반환
    return similar_parts['업체PN'].tolist()

# 검색 시 데이터베이스에 삽입
similar_parts = find_similar_parts(input1)

# 데이터베이스 연결 닫기
conn.close()
