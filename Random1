존 테이블의 구조만 복사하고 데이터를 삭제할 때 백업하는 트리거를 설정하려면, 먼저 Table_THP_Detail 테이블의 구조만 복사한 백업 테이블을 생성해야 합니다. 데이터를 포함하지 않고 구조만 복사하는 방법과 이후 트리거 설정에 대해 아래와 같이 진행할 수 있습니다.

1. 기존 테이블 구조 복사하여 백업 테이블 생성
아래 SQL 명령어를 사용하여 Table_THP_Detail 테이블의 구조만 복사한 Table_THP_Detail_Backup을 생성합니다:

-- 테이블 구조만 복사하기
SELECT TOP 0 *
INTO Table_THP_Detail_Backup
FROM Table_THP_Detail;

-- 추가적으로 삭제 날짜를 기록할 컬럼을 추가합니다
ALTER TABLE Table_THP_Detail_Backup
ADD DeletedDate DATETIME DEFAULT GETDATE();
여기서 SELECT TOP 0 * INTO Table_THP_Detail_Backup FROM Table_THP_Detail; 구문은 Table_THP_Detail의 구조만 복사하여 데이터를 포함하지 않은 Table_THP_Detail_Backup 테이블을 만듭니다.

2. 삭제 트리거 생성
Table_THP_Detail에서 데이터를 삭제할 때 백업 테이블에 데이터를 저장하는 트리거를 생성합니다.

-- 삭제 트리거 생성
CREATE TRIGGER trg_BackupOnDelete
ON Table_THP_Detail
AFTER DELETE
AS
BEGIN
    -- 삭제된 데이터를 백업 테이블에 삽입
    INSERT INTO Table_THP_Detail_Backup (Column1, Column2, Column3, ..., DeletedDate)
    SELECT Column1, Column2, Column3, ..., GETDATE()
    FROM DELETED;
END;
설명
AFTER DELETE 트리거가 Table_THP_Detail에서 DELETE가 발생할 때 실행됩니다.
DELETED 테이블에서 삭제된 데이터가 임시로 저장됩니다.