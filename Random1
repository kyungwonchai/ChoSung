트하려고 합니다. 이를 수행하기 위해, 먼저 데이터베이스에서 해당 LineA 값에 대해 몇 개의 행이 이미 존재하는지 확인해야 합니다. 그런 다음 존재하는 행 수에 따라 새 행을 삽입하거나 기존 행을 업데이트해야 합니다.

아래의 예제 코드는 이러한 작업을 수행하는 방법을 보여줍니다:

csharp

using System;
using System.Data;
using System.Data.SqlClient;

namespace UpdateDatabaseExample
{
    class Program
    {
        static void Main(string[] args)
        {
            string connectionString = "your_connection_string_here";
            string lineAValue = "some_value";
            string updateValue = "D123";

            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();

                int existingRowCount = GetExistingRowCount(connection, lineAValue);
                string query;

                if (existingRowCount < 3)
                {
                    // 해당 LineA 값에 대해 행이 3개 미만인 경우 새 행을 삽입
                    query = @"INSERT INTO TableA (LineA, D1, RowNumber) 
                              VALUES (@LineA, @D1, @RowNumber)";
                }
                else
                {
                    // 해당 LineA 값에 대해 행이 3개 이상인 경우 이전 행을 업데이트
                    query = @"UPDATE TableA 
                              SET D1 = @D1 
                              WHERE LineA = @LineA AND RowNumber = @RowNumber";
                }

                using (SqlCommand command = new SqlCommand(query, connection))
                {
                    command.Parameters.Add(new SqlParameter("@LineA", lineAValue));
                    command.Parameters.Add(new SqlParameter("@D1", updateValue));
                    command.Parameters.Add(new SqlParameter("@RowNumber", existingRowCount + 1));

                    command.ExecuteNonQuery();
                }

                connection.Close();
            }
        }

        static int GetExistingRowCount(SqlConnection connection, string lineAValue)
        {
            string query = @"SELECT COUNT(*) 
                             FROM TableA 
                             WHERE LineA = @LineA";

            using (SqlCommand command = new SqlCommand(query, connection))
            {
                command.Parameters.Add(new SqlParameter("@LineA", lineAValue));
                return (int)command.ExecuteScalar();
            }
        }
    }
}

위 코드는 먼저 GetExistingRowCount 메소드를 사용하여 지정된 LineA 값에 대해 몇 개의 행이 이미 존재하는지 확인합니다. 그런 다음 existingRowCount 값이 3 미만인지 확인하고, 그에 따라 새 행을 삽입