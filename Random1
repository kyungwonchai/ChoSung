using System;
using System.Diagnostics;
using System.IO;
using System.Threading;

namespace ScreenRecorder
{
    class Program
    {
        static void Main(string[] args)
        {
            string path = @"D:\blackbox";
            if (!Directory.Exists(path))
            {
                Directory.CreateDirectory(path);
            }

            Console.WriteLine("녹화 시작");
            for (int i = 0; i < 60480; i++)
            {
                string fileName = Path.Combine(path, DateTime.Now.ToString("yyyyMMddHHmmss") + ".mp4");
                using (Process process = new Process())
                {
                    process.StartInfo.FileName = "ffmpeg";
                    process.StartInfo.Arguments = $"-f dshow -i video=\"UScreenCapture\" -vcodec libx264 -crf 40 -preset ultrafast -t 00:00:10 {fileName}";
                    process.StartInfo.RedirectStandardOutput = true;
                    process.StartInfo.UseShellExecute = false;
                    process.StartInfo.CreateNoWindow = true;
                    process.Start();

                    process.WaitForExit();
                }
                Console.WriteLine($"{fileName} 저장 완료");
                Thread.Sleep(10000); // 다음 녹화를 위해 10초 대기
            }
            Console.WriteLine("녹화 종료");
        }
    }
}
