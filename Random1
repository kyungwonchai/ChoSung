능합니다. PM2가 동작하지 않을 때 와치독을 이용해 라즈베리파이를 재부팅하는 것은 사용자님이 원하시는 바로 그 시나리오에 해당합니다.

PM2 감지 및 재부팅 설정 방법
PM2 서비스의 상태를 확인하는 스크립트를 작성하여 와치독과 연결하면 됩니다. 이전에 설명드렸던 myservice-check.sh 스크립트를 pm2-check.sh로 바꾸고, 그 내용을 PM2 상태를 확인하는 코드로 수정하면 됩니다.

1단계: /etc/watchdog.conf 파일 수정 ⚙️
와치독이 주기적으로 실행할 스크립트 경로를 지정합니다. 이전에 설정했다면 동일하게 사용하면 됩니다.

Ini, TOML

# 와치독이 주기적으로 실행할 스크립트 경로 지정
test-binary = /etc/watchdog.d/pm2-check.sh

# 스크립트 실행 간격
interval = 5

# 이 시간 동안 스크립트가 연속으로 실패하면 재부팅
watchdog-timeout = 60
2단계: PM2 상태 확인 스크립트 작성 📝
PM2 서비스가 정상인지 확인하는 스크립트를 작성합니다. PM2의 상태는 systemctl로 확인하는 것이 가장 확실합니다.

Bash

sudo nano /etc/watchdog.d/pm2-check.sh
스크립트 내용:

Bash

#!/bin/bash

# PM2 서비스가 활성 상태인지 확인합니다.
# PM2가 멈추거나 문제가 생기면 이 명령어가 실패합니다.
if ! systemctl is-active --quiet pm2; then
  # exit 1은 '실패'를 의미하며, 와치독에게 문제가 있음을 알립니다.
  exit 1
fi

# PM2 서비스가 정상이라면 exit 0을 반환하여 와치독에게 '성공'을 알립니다.
exit 0
3단계: 스크립트 실행 권한 부여
Bash

sudo chmod +x /etc/watchdog.d/pm2-check.sh
4단계: 와치독 서비스 재시작 🔄
모든 설정이 완료되면 와치독 서비스를 재시작하여 변경 사항을 적용합니다.

Bash
