<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:local="clr-namespace:LockerManagementApp.Views"
    xmlns:viewmodels="clr-namespace:LockerManagementApp.ViewModels"
    xmlns:models="clr-namespace:LockerManagementApp.Models"
    Title="사물함 관리 프로그램 (DevExpress MVVM)" Height="600" Width="1000"
    Loaded="ThemedWindow_Loaded"
    Closing="ThemedWindow_Closing">

    <dx:ThemedWindow.DataContext>
        <viewmodels:MainViewModel/>
    </dx:ThemedWindow.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="{dx:ThemeResource ThemeBrush}" Padding="5">
             <StackPanel Orientation="Horizontal">
                <Button Content="🔄 Load/Refresh" Margin="3" Command="{Binding LoadDataCommand}" ToolTip="데이터베이스에서 최신 정보를 불러옵니다."/>
                <Button Content="💾 Save Changes" Margin="3" Command="{Binding SaveChangesCommand}" ToolTip="변경 사항을 데이터베이스에 저장합니다."/>
                <Button Content="➕ Add New Locker" Margin="3" Command="{Binding AddNewCommand}" ToolTip="새로운 사물함 정보를 추가합니다 (행 추가 후 편집)."/>
                <Button Content="❌ Delete Selected" Margin="3" Command="{Binding DeleteCommand}" ToolTip="선택된 사물함 정보를 삭제합니다."/>
                 <Button Content="🧹 Clear Assignment" Margin="3,3,15,3" Command="{Binding ClearAssignmentCommand}" ToolTip="선택된 사물함의 사용자 배정 정보를 제거합니다."/>
            </StackPanel>
        </Border>

        <dxg:GridControl Grid.Row="1"
                         ItemsSource="{Binding LockerAssignments}"
                         SelectedItem="{Binding SelectedAssignment, Mode=TwoWay}"
                         AutoGenerateColumns="None"
                         EnableSmartColumnsGeneration="True">

            <dxg:GridControl.View>
                <dxg:TableView AllowPerPixelScrolling="True"
                               ShowTotalSummary="False"
                               ShowGroupPanel="True"  AllowEditing="True"    AllowAddingNewItems="False" AllowDeletingItems="False" NavigationStyle="Cell" ShowAutoFilterRow="True" NewItemRowPosition="None">
                     <dxg:TableView.RowCellMenuCustomizations>
                         <dx:BarButtonItem Content="Clear Assignment"
                                           Command="{Binding View.DataContext.ClearAssignmentCommand}"
                                           Glyph="{dx:DXImage 'Svg/Actions/DeleteList.svg'}"/>
                         <dx:BarButtonItem Content="Delete Row"
                                           Command="{Binding View.DataContext.DeleteCommand}"
                                            Glyph="{dx:DXImage Svg/Actions/Delete.svg}"/>
                     </dxg:TableView.RowCellMenuCustomizations>
                </dxg:TableView>
            </dxg:GridControl.View>

            <dxg:GridControl.Columns>
                <dxg:GridColumn FieldName="LockerType" Header="종류">
                    <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.LockerTypes, RelativeSource={RelativeSource AncestorType={x:Type dx:ThemedWindow}}}"
                                                  IsTextEditable="False"/> </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>

                 <dxg:GridColumn FieldName="Floor" Header="층">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Floors, RelativeSource={RelativeSource AncestorType={x:Type dx:ThemedWindow}}}"
                                                  IsTextEditable="False"/>
                    </dxg:GridColumn.EditSettings>
                 </dxg:GridColumn>

                <dxg:GridColumn FieldName="Zone" Header="구역">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Zones, RelativeSource={RelativeSource AncestorType={x:Type dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/> </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>

                <dxg:GridColumn FieldName="SpecificLocation" Header="세부 위치"/>

                 <dxg:GridColumn FieldName="UserName" Header="성명"/>
                <dxg:GridColumn FieldName="KnoxId" Header="Knox ID"/>

                <dxg:GridColumn FieldName="SubPart" Header="소파트">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.SubParts, RelativeSource={RelativeSource AncestorType={x:Type dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>

                 <dxg:GridColumn FieldName="Administrator" Header="관리자">
                      <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Administrators, RelativeSource={RelativeSource AncestorType={x:Type dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/>
                    </dxg:GridColumn.EditSettings>
                 </dxg:GridColumn>

                <dxg:GridColumn FieldName="LastUpdated" Header="최종 수정일" AllowEditing="False">
                     <dxg:GridColumn.EditSettings>
                        <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>

                <dxg:GridColumn FieldName="Id" Header="ID" Visible="False" ReadOnly="True"/> </dxg:GridControl.Columns>

            <dxg:GridControl.ViewSettings>
                 <dxg:TableViewSettings ShowSearchPanelMode="Always" />
             </dxg:GridControl.ViewSettings>

        </dxg:GridControl>

        <StatusBar Grid.Row="2" Background="{dx:ThemeResource EditorGroupBox.Background}">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusBarText}" Margin="5,0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>