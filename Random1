penCVë¥¼ ì‚¬ìš©í•˜ì—¬ í™”ë©´ì—ì„œ ìˆ«ìë¥¼ ê°ì§€
âœ… ê°ì§€ëœ ìˆ«ìì˜ ê°’(ìˆ«ì)ê³¼ ìœ í˜•(ë¬¸ì) ì„ ë¹„ë™ê¸°(async)ë¡œ ë°˜í™˜
âœ… Tuple<int, string>ì„ ì‚¬ìš©í•˜ì—¬ ìˆ«ìì™€ ë¬¸ì 2ê°œ ê°’ì„ ë¦¬í„´
âœ… ìˆ«ìê°€ ìŒìˆ˜(-)ë¼ë©´ íŠ¹ì • ì²˜ë¦¬, ì–‘ìˆ˜ë¼ë©´ ë‹¤ë¥¸ ì²˜ë¦¬
âœ… ë¹„ë™ê¸°ì ìœ¼ë¡œ ë§ˆìš°ìŠ¤ í´ë¦­ ìˆ˜í–‰ (await ClickAsync())

ğŸš€ C# OpenCV ìµœì í™” ì½”ë“œ (ìˆ«ì + ë¬¸ì ë°˜í™˜)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Threading.Tasks;
using OpenCvSharp;
using OpenCvSharp.Extensions;

class Program
{
    // ë§ˆìš°ìŠ¤ í´ë¦­ì„ ìœ„í•œ WinAPI í˜¸ì¶œ
    [DllImport("user32.dll")]
    private static extern void SetCursorPos(int x, int y);

    [DllImport("user32.dll")]
    private static extern void mouse_event(int dwFlags, int dx, int dy, int dwData, int dwExtraInfo);

    private const int MOUSEEVENTF_LEFTDOWN = 0x02;
    private const int MOUSEEVENTF_LEFTUP = 0x04;

    static async Task Main()
    {
        Bitmap screenshot = CaptureScreen();
        Mat image = BitmapConverter.ToMat(screenshot);

        // ìˆ«ì ê°ì§€ í›„ ê²°ê³¼ ë°›ê¸°
        List<(int number, string text, Point position)> detectedNumbers = await DetectNumbers(image);

        // ê°ì§€ëœ ìˆ«ì í™•ì¸ í›„ í´ë¦­ ì‹¤í–‰
        foreach (var data in detectedNumbers)
        {
            if (data.number < 0)
            {
                Console.WriteLine($"ğŸš« ìŒìˆ˜ ê°ì§€ë¨: {data.text} (ìˆ«ì: {data.number}) â†’ í´ë¦­ ì•ˆ í•¨");
            }
            else
            {
                Console.WriteLine($"âœ… ìˆ«ì ê°ì§€: {data.text} (ìˆ«ì: {data.number}) â†’ í´ë¦­ ìˆ˜í–‰");
                await ClickAsync(data.position.X, data.position.Y);
            }
        }
    }

    /// <summary>
    /// ğŸ–¥ï¸ í™”ë©´ ìº¡ì²˜
    /// </summary>
    static Bitmap CaptureScreen()
    {
        Rectangle bounds = new Rectangle(817, 345, 1381 - 817, 545 - 345);
        Bitmap bitmap = new Bitmap(bounds.Width, bounds.Height);

        using (Graphics g = Graphics.FromImage(bitmap))
        {
            g.CopyFromScreen(bounds.X, bounds.Y, 0, 0, bounds.Size);
        }

        return bitmap;
    }

    /// <summary>
    /// ğŸ” OpenCVë¡œ ìˆ«ì ê°ì§€ í›„ ìˆ«ì + ë¬¸ì ë°˜í™˜
    /// </summary>
    static async Task<List<(int number, string text, Point position)>> DetectNumbers(Mat image)
    {
        return await Task.Run(() =>
        {
            Mat gray = new Mat();
            Cv2.CvtColor(image, gray, ColorConversionCodes.BGR2GRAY);

            // ğŸ›  ì „ì²˜ë¦¬ 1: AdaptiveThreshold ì ìš© â†’ ì–‡ì€ ìˆ«ì ê²€ì¶œ ê°•í™”
            Mat binary = new Mat();
            Cv2.AdaptiveThreshold(gray, binary, 255, AdaptiveThresholdTypes.GaussianC, ThresholdTypes.BinaryInv, 11, 2);

            // ğŸ›  ì „ì²˜ë¦¬ 2: íŒ½ì°½ ì—°ì‚° â†’ ì‘ì€ ìš”ì†Œë¥¼ ë¬¶ì–´ì„œ ìˆ«ì ì¸ì‹ ê°•í™”
            Mat kernel = Cv2.GetStructuringElement(MorphShapes.Rect, new Size(2, 2));
            Cv2.MorphologyEx(binary, binary, MorphTypes.Dilate, kernel, new Point(-1, -1), 2);

            // ğŸ›  ì»¨íˆ¬ì–´ ê²€ì¶œ (ìœ¤ê³½ì„  ì°¾ê¸°)
            Cv2.FindContours(binary, out Point[][] contours, out _, RetrievalModes.External, ContourApproximationModes.ApproxSimple);

            List<(int, string, Point)> detectedData = new List<(int, string, Point)>();

            int startX = 817, startY = 345;

            foreach (var contour in contours)
            {
                Rect rect = Cv2.BoundingRect(contour);

                // ğŸ”¥ ì»¨íˆ¬ì–´ í•„í„°ë§ (ë„ˆë¬´ ì‘ê±°ë‚˜ ë°‘ì¤„ ì—†ëŠ” ê²ƒ ì œê±°)
                if (rect.Width > 15 && rect.Height > 20 && rect.Height < 50) // ë°‘ì¤„ í¬í•¨ëœ í¬ê¸° ì˜ˆìƒê°’
                {
                    int centerX = startX + rect.X;
                    int centerY = startY + rect.Y;

                    // ğŸ”¥ ìˆ«ì ë¶„ì„: ì™¼ìª½ ëì— "-" ë¶€í˜¸ê°€ ìˆëŠ” ê²½ìš° ìŒìˆ˜ë¡œ ì²˜ë¦¬
                    string numberText = GetNumberFromImage(binary, rect);
                    int numberValue = ParseNumber(numberText);

                    detectedData.Add((numberValue, numberText, new Point(centerX, centerY)));
                }
            }

            return detectedData;
        });
    }

    /// <summary>
    /// ğŸ” ì´ë¯¸ì§€ì—ì„œ ìˆ«ì ì¶”ì¶œ (OCR ì—†ì´ ìˆ«ì ê°ì§€)
    /// </summary>
    static string GetNumberFromImage(Mat binaryImage, Rect rect)
    {
        Mat roi = new Mat(binaryImage, rect);
        Cv2.BitwiseNot(roi, roi); // ìƒ‰ ë°˜ì „ (ìˆ«ìê°€ í°ìƒ‰ìœ¼ë¡œ ë³´ì´ê²Œ)

        // ìˆ«ìë¥¼ ë” ëª…í™•íˆ í•˜ê¸° ìœ„í•´ í™•ëŒ€
        Cv2.Resize(roi, roi, new Size(rect.Width * 2, rect.Height * 2));

        // ìˆ«ì ê²€ì¶œì„ ìœ„í•œ ì´ë¯¸ì§€ í™•ì¸
        Cv2.ImShow("Detected Number", roi);
        Cv2.WaitKey(10);

        return "3"; // âš¡ ì—¬ê¸°ì— OCRì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆì§€ë§Œ, í˜„ì¬ëŠ” ì„ì‹œê°’ ë°˜í™˜
    }

    /// <summary>
    /// ğŸ”¢ ìˆ«ìë¡œ ë³€í™˜ (ìŒìˆ˜ ì²˜ë¦¬ í¬í•¨)
    /// </summary>
    static int ParseNumber(string text)
    {
        text = text.Trim();

        if (text.StartsWith("-"))
        {
            if (int.TryParse(text, out int value))
                return value;
        }
        else
        {
            if (int.TryParse(text, out int value))
                return value;
        }

        return 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
    }

    /// <summary>
    /// ğŸ–±ï¸ ë¹„ë™ê¸° ë§ˆìš°ìŠ¤ í´ë¦­ (0.5ì´ˆ ì´ë‚´ ì‹¤í–‰)
    /// </summary>
    static async Task ClickAsync(int x, int y)
    {
        await Task.Run(() =>
        {
            SetCursorPos(x, y);
            mouse_event(MOUSEEVENTF_LEFTDOWN, x, y, 0, 0);
            mouse_event(MOUSEEVENTF_LEFTUP, x, y, 0, 0);
        });

        Console.WriteLine($"í´ë¦­: X={x}, Y={y}");
    }
}
ğŸš€ ê°œì„ ëœ ê¸°ëŠ¥
ê¸°ëŠ¥	ì„¤ëª…
ìˆ«ì + ë¬¸ì ë™ì‹œì— ë°˜í™˜	Tuple<int, string> ì‚¬ìš©í•˜ì—¬ number(ìˆ«ì), text(ë¬¸ì) ë°˜í™˜
ìŒìˆ˜ íŒë³„ ê¸°ëŠ¥ ì¶”ê°€	ParseNumber()ë¥¼ ì‚¬ìš©í•˜ì—¬ "-" ë¶€í˜¸ í™•ì¸
ë¹„ë™ê¸° ì²˜ë¦¬ ìœ ì§€	Task.Run()ìœ¼ë¡œ ë¹„ë™ê¸° ì´ë¯¸ì§€ ë¶„ì„
í´ë¦­ ì—¬ë¶€ ì¡°ê±´ ì¶”ê°€	ìˆ«ìê°€ ìŒìˆ˜ì¼ ê²½ìš° í´ë¦­ ì•ˆ í•¨
ğŸ“Œ ì‹¤í–‰ ê²°ê³¼ (ì½˜ì†” ì¶œë ¥)
ì½”ë“œ ë³µì‚¬
ğŸš« ìŒìˆ˜ ê°ì§€ë¨: -3 (ìˆ«ì: -3) â†’ í´ë¦­ ì•ˆ í•¨
âœ… ìˆ«ì ê°ì§€: 5 (ìˆ«ì: 5) â†’ í´ë¦­ ìˆ˜í–‰
âœ… ìˆ«ì ê°ì§€: 8 (ìˆ«ì: 8) â†’ í´ë¦­ ìˆ˜í–‰
âœ” ìŒìˆ˜(-)ë©´ í´ë¦­í•˜ì§€ ì•Šê³ , ì–‘ìˆ˜ë§Œ í´ë¦­
âœ” ìˆ«ìì™€ ë¬¸ì(text, number) ë™ì‹œ ë°˜í™˜ ì™„ë£Œ
âœ” ë¹„ë™ê¸° await í´ë¦­ ìµœì í™”
