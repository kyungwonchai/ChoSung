이 문제는 소켓 서버를 시작할 때 포트 번호가 제대로 설정되지 않아 발생하는 것입니다. 첫 실행 시에 포트가 선택되지 않았거나 잘못된 값이 전달된 경우 발생할 수 있습니다. 이 문제를 해결하기 위해, 소켓 서버 시작 시 포트 번호를 올바르게 설정하고, 선택된 포트가 없을 경우 기본값을 설정하도록 수정하겠습니다.

수정된 코드
PortComboBox_SelectionChanged 메서드를 수정하여 기본 포트 값을 사용하고, 포트 번호가 유효한지 확인하도록 합니다.

csharp
코드 복사
private void PortComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    try
    {
        // 포트 선택이 없을 경우 기본값으로 20000을 사용
        string selectedPort = PortComboBox.SelectedItem?.ToString() ?? "20000";

        // 포트 번호가 유효한지 확인
        if (int.TryParse(selectedPort, out int portNumber))
        {
            // 포트 번호가 유효하다면 소켓 서버를 시작
            socketServer.Start(portNumber);
            settingsManager.SaveSetting("Port", selectedPort);
        }
        else
        {
            // 유효하지 않은 포트 번호인 경우 로그에 오류 메시지 기록
            LogMessage($"포트 번호가 유효하지 않습니다: {selectedPort}");
        }

        // QR 코드 업데이트
        string ipAddress = GetLocalIPAddress();
        GenerateQRCode(ipAddress, selectedPort);
    }
    catch (Exception ex)
    {
        LogMessage($"포트 설정 중 오류 발생: {ex.Message}");
    }
}
주요 변경 사항:
기본 포트 값 설정:

PortComboBox.SelectedItem?.ToString()으로 선택된 포트가 없는 경우를 처리하고, 기본값으로 "20000"을 사용합니다.
포트 번호 유효성 검사:

int.TryParse(selectedPort, out int portNumber)를 사용하여 포트 번호가 유효한지 확인합니다.
유효하지 않으면 로그에 메시지를 기록하고, 소켓 서버 시작을 방지합니다.
소켓 서버 시작:

포트 번호가 유효할 경우에만 소켓 서버를 시작합니다.
이로 인해 첫 실행 시 유효하지 않은 포트로 인해 발생하는 오류를 방지합니다.
이제 첫 실행 시에도 포트 번호가 올바르게 설정되고, 소켓 서버가 정상적으로 시작될 것입니다. 추가적으로 문제가 발생하거나 다른 질문이 있으시면 언제든지 알려주세요!