#에서는 EPPlus 라이브러리를 사용하여 Excel 파일을 열고 다룰 수 있습니다. 아래에는 파이썬 코드를 포함하여 C#으로 전체적인 코드를 변환한 예시입니다.

C# 코드:

csharp

using System;
using System.Collections.Generic;
using System.Text.RegularExpressions;
using System.Data.SqlClient;
using OfficeOpenXml;
using System.Linq;

namespace YourNamespace
{
    class Program
    {
        static void Main(string[] args)
        {
            string filePath = @"C:\allfiles\11.xlsx";
            ExcelPackage package = new ExcelPackage(new FileInfo(filePath));
            ExcelWorksheet sheet = package.Workbook.Worksheets[0];
            
            List<string> columns = new List<string>();
            Regex regex = new Regex("[your_pattern_here]");
            
            // Assuming second row in Excel file contains headers
            for (int col = 2; col <= sheet.Dimension.End.Column; col++)
            {
                object cellValue = sheet.Cells[2, col].Value;
                if (cellValue == null) continue;

                string result = regex.Replace(cellValue.ToString(), "-");
                string columnName = "C_" + result;

                if (columnName.StartsWith("C_"))
                {
                    columns.Add(columnName);
                }
            }

            using (SqlConnection conn = new SqlConnection("Your Connection String Here"))
            {
                conn.Open();
                SqlCommand cmd = new SqlCommand();
                cmd.Connection = conn;

                DateTime currentTime = DateTime.Now;
                string formattedTime = currentTime.ToString("yyyy-MM-dd HH:mm:ss");
                int numbb = 1;

                for (int row = 3; row <= sheet.Dimension.End.Row; row++)
                {
                    var rowValues = Enumerable.Range(2, columns.Count)
                                              .Select(col => sheet.Cells[row, col].Value)
                                              .ToArray();

                    if (rowValues.All(element => element == null))
                    {
                        break;
                    }
                    
                    if (string.IsNullOrEmpty(rowValues[2]?.ToString()))
                    {
                        continue;
                    }

                    Dictionary<string, object> data = new Dictionary<string, object>();
                    for (int i = 0; i < columns.Count; i++)
                    {
                        data[columns[i]] = rowValues[i];
                    }
                    
                    List<string> dataWithQuotes = new List<string>();
                    foreach (var value in data.Values)
                    {
                        dataWithQuotes.Add($"'{value}'");
                    }
                    
                    dataWithQuotes.Add(numbb.ToString());
                    dataWithQuotes.Add($"'{formattedTime}'");
                    
                    string insertQuery = $"INSERT INTO T_메인확정 ({string.Join(",", columns)}, N_number, N_time) VALUES ({string.Join(",", dataWithQuotes)})";
                    cmd.CommandText = insertQuery;
                    cmd.ExecuteNonQuery();
                    
                    numbb++;
                }
                
                conn.Close();
            }
        }
    }
}

이 코드는 EPPlus 라이브러리를 사용하므로 NuGet 패키지 관리자에서 해당 라이브러리를 설치해야 합니다. 또한, 이 예제에서는 SQL Server를 사용하므로 System.Data.SqlClient도 추가해야 합니다. SQL 연결 문자열은 "Your Connection String Here" 부분에 입력하시면