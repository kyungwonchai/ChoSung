7에서는 이벤트 내에서 임시 테이블을 생성하거나 동적 SQL을 사용하는 것이 제한될 수 있습니다. 대신, 다른 접근 방식을 사용하여 동일한 작업을 수행할 수 있습니다.

저장 프로시저를 사용하여 임시 테이블을 생성하고 삭제 작업을 수행합니다.
이벤트에서 저장 프로시저를 호출합니다.
1단계: 저장 프로시저 생성
먼저, 저장 프로시저를 생성하여 삭제 작업을 수행합니다.

sql
코드 복사
DELIMITER //

CREATE PROCEDURE delete_specific_rows()
BEGIN
    -- 임시 테이블 생성 및 서브쿼리 결과 저장
    CREATE TEMPORARY TABLE tmp_barcodes
    SELECT barcode
    FROM smd.ft_2d_archive
    WHERE machine = 2;
    
    -- 임시 테이블을 사용하여 삭제 작업 수행
    DELETE FROM smd.ft_2d_archive
    WHERE machine = 1
      AND ftsite = '0,0'
      AND barcode IN (SELECT barcode FROM tmp_barcodes);
    
    -- 임시 테이블 삭제
    DROP TEMPORARY TABLE tmp_barcodes;
END //

DELIMITER ;
2단계: 이벤트에서 저장 프로시저 호출
이제 이벤트를 등록하여 저장 프로시저를 주기적으로 호출합니다.

sql
코드 복사
-- 이벤트 스케줄러 활성화
SET GLOBAL event_scheduler = ON;

-- 이벤트 등록
CREATE EVENT delete_specific_rows_event
ON SCHEDULE EVERY 1 DAY
DO
CALL delete_specific_rows();
전체 과정
저장 프로시저 생성
sql
코드 복사
DELIMITER //

CREATE PROCEDURE delete_specific_rows()
BEGIN
    -- 임시 테이블 생성 및 서브쿼리 결과 저장
    CREATE TEMPORARY TABLE tmp_barcodes
    SELECT barcode
    FROM smd.ft_2d_archive
    WHERE machine = 2;
    
    -- 임시 테이블을 사용하여 삭제 작업 수행
    DELETE FROM smd.ft_2d_archive
    WHERE machine = 1
      AND ftsite = '0,0'
      AND barcode IN (SELECT barcode FROM tmp_barcodes);
    
    -- 임시 테이블 삭제
    DROP TEMPORARY TABLE tmp_barcodes;
END //

DELIMITER ;
이벤트 등록
sql
코드 복사
-- 이벤트 스케줄러 활성화
SET GLOBAL event_scheduler = ON;

-- 이벤트 등록
CREATE EVENT delete_specific_rows_event
ON SCHEDULE EVERY 1 DAY
DO
CALL delete_specific_rows();
이 스크립트를 실행하면 MySQL에서 매일 한 번씩 delete_specific_rows 저장 프로시저를 호출하여 조건에 맞는