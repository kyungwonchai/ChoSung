경원님, 반갑습니다! 윈도우 11 환경에서 여러 대의 라즈베리파이를 한 번에 제어하기 위해 **SSH 키 기반의 자동 로그인(Passwordless SSH)**을 설정하는 것은 아주 현명한 선택입니다.

이 과정은 보안을 강화하면서도 매번 비밀번호를 입력해야 하는 번거로움을 완전히 해결해 줍니다. 요청하신 대로 ip.txt 파일을 읽어 자동으로 키를 심어주는 원샷 파이썬 스크립트와 상세 가이드를 준비했습니다.

1. 사전 준비 (Windows 11)
스크립트를 실행하기 전, 윈도우 PC에 공개키(Public Key)가 생성되어 있어야 합니다.

터미널(PowerShell 또는 CMD) 열기

ssh-keygen -t rsa -b 4096 입력 후 엔터 (파일 경로는 기본값으로 유지)

이미 키가 있다면 생략해도 좋습니다. 보통 C:\Users\사용자이름\.ssh\id_rsa.pub 경로에 생성됩니다.

2. 프로젝트 구조 (cpp17 폴더)
요청하신 대로 cpp17 폴더 내에서 작업을 진행하도록 구성하겠습니다.

Plaintext

cpp17/
├── ip.txt                # 관리할 라즈베리파이 IP 목록 (한 줄에 하나씩)
└── setup_ssh_keys.py     # 자동화 스크립트
3. 원샷 파이썬 스크립트
이 스크립트는 paramiko 라이브러리를 사용합니다. 파이참 터미널에서 pip install paramiko를 먼저 실행해 주세요.

Python

import os
import paramiko

def inject_ssh_key():
    # --- 설정 영역 ---
    ip_file = 'ip.txt'
    username = 'pi'
    password = 'raspberry'
    
    # Windows의 기본 SSH 공개키 경로
    pub_key_path = os.path.expanduser('~/.ssh/id_rsa.pub')
    
    if not os.path.exists(pub_key_path):
        print(f"[오류] 공개키를 찾을 수 없습니다: {pub_key_path}")
        print("터미널에서 'ssh-keygen'을 실행하여 키를 먼저 생성하세요.")
        return

    # 공개키 내용 읽기
    with open(pub_key_path, 'r') as f:
        public_key = f.read().strip()

    # IP 목록 읽기
    if not os.path.exists(ip_file):
        print(f"[오류] {ip_file} 파일이 존재하지 않습니다.")
        return

    with open(ip_file, 'r') as f:
        ips = [line.strip() for line in f if line.strip()]

    print(f"총 {len(ips)}대의 장치에 키 주입을 시작합니다.")

    for ip in ips:
        print(f"\n[{ip}] 접속 시도 중...")
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        
        try:
            # SSH 접속
            ssh.connect(ip, username=username, password=password, timeout=10)
            
            # .ssh 폴더 생성 및 권한 설정, 키 추가 (한 번에 실행)
            commands = [
                "mkdir -p ~/.ssh",
                "chmod 700 ~/.ssh",
                f"echo '{public_key}' >> ~/.ssh/authorized_keys",
                "chmod 600 ~/.ssh/authorized_keys"
            ]
            
            full_command = " && ".join(commands)
            stdin, stdout, stderr = ssh.exec_command(full_command)
            
            # 결과 확인
            error = stderr.read().decode()
            if error:
                print(f"[{ip}] 명령 실행 중 에러 발생: {error}")
            else:
                print(f"[{ip}] SSH 키 주입 성공!")
                
        except Exception as e:
            print(f"[{ip}] 접속 실패: {e}")
        finally:
            ssh.close()

if __name__ == "__main__":
    inject_ssh_key()
4. 실행 방법 (PyCharm 기준)
폴더 생성: cpp17 폴더를 만듭니다.

IP 목록 작성: ip.txt 파일을 만들고 라즈베리파이 IP들을 입력합니다.

예: 192.168.0.10

라이브러리 설치: 파이참 하단 Terminal 탭에서 아래 명령을 입력합니다.

Bash

pip install paramiko
스크립트 실행: setup_ssh_keys.py를 실행합니다.

5. 확인 및 다음 단계
작업이 완료되면, 이후에는 파이참이나 터미널에서 비밀번호 없이 바로 접속이 가능합니다.

Bash

ssh pi@<라즈베리파이IP>
경원님, 혹시 다음 단계로 이 IP 목록을 활용해서 특정 설정(예: Nginx 자동 설치나 8028 포트 개방 등)을 모든 장비에 일괄적으로 적용하는 스크립트가 더 필요하신가요? 원하시면 바로 이어서 작성해 드릴 수 있습니다.