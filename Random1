using System;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Threading.Tasks;

class Program
{
    // 마우스 클릭을 위한 WinAPI 호출
    [DllImport("user32.dll")]
    private static extern void SetCursorPos(int x, int y);

    [DllImport("user32.dll")]
    private static extern void mouse_event(int dwFlags, int dx, int dy, int dwData, int dwExtraInfo);

    private const int MOUSEEVENTF_LEFTDOWN = 0x02;
    private const int MOUSEEVENTF_LEFTUP = 0x04;

    static async Task Main()
    {
        // 숫자 감지 후 값 받기
        (int number, string text) = await DetectNumberAsync();

        // 숫자가 음수인지 확인
        if (number < 0)
        {
            Console.WriteLine($"🚫 음수 감지됨: {text} (숫자: {number}) → 클릭 안 함");
        }
        else
        {
            Console.WriteLine($"✅ 숫자 감지: {text} (숫자: {number}) → 클릭 수행");
            await ClickAsync(100, 200); // 예제 클릭
        }
    }

    /// <summary>
    /// 🔍 숫자 감지 함수 (숫자 + 문자 리턴)
    /// </summary>
    static async Task<(int, string)> DetectNumberAsync()
    {
        return await Task.Run(() =>
        {
            int detectedNumber = -3;   // 감지된 숫자 (예제)
            string detectedText = "-3"; // 감지된 문자 값 (예제)

            return (detectedNumber, detectedText); // 2개 값 반환 (Tuple)
        });
    }

    /// <summary>
    /// 🖱️ 비동기 마우스 클릭 (0.5초 이내 실행)
    /// </summary>
    static async Task ClickAsync(int x, int y)
    {
        await Task.Run(() =>
        {
            SetCursorPos(x, y);
            mouse_event(MOUSEEVENTF_LEFTDOWN, x, y, 0, 0);
            mouse_event(MOUSEEVENTF_LEFTUP, x, y, 0, 0);
        });

        Console.WriteLine($"클릭: X={x}, Y={y}");
    }