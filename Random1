s.dm_io_virtual_file_stats에서 num_of_reads 또는 num_of_writes가 0일 때 발생합니다. 이를 방지하기 위해 NULLIF 함수를 사용하여 나누는 값이 0일 경우 NULL로 처리합니다. 아래는 수정된 코드입니다.

sql
코드 복사
-- IO 부하 확인 (0으로 나누기 방지)
SELECT 
    DB_NAME(fs.database_id) AS DatabaseName,
    CASE 
        WHEN fs.num_of_reads = 0 THEN NULL
        ELSE fs.io_stall_read_ms / NULLIF(fs.num_of_reads, 0)
    END AS AvgReadLatency_ms,
    CASE 
        WHEN fs.num_of_writes = 0 THEN NULL
        ELSE fs.io_stall_write_ms / NULLIF(fs.num_of_writes, 0)
    END AS AvgWriteLatency_ms,
    fs.io_stall_read_ms AS TotalReadStall_ms,
    fs.io_stall_write_ms AS TotalWriteStall_ms
FROM sys.dm_io_virtual_file_stats(NULL, NULL) fs
ORDER BY AvgReadLatency_ms DESC;
수정된 코드 설명
NULLIF(fs.num_of_reads, 0) 사용

fs.num_of_reads가 0이면 NULL을 반환하여 나누기 연산을 방지합니다.
CASE 문

fs.num_of_reads 또는 fs.num_of_writes가 0인 경우 NULL로 표시하여 평균 지연 시간이 계산되지 않도록 합니다.
정렬 기준

AvgReadLatency_ms 값이 계산된 경우에만 정렬되도록 합니다.
출력 결과
AvgReadLatency_ms와 AvgWriteLatency_ms는 값이 계산되지 않는 경우 NULL로 표시됩니다.