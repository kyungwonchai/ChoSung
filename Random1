습니다. 사용자가 요청하신 기능을 추가하여 .ini 파일을 사용하는 WPF 애플리케이션의 전체 코드를 업데이트하겠습니다.

업데이트 사항:

선택한 로그 파일 경로와 백업 폴더 경로를 화면에 표시.
시작 버튼을 추가하여 로그 감시를 시작할 수 있도록 함.
처음 로그 파일을 선택할 때 마지막 3줄을 표시하고 "최종 3줄"이라고 라벨링.
"시작" 버튼을 누른 이후부터 추가되는 로그만 감지하여 표시.
XAML 파일 (MainWindow.xaml)
xml
코드 복사
<Window x:Class="LogMonitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Log Monitor" Height="500" Width="800" Background="Purple">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal" Margin="10">
            <Button Content="Select Log File" Click="SelectLogFile_Click" Margin="5"/>
            <TextBlock Name="LogFilePathTextBlock" VerticalAlignment="Center" Margin="5"/>
        </StackPanel>
        <StackPanel Orientation="Horizontal" Margin="10">
            <Button Content="Select Backup Folder" Click="SelectBackupFolder_Click" Margin="5"/>
            <TextBlock Name="BackupFolderPathTextBlock" VerticalAlignment="Center" Margin="5"/>
        </StackPanel>
        <StackPanel Orientation="Horizontal" Margin="10">
            <TextBlock Text="Max Log Lines:" VerticalAlignment="Center" Margin="5"/>
            <TextBox Name="MaxLinesTextBox" Width="50" TextChanged="MaxLinesTextBox_TextChanged" VerticalAlignment="Center"/>
            <Button Content="Clear Logs" Click="ClearLogs_Click" Margin="5"/>
            <Button Content="Start" Click="StartMonitoring_Click" Margin="5"/>
        </StackPanel>
        <ListBox Name="LogListBox" Grid.Row="1" Margin="10"/>
    </Grid>
</Window>
C# 코드 파일 (MainWindow.xaml.cs)
csharp
코드 복사
using System;
using System.Collections.Generic;
using System.IO;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Threading;

namespace LogMonitor
{
    public partial class MainWindow : Window
    {
        private FileSystemWatcher _fileWatcher;
        private string _logFilePath;
        private string _backupFolderPath;
        private long _lastFilePosition = 0;
        private int _maxLogLines = 1000;
        private readonly List<string> _logLines = new List<string>();
        private bool _isMonitoring = false; // 감시가 시작되었는지 여부를 나타내는 플래그

        private const string ConfigFileName = "config.ini"; // 설정 파일 이름

        public MainWindow()
        {
            InitializeComponent();
            LoadSettings(); // 설정 파일 로드
        }

        // 설정 파일에서 값 로드
        private void LoadSettings()
        {
            if (File.Exists(ConfigFileName))
            {
                var lines = File.ReadAllLines(ConfigFileName);
                foreach (var line in lines)
                {
                    var parts = line.Split('=');
                    if (parts.Length == 2)
                    {
                        var key = parts[0].Trim();
                        var value = parts[1].Trim();
                        if (key == "LogFilePath")
                        {
                            _logFilePath = value;
                            LogFilePathTextBlock.Text = _logFilePath; // 로그 파일 경로 표시
                        }
                        else if (key == "BackupFolderPath")
                        {
                            _backupFolderPath = value;
                            BackupFolderPathTextBlock.Text = _backupFolderPath; // 백업 폴더 경로 표시
                        }
                        else if (key == "MaxLogLines")
                        {
                            if (int.TryParse(value, out int maxLines))
                            {
                                _maxLogLines = maxLines;
                            }
                        }
                    }
                }
            }

            MaxLinesTextBox.Text = _maxLogLines.ToString();
        }

        // 설정 파일에 값 저장
        private void SaveSettings()
        {
            var lines = new List<string>
            {
                $"LogFilePath={_logFilePath}",
                $"BackupFolderPath={_backupFolderPath}",
                $"MaxLogLines={_maxLogLines}"
            };

            File.WriteAllLines(ConfigFileName, lines);
        }

        // 로그 파일 변경 감시 시작
        private void StartFileWatcher()
        {
            if (_fileWatcher != null)
            {
                _fileWatcher.Dispose();
            }

            _fileWatcher = new FileSystemWatcher(Path.GetDirectoryName(_logFilePath))
            {
                Filter = Path.GetFileName(_logFilePath),
                NotifyFilter = NotifyFilters.LastWrite
            };

            _fileWatcher.Changed += OnLogFileChanged;
            _fileWatcher.EnableRaisingEvents = true;
        }

        // 로그 파일이 변경되었을 때 호출되는 이벤트 핸들러
        private async void OnLogFileChanged(object sender, FileSystemEventArgs e)
        {
            await ReadNewLinesAsync();
        }

        // 새로운 로그 라인 읽기 (비동기)
        private async Task ReadNewLinesAsync()
        {
            await Dispatcher.InvokeAsync(() =>
            {
                using (var fs = new FileStream(_logFilePath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
                {
                    fs.Seek(_lastFilePosition, SeekOrigin.Begin);

                    using (var sr = new StreamReader(fs))
                    {
                        while (!sr.EndOfStream)
                        {
                            var line = sr.ReadLine();
                            _logLines.Add(line);

                            // 시작 버튼 이후 로그 라인만 추가
                            if (_isMonitoring)
                            {
                                LogListBox.Items.Add(line);
                                BackupLogLine(line);
                            }

                            if (_logLines.Count > _maxLogLines)
                            {
                                _logLines.RemoveAt(0);
                                if (_isMonitoring)
                                {
                                    LogListBox.Items.RemoveAt(0);
                                }
                            }
                        }

                        _lastFilePosition = fs.Position;
                    }
                }
            });
        }

        // 로그 파일 선택 버튼 클릭 이벤트 핸들러
        private void SelectLogFile_Click(object sender, RoutedEventArgs e)
        {
            var openFileDialog = new Microsoft.Win32.OpenFileDialog();
            if (openFileDialog.ShowDialog() == true)
            {
                _logFilePath = openFileDialog.FileName;
                LogFilePathTextBlock.Text = _logFilePath; // 로그 파일 경로 표시
                SaveSettings(); // 설정 저장
                DisplayLastThreeLines(); // 마지막 3줄 표시
            }
        }

        // 백업 폴더 선택 버튼 클릭 이벤트 핸들러
        private void SelectBackupFolder_Click(object sender, RoutedEventArgs e)
        {
            var folderDialog = new System.Windows.Forms.FolderBrowserDialog();
            if (folderDialog.ShowDialog() == System.Windows.Forms.DialogResult.OK)
            {
                _backupFolderPath = folderDialog.SelectedPath;
                BackupFolderPathTextBlock.Text = _backupFolderPath; // 백업 폴더 경로 표시
                SaveSettings(); // 설정 저장
            }
        }

        // 마지막 3줄 표시
        private void DisplayLastThreeLines()
        {
            if (!File.Exists(_logFilePath))
                return;

            var lines = new List<string>();

            using (var fs = new FileStream(_logFilePath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
            {
                fs.Seek(0, SeekOrigin.Begin);

                using (var sr = new StreamReader(fs))
                {
                    while (!sr.EndOfStream)
                    {
                        lines.Add(sr.ReadLine());
                        if (lines.Count > 3)
                        {
                            lines.RemoveAt(0);
                        }
                    }
                }
            }

            LogListBox.Items.Clear();
            LogListBox.Items.Add("최종 3줄:");
            foreach (var line in lines)
            {
                LogListBox.Items.Add(line);
            }

            _lastFilePosition = new FileInfo(_logFilePath).Length;
        }

        // 로그 감시 시작 버튼 클릭 이벤트 핸들러
        private void StartMonitoring_Click(object sender, RoutedEventArgs e)
        {
            if (!string.IsNullOrEmpty(_logFilePath))
            {
                _isMonitoring = true;
                StartFileWatcher();
            }
        }

        // 로그 지우기 버튼 클릭 이벤트 핸들러
        private void ClearLogs_Click(object sender, RoutedEventArgs e)
        {
            LogListBox.Items.Clear();
            _logLines.Clear();
        }

        // 최대 로그 라인 수 텍스트 박스 변경 이벤트 핸들러
        private void MaxLinesTextBox_TextChanged(object sender, System.Windows.Controls.TextChangedEventArgs e)
        {
            if (int.TryParse(MaxLinesTextBox.Text, out int maxLines))
            {
                _maxLogLines = maxLines;
                SaveSettings(); // 설정 저장
            }
        }

        // 백업 폴더에 로그 라인 저장
        private void BackupLogLine(string line)
        {
            if (string.IsNullOrEmpty(_backupFolderPath))
            {
                return;
            }

            var backupFilePath = Path.Combine(_backupFolderPath, $"backup_{DateTime.Now:yyyyMMdd_HHmmss}.log");

            using (var sw = new StreamWriter(backupFilePath, true))
            {
                sw.WriteLine($"[{DateTime.Now:yyyy-MM-dd HH:mm:ss}] {line}");
            }
        }
    }
}
코드 설명
UI 업데이트: 사용자가 선택한 로그 파일 경로와 백업 폴더 경로를 TextBlock으로 UI에 표시합니다.
설정 파일 관리 (config.ini): 프로그램 시작 시 설정 파일을 읽어 기존 설정을 불러오고, 설정 변경 시마다 .ini 파일에 저장합니다.
시작 버튼: "Start" 버튼을 추가하여 사용자가 명시적으로 로그 감시를 시작할 수 있게 합니다. 이 버튼을 누르면 _isMonitoring 플래그가 true로 설정되고 StartFileWatcher()가 호출되어 로그 감시가 시작됩니다.
최종 3줄 표시: 사용자가 로그 파일을 선택하면 DisplayLastThreeLines 메서드가 호출되어 해당 로그 파일의 마지막 3줄을 읽어와 ListBox에 표시합니다.
비동기 작업: ReadNewLinesAsync 메서드는 비동기로 실행되어 UI 스레드를 차단하지 않고 새로운 로그 라인을 읽어옵니다. 로그 파일이 변경될 때마다 비동기로 라인을 읽어들여 UI가 부드럽게 작동하도록 합니다.
백업: 로그 파일에 새 줄이 추가될 때마다 BackupLogLine 메서드를 통해 지정된 백업 폴더에 로그를 백업합니다.
이 코드는 사용자의 모든 요구 사항을 충족하며, UI가 원활하게 작동하도록 최적화되