MSSQL 2014 í”„ë¡œì‹œì € ìƒì„± ì½”ë“œ
ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ ìµœê·¼ 10ê°œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€, ê° ì»¬ëŸ¼ì˜ 1 ì´ìƒ ê°’ ì¤‘ ìµœì†Œê°’ì„ êµ¬í•˜ê³  NULL ê°’ì€ 0ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•˜ëŠ” í”„ë¡œì‹œì €
sql
ì½”ë“œ ë³µì‚¬
CREATE PROCEDURE Get_Min_RecentData
    @ë¼ì¸ëª… NVARCHAR(50)
AS
BEGIN
    SET NOCOUNT ON;

    WITH RecentData AS (
        SELECT TOP 10 *
        FROM dbo.ExcelData
        WHERE ë¼ì¸ = @ë¼ì¸ëª…
        ORDER BY time1 DESC
    )
    SELECT 
        ISNULL(MIN(CASE WHEN BCT1_1 >= 1 THEN BCT1_1 ELSE NULL END), 0) AS BCT1_1,
        ISNULL(MIN(CASE WHEN BCT1_2 >= 1 THEN BCT1_2 ELSE NULL END), 0) AS BCT1_2,
        ISNULL(MIN(CASE WHEN BCT1_3 >= 1 THEN BCT1_3 ELSE NULL END), 0) AS BCT1_3,
        ISNULL(MIN(CASE WHEN BCT1_4 >= 1 THEN BCT1_4 ELSE NULL END), 0) AS BCT1_4,
        ISNULL(MIN(CASE WHEN BCT1_5 >= 1 THEN BCT1_5 ELSE NULL END), 0) AS BCT1_5,
        ISNULL(MIN(CASE WHEN BCT1_6 >= 1 THEN BCT1_6 ELSE NULL END), 0) AS BCT1_6,
        ISNULL(MIN(CASE WHEN BCT1_7 >= 1 THEN BCT1_7 ELSE NULL END), 0) AS BCT1_7,
        ISNULL(MIN(CASE WHEN BCT1_8 >= 1 THEN BCT1_8 ELSE NULL END), 0) AS BCT1_8,

        ISNULL(MIN(CASE WHEN BCT2_1 >= 1 THEN BCT2_1 ELSE NULL END), 0) AS BCT2_1,
        ISNULL(MIN(CASE WHEN BCT2_2 >= 1 THEN BCT2_2 ELSE NULL END), 0) AS BCT2_2,
        ISNULL(MIN(CASE WHEN BCT2_3 >= 1 THEN BCT2_3 ELSE NULL END), 0) AS BCT2_3,
        ISNULL(MIN(CASE WHEN BCT2_4 >= 1 THEN BCT2_4 ELSE NULL END), 0) AS BCT2_4,
        ISNULL(MIN(CASE WHEN BCT2_5 >= 1 THEN BCT2_5 ELSE NULL END), 0) AS BCT2_5,
        ISNULL(MIN(CASE WHEN BCT2_6 >= 1 THEN BCT2_6 ELSE NULL END), 0) AS BCT2_6,
        ISNULL(MIN(CASE WHEN BCT2_7 >= 1 THEN BCT2_7 ELSE NULL END), 0) AS BCT2_7,
        ISNULL(MIN(CASE WHEN BCT2_8 >= 1 THEN BCT2_8 ELSE NULL END), 0) AS BCT2_8,

        ISNULL(MIN(CASE WHEN TCT1_1 >= 1 THEN TCT1_1 ELSE NULL END), 0) AS TCT1_1,
        ISNULL(MIN(CASE WHEN TCT1_2 >= 1 THEN TCT1_2 ELSE NULL END), 0) AS TCT1_2,
        ISNULL(MIN(CASE WHEN TCT1_3 >= 1 THEN TCT1_3 ELSE NULL END), 0) AS TCT1_3,
        ISNULL(MIN(CASE WHEN TCT1_4 >= 1 THEN TCT1_4 ELSE NULL END), 0) AS TCT1_4,
        ISNULL(MIN(CASE WHEN TCT1_5 >= 1 THEN TCT1_5 ELSE NULL END), 0) AS TCT1_5,
        ISNULL(MIN(CASE WHEN TCT1_6 >= 1 THEN TCT1_6 ELSE NULL END), 0) AS TCT1_6,
        ISNULL(MIN(CASE WHEN TCT1_7 >= 1 THEN TCT1_7 ELSE NULL END), 0) AS TCT1_7,
        ISNULL(MIN(CASE WHEN TCT1_8 >= 1 THEN TCT1_8 ELSE NULL END), 0) AS TCT1_8,

        ISNULL(MIN(CASE WHEN TCT2_1 >= 1 THEN TCT2_1 ELSE NULL END), 0) AS TCT2_1,
        ISNULL(MIN(CASE WHEN TCT2_2 >= 1 THEN TCT2_2 ELSE NULL END), 0) AS TCT2_2,
        ISNULL(MIN(CASE WHEN TCT2_3 >= 1 THEN TCT2_3 ELSE NULL END), 0) AS TCT2_3,
        ISNULL(MIN(CASE WHEN TCT2_4 >= 1 THEN TCT2_4 ELSE NULL END), 0) AS TCT2_4,
        ISNULL(MIN(CASE WHEN TCT2_5 >= 1 THEN TCT2_5 ELSE NULL END), 0) AS TCT2_5,
        ISNULL(MIN(CASE WHEN TCT2_6 >= 1 THEN TCT2_6 ELSE NULL END), 0) AS TCT2_6,
        ISNULL(MIN(CASE WHEN TCT2_7 >= 1 THEN TCT2_7 ELSE NULL END), 0) AS TCT2_7,
        ISNULL(MIN(CASE WHEN TCT2_8 >= 1 THEN TCT2_8 ELSE NULL END), 0) AS TCT2_8

    FROM RecentData;
END;
âœ… í”„ë¡œì‹œì € ì‹¤í–‰ ë°©ë²•
ğŸ“Œ íŠ¹ì • ë¼ì¸ì˜ ë°ì´í„° ì¡°íšŒ
sql
ì½”ë“œ ë³µì‚¬
EXEC Get_Min_RecentData @ë¼ì¸ëª… = 'L1';
'L1' ë¶€ë¶„ì— ì›í•˜ëŠ” ë¼ì¸ ê°’ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ ë¼ì¸ì˜ ìµœê·¼ 10ê°œ ë°ì´í„°ì—ì„œ ìµœì†Œê°’ì„ ê°€ì ¸ì˜´.
NULL ê°’ì€ 0ìœ¼ë¡œ ë³€í™˜ë¨.
âœ… VBAì—ì„œ í”„ë¡œì‹œì € ì‹¤í–‰ (MS Access)
vba
ì½”ë“œ ë³µì‚¬
Sub ExecuteStoredProcedure(LineName As String)
    Dim conn As Object
    Dim rs As Object
    Dim sqlQuery As String
    Dim dbPath As String

    ' ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ (MSSQL ì—°ê²° ì„¤ì •)
    dbPath = "Provider=SQLOLEDB;Data Source=ì„œë²„ì´ë¦„;Initial Catalog=DBì´ë¦„;User ID=ì‚¬ìš©ìì´ë¦„;Password=ë¹„ë°€ë²ˆí˜¸;"

    ' MSSQL ì—°ê²°
    Set conn = CreateObject("ADODB.Connection")
    conn.Open dbPath

    ' í”„ë¡œì‹œì € ì‹¤í–‰ ì¿¼ë¦¬
    sqlQuery = "EXEC Get_Min_RecentData @ë¼ì¸ëª… = '" & LineName & "'"

    ' Recordset ì—´ê¸°
    Set rs = conn.Execute(sqlQuery)

    ' ê²°ê³¼ ì¶œë ¥
    If Not rs.EOF Then
        Debug.Print "=== ìµœì†Œê°’ ê²°ê³¼ (ë¼ì¸: " & LineName & ") ==="
        Dim i As Integer
        For i = 0 To rs.Fields.Count - 1
            Debug.Print rs.Fields(i).Name & ": " & rs.Fields(i).Value
        Next i
    Else
        Debug.Print "ë°ì´í„° ì—†ìŒ (ë¼ì¸: " & LineName & ")"
    End If

    ' ì¢…ë£Œ
    rs.Close
    conn.Close
    Set rs = Nothing
    Set conn = Nothing
End Sub
âœ… VBAì—ì„œ ì‹¤í–‰ ì˜ˆì‹œ
vba
ì½”ë“œ ë³µì‚¬
ExecuteStoredProcedure "L1"
ğŸ“Œ Immediate Window ì¶œë ¥ ì˜ˆì‹œ (Ctrl + G)
makefile
ì½”ë“œ ë³µì‚¬
=== ìµœì†Œê°’ ê²°ê³¼ (ë¼ì¸: L1) ===
BCT1_1: 8
BCT1_2: 3
BCT1_3: 6
BCT1_4: 7
...