DECLARE @cols AS NVARCHAR(MAX)
DECLARE @query AS NVARCHAR(MAX)

-- 동적으로 과제명 컬럼들을 가져옵니다.
SELECT @cols = STUFF((SELECT DISTINCT ', [' + 과제명 + ']' 
                      FROM table_rpa_runlog
                      FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')

-- 동적 쿼리를 생성합니다.
SET @query = 'SELECT CONVERT(date, rpastart) AS 날짜, ' + @cols + '
              FROM
              (
                  SELECT CONVERT(date, rpastart) AS 날짜, 과제명, CASE WHEN mailok = ''success'' THEN 1 ELSE 0 END AS 성공
                  FROM table_rpa_runlog
              ) AS SourceTable
              PIVOT
              (
                  SUM(성공)
                  FOR 과제명 IN (' + @cols + ')
              ) AS PivotTable'

-- 동적 쿼리를 실행합니다.
EXECUTE(@query)
