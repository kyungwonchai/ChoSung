using System;
using System.Diagnostics;
using System.Timers;

namespace HandleChecker
{
    class Program
    {
        static void Main()
        {
            Timer timer = new Timer(1800000); // 30분마다 실행 (30 * 60 * 1000 ms = 1800000 ms)
            timer.Elapsed += CheckHandleCount;
            timer.Start();

            Console.WriteLine("핸들 체크 프로그램 실행 중...");
            Console.ReadLine();
        }

        static void CheckHandleCount(object sender, ElapsedEventArgs e)
        {
            Process currentProcess = Process.GetCurrentProcess();
            int handleCount = currentProcess.HandleCount;

            Console.WriteLine($"현재 핸들 개수: {handleCount}");

            if (handleCount > 100000)
            {
                Console.WriteLine("핸들 수가 10만을 초과했습니다. 프로그램을 종료합니다.");
                currentProcess.CloseMainWindow(); // 주의: 강제 종료입니다.
                currentProcess.Close();
            }
        }
    }
}
