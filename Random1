ì¥ ê¸°ëŠ¥ ì „ì²´ êµ¬í˜„ ë° ì„¤ëª… (ëª¨ë“  ë°ì´í„° ì €ì¥í•˜ê¸°)
ìš”êµ¬ ì‚¬í•­ í™•ì¸
ì‚¬ìš©ì(User)ì™€ ê´€ë¦¬ í•­ëª©(ManagementItems) ë‘˜ ë‹¤ ì €ì¥ë˜ì–´ì•¼ í•¨.

ì‚¬ìš©ì ì •ë³´ (ì´ë¦„, KnoxId), ê´€ë¦¬ í•­ëª© ì •ë³´ (Name, Floor, Zone, SubPart, Manager, IsActive) ëª¨ë‘ ì €ì¥ ëŒ€ìƒ.

ì €ì¥ ê¸°ëŠ¥ì€ ë²„íŠ¼ í´ë¦­ ì‹œ(Save Changes) ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •.

ì €ì¥ ë¡œì§ì€ DataRepositoryì—ì„œ ê´€ë¦¬í•˜ë©°, MSSQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë¨.

ì €ì¥ í•¨ìˆ˜ëŠ” SaveAll()ë¡œ í†µí•©í•˜ì—¬ ì „ì²´ ì •ë³´ë¥¼ ì €ì¥í•˜ë„ë¡ êµ¬ì„±.

ğŸ“ 1. MainWindow.xaml (Save ë²„íŠ¼ ì¶”ê°€ ë° ì»¤ë§¨ë“œ ë°”ì¸ë”©)
xml
ì½”ë“œ ë³µì‚¬
<Button Content="Save Changes" Command="{Binding SaveAllCommand}" Width="100" Margin="0,10,0,0"/>
ğŸ“ 2. MainViewModel.cs (SaveAllCommand ì¶”ê°€ ë° SaveAll() êµ¬í˜„)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Windows.Input;
using WPF_DevExpress_Locker_Management.Models;
using WPF_DevExpress_Locker_Management.Services;

namespace WPF_DevExpress_Locker_Management.ViewModels
{
    public class MainViewModel : INotifyPropertyChanged
    {
        private readonly DataRepository _dataRepository;
        public ObservableCollection<User> Users { get; set; }
        public User SelectedUser { get; set; }

        public ICommand AddUserCommand { get; }
        public ICommand DeleteUserCommand { get; }
        public ICommand SaveAllCommand { get; }

        public MainViewModel()
        {
            _dataRepository = new DataRepository();
            Users = new ObservableCollection<User>(_dataRepository.GetUsers());

            AddUserCommand = new RelayCommand(AddUser);
            DeleteUserCommand = new RelayCommand(DeleteUser);
            SaveAllCommand = new RelayCommand(SaveAll);
        }

        /// <summary>
        /// ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        /// - ì‚¬ìš©ì ì •ë³´ì™€ ê´€ë¦¬ í•­ëª© ì •ë³´ë¥¼ ëª¨ë‘ ì €ì¥í•œë‹¤.
        /// - DataRepositoryì—ì„œ SaveUser() ë° SaveManagementItems() í•¨ìˆ˜ í˜¸ì¶œ.
        /// </summary>
        private void SaveAll()
        {
            if (SelectedUser != null)
            {
                _dataRepository.SaveUser(SelectedUser); // ì‚¬ìš©ì ì •ë³´ ì €ì¥
                _dataRepository.SaveManagementItems(SelectedUser.UserId, SelectedUser.ManagementItems); // ê´€ë¦¬ í•­ëª© ì €ì¥
            }
        }

        private void AddUser()
        {
            var newUser = new User
            {
                UserId = Guid.NewGuid(),
                Name = "New User",
                KnoxId = "NewKnoxId"
            };
            Users.Add(newUser);
            _dataRepository.AddUser(newUser);
        }

        private void DeleteUser()
        {
            if (SelectedUser != null)
            {
                _dataRepository.DeleteUser(SelectedUser.UserId);
                Users.Remove(SelectedUser);
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;
        protected void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}
ğŸ“ 3. DataRepository.cs (ì €ì¥ ë¡œì§ êµ¬í˜„ - ì‚¬ìš©ì ë° ê´€ë¦¬ í•­ëª© ëª¨ë‘ ì €ì¥)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.ObjectModel;
using System.Data.SqlClient;
using WPF_DevExpress_Locker_Management.Models;

namespace WPF_DevExpress_Locker_Management.Services
{
    public class DataRepository
    {
        private readonly string _connectionString = "Server=localhost;Database=LockerDB;User Id=your_user;Password=your_password;";

        /// <summary>
        /// ì‚¬ìš©ì ì •ë³´ ì €ì¥ ë˜ëŠ” ì—…ë°ì´íŠ¸
        /// </summary>
        public void SaveUser(User user)
        {
            using (SqlConnection conn = new SqlConnection(_connectionString))
            {
                conn.Open();
                var cmd = new SqlCommand(@"
                    IF EXISTS (SELECT 1 FROM Users WHERE UserId = @UserId)
                        UPDATE Users SET Name = @Name, KnoxId = @KnoxId WHERE UserId = @UserId;
                    ELSE
                        INSERT INTO Users (UserId, Name, KnoxId) VALUES (@UserId, @Name, @KnoxId);
                ", conn);

                cmd.Parameters.AddWithValue("@UserId", user.UserId);
                cmd.Parameters.AddWithValue("@Name", user.Name);
                cmd.Parameters.AddWithValue("@KnoxId", user.KnoxId);

                cmd.ExecuteNonQuery();
            }
        }

        /// <summary>
        /// ê´€ë¦¬ í•­ëª© ì •ë³´ ì €ì¥ ë˜ëŠ” ì—…ë°ì´íŠ¸
        /// </summary>
        public void SaveManagementItems(Guid userId, ObservableCollection<ManagementItem> items)
        {
            using (SqlConnection conn = new SqlConnection(_connectionString))
            {
                conn.Open();

                foreach (var item in items)
                {
                    var cmd = new SqlCommand(@"
                        IF EXISTS (SELECT 1 FROM ManagementItems WHERE UserId = @UserId AND Name = @Name)
                            UPDATE ManagementItems
                            SET Floor = @Floor, Zone = @Zone, SubPart = @SubPart, Manager = @Manager, IsActive = @IsActive
                            WHERE UserId = @UserId AND Name = @Name;
                        ELSE
                            INSERT INTO ManagementItems (UserId, Name, Floor, Zone, SubPart, Manager, IsActive)
                            VALUES (@UserId, @Name, @Floor, @Zone, @SubPart, @Manager, @IsActive);
                    ", conn);

                    cmd.Parameters.AddWithValue("@UserId", userId);
                    cmd.Parameters.AddWithValue("@Name", item.Name);
                    cmd.Parameters.AddWithValue("@Floor", item.Floor ?? (object)DBNull.Value);
                    cmd.Parameters.AddWithValue("@Zone", item.Zone ?? (object)DBNull.Value);
                    cmd.Parameters.AddWithValue("@SubPart", item.SubPart ?? (object)DBNull.Value);
                    cmd.Parameters.AddWithValue("@Manager", item.Manager ?? (object)DBNull.Value);
                    cmd.Parameters.AddWithValue("@IsActive", item.IsActive);

                    cmd.ExecuteNonQuery();
                }
            }
        }
    }
}
âœ… ì „ì²´ ì €ì¥ ê¸°ëŠ¥ ì„¤ëª…
SaveAll() í•¨ìˆ˜ (MainViewModel.cs)

SelectedUserì™€ ê·¸ì— ì†í•œ ManagementItemsë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•œë‹¤.

í˜¸ì¶œ ìˆœì„œ: SaveUser() â†’ SaveManagementItems()

SaveUser() í•¨ìˆ˜ (DataRepository.cs)

ì‚¬ìš©ìê°€ ìˆ˜ì •ëœ ì •ë³´ë¥¼ MSSQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•œë‹¤.

SaveManagementItems() í•¨ìˆ˜ (DataRepository.cs)

ì‚¬ìš©ìê°€ ìˆ˜ì •ëœ ê´€ë¦¬ í•­ëª© ì •ë³´ë¥¼ MSSQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•œë‹¤.

ğŸ“Œ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ íë¦„
ì‚¬ìš©ìê°€ ë²„íŠ¼(Save Changes) í´ë¦­.

SaveAll() í•¨ìˆ˜ í˜¸ì¶œ.

ì‚¬ìš©ì ì •ë³´ ì €ì¥ (SaveUser()).

ê´€ë¦¬ í•­ëª© ì •ë³´ ì €ì¥ (SaveManagementItems()).

ëª¨ë“  ë°ì´í„°ê°€ MSSQL ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë¨.
