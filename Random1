#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os

# --- [ 사용자 설정 ] ---

# 1. 탐색을 시작할 기본 폴더 경로
# (주의: '/mnt/smdpg' 폴더가 실제로 마운트되어 있어야 합니다.)
SEARCH_DIR = "/mnt/smdpg"

# 2. 파일/폴더 이름이 반드시 시작해야 하는 '필수 문자열'
# (예: "PROJECT_A", "DATA", "BACKUP" 등)
REQUIRED_PREFIX = "여기에_필수_문자열을_입력하세요" 

# --- [ 설정 끝 ] ---


def search_files():
    """
    지정된 디렉토리에서 조건에 맞는 파일과 폴더를 재귀적으로 탐색합니다.
    """
    print(f"--- 탐색 시작: '{SEARCH_DIR}' ---")
    print(f"--- 조건 1: 이름이 '{REQUIRED_PREFIX}'(으)로 시작")
    print(f"--- 조건 2: (조건1 제외 후) '_' 앞 숫자가 2 또는 3")
    print("-" * 40)

    found_count = 0

    # SEARCH_DIR이 존재하는지 확인
    if not os.path.exists(SEARCH_DIR):
        print(f"[오류] 지정된 폴더를 찾을 수 없습니다: {SEARCH_DIR}")
        print("폴더가 올바르게 마운트되었는지 확인하세요.")
        return

    # os.walk()로 모든 하위 디렉토리와 파일을 탐색합니다.
    # dirpath: 현재 폴더 경로
    # dirnames: 현재 폴더 안의 하위 폴더 목록
    # filenames: 현재 폴더 안의 파일 목록
    for dirpath, dirnames, filenames in os.walk(SEARCH_DIR, topdown=True):
        
        # 폴더와 파일을 합쳐서 한 번에 검사
        all_items = dirnames + filenames
        
        for item_name in all_items:
            
            # --- 조건 1: 파일/폴더 이름이 사용자가 지정한 문자열로 시작하는가? ---
            if not item_name.startswith(REQUIRED_PREFIX):
                continue  # 아니면 다음 파일/폴더로 넘어감

            # --- 조건 1 통과 ---
            
            # 이제 나머지 문자열을 분석합니다.
            # 예: REQUIRED_PREFIX="MY_APP", item_name="MY_APP_2_file.txt"
            # remaining_str = "_2_file.txt"
            remaining_str = item_name[len(REQUIRED_PREFIX):]

            # 맨 앞의 '_'가 있다면 제거합니다.
            # (예: "_2_file.txt" -> "2_file.txt")
            if remaining_str.startswith('_'):
                remaining_str = remaining_str[1:]
            else:
                # (예: "MY_APP2_file.txt" 처럼 '_'가 없는 경우는 제외)
                continue

            # --- 조건 2: 나머지 문자열이 '_'를 포함하고, 그 앞부분이 2 또는 3인가? ---
            
            # '_'가 없으면(예: "MY_APP_config.txt") 비교 대상이 없으므로 제외
            if '_' not in remaining_str:
                continue

            try:
                # 나머지 문자열을 첫 번째 '_' 기준으로 분리
                # (예: "2_file.txt" -> "2")
                prefix_num_str = remaining_str.split('_', 1)[0]
                
                # 숫자로 변환 시도
                prefix_num = int(prefix_num_str)
                
                # 숫자가 2 또는 3인지 확인
                if prefix_num in (2, 3):
                    
                    # --- 모든 조건 만족! ---
                    full_path = os.path.join(dirpath, item_name)
                    print(full_path)
                    found_count += 1
                    
            except ValueError:
                # int() 변환 실패 시 (예: "MY_APP_ADMIN_file.txt")
                # 이 경우는 숫자가 아니므로 무시하고 계속 진행
                continue
            except Exception as e:
                # 기타 예외 처리
                print(f"[경고] 파일 처리 중 오류 발생: {item_name} ({e})")

    print("-" * 40)
    print(f"--- 총 {found_count}개의 항목을 찾았습니다. ---")

if __name__ == "__main__":
    if REQUIRED_PREFIX == "여기에_필수_문자열을_입력하세요":
        print("[!!!] 스크립트 오류: 'REQUIRED_PREFIX' 값을 수정해야 합니다.")
        print("스크립트 파일을 열어 'USER_SETTINGS' 부분을 수정해주세요.")
    else:
        search_files()