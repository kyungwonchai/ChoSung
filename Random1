// MainForm 클래스 멤버 변수로 버튼을 저장할 리스트 선언
private List<SimpleButton> customButtons;

// MainForm 생성자에서 버튼 리스트 초기화
public MainForm()
{
    InitializeComponent();
    customButtons = new List<SimpleButton>();
}

// 데이터 로드 메서드 수정
private void LoadData()
{
    string selectQuery = "SELECT * FROM T1_ProjectList";
    using (SqlCommand command = new SqlCommand(selectQuery, connection))
    {
        SqlDataAdapter adapter = new SqlDataAdapter(command);
        DataTable dataTable = new DataTable();
        adapter.Fill(dataTable);
        gridControl1.DataSource = dataTable;
    }

    // 기존 버튼 삭제
    foreach (SimpleButton button in customButtons)
    {
        button.Click -= CustomButton_Click;
        button.Dispose();
    }
    customButtons.Clear();

    // 새로운 버튼 생성
    for (int i = 0; i < gridView1.RowCount; i++)
    {
        SimpleButton button = new SimpleButton();
        button.Text = "선택";
        button.Tag = i; // 행 인덱스를 버튼의 Tag로 저장
        button.Click += CustomButton_Click;
        gridView1.GridControl.Controls.Add(button);
        customButtons.Add(button);
    }

    // 버튼 위치 및 스타일 설정
    LayoutButtons();
}

// 버튼 위치 및 스타일을 조정하는 메서드
private void LayoutButtons()
{
    for (int i = 0; i < gridView1.RowCount; i++)
    {
        GridRow row = gridView1.GetRow(i) as GridRow;
        if (row != null)
        {
            Rectangle rect = gridView1.GetRowCellDisplayRectangle(i, gridView1.Columns["선택"], false);
            SimpleButton button = customButtons[i];
            button.Size = new Size(rect.Height, rect.Height);
            button.Location = new Point(rect.Right - button.Width, rect.Top);
            button.BringToFront();
        }
    }
}

// GridView1_MouseDown 이벤트 핸들러 수정
private void GridView1_MouseDown(object sender, MouseEventArgs e)
{
    if (e.Button == MouseButtons.Left && e.Clicks == 2)
    {
        GridHitInfo hitInfo = gridView1.CalcHitInfo(e.Location);
        if (hitInfo.RowHandle >= 0 && hitInfo.HitTest != GridHitTest.Column)
        {
            string pname = (string)gridView1.GetRowCellValue(hitInfo.RowHandle, "Pname");
            MessageBox.Show(pname, "선택된 Pname", MessageBoxButtons.OK, MessageBoxIcon.Information);
        }
    }
}

// CustomButton_Click 이벤트 핸들러
private void CustomButton_Click(object sender, EventArgs e)
{
    SimpleButton button = (SimpleButton)sender;
    int rowIndex = (int)button.Tag;
    if (rowIndex >= 0 && rowIndex < gridView1.RowCount)
    {
        gridView1.FocusedRowHandle = rowIndex;
        string pname = (string)gridView1.GetRowCellValue(rowIndex, "Pname");
        MessageBox.Show(pname, "선택된 Pname", MessageBoxButtons.OK, MessageBoxIcon.Information);
    }
}
