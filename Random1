from flask import Flask, render_template
import pymssql
import base64

app = Flask(__name__)

@app.route('/')
def index():
    # MSSQL 연결 설정
    conn = pymssql.connect(server='server_name',
                           user='username',
                           password='password',
                           database='database_name')

    try:
        # 데이터베이스에서 이미지 가져오기
        cursor = conn.cursor()
        query = "SELECT image1 FROM table1 ORDER BY d"
        cursor.execute(query)
        results = cursor.fetchall()

        # 이미지 데이터를 base64로 인코딩하여 Flask 템플릿에 전달
        images = []
        for row in results:
            image_data = row[0]
            encoded_image = base64.b64encode(image_data).decode('utf-8')
            images.append(encoded_image)

        # 인코딩된 이미지 데이터를 Flask 템플릿에 전달하여 렌더링
        return render_template('index.html', images=images)

    finally:
        # 연결 종료
        conn.close()

if __name__ == '__main__':
    app.run(port=5000)
