WITH CTE AS (
    SELECT 
        col1,
        date1,
        CASE WHEN col1 = 'pp1' THEN 1 ELSE 0 END AS is_pp1,
        ROW_NUMBER() OVER (ORDER BY date1) AS rn
    FROM 
        your_table
)
SELECT
    c1.col1,
    c1.date1,
    CASE 
        WHEN c1.is_pp1 = 1 THEN (SELECT MAX(c2.rn) FROM CTE c2 WHERE c2.is_pp1 = 1 AND c2.rn <= c1.rn)
        ELSE NULL
    END AS no1
FROM 
    CTE c1
ORDER BY
    c1.col1,
    c1.date1;
