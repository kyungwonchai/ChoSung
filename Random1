 테이블의 설정을 유지하면서 필드들을 새롭게 설정하는 VBA 코드를 아래와 같이 제공합니다. 이 코드는 기존에 체크되었거나 추가된 필드를 제거하고, 행 필드를 "구분2"로 설정한 후, 조건에 맞는 필드를 값 영역에 합계로 추가합니다.

vba

Sub UpdatePivotTableFields()
    Dim ws As Worksheet
    Dim pt As PivotTable
    Dim pf As PivotField
    Dim field As String
    
    ' "SOP 14주" 시트 설정
    Set ws = ThisWorkbook.Sheets("SOP 14주")

    ' "피벗테이블1" 피벗 테이블 설정
    Set pt = ws.PivotTables("피벗테이블1")

    ' 기존 필드 설정 제거
    With pt
        .ClearAllFilters
        .RowFields.Clear
        .DataFields.Clear
    End With

    ' "구분2"를 행 필드로 설정
    Set pf = pt.PivotFields("구분2")
    pf.Orientation = xlRowField
    pf.Position = 1

    ' 피벗 필드를 순회하면서 조건에 맞는 필드를 값 영역에 합계로 추가
    For Each pf In pt.PivotFields
        field = pf.Name
        If Len(field) = 6 And IsNumeric(field) And Left(field, 1) = "2" Then
            ' 해당 필드를 값 영역에 합계로 추가
            pt.AddDataField pt.PivotFields(field), "Sum of " & field, xlSum
        End If
    Next pf
End Sub

이 코드는 기존 피벗 테이블의 구조를 유지하면서 필요한 변경만을 수행합니다. 기존에 설정된 필드들을 제거하고 "구분2"를 행 필드로, 조건에 맞는 필드들을 값 영역에 합계로 추가합니다. VBA 편집기에 코드