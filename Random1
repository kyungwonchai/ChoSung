DECLARE @columns NVARCHAR(MAX);
DECLARE @query NVARCHAR(MAX);

-- 과제별 동적 컬럼 생성 쿼리
SELECT @columns = STUFF(
    (
        SELECT DISTINCT ', [' + 과제명 + ']'
        FROM table_task
        FOR XML PATH('')
    ), 1, 2, '');

-- 동적 피벗 쿼리
SET @query = '
SELECT *
FROM (
    SELECT
        rpastart AS 날짜,
        과제명,
        COUNT(*) AS 실행횟수
    FROM
        table_rpa_runlog AS runlog
        INNER JOIN table_task AS task ON runlog.과제ID = task.과제ID
    GROUP BY
        rpastart,
        과제명
) AS data
PIVOT (
    SUM(실행횟수)
    FOR 과제명 IN (' + @columns + ')
) AS pivot';

-- 동적 쿼리 실행
EXEC sp_executesql @query;
