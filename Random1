import pandas as pd
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.metrics.pairwise import cosine_similarity
from Levenshtein import distance
import joblib

def preprocess_data(data):
    # 특수 문자 제거
    data = data.str.replace('[^\w\s]', '')

    # 소문자 변환
    data = data.str.lower()

    # 불용어 처리, 토큰화 등 추가 전처리 작업 수행

    preprocessed_data = data

    return preprocessed_data

# 데이터베이스에서 데이터 추출
# 예시 데이터를 데이터프레임으로 가정하고 부품코드 컬럼이 있다고 가정합니다.
data = pd.read_sql_query("SELECT 부품코드 FROM 테이블명", connection)

# 전처리 작업
data['부품코드'] = preprocess_data(data['부품코드'])

# 모델 학습
vectorizer = CountVectorizer()
parts_vector = vectorizer.fit_transform(data['부품코드'])
similarity_matrix = cosine_similarity(parts_vector)

# 모델 저장
model_data = {'similarity_matrix': similarity_matrix, 'vectorizer': vectorizer}
joblib.dump(model_data, 'model.pkl')
