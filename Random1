DECLARE @cols AS NVARCHAR(MAX)
DECLARE @query AS NVARCHAR(MAX)

-- 동적으로 과제명 컬럼들을 가져옵니다.
SET @cols = STUFF((SELECT DISTINCT ', [' + 과제명 + ']' 
                   FROM table_rpa_runlog
                   FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '')

-- 동적으로 생성된 쿼리를 사용하여 피벗 테이블을 생성합니다.
SET @query = '
WITH PivotData AS (
    SELECT CONVERT(date, rpastart) AS 날짜, 과제명, CASE WHEN mailok = ''success'' THEN 1 ELSE 0 END AS 성공
    FROM table_rpa_runlog
)
SELECT *
FROM PivotData
PIVOT
(
    SUM(성공)
    FOR 과제명 IN (' + @cols + ')
) AS PivotTable'

-- 동적 쿼리를 실행합니다.
EXECUTE sp_executesql @query
