public class TaskManagerManager
{
    private SqlConnection sqlConnection;
    private SqlDataAdapter tasksDataAdapter;
    private SqlDataAdapter taskDetailsDataAdapter;
    private SqlDataAdapter recipientsDataAdapter;
    private DataSet dataSet;
    private SqlCommandBuilder tasksCommandBuilder;
    private SqlCommandBuilder taskDetailsCommandBuilder;
    private SqlCommandBuilder recipientsCommandBuilder;

    public TaskManagerManager(string connectionString)
    {
        sqlConnection = new SqlConnection(connectionString);
        tasksDataAdapter = new SqlDataAdapter("SELECT * FROM Tasks", sqlConnection);
        taskDetailsDataAdapter = new SqlDataAdapter("SELECT * FROM TaskDetails", sqlConnection);
        recipientsDataAdapter = new SqlDataAdapter("SELECT * FROM Recipients", sqlConnection);

        dataSet = new DataSet();

        tasksCommandBuilder = new SqlCommandBuilder(tasksDataAdapter);
        taskDetailsCommandBuilder = new SqlCommandBuilder(taskDetailsDataAdapter);
        recipientsCommandBuilder = new SqlCommandBuilder(recipientsDataAdapter);

        tasksDataAdapter.Fill(dataSet, "Tasks");
        taskDetailsDataAdapter.Fill(dataSet, "TaskDetails");
        recipientsDataAdapter.Fill(dataSet, "Recipients");
    }

    public DataTable GetTasks()
    {
        return dataSet.Tables["Tasks"];
    }

    public DataTable GetTaskDetails(int taskID)
    {
        dataSet.Tables["TaskDetails"].DefaultView.RowFilter = $"ID = {taskID}";
        return dataSet.Tables["TaskDetails"].DefaultView.ToTable();
    }

    public DataTable GetRecipients(int taskID)
    {
        dataSet.Tables["Recipients"].DefaultView.RowFilter = $"TaskID = {taskID}";
        return dataSet.Tables["Recipients"].DefaultView.ToTable();
    }

    public bool AddTask(string taskName)
    {
        DataRow[] existingRows = dataSet.Tables["Tasks"].Select($"Name = '{taskName}'");
        if (existingRows.Length > 0)
        {
            return false;
        }

        DataRow taskRow = dataSet.Tables["Tasks"].NewRow();
        taskRow["Name"] = taskName;
        dataSet.Tables["Tasks"].Rows.Add(taskRow);

        tasksDataAdapter.Update(dataSet, "Tasks");
        return true;
    }

    public void AddRecipient(int taskID, string address, string method)
    {
        DataRow recipientRow = dataSet.Tables["Recipients"].NewRow();
        recipientRow["TaskID"] = taskID;
        recipientRow["Address"] = address;
        recipientRow["Method"] = method;
        dataSet.Tables["Recipients"].Rows.Add(recipientRow);

        recipientsDataAdapter.Update(dataSet, "Recipients");
    }

    public void DeleteRecipient(int recipientID)
    {
        DataRow recipientRow = dataSet.Tables["Recipients"].Rows.Find(recipientID);
        if (recipientRow != null)
        {
            recipientRow.Delete();
            recipientsDataAdapter.Update(dataSet, "Recipients");
        }
    }
}
