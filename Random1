#에서 기존 함수들을 그대로 유지하면서, 10분마다 실행되지만 이전 실행이 끝나지 않았으면 기다렸다가 다시 실행하는 코드를 구현하려면, Task와 Timer를 적절히 조합해야 합니다.

✅ 핵심 요구사항
✔ 기존 함수 그대로 유지
✔ 10분마다 실행, 하지만 이전 실행이 끝나지 않았으면 다음 실행을 보류
✔ 비동기 (async/await) 방식으로 실행
✔ 클래스 생성 없이 현재 코드에 바로 적용 가능

✅ C# 기존 코드에서 적용 가능한 비동기 타이머
csharp
코드 복사
using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    private static Timer _timer;
    private static bool _isRunning = false; // 실행 상태 체크
    private static readonly object _lock = new object(); // 다중 실행 방지

    static async Task Main()
    {
        Console.WriteLine("Timer 시작...");
        StartTimer();

        // 프로그램 유지 (Ctrl + C로 종료)
        await Task.Delay(Timeout.Infinite);
    }

    private static void StartTimer()
    {
        _timer = new Timer(async _ => await CheckAndRunTask(), null, 0, 600000); // 10분마다 실행
    }

    private static async Task CheckAndRunTask()
    {
        lock (_lock)
        {
            if (_isRunning)
            {
                Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 이전 실행이 끝나지 않음, 다음 실행 대기...");
                return;
            }
            _isRunning = true;
        }

        try
        {
            Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 작업 시작");
            await RunTaskAsync(); // 기존 함수 호출
            Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 작업 완료");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"오류 발생: {ex.Message}");
        }
        finally
        {
            _isRunning = false; // 실행 완료 후 상태 변경
        }
    }

    private static async Task RunTaskAsync()
    {
        // ⚡ 기존 함수 (10분마다 실행될 내용)
        Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 기존 작업 실행 중...");
        await Task.Delay(20000); // 20초 동안 실행되는 작업 (테스트용)
        Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 기존 작업 종료");
    }
}
✅ 설명
StartTimer()

10분(600,000ms)마다 CheckAndRunTask() 실행
CheckAndRunTask()

_isRunning이 true이면 실행하지 않고 건너뜀
기존 함수를 await로 실행 후 상태 변경 (false)
RunTaskAsync()

⚡ 기존 함수 그대로 유지 (10분마다 실행할 내용 넣기)
여기서 await Task.Delay(20000);은 예제이므로 실제 실행 코드로 변경
✅ 실행 결과 (예제)
makefile
코드 복사
Timer 시작...
10:00:00 - 작업 시작
10:00:00 - 기존 작업 실행 중...
10:00:20 - 기존 작업 종료
10:00:20 - 작업 완료
10:10:00 - 작업 시작
10:10:00 - 기존 작업 실행 중...
10:10:20 - 기존 작업 종료
10:10:20 - 작업 완료
10:20:00 - 이전 실행이 끝나지 않음, 다음 실행 대기...
👉 10분마다 실행되지만, 이전 실행이 끝나지 않으면 다음 실행을 건너뜀

✅ 특징