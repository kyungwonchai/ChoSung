using DevExpress.XtraPivotGrid;

// 데이터 조회
DataTable dataTable = GetDataFromDatabase();

// 성공 횟수와 시도 횟수 필드 추가
DataColumn successCountColumn = new DataColumn("성공횟수", typeof(int));
DataColumn attemptCountColumn = new DataColumn("시도횟수", typeof(int));
dataTable.Columns.Add(successCountColumn);
dataTable.Columns.Add(attemptCountColumn);

foreach (DataRow row in dataTable.Rows)
{
    bool success = Convert.ToBoolean(row["성공여부"]);
    int successCount = success ? 1 : 0;
    row["성공횟수"] = successCount;
    row["시도횟수"] = 1;
}

// PivotGridControl 설정
PivotGridControl pivotGrid = new PivotGridControl();
pivotGrid.DataSource = dataTable;

PivotGridField fieldDate = new PivotGridField();
fieldDate.FieldName = "날짜";
fieldDate.Caption = "날짜";
fieldDate.Area = PivotArea.ColumnArea;
fieldDate.GroupInterval = PivotGroupInterval.Date;
pivotGrid.Fields.Add(fieldDate);

PivotGridField fieldTask = new PivotGridField();
fieldTask.FieldName = "과제명";
fieldTask.Caption = "과제명";
fieldTask.Area = PivotArea.RowArea;
pivotGrid.Fields.Add(fieldTask);

PivotGridField fieldSuccessCount = new PivotGridField();
fieldSuccessCount.FieldName = "성공횟수";
fieldSuccessCount.Caption = "성공 횟수";
fieldSuccessCount.Area = PivotArea.DataArea;
fieldSuccessCount.SummaryType = PivotSummaryType.Sum;
pivotGrid.Fields.Add(fieldSuccessCount);

PivotGridField fieldAttemptCount = new PivotGridField();
fieldAttemptCount.FieldName = "시도횟수";
fieldAttemptCount.Caption = "시도 횟수";
fieldAttemptCount.Area = PivotArea.DataArea;
fieldAttemptCount.SummaryType = PivotSummaryType.Sum;
pivotGrid.Fields.Add(fieldAttemptCount);

// 성공율 필드 추가
PivotGridField fieldSuccessRate = new PivotGridField();
fieldSuccessRate.Caption = "성공율";
fieldSuccessRate.UnboundType = DevExpress.Data.UnboundColumnType.Decimal;
fieldSuccessRate.UnboundExpression = "[성공 횟수] / [시도 횟수]";
fieldSuccessRate.UnboundFieldName = "성공율";
fieldSuccessRate.Area = PivotArea.DataArea;
pivotGrid.Fields.Add(fieldSuccessRate);
