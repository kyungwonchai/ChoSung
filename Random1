using Microsoft.Win32.TaskScheduler;
using System;
using System.Windows.Forms;

private void button1_Click(object sender, EventArgs e)
{
    using (TaskService ts = new TaskService())
    {
        Task task = ts.GetTask("monitoronbylogin");

        if (task == null)
        {
            TaskDefinition td = ts.NewTask();
            td.RegistrationInfo.Description = "Runs a command when workstation unlock event is triggered.";

            td.Triggers.Add(new SessionStateChangeTrigger
            {
                StateChange = TaskSessionStateChangeType.SessionUnlock,
                UserId = Environment.UserName
            });

            td.Actions.Add(new ExecAction("cmd.exe", "/c taskkill /im monitoroff.exe /f", null));

            ts.RootFolder.RegisterTaskDefinition("monitoronbylogin", td);
            MessageBox.Show("Task created successfully.");
        }
        else
        {
            MessageBox.Show("Task already exists.");
        }
    }
}
