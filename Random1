using System;
using System.Data;
using System.Data.SqlClient;
using System.Linq;

public void InsertNonDuplicateDataWithLinq(DataTable ttt)
{
    DataTable existingData = new DataTable();

    // 1. T_설계변경요약 테이블의 데이터 가져오기
    using (SqlConnection connection = new SqlConnection("your_connection_string_here"))
    {
        connection.Open();
        SqlDataAdapter adapter = new SqlDataAdapter("SELECT N_Rkey FROM T_설계변경요약", connection);
        adapter.Fill(existingData);
    }

    // 2. 중복되지 않는 데이터만 필터링 (LINQ 사용)
    var existingKeys = existingData.AsEnumerable().Select(r => r.Field<string>("N_Rkey")).ToList();
    var nonDuplicateRows = ttt.AsEnumerable().Where(r => !existingKeys.Contains(r.Field<string>("N_Rkey")));

    DataTable nonDuplicateData = ttt.Clone();
    foreach (var row in nonDuplicateRows)
    {
        nonDuplicateData.ImportRow(row);
    }

    // 3. 중복되지 않은 데이터를 T_설계변경요약 테이블에 벌크 인서트
    using (SqlConnection connection = new SqlConnection("your_connection_string_here"))
    {
        connection.Open();
        using (SqlBulkCopy bulkCopy = new SqlBulkCopy(connection))
        {
            bulkCopy.DestinationTableName = "T_설계변경요약";
            bulkCopy.WriteToServer(nonDuplicateData);
        }
    }
}
