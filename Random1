from flask import Flask, send_file
import pyodbc

app = Flask(__name__)

@app.route('/')
def open_excel():
    # MSSQLDB 연결 설정
    conn_str = 'DRIVER={SQL Server};SERVER=YourServerName;DATABASE=YourDatabaseName;UID=YourUsername;PWD=YourPassword;'
    connection = pyodbc.connect(conn_str)
    cursor = connection.cursor()

    # 쿼리 실행하여 데이터 가져오기
    query = 'SELECT * FROM YourTableName'
    cursor.execute(query)

    # 데이터를 스프레드시트로 로드
    workbook = Workbook()
    worksheet = workbook.active
    for row in cursor:
        worksheet.append(row)

    # 임시 파일로 저장
    temp_file_path = 'temp.xlsx'
    workbook.save(temp_file_path)

    # 파일 다운로드
    return send_file(temp_file_path, as_attachment=True)

if __name__ == '__main__':
    app.run()
