import os
import datetime
from flask import Flask, render_template, request, redirect, session

app = Flask(__name__)
app.secret_key = os.urandom(24)  # 세션에 사용되는 시크릿 키 설정

PASSWORD = "k11ㅇㅇㄴ4!!"  # 암호 설정

def search_notebooks(folder_path):
    notebooks = []
    for root, dirs, files in os.walk(folder_path):
        for file in files:
            if file.endswith('.ipynb') and not file.startswith('.') and '.ipynb_checkpoints' not in root:
                notebook_path = os.path.join(root, file)
                relative_path = os.path.relpath(notebook_path, folder_path)
                notebooks.append(relative_path)
    return notebooks

def get_file_dates(folder_path, notebooks):
    file_dates = {}
    for notebook in notebooks:
        file_path = os.path.join(folder_path, notebook)
        modification_time = os.path.getmtime(file_path)
        formatted_time = datetime.datetime.fromtimestamp(modification_time).strftime('%Y-%m-%d %H:%M:%S')
        file_dates[notebook] = formatted_time
    return file_dates

@app.route('/', methods=['GET', 'POST'])
def index():
    if 'authenticated' not in session:  # 인증되지 않은 상태일 때
        if 'device_id' not in session:  # 최초 접속인 경우
            session['device_id'] = request.remote_addr  # 기기 번호 저장 (클라이언트의 IP 주소로 대체 가능)

        # if request.method == 'POST':
        #     password = request.form.get('password')
        #     if password == PASSWORD:
        #         session['authenticated'] = True  # 세션에 인증 정보 저장
        #         return redirect('/')
        #     else:
        #         return "잘못된 암호입니다. 다시 시도해주세요."
        # else:
        #     return render_template('password.html')

    folder_path = '/home/kwㄴㅁ스/'
    notebooks = search_notebooks(folder_path)
    file_dates = get_file_dates(folder_path, notebooks)

    folder_dict = {}
    for notebook in notebooks:
        path_parts = notebook.split(os.sep)
        folder = '/'.join(path_parts[:-1])
        file = path_parts[-1]
        if folder not in folder_dict:
            folder_dict[folder] = []
        folder_dict[folder].append(file)

    folders = []
    for folder, files in folder_dict.items():
        folder_info = {
            'path': folder,
            'name': folder.split('/')[-1],
            'files': files
        }
        folders.append(folder_info)

    return render_template('index.html', folders=folders, file_dates=file_dates)

if __name__ == '__main__':
    app.run(host='1 .17', port=10000, debug=True)
    
    
    
    
    
    
    
    
    
    
    
    
    <!DOCTYPE html>
<html>
<head>
    <title>서ㄹ비</title>
    <style>
        body {
            background: linear-gradient(to right, #006400, #FFD700);
            color: #ffffff;
        }

        ul {
            list-style-type: none;
            padding-left: 20px;
        }

        li {
            margin-bottom: 5px;
        }

        .folder {
            font-weight: bold;
            cursor: pointer;
            color: #ffff00;
            text-decoration: none;
        }

        .folder:hover {
            text-decoration: underline;
        }

        .file {
            margin-left: 20px;
            cursor: pointer;
        }

        .file a {
            color: #ffff00;
            font-weight: bold;
            text-decoration: none;
        }

        .file a.important {
            color: #ff69b4;
        }

        .file .date {
            font-size: 12px;
            color: #ffffff;
            margin-left: 5px;
        }

        .file:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        function toggleFolder(folderId) {
            var folderElement = document.getElementById(folderId);
            folderElement.classList.toggle("opened");
        }

        function openNotebook(file_path) {
            var url = 'http://59.24.147.89:40100/notebooks/서티알고리즘/' + encodeURIComponent(file_path);
            window.open(url, '_blank');
        }
    </script>
</head>
<body>
    <h2>서ㄹ비</h2>
    <ul>
        {% for folder in folders %}
            <li class="folder" onclick="toggleFolder('{{ folder.path }}')">{{ folder.name }}</li>
            <ul id="{{ folder.path }}" {% if folder.path != '' %}class="opened"{% endif %}>
                {% for file in folder.files %}
                    {% if not file.startswith('.ipynb_checkpoints/') %}
                        {% set file_name = file[:-6] %}
                        {% set file_path = folder.path + '/' + file_name + '.ipynb' %}
                        <li class="file" onclick="openNotebook('{{ file_path }}')">
                            {% if '중요' in file_name %}
                                <a href="javascript:void(0);" class="important">{{ file_name }}</a>
                            {% else %}
                                <a href="javascript:void(0);">{{ file_name }}</a>
                            {% endif %}
                            <span class="date">{{ file_dates[file_path] }}</span>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% endfor %}
    </ul>
</body>
</html>

