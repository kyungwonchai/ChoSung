CREATE PROCEDURE MoveOldDataToBackupTable
AS
BEGIN
    -- 현재 날짜를 기준으로 30일 전 날짜 계산
    DECLARE @CutoffDate DATETIME
    SET @CutoffDate = DATEADD(DAY, -30, GETDATE())
    
    -- 백업 테이블 생성
    IF OBJECT_ID('LOG_MES_Backup', 'U') IS NULL
    BEGIN
        SELECT *
        INTO LOG_MES_Backup
        FROM LOG_MES
        WHERE datetime1 < @CutoffDate
    END
    ELSE
    BEGIN
        INSERT INTO LOG_MES_Backup
        SELECT *
        FROM LOG_MES
        WHERE datetime1 < @CutoffDate
    END
    
    -- 백업이 완료된 데이터 삭제
    DELETE FROM LOG_MES
    WHERE datetime1 < @CutoffDate
END
