import os
import textwrap

# --- 프로젝트 구조 및 파일 내용 정의 ---
# { "경로/파일명": """파일 내용""" } 형식
project_files = {
    "LightMeter/.gitignore": """
        *.iml
        .gradle
        /local.properties
        /.idea
        build
        /captures
        .externalNativeBuild
        .cxx
        local.properties
    """,
    "LightMeter/build.gradle.kts": """
        plugins {
            alias(libs.plugins.android.application) apply false
            alias(libs.plugins.jetbrains.kotlin.android) apply false
        }
    """,
    "LightMeter/gradle.properties": """
        org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
        android.useAndroidX=true
        kotlin.code.style=official
    """,
    # 매우 안정적인 그래들 8.4 버전으로 설정
    "LightMeter/gradle/wrapper/gradle-wrapper.properties": """
        distributionBase=GRADLE_USER_HOME
        distributionPath=wrapper/dists
        distributionUrl=https\\://services.gradle.org/distributions/gradle-8.4-bin.zip
        zipStoreBase=GRADLE_USER_HOME
        zipStorePath=wrapper/dists
    """,
    "LightMeter/settings.gradle.kts": """
        pluginManagement {
            repositories {
                google()
                mavenCentral()
                gradlePluginPortal()
            }
        }
        dependencyResolutionManagement {
            repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
            repositories {
                google()
                mavenCentral()
            }
        }

        rootProject.name = "LightMeter"
        include(":app")
    """,
    "LightMeter/app/.gitignore": """
        /build
    """,
    "LightMeter/app/build.gradle.kts": """
        plugins {
            alias(libs.plugins.android.application)
            alias(libs.plugins.jetbrains.kotlin.android)
        }

        android {
            namespace = "com.example.lightmeter"
            compileSdk = 34

            defaultConfig {
                applicationId = "com.example.lightmeter"
                minSdk = 24
                targetSdk = 34
                versionCode = 1
                versionName = "1.0"

                testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
            }

            buildTypes {
                release {
                    isMinifyEnabled = false
                    proguardFiles(
                        getDefaultProguardFile("proguard-android-optimize.txt"),
                        "proguard-rules.pro"
                    )
                }
            }
            compileOptions {
                sourceCompatibility = JavaVersion.VERSION_1_8
                targetCompatibility = JavaVersion.VERSION_1_8
            }
            kotlinOptions {
                jvmTarget = "1.8"
            }
            buildFeatures {
                viewBinding = true
            }
        }

        dependencies {
            implementation(libs.androidx.core.ktx)
            implementation(libs.androidx.appcompat)
            implementation(libs.material)
            implementation(libs.androidx.constraintlayout)
            testImplementation(libs.junit)
            androidTestImplementation(libs.androidx.junit)
            androidTestImplementation(libs.androidx.espresso.core)
        }
    """,
    "LightMeter/app/proguard-rules.pro": "# Add project specific ProGuard rules here.",
    "LightMeter/app/src/main/AndroidManifest.xml": """
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:tools="http://schemas.android.com/tools">

            <application
                android:allowBackup="true"
                android:dataExtractionRules="@xml/data_extraction_rules"
                android:fullBackupContent="@xml/backup_rules"
                android:icon="@mipmap/ic_launcher"
                android:label="@string/app_name"
                android:roundIcon="@mipmap/ic_launcher_round"
                android:supportsRtl="true"
                android:theme="@style/Theme.LightMeter"
                tools:targetApi="31">
                <activity
                    android:name=".MainActivity"
                    android:exported="true">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
            </application>

        </manifest>
    """,
    # 스펙에 따른 색상 변경 로직 추가
    "LightMeter/app/src/main/java/com/example/lightmeter/MainActivity.kt": """
        package com.example.lightmeter

        import android.content.Context
        import android.hardware.Sensor
        import android.hardware.SensorEvent
        import android.hardware.SensorEventListener
        import android.hardware.SensorManager
        import android.os.Bundle
        import androidx.appcompat.app.AppCompatActivity
        import androidx.core.content.ContextCompat
        import com.example.lightmeter.databinding.ActivityMainBinding

        class MainActivity : AppCompatActivity(), SensorEventListener {

            private lateinit var binding: ActivityMainBinding
            private lateinit var sensorManager: SensorManager
            private var lightSensor: Sensor? = null

            // --- 조도 스펙 정의 (이 값을 변경하여 스펙을 조절할 수 있습니다) ---
            private val SPEC_MIN_LUX = 100.0f
            private val SPEC_MAX_LUX = 500.0f
            // ---------------------------------------------------------

            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                binding = ActivityMainBinding.inflate(layoutInflater)
                setContentView(binding.root)

                // 화면에 현재 스펙 정보 표시
                binding.tvSpecInfo.text = getString(R.string.spec_info_format, SPEC_MIN_LUX, SPEC_MAX_LUX)

                sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager
                lightSensor = sensorManager.getDefaultSensor(Sensor.TYPE_LIGHT)

                if (lightSensor == null) {
                    binding.tvLuxValue.text = "조도 센서 없음"
                    binding.tvUnit.text = ""
                }
            }

            override fun onResume() {
                super.onResume()
                lightSensor?.let {
                    sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
                }
            }

            override fun onPause() {
                super.onPause()
                sensorManager.unregisterListener(this)
            }

            override fun onSensorChanged(event: SensorEvent?) {
                if (event?.sensor?.type == Sensor.TYPE_LIGHT) {
                    val luxValue = event.values[0]
                    binding.tvLuxValue.text = "%.1f".format(luxValue)
                    binding.tvUnit.text = "lux"

                    // 스펙 범위에 따라 텍스트 색상 변경
                    val colorResId = when {
                        luxValue < SPEC_MIN_LUX -> R.color.spec_out_dark_blue // 어두울 때
                        luxValue > SPEC_MAX_LUX -> R.color.spec_out_bright_red // 밝을 때
                        else -> R.color.spec_in_black // 정상 범위
                    }
                    binding.tvLuxValue.setTextColor(ContextCompat.getColor(this, colorResId))
                }
            }

            override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) {
                // Do nothing
            }
        }
    """,
    # 스펙 정보 표시를 위한 TextView 추가
    "LightMeter/app/src/main/res/layout/activity_main.xml": """
        <?xml version="1.0" encoding="utf-8"?>
        <androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            xmlns:tools="http://schemas.android.com/tools"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:padding="16dp"
            tools:context=".MainActivity">

            <TextView
                android:id="@+id/tv_lux_value"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="-"
                android:textSize="80sp"
                android:textStyle="bold"
                app:layout_constraintBottom_toBottomOf="parent"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toTopOf="parent"
                app:layout_constraintVertical_bias="0.45" />

            <TextView
                android:id="@+id/tv_unit"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:text="lux"
                android:textSize="24sp"
                app:layout_constraintEnd_toEndOf="@+id/tv_lux_value"
                app:layout_constraintStart_toStartOf="@+id/tv_lux_value"
                app:layout_constraintTop_toBottomOf="@+id/tv_lux_value" />

            <TextView
                android:id="@+id/tv_spec_info"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="24dp"
                android:textSize="16sp"
                app:layout_constraintEnd_toEndOf="parent"
                app:layout_constraintStart_toStartOf="parent"
                app:layout_constraintTop_toBottomOf="@+id/tv_unit"
                tools:text="Spec: 100.0 ~ 500.0 lux" />

        </androidx.constraintlayout.widget.ConstraintLayout>
    """,
    # 스펙 정보 표시를 위한 문자열 추가
    "LightMeter/app/src/main/res/values/strings.xml": """
        <resources>
            <string name="app_name">LightMeter</string>
            <string name="spec_info_format">Spec: %.1f ~ %.1f lux</string>
        </resources>
    """,
    "LightMeter/app/src/main/res/values/themes.xml": """
        <resources xmlns:tools="http://schemas.android.com/tools">
            <style name="Base.Theme.LightMeter" parent="Theme.Material3.DayNight.NoActionBar"></style>
            <style name="Theme.LightMeter" parent="Base.Theme.LightMeter" />
        </resources>
    """,
    # 스펙에 따른 색상 값 정의
    "LightMeter/app/src/main/res/values/colors.xml": """
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="black">#FF000000</color>
            <color name="white">#FFFFFFFF</color>

            <color name="spec_in_black">#FF000000</color>
            <color name="spec_out_dark_blue">#FF0000FF</color>
            <color name="spec_out_bright_red">#FFFF0000</color>
        </resources>
    """,
    "LightMeter/app/src/main/res/xml/backup_rules.xml": "<?xml version=\"1.0\" encoding=\"utf-8\"?><full-backup-content></full-backup-content>",
    "LightMeter/app/src/main/res/xml/data_extraction_rules.xml": "<?xml version=\"1.0\" encoding=\"utf-8\"?><data-extraction-rules></data-extraction-rules>",
    # 안정적인 AGP 8.4.2 버전으로 설정
    "LightMeter/gradle/libs.versions.toml": """
        [versions]
        agp = "8.4.2"
        kotlin = "1.9.23"
        coreKtx = "1.13.1"
        junit = "4.13.2"
        junitVersion = "1.2.1"
        espressoCore = "3.6.1"
        appcompat = "1.7.0"
        material = "1.12.0"
        constraintlayout = "2.1.4"

        [libraries]
        androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
        junit = { group = "junit", name = "junit", version.ref = "junit" }
        androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "junitVersion" }
        androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espressoCore" }
        androidx-appcompat = { group = "androidx.appcompat", name = "appcompat", version.ref = "appcompat" }
        material = { group = "com.google.android.material", name = "material", version.ref = "material" }
        androidx-constraintlayout = { group = "androidx.constraintlayout", name = "constraintlayout", version.ref = "constraintlayout" }

        [plugins]
        android-application = { id = "com.android.application", version.ref = "agp" }
        jetbrains-kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }
    """
}

def create_project():
    base_dir = "LightMeter"
    print(f"'{base_dir}' 프로젝트 생성을 시작합니다...")
    if not os.path.exists(base_dir):
        os.makedirs(base_dir)
    for file_path, content in project_files.items():
        directory = os.path.dirname(file_path)
        if not os.path.exists(directory):
            os.makedirs(directory)
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(textwrap.dedent(content).strip())
        print(f"  - 생성 완료: {file_path}")
    print(f"\n✅ '{base_dir}' 프로젝트 파일 생성이 완료되었습니다!")

if __name__ == "__main__":
    create_project()