#에서 static 없이 기존 함수들을 10분마다 실행하면서, 이전 실행이 끝나지 않으면 대기 후 다시 실행하는 비동기 코드를 작성했습니다.

✅ static 없이 비동기 타이머
csharp
코드 복사
using System;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    private Timer _timer;
    private bool _isRunning = false; // 실행 중인지 확인
    private readonly object _lock = new object(); // 동시 실행 방지

    public Program()
    {
        _timer = new Timer(async _ => await CheckAndRunTask(), null, 0, 600000); // 10분마다 실행
    }

    private async Task CheckAndRunTask()
    {
        lock (_lock)
        {
            if (_isRunning)
            {
                Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 이전 실행이 끝나지 않음, 다음 실행 대기...");
                return;
            }
            _isRunning = true;
        }

        try
        {
            Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 작업 시작");
            await RunTaskAsync(); // 기존 함수 실행
            Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 작업 완료");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"오류 발생: {ex.Message}");
        }
        finally
        {
            _isRunning = false; // 실행 완료 후 다시 실행 가능하도록 설정
        }
    }

    private async Task RunTaskAsync()
    {
        // ⚡ 기존 함수 실행 (여기에 10분마다 실행할 작업 추가)
        Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 기존 작업 실행 중...");
        await Task.Delay(20000); // 20초 동안 실행되는 작업 (테스트용)
        Console.WriteLine($"{DateTime.Now:HH:mm:ss} - 기존 작업 종료");
    }

    public static async Task Main()
    {
        Console.WriteLine("Timer 시작...");
        var program = new Program(); // 객체 생성

        await Task.Delay(Timeout.Infinite); // 프로그램 유지
    }
}
✅ 설명
Program 클래스 내부에 모든 변수 및 타이머 인스턴스를 유지 (static 없이 관리)
Program 생성자에서 Timer 실행
10분마다 CheckAndRunTask() 실행
실행 중이면 다음 실행 대기
실행 가능하면 RunTaskAsync() 실행
기존 함수 (RunTaskAsync()) 수정 없이 사용 가능
✅ 실행 결과 (예제)
makefile
코드 복사
Timer 시작...
10:00:00 - 작업 시작
10:00:00 - 기존 작업 실행 중...
10:00:20 - 기존 작업 종료
10:00:20 - 작업 완료
10:10:00 - 작업 시작
10:10:00 - 기존 작업 실행 중...
10:10:20 - 기존 작업 종료
10:10:20 - 작업 완료
10:20:00 - 이전 실행이 끝나지 않음, 다음 실행 대기...
👉 10분마다 실행되지만, 이전 실행이 끝나지 않으면 다음 실행을 건너뜀

✅ 특징
✔ static 없이 인스턴스(Program)에서 타이머 관리
✔ 기존 함수 (RunTaskAsync()) 수정 없이 사용 가능
✔ 10분마다 실행되되, 이전 실행이 끝나지 않으면 대기
✔ 비동기 (async/await) 방식으로 실행