gent\routeracrmiddleware\setting.ini 파일에 저장하고 불러오는 Settings 클래스를 구현하는 방법을 설명드릴게요. 이 클래스는 COM 포트 값을 저장하거나 불러오는 기능을 가지고 있습니다. SaveSettings와 LoadSettings 함수를 통해 값을 저장하고 불러올 수 있도록 구성하겠습니다.

먼저, Settings 클래스를 작성합니다.

Settings 클래스 구현
csharp
코드 복사
using System;
using System.IO;
using System.Text;

public class Settings
{
    private readonly string _filePath;

    // 설정 파일 경로를 지정합니다.
    public Settings()
    {
        _filePath = @"C:\agent\routeracrmiddleware\setting.ini";
    }

    // COM 포트 값을 파일에 저장하는 함수
    public void SaveSettings(string comPort)
    {
        try
        {
            // 설정 파일이 없는 경우 파일을 생성합니다.
            if (!File.Exists(_filePath))
            {
                File.Create(_filePath).Dispose();
            }

            // 파일에 COM 포트 값을 저장합니다.
            using (StreamWriter writer = new StreamWriter(_filePath, false, Encoding.UTF8))
            {
                writer.WriteLine($"COM_PORT={comPort}");
            }
        }
        catch (Exception ex)
        {
            // 에러 발생 시 로그 또는 예외 처리
            Console.WriteLine($"Error saving settings: {ex.Message}");
        }
    }

    // COM 포트 값을 파일에서 불러오는 함수
    public string LoadSettings()
    {
        try
        {
            // 파일이 존재하는지 확인하고 존재하면 내용을 읽어옵니다.
            if (File.Exists(_filePath))
            {
                using (StreamReader reader = new StreamReader(_filePath, Encoding.UTF8))
                {
                    string line;
                    while ((line = reader.ReadLine()) != null)
                    {
                        // "COM_PORT="로 시작하는 줄을 찾고 값을 반환합니다.
                        if (line.StartsWith("COM_PORT="))
                        {
                            return line.Substring("COM_PORT=".Length).Trim();
                        }
                    }
                }
            }
        }
        catch (Exception ex)
        {
            // 에러 발생 시 로그 또는 예외 처리
            Console.WriteLine($"Error loading settings: {ex.Message}");
        }

        // 파일이 없거나 값을 찾지 못한 경우 빈 문자열 반환
        return string.Empty;
    }
}
코드 설명
파일 경로 지정:

_filePath 변수에 설정 파일 경로를 지정합니다. (C:\agent\routeracrmiddleware\setting.ini)
SaveSettings 함수:

SaveSettings 함수는 comPort 값을 받아 설정 파일에 저장합니다.
파일이 존재하지 않으면 새로 생성하고, 존재하면 덮어씁니다.
LoadSettings 함수:

LoadSettings 함수는 설정 파일에서 COM 포트 값을 불러옵니다.
설정 파일에 저장된 값 중 "COM_PORT="로 시작하는 값을 찾아 반환합니다.
파일이 없거나 값이 없을 경우 빈 문자열을 반환합니다.
이제 이 클래스를 사용하여 COM 포트 값을 저장하고 불러올 수 있습니다.

예제 사용법
csharp
코드 복사
public class MainViewModel
{
    private readonly Settings _settings;

    public MainViewModel()
    {
        _settings = new Settings();
        // 설정 불러오기 예제
        string comPort = _settings.LoadSettings();
        Console.WriteLine($"Loaded COM Port: {comPort}");

        // 설정 저장 예제
        _settings.SaveSettings("COM1");
        Console.WriteLine("COM Port saved as COM1.");
    }
}
위 예제에서는 MainViewModel에서 Settings 클래스를 생성하여 LoadSettings와 SaveSettings를 사용합니다. LoadSettings는 파일에서 설정을 불러오고, SaveSettings는 새로운 COM 포트 값을 저장합니다.

이렇게 구현하면 설정 파일에 간단하게 COM 포트 값을 저장하고 불러오는 기능을 손쉽게 관리할 수 있습니다.




