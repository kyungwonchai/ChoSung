코드는 여러 개의 파일을 선택하고, 그중에서 "SOP"라는 글자가 포함된 파일을 열어 사내, 외주, 일별이라는 단어가 포함된 시트를 복제해 내 파일의 "SOP시트"로 생성합니다. 만약 "SOP시트"가 이미 존재하면 삭제한 후 새로 생성합니다.

VBA 매크로를 작성하기 위해 Excel에서 Alt + F11을 눌러 VBA 편집기를 열고,
삽입 -> 모듈을 선택해 새 모듈에 아래 코드를 붙여넣으세요.
vba
코드 복사
Sub 복제_SOP_시트()
    Dim 파일_대화상자 As FileDialog
    Dim 선택된_파일 As Variant
    Dim 원본_통합문서 As Workbook
    Dim 대상_시트 As Worksheet
    Dim 복사할_시트 As Worksheet
    Dim 필요_시트_목록 As Collection
    Dim ws As Worksheet
    
    ' SOP시트가 이미 존재하면 삭제
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("SOP시트")
    If Not ws Is Nothing Then
        Application.DisplayAlerts = False
        ws.Delete
        Application.DisplayAlerts = True
    End If
    On Error GoTo 0
    
    ' 파일 열기 대화상자 설정
    Set 파일_대화상자 = Application.FileDialog(msoFileDialogFilePicker)
    With 파일_대화상자
        .Title = "파일 선택"
        .AllowMultiSelect = True
        .Filters.Clear
        .Filters.Add "Excel 파일", "*.xls; *.xlsx; *.xlsm"
        If .Show = -1 Then
            ' 선택된 파일들에 대해 처리
            For Each 선택된_파일 In .SelectedItems
                If InStr(1, 선택된_파일, "SOP", vbTextCompare) > 0 Then
                    Set 원본_통합문서 = Workbooks.Open(선택된_파일)
                    Set 필요_시트_목록 = New Collection
                    
                    ' 사내, 외주, 일별 포함된 시트 검색
                    For Each 대상_시트 In 원본_통합문서.Sheets
                        If InStr(1, 대상_시트.Name, "사내", vbTextCompare) > 0 And _
                           InStr(1, 대상_시트.Name, "외주", vbTextCompare) > 0 And _
                           InStr(1, 대상_시트.Name, "일별", vbTextCompare) > 0 Then
                            필요_시트_목록.Add 대상_시트
                        End If
                    Next 대상_시트
                    
                    ' 시트 복사 및 SOP시트로 이름 변경
                    If 필요_시트_목록.Count > 0 Then
                        필요_시트_목록(1).Copy After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count)
                        Set 복사할_시트 = ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count)
                        복사할_시트.Name = "SOP시트"
                    End If
                    
                    ' 원본 통합문서 닫기
                    원본_통합문서.Close SaveChanges:=False
                End If
            Next 선택된_파일
        End If
    End With
End Sub
코드 설명:
SOP시트 삭제 후 생성: 만약 기존에 "SOP시트"가 존재하면 먼저 삭제하고, 이후 복사된 시트의 이름을 "SOP시트"로 설정합니다.
파일 열기 대화상자: 사용자가 여러 개의 파일을 선택할 수 있도록 파일 대화상자를 표시하고, 선택된 파일 중 이름에 "SOP"가 포함된 파일만 처리합니다.
시트 검색 및 복사: 파일에서 "사내", "외주", "일별"이라는 단어가 모두 포함된 시트를 찾은 후, 이 시트를 현재 작업 중인 통합 문서로 복사하여 "SOP시트"라는 이름으로 설정합니다.