시트를 선택한 후, 병합된 셀의 오른쪽 영역을 복사하여 다른 시트에 데이터(y1, y2)로 넣도록 구현한 매크로입니다.

VBA 매크로 코드 (상세 주석 포함)
vba
코드 복사
Sub ProcessOpenWorkbooks()
    Dim wbA As Workbook, wbB As Workbook
    Dim wsS1 As Worksheet, wsTarget As Worksheet
    Dim cell As Range
    Dim CH1 As String, SH1 As String
    Dim y1 As Range, y2 As Range
    Dim targetRow As Long
    Dim mergeRange As Range

    ' A 파일: SOP로 시작하는 열린 파일 찾기
    For Each wbA In Application.Workbooks
        If InStr(1, wbA.Name, "SOP") > 0 Then
            Set wbA = wbA
            Exit For
        End If
    Next wbA

    ' B 파일: SMD로 시작하는 열린 파일 찾기
    For Each wbB In Application.Workbooks
        If InStr(1, wbB.Name, "SMD") > 0 Then
            Set wbB = wbB
            Exit For
        End If
    Next wbB

    ' 열려 있는 SOP 또는 SMD 파일이 없는 경우
    If wbA Is Nothing Or wbB Is Nothing Then
        MsgBox "SOP 또는 SMD로 시작하는 파일이 열려 있지 않습니다.", vbCritical
        Exit Sub
    End If

    ' A 파일에서 "사내"와 "외주"가 포함된 시트(S1) 찾기
    For Each wsS1 In wbA.Worksheets
        If InStr(wsS1.Name, "사내") > 0 And InStr(wsS1.Name, "외주") > 0 Then
            Set wsS1 = wsS1
            wsS1.Activate ' 찾은 시트를 활성화
            Exit For
        End If
    Next wsS1

    ' S1 시트를 찾을 수 없는 경우
    If wsS1 Is Nothing Then
        MsgBox "A 파일에서 '사내'와 '외주'가 포함된 시트를 찾을 수 없습니다.", vbCritical
        Exit Sub
    End If

    ' C열에서 CH1 값을 찾기
    ' 조건: "W", 숫자 2개, "일별 생산계획" 포함된 셀
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If InStr(cell.Value, "W") > 0 And _
           IsNumeric(Mid(cell.Value, InStr(cell.Value, "W") + 1, 2)) And _
           InStr(cell.Value, "일별 생산계획") > 0 Then
            CH1 = Mid(cell.Value, InStr(cell.Value, "W"), 3) ' 예: W55 추출
            SH1 = Mid(CH1, 2, 2) & "주차" ' 예: 55주차
            Exit For
        End If
    Next cell

    ' CH1 또는 SH1 값을 찾지 못한 경우
    If CH1 = "" Or SH1 = "" Then
        MsgBox "CH1 또는 SH1 값을 찾을 수 없습니다.", vbCritical
        Exit Sub
    End If

    ' 병합된 셀의 오른쪽 데이터를 y1, y2로 설정
    ' 조건: E열 값에 "SM-"이 포함된 경우
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If cell.MergeArea Is Nothing = False Then ' 병합된 셀 확인
            Set mergeRange = cell.MergeArea ' 병합된 셀 영역
            Dim mergeRow As Long
            mergeRow = mergeRange.Row ' 병합된 셀의 시작 행
            
            ' E열에 "SM-" 포함 여부 확인
            If InStr(wsS1.Cells(mergeRow, "E").Value, "SM-") > 0 Then
                ' y1: E열 데이터
                Set y1 = wsS1.Cells(mergeRow, "E")
                
                ' y2: 병합된 셀 우측의 F~K 열
                Set y2 = wsS1.Range(wsS1.Cells(mergeRow, "F"), wsS1.Cells(mergeRow, "K"))
                
                ' 해당 데이터를 다른 시트로 복사
                Exit For
            End If
        End If
    Next cell

    ' y1 또는 y2를 찾을 수 없는 경우
    If y1 Is Nothing Or y2 Is Nothing Then
        MsgBox "병합 셀의 우측 데이터를 찾을 수 없습니다.", vbCritical
        Exit Sub
    End If

    ' B 파일에서 SH1 이름이 포함된 시트 찾기
    For Each wsTarget In wbB.Worksheets
        If InStr(wsTarget.Name, SH1) > 0 Then
            Set wsTarget = wsTarget
            wsTarget.Activate ' 해당 시트를 활성화
            Exit For
        End If
    Next wsTarget

    ' SH1 이름이 포함된 시트를 찾지 못한 경우
    If wsTarget Is Nothing Then
        MsgBox "B 파일에서 '" & SH1 & "' 시트를 찾을 수 없습니다.", vbCritical
        Exit Sub
    End If

    ' y1, y2 데이터를 SH1 시트로 복사
    targetRow = wsTarget.Cells(wsTarget.Rows.Count, "D").End(xlUp).Row + 1
    wsTarget.Cells(targetRow, "D").Value = y1.Value ' y1 데이터를 D열에 복사
    wsTarget.Range(wsTarget.Cells(targetRow, "F"), wsTarget.Cells(targetRow, "K")).Value = y2.Value ' y2 데이터를 F~K 열에 복사

    ' 완료 메시지
    MsgBox "데이터 복사가 완료되었습니다.", vbInformation
End Sub
주요 작업 내용
파일 선택:

열려 있는 모든 파일에서 이름에 "SOP"와 "SMD"가 포함된 파일을 자동으로 선택합니다.
S1 시트 활성화:

"사내"와 "외주"가 포함된 시트를 검색하고 찾으면 선택(활성화)합니다.
CH1 값 추출:

C열에서 "W", 숫자 2개, "일별 생산계획"이 포함된 셀에서 CH1 값을 추출합니다.
예: W55 → CH1 값으로 설정.
병합된 셀의 오른쪽 데이터 복사:

E열 값에 "SM-"이 포함된 병합된 셀의 F~K 열 데이터를 y1, y2로 설정합니다.
B 파일의 타겟 시트 활성화:

B 파일에서 SH1 이름이 포함된 시트를 검색하고 찾으면 선택(활성화)합니다.
데이터 복사:

y1(E열 값)을 타겟 시트의 D열에 복사합니다.
y2(FK 열 값)를 타겟 시트의 FK 열에 복사합니다.
사용 방법
VBA 편집기 열기: Alt + F11을 눌러 VBA 편집기를 엽니다.
모듈 추가: 삽입 > 모듈을 선택한 후 위 코드를 붙여넣습니다.
매크로 실행: Alt + F8을 눌러 ProcessOpenWorkbooks를 실행합니다.
주의 사항
파일 이름에 반드시 "SOP"와 "SMD"가 포함되어야 합니다.
S1 시트에서 병합된 셀의 오른쪽 값이 올바르게 포함되어야 합니다.