ere is a T-SQL query using a common table expression (CTE) and window functions (ROW_NUMBER(), LEAD(), LAG()) to achieve your goal.

Query Explanation:
Merge Two Tables – Using JOIN or UNION depending on how they are combined.
Find the Row Containing %abc% – Using LIKE '%abc%' in WHERE.
Get the First Value (Ordered by no1) – Using TOP 1 and ORDER BY no1.
Find the 3 Rows Above and Below This Value – Using ROW_NUMBER(), LAG(), LEAD().
Functional SQL Procedure
sql
코드 복사
CREATE PROCEDURE GetSurroundingValues
    @searchValue NVARCHAR(100) -- Search keyword, e.g., 'abc'
AS
BEGIN
    SET NOCOUNT ON;
    
    WITH CTE AS (
        SELECT 
            szmodelname, 
            szbarcode, 
            no1,
            ROW_NUMBER() OVER (ORDER BY no1) AS rn
        FROM MergedTable  -- Assuming the merged table
        WHERE szmodelname LIKE '%' + @searchValue + '%'
    )
    -- Find the first row where the condition is met
    , FirstValue AS (
        SELECT TOP 1 szmodelname, szbarcode, no1, rn
        FROM CTE
        ORDER BY no1
    )
    -- Get the 3 rows above and below this value
    SELECT 
        M.szmodelname, M.szbarcode, M.no1
    FROM CTE M
    INNER JOIN FirstValue F ON ABS(M.rn - F.rn) <= 3  -- Get ±3 rows
    ORDER BY M.no1;
END;
How to Use It
sql
코드 복사
EXEC GetSurroundingValues 'abc';
Alternative Inline Query (Without Procedure)
sql
코드 복사
WITH CTE AS (
    SELECT 
        szmodelname, 
        szbarcode, 
        no1,
        ROW_NUMBER() OVER (ORDER BY no1) AS rn
    FROM MergedTable
),
FirstValue AS (
    SELECT TOP 1 no1, rn FROM CTE WHERE szmodelname LIKE '%abc%' ORDER BY no1
)
SELECT CTE.szmodelname, CTE.szbarcode, CTE.no1
FROM CTE
JOIN FirstValue ON ABS(CTE.rn - FirstValue.rn) <= 3
ORDER BY CTE.no1;
Explanation
CTE (Common Table Expression) – Assigns a row number to each row ordered by no1.
FirstValue CTE – Finds the first occurrence of %abc% and saves its no1.
Final Selection – Selects rows 3 above and 3 below that match no1.
Output Example
szmodelname	szbarcode	no1
xyz123	123456789	100
abc001	123456780	101 ← (Matched Value)
pqr456	123456781	102
def789	123456782	103