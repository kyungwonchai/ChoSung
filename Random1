able_InspectionResult 테이블에서 각 ipname별로 inspectiontime이 최근인 50개의 데이터를 조회하는 저장 프로시저입니다.

저장 프로시저
sql
코드 복사
CREATE PROCEDURE GetLatestInspectionResults
AS
BEGIN
    SET NOCOUNT ON;

    ;WITH RankedResults AS (
        SELECT
            ipname,
            inspectiontime,
            modelname,
            alignresult,
            mp1data,
            mp1result,
            mp2data,
            mp2result,
            mp3data,
            mp3result,
            mp4data,
            mp4result,
            mp5data,
            mp5result,
            mp6data,
            mp6result,
            mp7data,
            mp7result,
            mp8data,
            mp8result,
            mp9data,
            mp9result,
            mp10data,
            mp10result,
            ROW_NUMBER() OVER (PARTITION BY ipname ORDER BY inspectiontime DESC) AS RowNum
        FROM
            Table_InspectionResult
    )
    SELECT
        ipname,
        inspectiontime,
        modelname,
        alignresult,
        mp1data,
        mp1result,
        mp2data,
        mp2result,
        mp3data,
        mp3result,
        mp4data,
        mp4result,
        mp5data,
        mp5result,
        mp6data,
        mp6result,
        mp7data,
        mp7result,
        mp8data,
        mp8result,
        mp9data,
        mp9result,
        mp10data,
        mp10result
    FROM
        RankedResults
    WHERE
        RowNum <= 50
    ORDER BY
        ipname,
        inspectiontime DESC;
END;
GO
주요 동작 원리
ROW_NUMBER() 함수 사용:
각 ipname을 기준으로 inspectiontime을 내림차순 정렬하여 순번을 부여합니다.
ROW_NUMBER() 함수는 PARTITION BY ipname으로 IP별로 그룹을 나누고, 그룹 내부에서 정렬하여 고유한 번호를 생성합니다.
WITH 절 (CTE):
Common Table Expression(CTE)을 사용하여 각 IP별로 순번을 부여한 데이터를 생성합니다.
최대 50개 데이터 필터링:
WHERE RowNum <= 50 조건을 사용하여 각 IP별로 상위 50개의 데이터만 필터링합니다.
정렬:
결과를 ipname과 inspectiontime DESC 기준으로 정렬하여 보기 쉽게 만듭니다.
실행 방법
저장 프로시저를 생성한 뒤, 아래와 같이 실행합니다.

sql
코드 복사
EXEC GetLatestInspectionResults;
기대 결과
Table_InspectionResult 테이블에서 각 ipname별로 가장 최근의 50개의 데이터가 반환됩니다. 반환된 데이터는 ipname과 inspectiontime 기준으로 정렬됩니다.

반환 예시
ipname	inspectiontime	modelname	alignresult	mp1data	mp1result	...	mp10data	mp10result
10.22.164.22	2025-01-18 10:00:00	ModelA	Aligned	0.542	OK	...	0.612	OK
10.22.164.22	2025-01-18 09:50:00	ModelA	Aligned	0.322	OK	...	0.412	OK
...	...	...	...	...	...	...	...	...
10.22.165.22	2025-01-18 10:05:00	ModelB	Aligned	-0.432	OK	...	0.152	OK
...	...	...	...	...	...	...	...	...
성능 최적화
ipname과 inspectiontime에 인덱스를 추가하면 성능이 크게 향상됩니다.
sql
코드 복사
CREATE INDEX IX_Table_InspectionResult_ipname_inspectiontime
ON Table_InspectionResult (ipname, inspectiontime DESC);


