using DevExpress.XtraEditors;
using DevExpress.XtraGrid;
using DevExpress.XtraGrid.Views.Grid;
using DevExpress.XtraPrinting;
using System;
using System.IO;
using System.Windows.Forms;

namespace WinFormsApp
{
    public partial class MainForm : XtraForm
    {
        public MainForm()
        {
            InitializeComponent();
        }

        private void MainForm_Load(object sender, EventArgs e)
        {
            // 예시 GridView 추가
            AddGridView(gridControl1, gridView1, "Sheet1");
            AddGridView(gridControl2, gridView2, "Sheet2");
            // 필요한 만큼 GridView를 추가하십시오.
        }

        private void AddGridView(GridControl gridControl, GridView gridView, string sheetName)
        {
            // GridView 설정
            gridView.OptionsBehavior.Editable = false; // 편집 비활성화

            // 예시 데이터 설정
            gridView.Columns.AddField("Name").Visible = true;
            gridView.Columns.AddField("Age").Visible = true;
            gridView.Columns.AddField("Address").Visible = true;
            gridView.Columns.AddField("Email").Visible = true;

            // 데이터 바인딩
            gridControl.DataSource = GetDataSource();

            // GridControl에 컨텍스트 메뉴 추가
            gridControl.ContextMenuStrip = new ContextMenuStrip();
            gridControl.ContextMenuStrip.Opening += ContextMenuStrip_Opening;

            // GridView와 시트 이름을 연결하여 Tag에 저장
            gridView.Tag = sheetName;

            // GridControl 추가
            Controls.Add(gridControl);
        }

        private void ContextMenuStrip_Opening(object sender, System.ComponentModel.CancelEventArgs e)
        {
            ContextMenuStrip contextMenuStrip = (ContextMenuStrip)sender;
            contextMenuStrip.Items.Clear();

            // 우클릭한 GridControl과 연결된 GridView 가져오기
            GridControl gridControl = (GridControl)contextMenuStrip.SourceControl;
            GridView gridView = (GridView)gridControl.MainView;

            // 내보내기 메뉴 아이템 추가
            ToolStripMenuItem exportMenuItem = new ToolStripMenuItem("Export to Excel");
            exportMenuItem.Click += (s, ev) => ExportMenuItem_Click(sender, gridView);
            contextMenuStrip.Items.Add(exportMenuItem);
        }

        private void ExportMenuItem_Click(object sender, GridView gridView)
        {
            // GridView를 엑셀로 내보내기
            SaveFileDialog saveFileDialog = new SaveFileDialog();
            saveFileDialog.Filter = "Excel files|*.xlsx";
            if (saveFileDialog.ShowDialog() == DialogResult.OK)
            {
                XlsxExportOptionsEx options = new XlsxExportOptionsEx();
                options.ExportType = ExportType.WYSIWYG;
                options.ShowGridLines = true;

                using (FileStream stream = new FileStream(saveFileDialog.FileName, FileMode.Create))
                {
                    gridView.ExportToXlsx(stream, options);
                }

                XtraMessageBox.Show("Export completed!", "Export", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }

        private object GetDataSource()
        {
            // 예시 데이터 소스 반환
            // 실제 데이터를 가져와서 바인딩하는 로직으로 대체해야 합니다.
            return new[]
            {
                new { Name = "John Doe", Age = 30, Address = "123 Main St", Email = "john@example.com" },
                new
