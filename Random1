MSSQL 테이블 생성 스크립트

sql

CREATE TABLE FilesTable (
    ID INT PRIMARY KEY IDENTITY(1, 1),
    FileName NVARCHAR(255),
    FilePath NVARCHAR(255),
    FileData VARBINARY(MAX)
);

C# WinForms 코드

Devexpress를 사용한 코드입니다.

csharp

using DevExpress.XtraEditors;
using System;
using System.Data;
using System.Data.SqlClient;
using System.IO;
using System.Windows.Forms;

public class MyForm : XtraForm
{
    DevExpress.XtraGrid.GridControl gridControl;
    DevExpress.XtraGrid.Views.Grid.GridView gridView;
    SimpleButton uploadButton, downloadButton;
    string connectionString = "Data Source=서버주소;Initial Catalog=데이터베이스명;User ID=유저ID;Password=비밀번호";
    string variableAA = @"C:\path\to\file.txt";

    public MyForm()
    {
        InitializeComponent();
        LoadData();
    }

    void InitializeComponent()
    {
        // DevExpress GridControl 초기화
        gridControl = new DevExpress.XtraGrid.GridControl();
        gridView = new DevExpress.XtraGrid.Views.Grid.GridView();
        gridControl.ViewCollection.Add(gridView);
        gridControl.MainView = gridView;
        Controls.Add(gridControl);

        // 버튼 초기화
        uploadButton = new SimpleButton();
        uploadButton.Text = "업로드";
        uploadButton.Click += UploadButton_Click;
        Controls.Add(uploadButton);

        downloadButton = new SimpleButton();
        downloadButton.Text = "다운로드";
        downloadButton.Click += DownloadButton_Click;
        Controls.Add(downloadButton);
    }

    // 데이터 로드 함수
    void LoadData()
    {
        using (SqlConnection conn = new SqlConnection(connectionString))
        {
            conn.Open();
            SqlDataAdapter sda = new SqlDataAdapter("SELECT * FROM FilesTable", conn);
            DataTable dt = new DataTable();
            sda.Fill(dt);
            gridControl.DataSource = dt;
        }
    }

    // 업로드 버튼 클릭 이벤트
    void UploadButton_Click(object sender, EventArgs e)
    {
        string fileName = Path.GetFileName(variableAA);
        byte[] fileData = File.ReadAllBytes(variableAA);

        using (SqlConnection conn = new SqlConnection(connectionString))
        {
            conn.Open();
            string query = "INSERT INTO FilesTable (FileName, FilePath, FileData) VALUES (@FileName, @FilePath, @FileData)";
            using (SqlCommand cmd = new SqlCommand(query, conn))
            {
                cmd.Parameters.AddWithValue("@FileName", fileName);
                cmd.Parameters.AddWithValue("@FilePath", variableAA);
                cmd.Parameters.AddWithValue("@FileData", fileData);
                cmd.ExecuteNonQuery();
            }
        }
        LoadData();
    }

    // 다운로드 버튼 클릭 이벤트
    void DownloadButton_Click(object sender, EventArgs e)
    {
        int[] selectedRows = gridView.GetSelectedRows();
        if (selectedRows.Length > 0)
        {
            DataRow row = gridView.GetDataRow(selectedRows[0]);
            string filePath = row["FilePath"].ToString();
            DownloadFileFromDatabase(filePath);
        }
    }

    // 데이터베이스에서 파일 다운로드
    void DownloadFileFromDatabase(string filePath)
    {
        using (SqlConnection conn = new SqlConnection(connectionString))
        {
            conn.Open();
            string query = "SELECT FileData FROM FilesTable WHERE FilePath=@FilePath";
            using (SqlCommand cmd = new SqlCommand(query, conn))
            {
                cmd.Parameters.AddWithValue("@FilePath", filePath);
                byte[] fileData = (byte[])cmd.ExecuteScalar();
                File.WriteAllBytes("저장될경로", fileData);
            }
        }
    }
}

이 코드에서는 DevExpress의 GridControl과 SimpleButton을 사용하여 UI를 구성하였습니다.

    LoadData: 데이터베이스에서 파일 정보를 로드하여 gridControl에 바인딩합니다.
    UploadButton_Click: variableAA에 저장된 파일을 데이터베이스에 업로드합니다.
    DownloadButton_Click: 선택한 행의 파일을 데이터베이스에서 다운로드합니다.

코드는 예시이므로 실제 환경에 맞게 수정이 필요할 수 있습니다. 예외 처리 등