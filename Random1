행의 값이 500 이하일 경우, 해당 열의 3행 값 자체를 기준으로 우측에 값이 있으면 우측에 더하고, 우측에 값이 없으면 좌측에 더하는 로직으로 코드를 수정하겠습니다. 주석도 추가하겠습니다. 다음은 수정된 코드입니다:

csharp
Copy code
using System;
using Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Application excelApp = (Application)System.Runtime.InteropServices.Marshal.GetActiveObject("Excel.Application");
        Workbook workbook = null;

        // 열려있는 워크북 중에서 "SMD_검사기"가 포함된 파일명을 가진 워크북을 찾습니다.
        foreach (Workbook wb in excelApp.Workbooks)
        {
            if (wb.Name.Contains("SMD_검사기"))
            {
                workbook = wb;
                break;
            }
        }

        if (workbook != null)
        {
            Worksheet worksheet = workbook.Worksheets["Data"];
            Range usedRange = worksheet.UsedRange;
            int startColumn = worksheet.Columns["BQ"].Column;
            int totalRows = usedRange.Rows.Count;
            int totalColumns = usedRange.Columns.Count;

            // BQ 열부터 시작하여 마지막 열까지 순회합니다.
            for (int col = startColumn; col <= totalColumns; col++)
            {
                // 3행의 값을 확인합니다.
                var thirdRowValue = worksheet.Cells[3, col].Value;
                if (thirdRowValue != null && double.TryParse(thirdRowValue.ToString(), out double thirdRowNumericValue) && thirdRowNumericValue <= 500)
                {
                    // 우측 컬럼에 값이 있으면 그 값에 더합니다.
                    if (col < totalColumns && worksheet.Cells[3, col + 1].Value != null)
                    {
                        worksheet.Cells[3, col + 1].Value = thirdRowNumericValue + Convert.ToDouble(worksheet.Cells[3, col + 1].Value);
                    }
                    // 우측 컬럼에 값이 없으면 좌측 컬럼의 값에 더합니다.
                    else if (col > 1 && worksheet.Cells[3, col - 1].Value != null)
                    {
                        worksheet.Cells[3, col - 1].Value = thirdRowNumericValue + Convert.ToDouble(worksheet.Cells[3, col - 1].Value);
                    }
                }
            }
        }
        else
        {
            Console.WriteLine("해당하는 이름의 엑셀 파일이 열려있지 않습니다.");
        }
    }
}
이 코드는 3행의 값이 500 이하인 경우에만 해당 열의 3행 값에 대해 처리를 진행합니다. 처리는 우측 컬럼에 값이 있으면 그 값에 더하고, 없으면 좌측 컬럼의 