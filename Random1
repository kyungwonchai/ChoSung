경원님. 아주 중요한 파일들을 발견하셨네요! 그 service 파일들이 있어야 라즈베리파이가 켜질 때 자동으로 프로그램들이 돌기 시작합니다.

요청하신 대로 두 가지로 나누어 드리겠습니다.

[별도 요청] 서비스 파일 백업용 명령어 (기존 파이 -> USB): 손으로 직접 복사하실 때 쓰는 명령어입니다.

[업데이트됨] 통합 복원 스크립트 (import_pi.sh): /home/pi 복구, Python 3.9 설정, 그리고 서비스 파일 등록 및 자동 실행까지 한 번에 처리합니다.

1. (기존 라즈베리파이용) 서비스 파일 수동 복사 명령어
기존 라즈베리파이에서 USB(또는 백업 폴더)로 서비스 파일 3개를 복사해오는 명령어입니다. (USB 경로가 /media/pi/smd라고 가정합니다. 다르다면 경로만 바꿔주세요.)

Bash

# 1. 파일 복사 (관리자 권한 필요)
sudo cp /etc/systemd/system/battery_collector.service /media/pi/smd/
sudo cp /etc/systemd/system/battery_logger.service /media/pi/smd/
sudo cp /etc/systemd/system/batt_test.service /media/pi/smd/

# 2. 잘 들어갔는지 확인
ls -l /media/pi/smd/*.service
2. (새 라즈베리파이용) 통합 복원 스크립트 (import_pi.sh)
이 스크립트 하나만 돌리면 파일 복구 + Python 3.9 셋팅 + 서비스 등록/실행이 모두 끝납니다.

변경점: USB에 있는 .service 파일 3개를 /etc/systemd/system으로 옮기고, 권한을 주고, 부팅 시 자동 실행되도록 등록하는 과정(7단계)을 추가했습니다.

Bash

#!/bin/bash
# import_pi.sh
# 작성자: Gemini (for Kyongwon)
# 설명: 데이터 복원, Python 3.9 환경 구축, 그리고 Systemd 서비스 파일 등록까지 일괄 처리

set +e 

# === [설정 변수] ===
USB_PATH="/media/pi/smd"
BACKUP_FILE="$USB_PATH/pi_home_full_backup.tar.gz"
TARGET_DATE="2025-12-15 13:30:00"

# 서비스 파일 이름 목록
SERVICES=("battery_collector.service" "battery_logger.service" "batt_test.service")

# === [0. 권한 체크] ===
if [ "$EUID" -ne 0 ]; then
  echo "에러: sudo로 실행해주세요. (예: sudo ./import_pi.sh)"
  exit 1
fi

echo "=== [1/7] 시스템 날짜 설정 ==="
date -s "$TARGET_DATE"
echo "현재 시간: $(date)"

echo "=== [2/7] 백업 파일 확인 ==="
if [ ! -f "$BACKUP_FILE" ]; then
    echo "치명적 에러: 백업 파일이 없습니다 ($BACKUP_FILE)"
    exit 1
fi

echo "=== [3/7] 기존 /home/pi 초기화 ==="
find /home/pi -mindepth 1 -delete
echo "/home/pi 폴더를 비웠습니다."

echo "=== [4/7] 데이터 복원 (압축 해제) ==="
tar -xzpf "$BACKUP_FILE" -C /
chown -R pi:pi /home/pi
echo "데이터 복원 및 소유권 설정 완료."

echo "=== [5/7] Python 3.9 설치 (Source Build) ==="
PYTHON_SRC_DIR="/home/pi/Python-3.9.18"

if [ -d "$PYTHON_SRC_DIR" ]; then
    echo "Python 3.9 소스 폴더 발견. 설치 진행..."
    cd "$PYTHON_SRC_DIR"
    make altinstall
    if [ $? -eq 0 ]; then echo "Python 3.9 설치 성공."; fi
else
    echo "알림: Python 소스 폴더가 없어 설치 건너뜀."
fi

echo "=== [6/7] 명령어 강제 연결 (python -> 3.9) ==="
TARGET_PYTHON="/usr/local/bin/python3.9"
TARGET_PIP="/usr/local/bin/pip3.9"

if [ -f "$TARGET_PYTHON" ]; then
    rm -f /usr/bin/python /usr/bin/python3 /usr/bin/pip
    ln -s "$TARGET_PYTHON" /usr/bin/python
    ln -s "$TARGET_PYTHON" /usr/bin/python3
    ln -s "$TARGET_PIP" /usr/bin/pip
    echo "명령어 연결 완료 (python --version : $(/usr/bin/python --version))"
else
    echo "에러: Python 3.9 바이너리가 없어 링크를 걸지 못했습니다."
fi

echo "=== [7/7] 서비스 파일 등록 및 실행 ==="
# USB에 있는 서비스 파일들을 시스템 폴더로 이동 및 등록
SERVICE_DEST="/etc/systemd/system"

for SERVICE in "${SERVICES[@]}"; do
    SOURCE_FILE="$USB_PATH/$SERVICE"
    
    if [ -f "$SOURCE_FILE" ]; then
        echo "처리 중: $SERVICE"
        
        # 1. 파일 복사
        cp "$SOURCE_FILE" "$SERVICE_DEST/"
        
        # 2. 권한 설정 (root 소유, 644 권한)
        chown root:root "$SERVICE_DEST/$SERVICE"
        chmod 644 "$SERVICE_DEST/$SERVICE"
        
        # 3. 서비스 활성화 (부팅 시 자동 실행)
        systemctl enable "$SERVICE"
        
        # 4. 서비스 즉시 시작
        systemctl restart "$SERVICE"
        
        echo "  -> 등록 및 시작 완료."
    else
        echo "  -> 경고: USB에 $SERVICE 파일이 없습니다. 건너뜁니다."
    fi
done

# 시스템 데몬 리로드 (변경된 설정 적용)
systemctl daemon-reload

echo ""
echo "!!! 모든 작업 완료. 서비스 상태 확인 후 재부팅하세요 !!!"
echo "상태 확인 명령: systemctl status battery_collector"
사용법
USB 확인: /media/pi/smd 안에 pi_home_full_backup.tar.gz와 서비스 파일 3개(battery_collector.service 등)가 같이 들어있어야 합니다.

실행: 새 라즈베리파이에서 sudo ./import_pi.sh 실행.

이제 파이썬 환경부터 백그라운드 서비스까지 완벽하게 이전될 겁니다. 성공 기원합니다!