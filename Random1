<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MasterDataWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:viewmodels="clr-namespace:LockerManagementApp.ViewModels"
    xmlns:models="clr-namespace:LockerManagementApp.Models"
    xmlns:infra="clr-namespace:LockerManagementApp.Infrastructure"
    mc:Ignorable="d"
    Title="마스터 데이터 관리" Height="700" Width="900" ResizeMode="CanResizeWithGrip"
    WindowStartupLocation="CenterOwner" ShowInTaskbar="False"
    Closing="MasterDataWindow_Closing">
    <dx:ThemedWindow.Resources>
        </dx:ThemedWindow.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="💾 변경 사항 저장" Command="{Binding SaveChangesCommand}" Margin="3" Padding="10,3"/>
            <Button Content="🔄 목록 새로고침" Command="{Binding LoadAllMasterDataCommand}" Margin="3" Padding="10,3"/>
            <TextBlock Text="{Binding StatusMessage}" Margin="15,0,0,0" VerticalAlignment="Center" Foreground="Gray" FontStyle="Italic"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <dxlc:LayoutControl Orientation="Vertical" Padding="0">
                <dxlc:LayoutGroup Header="사물함 종류" View="GroupBox" Orientation="Vertical" IsCollapsible="True" IsCollapsed="False" MaxHeight="250">
                    <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <Button Content="종류 추가" Command="{Binding AddItemCommand}" CommandParameter="LockerType" Margin="0,0,5,0"/>
                        <Button Content="선택 삭제" Command="{Binding DeleteItemCommand}"/>
                    </StackPanel>
                    <dxg:GridControl ItemsSource="{Binding LockerTypes}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150">
                        <dxg:GridControl.View>
                            <dxg:TableView AllowEditing="True" NewItemRowPosition="None" ShowGroupPanel="False"/>
                        </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="Name" Header="종류 이름"/>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>
                </dxlc:LayoutGroup>

                <dxlc:LayoutGroup Header="층" View="GroupBox" Orientation="Vertical" IsCollapsible="True" IsCollapsed="True" MaxHeight="250">
                     <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <Button Content="층 추가" Command="{Binding AddItemCommand}" CommandParameter="Floor" Margin="0,0,5,0"/>
                        <Button Content="선택 삭제" Command="{Binding DeleteItemCommand}" />
                     </StackPanel>
                     <dxg:GridControl ItemsSource="{Binding Floors}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150">
                        <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None" ShowGroupPanel="False"/></dxg:GridControl.View>
                        <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="층 이름"/> </dxg:GridControl.Columns>
                     </dxg:GridControl>
                </dxlc:LayoutGroup>

                <dxlc:LayoutGroup Header="구역" View="GroupBox" Orientation="Vertical" IsCollapsible="True" IsCollapsed="True" MaxHeight="250">
                     <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <Button Content="구역 추가" Command="{Binding AddItemCommand}" CommandParameter="Zone" Margin="0,0,5,0"/>
                        <Button Content="선택 삭제" Command="{Binding DeleteItemCommand}" />
                     </StackPanel>
                     <dxg:GridControl ItemsSource="{Binding Zones}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150">
                        <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None" ShowGroupPanel="False"/></dxg:GridControl.View>
                        <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="구역 이름"/> </dxg:GridControl.Columns>
                     </dxg:GridControl>
                </dxlc:LayoutGroup>

                <dxlc:LayoutGroup Header="소파트" View="GroupBox" Orientation="Vertical" IsCollapsible="True" IsCollapsed="True" MaxHeight="250">
                     <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <Button Content="소파트 추가" Command="{Binding AddItemCommand}" CommandParameter="SubPart" Margin="0,0,5,0"/>
                        <Button Content="선택 삭제" Command="{Binding DeleteItemCommand}" />
                     </StackPanel>
                     <dxg:GridControl ItemsSource="{Binding SubParts}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150">
                        <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None" ShowGroupPanel="False"/></dxg:GridControl.View>
                        <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="소파트 이름"/> </dxg:GridControl.Columns>
                     </dxg:GridControl>
                </dxlc:LayoutGroup>

                <dxlc:LayoutGroup Header="관리자" View="GroupBox" Orientation="Vertical" IsCollapsible="True" IsCollapsed="True" MaxHeight="250">
                     <StackPanel Orientation="Horizontal" Margin="5,0,0,5">
                        <Button Content="관리자 추가" Command="{Binding AddItemCommand}" CommandParameter="Administrator" Margin="0,0,5,0"/>
                        <Button Content="선택 삭제" Command="{Binding DeleteItemCommand}" />
                     </StackPanel>
                     <dxg:GridControl ItemsSource="{Binding Administrators}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150">
                        <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None" ShowGroupPanel="False"/></dxg:GridControl.View>
                        <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="관리자 이름"/> </dxg:GridControl.Columns>
                     </dxg:GridControl>
                </dxlc:LayoutGroup>

            </dxlc:LayoutControl>
        </ScrollViewer>

        <Button Grid.Row="2" Content="닫기" Width="80" HorizontalAlignment="Right" Margin="0,10,0,0" Click="CloseButton_Click" IsCancel="True"/>

    </Grid>
</dx:ThemedWindow>
```

**주요 변경 사항:**

* **루트 요소:** `dx:ThemedWindow`를 사용합니다.
* **DataContext:** XAML에서 직접 설정하지 않고, 이 창을 여는 코드(`MainViewModel`)에서 설정하도록 합니다.
* **레이아웃:** `ScrollViewer` 안에 `LayoutControl`을 사용하여 각 마스터 데이터 그룹(`LayoutGroup`)을 배치했습니다. `LayoutGroup`은 접고 펼 수 있도록 설정했습니다 (`IsCollapsible="True"`).
* **컨트롤 활성화:** 버튼(`IsEnabled`)이나 그리드(`AllowEditing`)에 `IsMasterModeEnabled` 바인딩을 제거했습니다. 이 창은 마스터 모드에서만 열리므로 내부는 항상 활성화된 상태입니다. (실제 버튼 활성화 여부는 Command의 `CanExecute` 로직에 따라 결정됩니다.)
* **닫기 버튼:** 창을 닫는 "닫기" 버튼을 추가하고 `IsCancel="True"` 속성을 설정하여 ESC 키로도 창을 닫을 수 있게 했습니다. 해당 버튼의 `Click` 이벤트 핸들러는 다음 단계에서 만들 `MasterDataWindow.xaml.cs` 파일에 구현해야 합니다.