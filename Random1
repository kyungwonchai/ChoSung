로 체크박스를 토글하는 기능을 구현하기 위해 PreviewKeyDown 이벤트를 사용할 수 있습니다. 아래는 해당 기능을 구현하는 방법에 대한 코드 예시입니다.

먼저, ListBox의 PreviewKeyDown 이벤트에 대한 핸들러를 추가해야 합니다.

xaml
Copy code
<ListBox x:Name="listBox" PreviewKeyDown="ListBox_PreviewKeyDown">
    <!-- 여기에 ListBoxItem과 CheckBox가 정의되어 있을 것입니다 -->
</ListBox>
그리고 ListBox_PreviewKeyDown 이벤트 핸들러를 다음과 같이 구현합니다.

csharp
Copy code
private void ListBox_PreviewKeyDown(object sender, KeyEventArgs e)
{
    var listBox = sender as ListBox;
    if (listBox == null || listBox.SelectedItem == null)
        return;

    // 선택된 ListBoxItem을 가져옵니다.
    var selectedListBoxItem = listBox.ItemContainerGenerator.ContainerFromItem(listBox.SelectedItem) as ListBoxItem;

    // 화살표 키에 따라 항목을 이동합니다.
    if (e.Key == Key.Up)
    {
        MoveItem(listBox, -1);
        e.Handled = true;
    }
    else if (e.Key == Key.Down)
    {
        MoveItem(listBox, 1);
        e.Handled = true;
    }
    else if (e.Key == Key.Space)
    {
        // 스페이스바가 눌렸을 때 CheckBox의 체크 상태를 토글합니다.
        var checkBox = FindChild<CheckBox>(selectedListBoxItem);
        if (checkBox != null)
        {
            checkBox.IsChecked = !checkBox.IsChecked;
        }
        e.Handled = true;
    }
}

private void MoveItem(ListBox listBox, int direction)
{
    // 현재 선택된 항목의 인덱스를 가져옵니다.
    int newIndex = listBox.SelectedIndex + direction;

    // 이동이 유효한 범위 내인지 확인합니다.
    if (newIndex < 0 || newIndex >= listBox.Items.Count)
        return;

    // 항목을 새로운 위치로 이동합니다.
    var itemToMove = listBox.SelectedItem;
    listBox.Items.Remove(itemToMove);
    listBox.Items.Insert(newIndex, itemToMove);
    listBox.SelectedIndex = newIndex;
}

// ListBoxItem에서 첫 번째 CheckBox를 찾는 헬퍼 메서드입니다.
private T FindChild<T>(DependencyObject parent) where T : DependencyObject
{
    if (parent == null) return null;

    T foundChild = null;
    int childrenCount = VisualTreeHelper.GetChildrenCount(parent);

    for (int i = 0; i < childrenCount; i++)
    {
        var child = VisualTreeHelper.GetChild(parent, i);
        T childType = child as T;
        if (childType == null)
        {
            foundChild = FindChild<T>(child);

            if (foundChild != null) break;
        }
        else
        {
            foundChild = (T)child;
            break;
        }
    }

    return foundChild;
}
이 코드는 선택된 ListBox 아이템을 위나 아래로 이동하고, 스페이스바로 해당 아이템의 체크박스를 토글하는 기능을 수행합니다. FindChild 메서드는 ListBoxItem의 Visual Tree를 재귀적으로 탐색하여 첫 번째 CheckBox를 찾는 헬퍼 함수입니다. MoveItem 메서드는 주어진 방