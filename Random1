다음은 요구사항을 반영하여 수정된 GetNewRows 함수입니다.

수정 내용:

에러 발생 시 파일 경로 포함 디버그 출력.
행 데이터 중 하나라도 null 값이 있으면 스킵.
디버그 메시지로 각 단계의 처리 결과 표시.
수정된 GetNewRows 함수
csharp
코드 복사
public List<Dictionary<string, object>> GetNewRows(string rootPath)
{
    var newRows = new List<Dictionary<string, object>>();
    var csvFiles = Directory.GetFiles(rootPath, "*.csv", SearchOption.AllDirectories);

    foreach (var file in csvFiles)
    {
        try
        {
            using (var reader = new StreamReader(new FileStream(file, FileMode.Open, FileAccess.Read, FileShare.ReadWrite)))
            {
                reader.ReadLine(); // 첫 번째 행(헤더) 무시
                while (!reader.EndOfStream)
                {
                    var values = reader.ReadLine()?.Split(',');
                    if (values == null || values.Length < 12) // MP5DATA와 MP5RESULT 포함 최소 12개 컬럼 확인
                    {
                        Debug.WriteLine($"Skipped Row in File {file}: Insufficient columns.");
                        continue;
                    }

                    // 디버그 출력: 현재 처리 중인 행의 값을 출력
                    Debug.WriteLine($"Processing Row in File {file}: {string.Join(", ", values)}");

                    // Null 값 체크: 행 데이터 중 하나라도 null이면 스킵
                    if (values.Any(string.IsNullOrWhiteSpace))
                    {
                        Debug.WriteLine($"Skipped Row in File {file}: Contains null or empty values.");
                        continue;
                    }

                    // InspectionTime 형식을 yyyy-MM-dd HH:mm:ss로 변환
                    string inspectionTimeOriginal = values[0];
                    string inspectionTime;
                    if (DateTime.TryParseExact(inspectionTimeOriginal, "yyyyMMdd HH:mm:ss", null, System.Globalization.DateTimeStyles.None, out var parsedDate))
                    {
                        inspectionTime = parsedDate.ToString("yyyy-MM-dd HH:mm:ss"); // 변환된 형식
                    }
                    else
                    {
                        Debug.WriteLine($"Skipped Row in File {file}: InspectionTime is not in the valid format (yyyyMMdd HH:mm:ss).");
                        continue;
                    }

                    // 4열이 숫자(정수 또는 실수)가 아니면 제외
                    if (!decimal.TryParse(values[3], out _))
                    {
                        Debug.WriteLine($"Skipped Row in File {file}: 4th column is not a valid number.");
                        continue;
                    }

                    var row = new Dictionary<string, object>
                    {
                        ["InspectionTime"] = inspectionTime, // 변환된 문자열로 저장
                        ["ModelName"] = values[1],
                        ["AlignResult"] = values[2],
                        ["MP1DATA"] = float.Parse(values[3]),
                        ["MP1RESULT"] = values[4],
                        ["MP2DATA"] = float.Parse(values[5]),
                        ["MP2RESULT"] = values[6],
                        ["MP3DATA"] = float.Parse(values[7]),
                        ["MP3RESULT"] = values[8],
                        ["MP4DATA"] = float.Parse(values[9]),
                        ["MP4RESULT"] = values[10],
                        ["MP5DATA"] = float.Parse(values[11]),
                        ["MP5RESULT"] = values[12],
                        ["ipname"] = _ipAddress // 현재 IP 추가
                    };

                    // InspectionTime 조건 검사
                    if (DateTime.ParseExact(inspectionTime, "yyyy-MM-dd HH:mm:ss", null) > _lastUploadedTime)
                    {
                        Debug.WriteLine($"Added Row from File {file}: Passed all checks.");
                        newRows.Add(row);
                    }
                    else
                    {
                        Debug.WriteLine($"Skipped Row in File {file}: InspectionTime is not newer than the last uploaded time.");
                    }
                }
            }
        }
        catch (Exception ex)
        {
            // 파일 처리 중 에러 발생 시 파일 경로와 에러 메시지 출력
            Debug.WriteLine($"Error processing File {file}: {ex.Message}");
        }
    }

    return newRows;
}
수정된 부분 설명
에러 발생 시 파일 경로 출력:

try-catch로 파일 처리 중 발생한 에러를 잡아 디버그 메시지로 출력.
파일 경로와 에러 메시지를 함께 출력:
plaintext
코드 복사
Error processing File C:\Logs\Sample.csv: Index was outside the bounds of the array.
Null 값 체크:

values.Any(string.IsNullOrWhiteSpace)를 사용해 행 데이터에 null 값 또는 공백 값이 있는지 확인.
null 값이 있으면 해당 행 스킵:
plaintext
코드 복사
Skipped Row in File C:\Logs\Sample.csv: Contains null or empty values.
InspectionTime 형식 변환:

yyyyMMdd HH:mm:ss → yyyy-MM-dd HH:mm:ss로 변환.
형식이 맞지 않을 경우 스킵:
plaintext
코드 복사
Skipped Row in File C:\Logs\Sample.csv: InspectionTime is not in the valid format (yyyyMMdd HH:mm:ss).
디버그 메시지 추가:

처리 중인 파일 이름과 행 값을 출력.
스킵된 이유와 파일 이름 출력.
디버깅 출력 예시
CSV 데이터
plaintext
코드 복사
20250110 10:00:00,ModelA,Good,123.45,Result1,67.89,Result2,45.67,Result3,89.01,Result4,12.34,Result5
20250109 09:00:00,ModelB,,N/A,Result1,67.89,Result2,45.67,Result3,89.01,Result4,12.34,Result5
InvalidDate,ModelC,Good,123.45,Result1,67.89,Result2,45.67,Result3,89.01,Result4,12.34,Result5
디버그 출력
plaintext
코드 복사
Processing Row in File C:\Logs\Sample.csv: 20250110 10:00:00, ModelA, Good, 123.45, Result1, 67.89, Result2, 45.67, Result3, 89.01, Result4, 12.34, Result5
Added Row from File C:\Logs\Sample.csv: Passed all checks.
Processing Row in File C:\Logs\Sample.csv: 20250109 09:00:00, ModelB, , N/A, Result1, 67.89, Result2, 45.67, Result3, 89.01, Result4, 12.34, Result5
Skipped Row in File C:\Logs\Sample.csv: Contains null or empty values.
Processing Row in File C:\Logs\Sample.csv: InvalidDate, ModelC, Good, 123.45, Result1, 67.89, Result2, 45.67, Result3, 89.01, Result4, 12.34, Result5