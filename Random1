Sub 병합_해제_및_빈셀_위의값_채우기()
    Dim 대상_시트 As Worksheet
    Dim 마지막_행 As Long
    Dim i As Long
    Dim SOP_파일 As Workbook
    Dim 주차별_파일 As Workbook
    Dim 선택된_파일 As Variant
    Dim 파일_대화상자 As FileDialog
    Dim SOP_처리_완료 As Boolean
    
    ' SOP 및 주차별 파일 처리 순서 설정
    Set 파일_대화상자 = Application.FileDialog(msoFileDialogFilePicker)
    With 파일_대화상자
        .Title = "파일 선택"
        .AllowMultiSelect = True
        .Filters.Clear
        .Filters.Add "Excel 파일", "*.xls; *.xlsx; *.xlsm"
        If .Show = -1 Then
            For Each 선택된_파일 In .SelectedItems
                If InStr(1, 선택된_파일, "SOP", vbTextCompare) > 0 Then
                    Set SOP_파일 = Workbooks.Open(선택된_파일)
                    SOP_처리_완료 = True
                ElseIf InStr(1, 선택된_파일, "주차별", vbTextCompare) > 0 Then
                    Set 주차별_파일 = Workbooks.Open(선택된_파일)
                End If
            Next 선택된_파일
        End If
    End With
    
    ' "SOP시트"를 대상으로 설정
    If SOP_처리_완료 Then
        Set 대상_시트 = ThisWorkbook.Sheets("SOP시트")
        
        ' C, D, N, O 열 병합 해제
        대상_시트.Range("C:C,D:D,N:N,O:O").UnMerge
        
        ' D열의 빈 셀을 위의 값으로 채우기
        마지막_행 = 대상_시트.Cells(Rows.Count, "C").End(xlUp).Row
        For i = 2 To 마지막_행 ' 데이터가 2행부터 시작한다고 가정
            If 대상_시트.Cells(i, "D").Value = "" Then
                대상_시트.Cells(i, "D").Value = 대상_시트.Cells(i - 1, "D").Value
            End If
        Next i
    
        ' O열의 빈 셀을 위의 값으로 채우기
        마지막_행 = 대상_시트.Cells(Rows.Count, "N").End(xlUp).Row
        For i = 2 To 마지막_행 ' 데이터가 2행부터 시작한다고 가정
            If 대상_시트.Cells(i, "O").Value = "" Then
                대상_시트.Cells(i, "O").Value = 대상_시트.Cells(i - 1, "O").Value
            End If
        Next i
    
        ' D, O열에 값이 있으면서 E, P열의 배경이 투명하거나 흰색이고 글자가 있는 경우 C, N열에 "복사대기" 추가
        마지막_행 = 대상_시트.Cells(Rows.Count, "C").End(xlUp).Row
        For i = 2 To 마지막_행
            If 대상_시트.Cells(i, "D").Value <> "" And 대상_시트.Cells(i, "E").Interior.Color = RGB(255, 255, 255) And 대상_시트.Cells(i, "E").Value <> "" Then
                대상_시트.Cells(i, "C").Value = "복사대기"
            End If
            
            If 대상_시트.Cells(i, "O").Value <> "" And 대상_시트.Cells(i, "P").Interior.Color = RGB(255, 255, 255) And 대상_시트.Cells(i, "P").Value <> "" Then
                대상_시트.Cells(i, "N").Value = "복사대기"
            End If
        Next i

        ' SOP 시트 복사 후 새로운 이름으로 추가
        대상_시트.Copy After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count)
        Set 대상_시트 = ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count)
        대상_시트.Name = "시트123"
    End If

    ' 주차별 파일 처리
    If Not 주차별_파일 Is Nothing Then
        ' 주차별 파일을 열어둔 상태에서 추가 처리
        ' 여기에 주차별 파일에 대한 추가 작업을 정의할 수 있습니다.
    End If
