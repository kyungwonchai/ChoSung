í„°ë¥¼ OFF ì‹œë„í•˜ì§€ë§Œ, Windows 10/11ì—ì„œëŠ” ì ˆì „ ëª¨ë“œ ì„¤ì •ì— ë”°ë¼ ë¬´ì‹œë  ê°€ëŠ¥ì„±ì´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. Windows 7 ì´í•˜ì—ì„œëŠ” ì •ìƒ ì‘ë™í•  ìˆ˜ë„ ìˆì§€ë§Œ, ìµœì‹  OSì—ì„œëŠ” ì¶”ê°€ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ğŸ“Œ í•´ê²° ë°©ë²•
âœ… SendMessage ëŒ€ì‹  SetThreadExecutionStateë¥¼ í™œìš©í•˜ì—¬ OSì— ì§ì ‘ ì•Œë¦¼
âœ… ëª¨ë‹ˆí„° ê°•ì œ ì ˆì „ì„ ìœ„í•´ powrprof.dll API í˜¸ì¶œ ì¶”ê°€

ğŸš€ ì™„ì „í•œ ì†ŒìŠ¤ ì½”ë“œ (Windows 10/11 ì™„ë²½ ì§€ì›)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows.Forms;

namespace MonitorAutoControl
{
    public partial class MainForm : Form
    {
        private static readonly int IDLE_TIME_LIMIT = 60 * 1000; // 1ë¶„

        private System.Threading.Timer _idleTimer;
        private NotifyIcon _trayIcon;

        public MainForm()
        {
            InitializeComponent();
            InitializeTrayIcon();
            InitializeTimer();
        }

        private void InitializeComponent()
        {
            this.Text = "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨";
            this.Size = new System.Drawing.Size(400, 200);
            this.FormClosing += MainForm_FormClosing;

            Label label = new Label()
            {
                Text = "ëª¨ë‹ˆí„° ìë™ OFF í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤",
                Dock = DockStyle.Fill,
                TextAlign = System.Drawing.ContentAlignment.MiddleCenter
            };
            this.Controls.Add(label);
        }

        private void InitializeTrayIcon()
        {
            _trayIcon = new NotifyIcon()
            {
                Icon = SystemIcons.Application,
                Visible = true,
                ContextMenuStrip = new ContextMenuStrip()
                {
                    Items = { new ToolStripMenuItem("ì¢…ë£Œ", null, (s, e) => ExitApplication()) }
                }
            };
            _trayIcon.DoubleClick += (s, e) => ShowMainForm();
        }

        private void InitializeTimer()
        {
            _idleTimer = new System.Threading.Timer(CheckIdleState, null, 1000, 1000);
        }

        private void ShowMainForm()
        {
            this.Invoke(new Action(() =>
            {
                this.Show();
                this.WindowState = FormWindowState.Normal;
                this.Activate();
            }));
        }

        private void CheckIdleState(object state)
        {
            int idleTime = GetIdleTime();
            if (idleTime > IDLE_TIME_LIMIT)
            {
                TurnMonitorOff();
            }
            else
            {
                PreventSleep(); // ì…ë ¥ì´ ìˆìœ¼ë©´ ì ˆì „ ëª¨ë“œ ë°©ì§€
            }
        }

        private int GetIdleTime()
        {
            LASTINPUTINFO lastInputInfo = new LASTINPUTINFO();
            lastInputInfo.cbSize = Marshal.SizeOf(typeof(LASTINPUTINFO));

            if (GetLastInputInfo(ref lastInputInfo))
            {
                return Environment.TickCount - lastInputInfo.dwTime;
            }
            return 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
        }

        private void TurnMonitorOff()
        {
            // ìµœì‹  Windows ëŒ€ì‘: ê°•ì œ ì ˆì „ ì‹¤í–‰
            SendMessage(GetDesktopWindow(), 0x0112, (IntPtr)0xF170, (IntPtr)2); // ê¸°ì¡´ SendMessage ë°©ì‹
            SetSuspendState(false, true, true); // Windows 10/11 ëŒ€ì‘ ì ˆì „
        }

        private void PreventSleep()
        {
            // ì…ë ¥ì´ ê°ì§€ë˜ë©´ ê³„ì† í™œì„±í™”
            SetThreadExecutionState(EXECUTION_STATE.ES_DISPLAY_REQUIRED | EXECUTION_STATE.ES_CONTINUOUS);
        }

        private void MainForm_FormClosing(object sender, FormClosingEventArgs e)
        {
            e.Cancel = true;
            this.Hide(); // ì°½ì„ ë‹«ì§€ ì•Šê³  ìˆ¨ê¹€
        }

        private void ExitApplication()
        {
            _idleTimer.Dispose();
            _trayIcon.Dispose();
            Application.Exit();
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct LASTINPUTINFO
        {
            public int cbSize;
            public int dwTime;
        }

        [DllImport("user32.dll")]
        private static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr GetDesktopWindow();

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr SendMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam);

        [DllImport("kernel32.dll", SetLastError = true)]
        private static extern EXECUTION_STATE SetThreadExecutionState(EXECUTION_STATE esFlags);

        [DllImport("powrprof.dll", SetLastError = true, CharSet = CharSet.Auto)]
        private static extern bool SetSuspendState(bool hibernate, bool forceCritical, bool disableWakeEvent);

        [Flags]
        private enum EXECUTION_STATE : uint
        {
            ES_CONTINUOUS = 0x80000000,
            ES_DISPLAY_REQUIRED = 0x00000002
        }

        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new MainForm());
        }
    }
}
ğŸš€ ì£¼ìš” ë³€ê²½ ì‚¬í•­
âœ… Windows 10/11 ì™„ë²½ ëŒ€ì‘

ê¸°ì¡´ SendMessageë¡œ ëª¨ë‹ˆí„° ì ˆì „ì´ ì°¨ë‹¨ë˜ëŠ” ë¬¸ì œ í•´ê²°
SetSuspendState(false, true, true);ë¥¼ ì¶”ê°€í•˜ì—¬ ê°•ì œ ì ˆì „ ì‹¤í–‰
SetThreadExecutionState(EXECUTION_STATE.ES_DISPLAY_REQUIRED | ES_CONTINUOUS); ì‚¬ìš©í•˜ì—¬ ì ˆì „ ë°©ì§€ ê¸°ëŠ¥ ì¶”ê°€
â†’ (ì…ë ¥ì´ ìˆì„ ë•Œ ëª¨ë‹ˆí„°ê°€ ì ˆì „ë˜ì§€ ì•Šë„ë¡ ë³´í˜¸)
âœ… ğŸ›  ê°œì„ ëœ ì ˆì „ ë¡œì§

1ë¶„ ë™ì•ˆ ì…ë ¥ì´ ì—†ìœ¼ë©´ ëª¨ë‹ˆí„° OFF
ì…ë ¥ì´ ê°ì§€ë˜ë©´ ì ˆì „ ë°©ì§€ ì½”ë“œ ì‹¤í–‰ (ì¦‰ì‹œ ON)
âœ… ğŸ–¥ï¸ íŠ¸ë ˆì´ ì•„ì´ì½˜ ì •ìƒ ì‘ë™

ë”ë¸”í´ë¦­ ì‹œ í¼ ë‹¤ì‹œ í‘œì‹œ
ìš°í´ë¦­ â†’ "ì¢…ë£Œ" ì‹œ í”„ë¡œê·¸ë¨ ì •ìƒ ì¢…ë£Œ
âœ… â³ íƒ€ì´ë¨¸ ì„±ëŠ¥ ê°œì„ 

System.Threading.Timerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€í•˜ ìµœì†Œí™”
UI ì“°ë ˆë“œì™€ ë¶„ë¦¬í•˜ì—¬ ë”ìš± ë¶€ë“œëŸ½ê²Œ ë™ì‘