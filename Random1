죄송합니다, 여전히 문제가 해결되지 않아 답답하실 것 같습니다. 지금까지 제공된 정보와 발생한 문제를 바탕으로 더 깊이 들어가 문제를 해결하겠습니다.

현재 상황으로 보아 Android 앱에서 서버로부터 받은 JSON 응답이 올바르게 파싱되지 않는 것이 문제의 핵심입니다. 서버에서의 응답을 제대로 확인하고 JSON 형식을 보장하는 방향으로 가야 합니다. response is not a valid JSON 오류가 발생하는 이유는 응답이 JSON 형식으로 제대로 파싱되지 않기 때문입니다.

1. 문제 분석
문제는 Android 앱이 서버로부터 JSON 응답을 수신할 때 JSON 형식이 올바르지 않다고 판단되는 것입니다. 이는 다음과 같은 이유로 발생할 수 있습니다:

서버에서 잘못된 형식의 JSON 반환: 서버에서 반환되는 JSON 데이터가 예상과 다르게 형성되어 있을 수 있습니다.
응답 데이터에 불필요한 문자 포함: 서버에서의 응답에 줄바꿈, 탭, 공백 등 JSON 파싱을 방해하는 불필요한 문자가 포함되어 있을 수 있습니다.
인코딩 문제: 서버에서 응답을 반환할 때 인코딩이 올바르지 않을 수 있습니다.
2. 해결 방법
2-1. 서버에서 응답 확인
먼저, Flask 서버에서 올바른 JSON 응답을 반환하고 있는지 확실히 확인해야 합니다. 서버에서 반환되는 JSON 데이터가 Android 앱에서 올바르게 파싱될 수 있도록 해야 합니다.

Flask 서버 코드 수정
Flask 서버의 엔드포인트에서 JSON 응답을 명확하게 반환하도록 합니다.

python
코드 복사
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/api/apk1/version', methods=['GET'])
def apk1_version():
    version_info = {
        "version": "1.2",
        "apk_url": "/download/apk1"
    }
    return jsonify(version_info)  # Flask의 jsonify 함수는 올바른 JSON 응답을 반환합니다.

@app.route('/download/apk1', methods=['GET'])
def download_apk1():
    return send_from_directory('static/apks', 'apk1.apk')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8116)
jsonify 사용: jsonify 함수는 Python의 딕셔너리를 JSON으로 변환하여 올바른 Content-Type을 설정하고 반환합니다. 추가로 인코딩 문제를 방지하기 위해 charset을 설정하지 않아도 됩니다.
서버에서 JSON 형식 확인
서버가 올바른 JSON 형식의 응답을 반환하는지 확인하려면 터미널 또는 브라우저에서 서버의 API를 호출하여 응답을 직접 확인합니다.

bash
코드 복사
curl http://10.244.122.222:8116/api/apk1/version
응답이 다음과 같은 형식인지 확인하세요:

json
코드 복사
{
    "version": "1.2",
    "apk_url": "/download/apk1"
}
2-2. Android 앱에서 응답 처리
Android에서 서버로부터 받은 응답이 올바른 JSON인지 다시 한번 철저히 검증합니다.

kotlin
코드 복사
private suspend fun checkForUpdates(context: Context, apkName: String) {
    Log.d("TTTTT", "Starting checkForUpdates for $apkName")

    val client = OkHttpClient()
    val request = Request.Builder()
        .url("http://10.244.122.222:8116/api/$apkName/version")
        .build()

    try {
        val response = client.newCall(request).execute()

        if (!response.isSuccessful) {
            Log.e("TTTTT", "Unexpected response code: ${response.code}")
            return
        }

        val responseData = response.body?.string()
        Log.d("TTTTT", "Received response: $responseData")

        if (responseData != null) {
            // JSON 파싱 전에 데이터를 트림하고 올바른지 확인
            val trimmedResponse = responseData.trim()
            if (trimmedResponse.startsWith("{") && trimmedResponse.endsWith("}")) {
                try {
                    val jsonObject = JSONObject(trimmedResponse)
                    val latestVersion = jsonObject.getString("version")
                    val apkUrl = jsonObject.getString("apk_url")
                    Log.d("TTTTT", "Parsed version: $latestVersion, apk_url: $apkUrl")

                    // APK 다운로드 및 설치 로직
                    downloadAndInstallApk(context, apkUrl, apkName)
                } catch (e: JSONException) {
                    Log.e("TTTTT", "Failed to parse JSON: $trimmedResponse", e)
                }
            } else {
                Log.e("TTTTT", "Response is not a valid JSON object: $trimmedResponse")
            }
        } else {
            Log.e("TTTTT", "Response data is null")
        }
    } catch (e: Exception) {
        Log.e("TTTTT", "Error during checkForUpdates: ${e.message}", e)
    }
}
응답 데이터 트림: trim() 메서드를 사용하여 응답 데이터의 앞뒤 공백을 제거하여 JSON이 올바르게 파싱될 수 있도록 합니다.
JSON 데이터 유효성 검사: startsWith("{") 및 endsWith("}")를 통해 응답이 JSON 객체 형식인지 확인합니다.
2-3. 서버 및 네트워크 구성 확인
서버와 네트워크 설정도 문제가 될 수 있습니다. 다음 사항을 확인하세요.

서버의 네트워크 보안 정책: 서버가 Android 애플리케이션의 요청을 허용하는지 확인합니다.
CORS 설정: 클라이언트와 서버 간의 CORS 설정이 올바르게 구성되어 있는지 확인합니다. (Access-Control-Allow-Origin 헤더 설정 필요 여부)
방화벽 및 네트워크 허용 목록: 서버 포트가 외부에서 접근 가능한지 확인합니다.
결론
위의 단계를 따라 Flask 서버와 Android 앱이 올바른 JSON 응답을 주고받는지 철저히 확인하세요. response is not a valid JSON 오류는 대부분 서버에서 잘못된 형식의 응답을 반환하거나, 불필요한 문자나 형식 문제로 인해 발생합니다. 위의 모든 단계를 따라 서버 응답을 점검하고 Android 코드에서 JSON을 올바르게 처리하도록 수정한 후 다시 테스트해보세요.

다시 한 번 문제 해결에 도움이 되지 않아 죄송합니다. 모든 로그와 데이터를 최대한 자세히 확인하시고, 여전히 문제가 발생하면 해당 부분을 추가로 알려주시면 더 자세히 도와드리겠습니다