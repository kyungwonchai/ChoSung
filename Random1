# 코드 (Office.Interop.Excel 사용)
이 코드는 엑셀의 병합된 셀을 해제하고, 비어 있는 셀에 위쪽 셀의 값을 복사하는 과정을 추가로 포함합니다.

csharp
Copy code
using System;
using System.Data.SqlClient;
using Excel = Microsoft.Office.Interop.Excel;

namespace ExcelToMssql
{
    class Program
    {
        static void Main(string[] args)
        {
            // 엑셀 파일 열기
            Excel.Application excelApp = new Excel.Application();
            Excel.Workbook workbook = excelApp.Workbooks.Open("파일경로");
            Excel.Worksheet worksheet = workbook.Sheets[1];
            worksheet.Cells.UnMerge(); // 병합 해제

            // 병합 해제 후 비어 있는 셀 채우기
            Excel.Range usedRange = worksheet.UsedRange;
            for (int col = 2; col <= 5; col++) // B열부터 E열까지
            {
                for (int row = 2; row <= usedRange.Rows.Count; row++)
                {
                    if ((worksheet.Cells[row, col] as Excel.Range).Value2 == null)
                    {
                        (worksheet.Cells[row, col] as Excel.Range).Value2 = (worksheet.Cells[row - 1, col] as Excel.Range).Value2;
                    }
                }
            }

            // 데이터베이스 연결 설정
            string connectionString = "Server=서버주소;Database=데이터베이스명;User Id=사용자명;Password=비밀번호;";
            SqlConnection conn = new SqlConnection(connectionString);

            try
            {
                conn.Open();

                // 엑셀 파일 읽기 및 데이터베이스에 업로드
                for (int row = 3; row <= usedRange.Rows.Count; row++)
                {
                    if ((worksheet.Cells[row, 5] as Excel.Range).Value2.ToString() != "자재코드")
                    {
                        throw new Exception("파일 형식 오류");
                    }

                    string bValue = (worksheet.Cells[row, 2] as Excel.Range).Value2.ToString();
                    string cValue = (worksheet.Cells[row, 3] as Excel.Range).Value2.ToString();
                    string dValue = (worksheet.Cells[row, 4] as Excel.Range).Value2.ToString();
                    string eValue = (worksheet.Cells[row, 5] as Excel.Range).Value2.ToString();

                    // 데이터베이스에 데이터 업데이트 또는 삽입
                    string query = $"IF EXISTS (SELECT * FROM 테이블명 WHERE B열='{bValue}') " +
                                   $"UPDATE 테이블명 SET C열='{cValue}', D열='{dValue}', E열='{eValue}' WHERE B열='{bValue}' " +
                                   $"ELSE " +
                                   $"INSERT INTO 테이블명 (B열, C열, D열, E열) VALUES ('{bValue}', '{cValue}', '{dValue}', '{eValue}')";

                    SqlCommand command = new SqlCommand(query, conn);
                    command.ExecuteNonQuery();
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
            finally
            {
                conn.Close();
                workbook.Close();
                excelApp.Quit();
            }
        }
    }
}
VBA 코드
VBA 코드는 엑셀 내부에서 병합된 셀을 해제하고, 빈 셀을 윗줄의 값으로 채우는 과정