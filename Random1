니다. Type과 측정값 구분 열이 있으며, 그 옆에 실제 값을 포함하도록 매크로를 수정하겠습니다. 각각의 열은 Type, 측정값 구분, 그리고 실제 값을 정확히 매칭해 새로운 시트에 결과를 복사하도록 하겠습니다.

다음은 요구사항을 반영한 매크로 코드입니다.

vba
코드 복사
Sub CopyDetailedDataWithTypeAndActualValues()
    Dim ws As Worksheet
    Dim outputWs As Worksheet
    Dim lastRow As Long
    Dim outputRow As Long
    Dim dateValue As Variant
    Dim wsName As String
    Dim i As Long
    
    ' 통합된 데이터를 넣을 새로운 시트 생성
    On Error Resume Next ' 동일한 이름 시트가 있을 경우 오류 방지
    Set outputWs = ThisWorkbook.Sheets("DetailedDataWithTypeValues")
    On Error GoTo 0
    
    If outputWs Is Nothing Then
        Set outputWs = ThisWorkbook.Sheets.Add
        outputWs.Name = "DetailedDataWithTypeValues"
    Else
        outputWs.Cells.Clear ' 기존 데이터가 있을 경우 초기화
    End If
    
    ' 헤더 생성
    outputWs.Range("A1").Value = "Sheet Name"
    outputWs.Range("B1").Value = "Date"
    outputWs.Range("C1").Value = "Type"
    outputWs.Range("D1").Value = "Measure Type"
    outputWs.Range("E1").Value = "Actual Value"
    outputRow = 2
    
    ' 모든 시트를 순회하며 데이터를 추출
    For Each ws In ThisWorkbook.Sheets
        ' 새로 만든 요약 시트와 동일하지 않은 시트만 작업
        If ws.Name <> outputWs.Name Then
            ' 날짜 가져오기 (F열 2행)
            dateValue = ws.Cells(2, 6).Value ' 2행 F열의 날짜 값
            
            ' 데이터의 마지막 행 찾기
            lastRow = ws.Cells(ws.Rows.Count, 2).End(xlUp).Row
            
            ' Temperature와 Humidity 데이터를 정확히 일치하는 실제 값으로 복사
            For i = 4 To lastRow
                If ws.Cells(i, 2).Value = "Temperature" Or ws.Cells(i, 2).Value = "Humidity" Then
                    ' 시트 이름, 날짜, 구분값, 측정값 구분, F열 실제 측정 값을 통합 시트에 추가
                    outputWs.Cells(outputRow, 1).Value = ws.Name ' 시트 이름
                    outputWs.Cells(outputRow, 2).Value = dateValue ' 날짜 (F2에서 가져온 값)
                    outputWs.Cells(outputRow, 3).Value = ws.Cells(i, 2).Value ' Type (Temperature or Humidity)
                    outputWs.Cells(outputRow, 4).Value = ws.Cells(i, 3).Value ' 측정값 구분 (Measure Type)
                    outputWs.Cells(outputRow, 5).Value = ws.Cells(i, 6).Value ' F열의 실제 값
                    outputRow = outputRow + 1 ' 다음 행으로 이동
                End If
            Next i
        End If
    Next ws
    
    ' 사용자에게 완료 메시지 출력
    MsgBox "모든 시트의 데이터를 구분, 측정값 구분, 실제 값으로 DetailedDataWithTypeValues 시트에 복사 완료했습니다.", vbInformation
End Sub
코드 설명
새 시트 생성: DetailedDataWithTypeValues라는 이름의 새 시트를 생성하여 통합 데이터를 저장합니다. 기존에 동일한 이름의 시트가 있을 경우 데이터를 초기화합니다.

헤더 생성: Sheet Name, Date, Type, Measure Type, Actual Value 다섯 가지 열로 구성하여 데이터를 정리합니다.

시트 순회: 모든 시트를 순회하면서 DetailedDataWithTypeValues 시트는 제외하고 데이터를 추출합니다.

데이터 추출:

각 시트의 F2 셀에 있는 날짜 값을 가져옵니다.
B열이 Temperature 또는 Humidity인 경우를 확인합니다.
각 행에서 C열의 측정값 구분(Measure Type)과 F열의 실제 값을 각각 DetailedDataWithTypeValues 시트에 추가합니다.
출력: 통합된 데이터는 DetailedDataWithTypeValues 시트에 추가되며, 시트 이름, 날짜, 타입, 측정값 구분, 실제 측정값을 포함합니다.

완료 메시지: 작업 완료 후 메시지를 통해 사용자에게 알립니다.