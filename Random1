using System;
using System.Data.SqlClient;
using System.IO;
using System.Linq;

class Program
{
    static void Main()
    {
        string G_Folder1 = "경로"; // 여기에 폴더 경로를 입력하세요
        DateTime g_lastfiletime = DateTime.Parse("2022-01-01"); // 예시, 실제로는 적절한 값으로 설정하세요

        if (Directory.Exists(G_Folder1))
        {
            string[] files = Directory.GetFiles(G_Folder1, "SPIworksPro_RecordCondition_*.txt");

            foreach (var file in files)
            {
                DateTime fileLastModified = File.GetLastWriteTime(file);

                if (fileLastModified > g_lastfiletime)
                {
                    string[] lines = File.ReadAllLines(file);

                    foreach (var line in lines)
                    {
                        if (line.Contains("Lane:") && line.Contains("Model") && line.Contains("BSM"))
                        {
                            DateTime logtime1 = DateTime.Parse(line.Substring(0, 23)); // 첫 23글자가 날짜와 시간임을 가정
                            string folderName = G_Folder1;
                            string log1 = line;

                            // DB에 Insert
                            using (SqlConnection conn = new SqlConnection("Data Source=your_server;Initial Catalog=your_database;User ID=your_username;Password=your_password"))
                            {
                                conn.Open();

                                string query = "INSERT INTO PAOI_ChangeDetect (logtime1, folderName, log1) VALUES (@logtime1, @folderName, @log1)";
                                using (SqlCommand cmd = new SqlCommand(query, conn))
                                {
                                    cmd.Parameters.AddWithValue("@logtime1", logtime1);
                                    cmd.Parameters.AddWithValue("@folderName", folderName);
                                    cmd.Parameters.AddWithValue("@log1", log1);

                                    cmd.ExecuteNonQuery();
                                }

                                conn.Close();
                            }
                        }
                    }
                }
            }
        }
    }
}
