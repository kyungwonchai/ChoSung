using System.Net.Http;
using System.Threading.Tasks;

public async Task SendEmailWithAttachment(string requestUrl, string subject, string contents, string sendmailaddress, string mail1, string filePath)
{
    using (var client = new HttpClient())
    {
        // MultipartFormDataContent를 사용하여 요청 본문을 구성합니다.
        using (var content = new MultipartFormDataContent())
        {
            // 기존 JSON 데이터를 추가합니다.
            var requestData = new
            {
                subject,
                contents,
                contentType = "HTML",
                sender = new { emailAddress = sendmailaddress },
                recipients = new { emailAddress = mail1, method = "TO" }
            };
            var jsonPayload = JsonConvert.SerializeObject(requestData);
            content.Add(new StringContent(jsonPayload, Encoding.UTF8, "application/json"), "json");

            // 첨부파일을 추가합니다.
            var fileContent = new ByteArrayContent(File.ReadAllBytes(filePath));
            fileContent.Headers.ContentType = MediaTypeHeaderValue.Parse("application/octet-stream");
            content.Add(fileContent, "attachments", Path.GetFileName(filePath));

            // 요청을 전송합니다.
            var response = await client.PostAsync(requestUrl, content);

            // 응답을 처리합니다. (예: 로깅, 오류 처리 등)
            if (response.IsSuccessStatusCode)
            {
                Console.WriteLine("Email sent successfully.");
            }
            else
            {
                Console.WriteLine("Failed to send email.");
            }
        }
    }
}
