using DevExpress.XtraTreeList;
using DevExpress.XtraTreeList.Nodes;
using System;
using System.IO;
using System.Windows.Forms;

namespace WindowsFormsApp1
{
    public partial class Form1 : Form
    {
        TreeList treeList1;

        public Form1()
        {
            InitializeComponent();

            // TreeList 컨트롤 생성 및 초기화
            treeList1 = new TreeList();
            treeList1.Dock = DockStyle.Fill;
            treeList1.OptionsBehavior.Editable = false;
            treeList1.OptionsView.ShowColumns = false;
            treeList1.OptionsView.ShowIndicator = false;
            treeList1.GetSelectImage += (s, e) => { e.NodeImageIndex = e.Node.HasChildren ? 0 : 1; };
            treeList1.DoubleClick += TreeList1_DoubleClick;

            // TreeList를 Panel에 추가
            panel1.Controls.Add(treeList1);
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            DirectoryInfo info = new DirectoryInfo(@"C:\YourSpecificPath");
            if (info.Exists)
            {
                treeList1.BeginUnboundLoad();
                TreeListNode parentForRootNodes = null;
                treeList1.AppendNode(new object[] { info.FullName }, parentForRootNodes);
                PopulateTreeList(info, treeList1.Nodes[0]);
                treeList1.EndUnboundLoad();
            }
        }

        private void PopulateTreeList(DirectoryInfo info, TreeListNode parentNode)
        {
            foreach (DirectoryInfo dir in info.GetDirectories())
            {
                TreeListNode childNode = treeList1.AppendNode(new object[] { dir.FullName }, parentNode);
                PopulateTreeList(dir, childNode);
            }
            foreach (FileInfo file in info.GetFiles())
            {
                treeList1.AppendNode(new object[] { file.FullName }, parentNode);
            }
        }

        private void TreeList1_DoubleClick(object sender, EventArgs e)
        {
            TreeListHitInfo hi = treeList1.CalcHitInfo(treeList1.PointToClient(MousePosition));
            if (hi.Node != null)
            {
                string filePath = hi.Node.GetValue(0).ToString();
                FileInfo fileInfo = new FileInfo(filePath);
                if (fileInfo.Extension == ".txt")
                {
                    using (StreamReader reader = new StreamReader(filePath))
                    {
                        textBox1.Text = reader.ReadToEnd();
                    }
                }
            }
        }

        private void btnSave_Click(object sender, EventArgs e)
        {
            TreeListNode node = treeList1.FocusedNode;
            if (node != null)
            {
                string filePath = node.GetValue(0).ToString();
                FileInfo fileInfo = new FileInfo(filePath);
                if (fileInfo.Extension == ".txt")
                {
                    using (StreamWriter writer = new StreamWriter(filePath))
                    {
                        writer.Write(textBox1.Text);
                    }
                }
            }
        }
    }
}
