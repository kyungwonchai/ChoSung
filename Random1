SELECT 
    rp.partcode,
    rp.partcount,
    rp.lastupdate,
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) THEN 
        CASE WHEN pm.inout_value = 'in' THEN pm.inout_count 
             WHEN pm.inout_value = 'incancel' THEN -pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_in_this_week`,
    -- Replicate the above for each of the last 4 weeks with manual labels
    -- Adjust each week's YEARWEEK calculation manually
    -- For example, for last week:
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) - 1 THEN 
        CASE WHEN pm.inout_value = 'in' THEN pm.inout_count 
             WHEN pm.inout_value = 'incancel' THEN -pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_in_last_week`
    -- Continue with the pattern for the remaining weeks
FROM 
    smd.tbl_repare_part_remain rp
JOIN 
    smd.tbl_repare_partmanage pm ON rp.partcode = pm.partcode
GROUP BY 
    rp.partcode, rp.partcount, rp.lastupdate;
