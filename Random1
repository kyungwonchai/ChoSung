래 VBA 코드는 두 가지 작업을 수행합니다.

Date1과 Shift1의 개수를 날짜 순서 및 day, night 순서대로 차트로 표시합니다.
각 Line1의 고유 값마다 개별 차트를 생성하여, 각 Line1에 대한 Machine1별 횟수를 막대 차트로 표시합니다.
이 코드는 Summary 시트에 요약 데이터를 기록하고, 요청한 방식으로 차트를 생성합니다.

VBA 코드
vba
코드 복사
Sub CreateShift1AndMachineCharts()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim uniqueDates As Object, uniqueLines As Object
    Dim dateCell As Range, shiftCell As Range
    Dim i As Long, j As Long
    Dim dateVal As String, shiftVal As String, lineVal As String
    Dim rowCounter As Long
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    ' 중복 없는 Date1 및 Shift1 목록 생성
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    Set uniqueLines = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            lineVal = ws.Cells(i, 1).Value
            
            ' Date1과 Shift1 기준으로 개수 누적
            If Not uniqueDates.exists(dateVal & "_" & shiftVal) Then
                uniqueDates(dateVal & "_" & shiftVal) = 0
            End If
            uniqueDates(dateVal & "_" & shiftVal) = uniqueDates(dateVal & "_" & shiftVal) + 1
            
            ' Line1을 기준으로 Machine1 개수 카운트
            If Not uniqueLines.exists(lineVal) Then
                uniqueLines.Add lineVal, New Collection
            End If
            uniqueLines(lineVal).Add ws.Cells(i, 2).Value
        End If
    Next i
    
    ' 요약 데이터 시트에 기록 (Date1, Shift1 별로)
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    rowCounter = 2
    For Each key In uniqueDates.keys
        summaryWs.Cells(rowCounter, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(rowCounter, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(rowCounter, 3).Value = uniqueDates(key)   ' Count 값
        rowCounter = rowCounter + 1
    Next key
    
    ' Date1과 Shift1 차트 생성
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "Date1별 Shift1의 개수 (Day/Night)"
    End With
    
    ' 각 Line1에 대한 Machine1별 횟수 차트 생성
    Dim lineKey As Variant
    Dim lineIndex As Integer
    lineIndex = 1
    
    For Each lineKey In uniqueLines.keys
        Dim lineSummaryRow As Long
        summaryWs.Cells(rowCounter, 1).Value = "Line1: " & lineKey
        rowCounter = rowCounter + 1
        
        ' Machine1별 개수를 세어 요약
        Dim machineCounts As Object
        Set machineCounts = CreateObject("Scripting.Dictionary")
        
        For Each machine In uniqueLines(lineKey)
            If Not machineCounts.exists(machine) Then
                machineCounts(machine) = 0
            End If
            machineCounts(machine) = machineCounts(machine) + 1
        Next machine
        
        ' Machine1별 횟수 기록
        summaryWs.Cells(rowCounter, 1).Value = "Machine1"
        summaryWs.Cells(rowCounter, 2).Value = "Count"
        lineSummaryRow = rowCounter
        
        For Each machine In machineCounts.keys
            summaryWs.Cells(rowCounter, 1).Value = machine
            summaryWs.Cells(rowCounter, 2).Value = machineCounts(machine)
            rowCounter = rowCounter + 1
        Next machine
        
        ' Machine1별 횟수 차트 생성
        Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=350 + (lineIndex - 1) * 300, Height:=300)
        With chart.Chart
            .SetSourceData Source:=summaryWs.Range(summaryWs.Cells(lineSummaryRow + 1, 1), summaryWs.Cells(rowCounter - 1, 2))
            .ChartType = xlColumnClustered
            .HasTitle = True
            .ChartTitle.Text = "Line1: " & lineKey & "의 Machine1별 횟수"
        End With
        
        lineIndex = lineIndex + 1
    Next lineKey
End Sub
코드 설명
Date1과 Shift1별 개수 차트:

Summary 시트에 Date1과 Shift1별 개수를 집계하여 기록하고, 이를 클러스터형 막대 차트로 생성합니다.
Line1 값에 따른 Machine1별 횟수 차트:

각 Line1의 고유 값마다 개별로 Machine1의 횟수를 계산하여 요약하고, Summary 시트에 추가합니다.
각 Line1마다 고유한 차트를 생성하며, Line1의 고유값 개수에 따라 차트를 순서대로 배치합니다.
차트 배치:
