ê² ìŠµë‹ˆë‹¤. ì‹¤í–‰ ì‹œ ë°œìƒí•˜ëŠ” ì—°ê²° ê´€ë ¨ ì˜¤ë¥˜ì™€ íŠ¹ì • ì½¤ë³´ë°•ìŠ¤(ê´€ë¦¬ë‹´ë‹¹ì, ì†ŒíŒŒíŠ¸)ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê´€ë ¨ íŒŒì¼ ì „ì²´ ì½”ë“œë¥¼ ì ê²€í•˜ê³  ìˆ˜ì •í•˜ì—¬ ë‹¤ì‹œ ì œê³µí•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì˜¤ë¥˜ ì›ì¸ ë¶„ì„ ë° í•´ê²° ë°©í–¥:

ì—°ê²° ì˜¤ë¥˜ ("ì—´ë¦° ì—°ê²°...", ë“±):

DbContext ê´€ë¦¬: ì—¬ëŸ¬ ViewModelì—ì„œ LockerDbContext ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë³„ë„ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ë©´ ì—°ê²° ì¶©ëŒì´ë‚˜ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ê°€ ë°œìƒí•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ MainViewModelì—ì„œ í•˜ë‚˜ì˜ DbContext ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ MasterDataViewModelê³¼ LogViewModelì˜ ìƒì„±ìë¥¼ í†µí•´ ì „ë‹¬í•˜ì—¬ ê³µìœ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ MainViewModelì´ Disposeë  ë•Œ ê³µìœ ëœ DbContextë„ í•¨ê»˜ ì •ë¦¬ë˜ì–´ ì—°ê²°ì´ ê¹”ë”í•˜ê²Œ ë‹«í™ë‹ˆë‹¤. (ì´ì „ ì½”ë“œì—ì„œ ì´ë¯¸ ìƒì„±ì ì „ë‹¬ ë°©ì‹ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ, ê° ViewModelì´ ë‚´ë¶€ì—ì„œ new LockerDbContext()ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.)
MARS (Multiple Active Result Sets): App.config ì—°ê²° ë¬¸ìì—´ì— MultipleActiveResultSets=True; ì˜µì…˜ì´ ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ì¬í™•ì¸í•©ë‹ˆë‹¤. ê³µìœ ëœ DbContextë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ë™ì‹œì— ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì‘ì—…(íŠ¹íˆ ë¹„ë™ê¸° ë¡œë”© ì¤‘)ì—ëŠ” ì´ ì˜µì…˜ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ ëŒ€ê¸°: ëª¨ë“  async ë©”ì„œë“œ í˜¸ì¶œ ì‹œ awaitë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì´ ì™„ì „íˆ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. (í˜„ì¬ ì½”ë“œëŠ” ëŒ€ë¶€ë¶„ ì˜ ë˜ì–´ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.)
ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ Dispose í˜¸ì¶œ: MainWindow.xaml.csì˜ Closing ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ MainViewModelì˜ Dispose ë©”ì„œë“œë¥¼ ë°˜ë“œì‹œ í˜¸ì¶œí•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ DbContext ë¦¬ì†ŒìŠ¤ê°€ ëª…ì‹œì ìœ¼ë¡œ í•´ì œë˜ë„ë¡ í•©ë‹ˆë‹¤.
ì½¤ë³´ë°•ìŠ¤ ë¬¸ì œ (ê´€ë¦¬ë‹´ë‹¹ì, ì†ŒíŒŒíŠ¸):

ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ìœ„ì—ì„œ ì–¸ê¸‰í•œ ì—°ê²° ì˜¤ë¥˜ë¡œ ì¸í•´ MainViewModelì˜ LoadMasterDataAsync ë©”ì„œë“œê°€ ì‹¤íŒ¨í•˜ë©´ AllAdministratorsë‚˜ AllSubParts ì»¬ë ‰ì…˜ì´ ë¹„ì–´ìˆê²Œ ë˜ì–´ ì½¤ë³´ë°•ìŠ¤ì— ëª©ë¡ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—°ê²° ì˜¤ë¥˜ë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ ì´ ë¬¸ì œ í•´ê²°ì˜ í•µì‹¬ì…ë‹ˆë‹¤.
XAML ë°”ì¸ë”© í™•ì¸: MainWindow.xamlì—ì„œ í•´ë‹¹ GridColumn ë‚´ë¶€ ComboBoxEditSettingsì˜ ItemsSourceê°€ AllAdministrators, AllSubPartsì— ì˜¬ë°”ë¥´ê²Œ ë°”ì¸ë”©ë˜ì–´ ìˆê³  DisplayMember="Name"ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ ë‹¤ì‹œ í™•ì¸í•©ë‹ˆë‹¤.
ìˆ˜ì •ëœ ì „ì²´ ì½”ë“œ:

ì•„ë˜ì— ê´€ë ¨ íŒŒì¼ë“¤ì˜ ìˆ˜ì •ëœ ì „ì²´ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

1. App.config (MARS í™•ì¸)

ì—°ê²° ë¬¸ìì—´ì— MultipleActiveResultSets=True;ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

XML

<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
  </configSections>

  <appSettings>
    <add key="MasterKey" value="admin123" /> </appSettings>

  <connectionStrings>
    <add name="LockerDbConnection"
         connectionString="Server=YOUR_SERVER_NAME;Database=LockerManagementDB;Trusted_Connection=True;MultipleActiveResultSets=True;"
         providerName="System.Data.SqlClient"/>
  </connectionStrings>

  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.8" />
  </startup>

  <entityFramework>
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework">
      <parameters> <parameter value="mssqllocaldb" /> </parameters>
    </defaultConnectionFactory>
    <providers>
      <provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
    </providers>
  </entityFramework>
</configuration>
 1 2. Models í´ë” Â  
1.
learn.microsoft.com
learn.microsoft.com

(ì´ì „ê³¼ ë™ì¼ - LockerAssignment.cs, AuditLog.cs, Floor.cs, Zone.cs, SubPart.cs, Administrator.cs, LockerType.cs íŒŒì¼ë“¤ì´ ì˜¬ë°”ë¥´ê²Œ ì •ì˜ë˜ì–´ ìˆë‹¤ê³  ê°€ì •)

3. Data/LockerDbContext.cs

(ì´ì „ê³¼ ë™ì¼ - ë³€ê²½ ì—†ìŒ)

C#

using LockerManagementApp.Models;
using System;
using System.Collections.Generic;
using System.Data.Entity;
using System.Data.Entity.Infrastructure;
using System.Linq;
using System.Threading.Tasks;
using System.Web.Script.Serialization; // ë˜ëŠ” Newtonsoft.Json

namespace LockerManagementApp.Data
{
    public class LockerDbContext : DbContext
    {
        public DbSet<LockerAssignment> LockerAssignments { get; set; }
        public DbSet<AuditLog> AuditLogs { get; set; }
        public DbSet<LockerType> LockerTypes { get; set; }
        public DbSet<Floor> Floors { get; set; }
        public DbSet<Zone> Zones { get; set; }
        public DbSet<SubPart> SubParts { get; set; }
        public DbSet<Administrator> Administrators { get; set; }

        public LockerDbContext() : base("name=LockerDbConnection") { }

        protected override void OnModelCreating(DbModelBuilder modelBuilder) { base.OnModelCreating(modelBuilder); }

        public override int SaveChanges() { var auditEntries = CreateAuditEntries(); var result = base.SaveChanges(); SaveAuditLogs(auditEntries); return result; }
        public override async Task<int> SaveChangesAsync() { var auditEntries = CreateAuditEntries(); var result = await base.SaveChangesAsync(); await SaveAuditLogsAsync(auditEntries); return result; }

        private List<AuditLog> CreateAuditEntries()
        {
            string currentUserName = System.Threading.Thread.CurrentPrincipal?.Identity?.Name ?? "UnknownUser"; // ì‹¤ì œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            var auditEntries = new List<AuditLog>();
            var changedEntries = ChangeTracker.Entries().Where(e => e.State == EntityState.Added || e.State == EntityState.Modified || e.State == EntityState.Deleted).ToList();
            var serializer = new JavaScriptSerializer(); // Newtonsoft.Json ê¶Œì¥

            foreach (var entry in changedEntries)
            {
                if (entry.Entity is AuditLog) continue;
                var auditEntry = new AuditLog { Timestamp = DateTime.Now, UserName = currentUserName, TableName = entry.Entity.GetType().Name, Action = entry.State.ToString() };
                try { auditEntry.RecordId = entry.Property("Id").CurrentValue?.ToString(); } catch { auditEntry.RecordId = "N/A"; }
                var oldValues = new Dictionary<string, object>(); var newValues = new Dictionary<string, object>(); var affectedColumns = new List<string>();

                if (entry.State == EntityState.Added) { foreach (var pn in entry.CurrentValues.PropertyNames) newValues[pn] = entry.CurrentValues[pn]; auditEntry.NewValues = serializer.Serialize(newValues); }
                else if (entry.State == EntityState.Deleted) { foreach (var pn in entry.OriginalValues.PropertyNames) oldValues[pn] = entry.OriginalValues[pn]; auditEntry.OldValues = serializer.Serialize(oldValues); }
                else if (entry.State == EntityState.Modified)
                {
                    foreach (var pn in entry.OriginalValues.PropertyNames) { var ov = entry.OriginalValues[pn]; var cv = entry.CurrentValues[pn]; if (!Equals(ov, cv)) { affectedColumns.Add(pn); oldValues[pn] = ov; newValues[pn] = cv; } }
                    if (affectedColumns.Any()) { auditEntry.AffectedColumns = string.Join(",", affectedColumns); auditEntry.OldValues = serializer.Serialize(oldValues); auditEntry.NewValues = serializer.Serialize(newValues); } else continue;
                }
                auditEntries.Add(auditEntry);
            }
            UpdateLockerAssignmentTimestamps(changedEntries); return auditEntries;
        }
        private void SaveAuditLogs(List<AuditLog> auditEntries) { if (auditEntries.Any()) { this.AuditLogs.AddRange(auditEntries); base.SaveChanges(); } }
        private async Task SaveAuditLogsAsync(List<AuditLog> auditEntries) { if (auditEntries.Any()) { this.AuditLogs.AddRange(auditEntries); await base.SaveChangesAsync(); } }
        private void UpdateLockerAssignmentTimestamps(List<DbEntityEntry> changedEntries) { var lockerEntries = changedEntries.Where(e => e.Entity is LockerAssignment && (e.State == EntityState.Added || e.State == EntityState.Modified)); foreach (var entry in lockerEntries) ((LockerAssignment)entry.Entity).LastUpdated = DateTime.Now; }
    }
}
4. Infrastructure í´ë”

(ViewModelBase.cs, RelayCommand.cs, PasswordHelper.cs - ì´ì „ê³¼ ë™ì¼)

5. ViewModels í´ë”

MainViewModel.cs (ìˆ˜ì •)

(ì´ì „ ìµœì¢… ë²„ì „ê³¼ ë™ì¼ - RollbackChanges ë§¤ê°œë³€ìˆ˜ List<> íƒ€ì…, LoadMasterDataAsyncì—ì„œ ì¤‘ë³µ í˜¸ì¶œ ì œê±° ë“± í™•ì¸)

C#

// í•„ìš”í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¶”ê°€
using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.Generic; // List<T> ì‚¬ìš©
using System.Collections.ObjectModel;
using System.Configuration; // AppSettings ë° ConnectionStrings ì‚¬ìš© ìœ„í•´ ì¶”ê°€
using System.Data.Entity;
using System.Data.Entity.Infrastructure; // DbEntityEntry, DbUpdateException ì‚¬ìš©
using System.Linq;
using System.Security;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Input;
using System.Runtime.InteropServices; // Marshal ì‚¬ìš©

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ë©”ì¸ ìœˆë„ìš°(MainWindow)ì™€ ì—°ê²°ë˜ëŠ” ì£¼ ViewModel í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
    /// (.NET Framework 4.8 ë²„ì „ - ìµœì¢…)
    /// </summary>
    public class MainViewModel : ViewModelBase, IDisposable
    {
        private LockerDbContext _context;
        private ObservableCollection<LockerAssignment> _lockerAssignments;
        private LockerAssignment _selectedAssignment;
        private string _statusBarText = "ì¤€ë¹„ ì™„ë£Œ";
        private string _currentAdmin = "í™ê¸¸ë™A";

        private SecureString _masterPasswordInput;
        private bool _isMasterModeEnabled = false;

        private ObservableCollection<LockerType> _allLockerTypes;
        private ObservableCollection<Floor> _allFloors;
        private ObservableCollection<Zone> _allZones;
        private ObservableCollection<SubPart> _allSubParts;
        private ObservableCollection<Administrator> _allAdministrators;

        // ìì‹ ViewModel ì¸ìŠ¤í„´ìŠ¤ (DbContext ê³µìœ )
        public MasterDataViewModel MasterDataVM { get; private set; }
        public LogViewModel LogVM { get; private set; }

        #region Public Properties
        public ObservableCollection<LockerAssignment> LockerAssignments { get => _lockerAssignments; set => SetProperty(ref _lockerAssignments, value); }
        public LockerAssignment SelectedAssignment { get => _selectedAssignment; set { if (SetProperty(ref _selectedAssignment, value)) { ((RelayCommand)DeleteCommand).RaiseCanExecuteChanged(); ((RelayCommand)ClearAssignmentCommand).RaiseCanExecuteChanged(); } } }
        public string StatusBarText { get => _statusBarText; set => SetProperty(ref _statusBarText, value); }
        public SecureString MasterPasswordInput { get => _masterPasswordInput; set => SetProperty(ref _masterPasswordInput, value); }
        public bool IsMasterModeEnabled { get => _isMasterModeEnabled; set => SetProperty(ref _isMasterModeEnabled, value); }
        public ObservableCollection<LockerType> AllLockerTypes { get => _allLockerTypes; set => SetProperty(ref _allLockerTypes, value); }
        public ObservableCollection<Floor> AllFloors { get => _allFloors; set => SetProperty(ref _allFloors, value); }
        public ObservableCollection<Zone> AllZones { get => _allZones; set => SetProperty(ref _allZones, value); }
        public ObservableCollection<SubPart> AllSubParts { get => _allSubParts; set => SetProperty(ref _allSubParts, value); }
        public ObservableCollection<Administrator> AllAdministrators { get => _allAdministrators; set => SetProperty(ref _allAdministrators, value); }
        #endregion

        #region Commands
        public ICommand LoadDataCommand { get; }
        public ICommand SaveChangesCommand { get; }
        public ICommand AddNewCommand { get; }
        public ICommand DeleteCommand { get; }
        public ICommand ClearAssignmentCommand { get; }
        public ICommand CheckMasterPasswordCommand { get; }
        public ICommand RefreshMasterDataCommand { get; }
        #endregion

        public MainViewModel()
        {
            try
            {
                _context = new LockerDbContext(); // ì—¬ê¸°ì„œ DbContext ìƒì„± (ê³µìœ  ëª©ì )
                // ì—°ê²° í…ŒìŠ¤íŠ¸ (ì„ íƒ ì‚¬í•­)
                // _context.Database.Connection.Open();
                // _context.Database.Connection.Close();
                StatusBarText = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ.";
            }
            catch (Exception ex) { MessageBox.Show($"DB ì»¨í…ìŠ¤íŠ¸ ìƒì„± ì˜¤ë¥˜:\n{ex.ToString()}", "ì´ˆê¸°í™” ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); StatusBarText = "DB ì—°ê²° ì˜¤ë¥˜!"; return; }

            _lockerAssignments = new ObservableCollection<LockerAssignment>();
            _allLockerTypes = new ObservableCollection<LockerType>();
            _allFloors = new ObservableCollection<Floor>();
            _allZones = new ObservableCollection<Zone>();
            _allSubParts = new ObservableCollection<SubPart>();
            _allAdministrators = new ObservableCollection<Administrator>();

            // ìì‹ ViewModel ìƒì„± ì‹œ ê³µìœ  DbContext ì „ë‹¬
            MasterDataVM = new MasterDataViewModel(_context);
            LogVM = new LogViewModel(_context);

            LoadDataCommand = new RelayCommand(async _ => await LoadInitialDataAsync());
            SaveChangesCommand = new RelayCommand(async _ => await SaveChangesAsync());
            AddNewCommand = new RelayCommand(AddNewLocker);
            DeleteCommand = new RelayCommand(async _ => await DeleteSelectedAsync(), _ => SelectedAssignment != null);
            ClearAssignmentCommand = new RelayCommand(ClearSelectedAssignment, _ => SelectedAssignment != null && SelectedAssignment.IsAssigned);
            CheckMasterPasswordCommand = new RelayCommand(CheckMasterPassword);
            RefreshMasterDataCommand = new RelayCommand(async _ => await LoadMasterDataAsync()); // ë§ˆìŠ¤í„° ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨

            if (_context != null) { _ = LoadInitialDataAsync(); }
        }

        private async Task LoadInitialDataAsync() { await LoadMasterDataAsync(); await LoadAssignmentsAsync(); }
        private async Task LoadAssignmentsAsync()
        {
            if (_context == null) return; StatusBarText = "ì‚¬ë¬¼í•¨ ëª©ë¡ ë¡œë”© ì¤‘..."; try { var assignments = await _context.LockerAssignments.OrderBy(l => l.Floor).ThenBy(l => l.Zone).ThenBy(l => l.SpecificLocation).ToListAsync(); LockerAssignments = new ObservableCollection<LockerAssignment>(assignments); StatusBarText = $"ì´ {LockerAssignments.Count}ê°œ ë¡œë“œ ì™„ë£Œ."; } catch (Exception ex) { HandleGenericException("ì‚¬ë¬¼í•¨ ëª©ë¡ ë¡œë”©", ex); }
        }
        private async Task LoadMasterDataAsync()
        {
            if (_context == null) return; StatusBarText = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”© ì¤‘..."; try { AllLockerTypes = new ObservableCollection<LockerType>(await _context.LockerTypes.OrderBy(t => t.Name).ToListAsync()); AllFloors = new ObservableCollection<Floor>(await _context.Floors.OrderBy(f => f.Name).ToListAsync()); AllZones = new ObservableCollection<Zone>(await _context.Zones.OrderBy(z => z.Name).ToListAsync()); AllSubParts = new ObservableCollection<SubPart>(await _context.SubParts.OrderBy(p => p.Name).ToListAsync()); AllAdministrators = new ObservableCollection<Administrator>(await _context.Administrators.OrderBy(a => a.Name).ToListAsync()); StatusBarText = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë“œ ì™„ë£Œ."; } catch (InvalidOperationException ioEx) when (ioEx.Message.Contains("DataReader")) { HandleGenericException("ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”© (DataReader ì¶©ëŒ ê°€ëŠ¥ì„±)", ioEx); MessageBox.Show("ë°ì´í„° ë¡œë”© ì¤‘ ì¶©ëŒ ë°œìƒ. App.config ì—°ê²° ë¬¸ìì—´ì— MultipleActiveResultSets=True; ì˜µì…˜ í™•ì¸ ë˜ëŠ” ì¬ì‹œë„.", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning); } catch (Exception ex) { HandleGenericException("ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”©", ex); }
        }
        private void CheckMasterPassword(object parameter) { try { string storedMasterKey = ConfigurationManager.AppSettings["MasterKey"]; if (string.IsNullOrEmpty(storedMasterKey)) { MessageBox.Show("App.configì— ë§ˆìŠ¤í„° í‚¤(MasterKey) ì—†ìŒ.", "ì„¤ì • ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning); return; } string plainPassword = ConvertToUnsecureString(MasterPasswordInput); if (plainPassword == storedMasterKey) { IsMasterModeEnabled = true; StatusBarText = "ë§ˆìŠ¤í„° ëª¨ë“œ í™œì„±í™”."; MessageBox.Show("ë§ˆìŠ¤í„° í‚¤ í™•ì¸ ì™„ë£Œ.", "ì„±ê³µ", MessageBoxButton.OK, MessageBoxImage.Information); } else { IsMasterModeEnabled = false; MessageBox.Show("ë§ˆìŠ¤í„° í‚¤ ë¶ˆì¼ì¹˜.", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } } catch (ConfigurationErrorsException confEx) { MessageBox.Show($"ì„¤ì • íŒŒì¼ ì˜¤ë¥˜:\n{confEx.Message}", "ì„¤ì • ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } catch (Exception ex) { MessageBox.Show($"ë§ˆìŠ¤í„° í‚¤ í™•ì¸ ì˜¤ë¥˜: {ex.Message}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } }

        #region CRUD ë° ê¸°íƒ€ ë©”ì„œë“œ
        private async Task SaveChangesAsync()
        {
             if (_context == null) return; StatusBarText = "ë³€ê²½ ì‚¬í•­ ì €ì¥ ì¤‘..."; List<DbEntityEntry> allChangedEntriesForRollback = _context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged).ToList(); try { var changedLockerEntries = _context.ChangeTracker.Entries<LockerAssignment>().Where(e => e.State == EntityState.Added || e.State == EntityState.Modified).ToList(); var allItemsToCheck = LockerAssignments.ToList(); var duplicates = allItemsToCheck.GroupBy(l => new { l.Floor, l.Zone, l.SpecificLocation }).Where(g => g.Count() > 1).Select(g => g.Key); if (duplicates.Any()) { MessageBox.Show($"ì €ì¥ ë¶ˆê°€: ì¤‘ë³µ ìœ„ì¹˜ ë°œê²¬ - {string.Join(", ", duplicates.Select(d => $"{d.Floor}-{d.Zone}-{d.SpecificLocation}"))}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning); RollbackChanges(allChangedEntriesForRollback); return; } foreach(var entry in changedLockerEntries) { entry.Entity.Administrator = _currentAdmin; } int changedCount = await _context.SaveChangesAsync(); StatusBarText = $"ì„±ê³µì ìœ¼ë¡œ {changedCount}ê°œ ì €ì¥ë¨."; } catch (DbUpdateException dbEx) { HandleDbUpdateException(dbEx); RollbackChanges(allChangedEntriesForRollback); } catch (Exception ex) { HandleGenericException("ì €ì¥", ex); RollbackChanges(allChangedEntriesForRollback); }
        }
        private void RollbackChanges(List<DbEntityEntry> changedEntries) { if (_context == null || changedEntries == null) return; foreach (var entry in changedEntries) { switch (entry.State) { case EntityState.Modified: entry.CurrentValues.SetValues(entry.OriginalValues); entry.State = EntityState.Unchanged; break; case EntityState.Added: entry.State = EntityState.Detached; if (entry.Entity is LockerAssignment addedEntity && LockerAssignments.Contains(addedEntity)) LockerAssignments.Remove(addedEntity); break; case EntityState.Deleted: entry.State = EntityState.Unchanged; break; } } StatusBarText = "ë³€ê²½ ë¡¤ë°±ë¨."; }
        private void AddNewLocker(object parameter) { if (_context == null) return; var newAssignment = new LockerAssignment { LockerType = AllLockerTypes.FirstOrDefault()?.Name ?? "ê°œì¸ì‚¬ë¬¼í•¨", Floor = AllFloors.FirstOrDefault()?.Name ?? "1", Zone = AllZones.FirstOrDefault()?.Name ?? "A", SpecificLocation = "ìƒˆ ìœ„ì¹˜-" + Guid.NewGuid().ToString("N").Substring(0, 4), Administrator = _currentAdmin, LastUpdated = DateTime.Now }; LockerAssignments.Add(newAssignment); _context.LockerAssignments.Add(newAssignment); SelectedAssignment = newAssignment; StatusBarText = "ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€ë¨. ì €ì¥ í•„ìš”."; }
        private async Task DeleteSelectedAsync() { if (_context == null || SelectedAssignment == null) return; if (MessageBox.Show($"'{SelectedAssignment.Floor}-{SelectedAssignment.Zone}-{SelectedAssignment.SpecificLocation}' ì‚­ì œ?", "í™•ì¸", MessageBoxButton.YesNo, MessageBoxImage.Warning) == MessageBoxResult.Yes) { StatusBarText = "ì‚­ì œ ì¤‘..."; List<DbEntityEntry> changesForRollback = _context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged).ToList(); try { var assignmentToDelete = SelectedAssignment; var entry = _context.Entry(assignmentToDelete); if (entry.State == EntityState.Detached) { _context.LockerAssignments.Attach(assignmentToDelete); } _context.LockerAssignments.Remove(assignmentToDelete); int changedCount = await _context.SaveChangesAsync(); LockerAssignments.Remove(assignmentToDelete); SelectedAssignment = null; StatusBarText = $"ì„±ê³µì ìœ¼ë¡œ {changedCount}ê°œ ì‚­ì œë¨."; } catch (DbUpdateException dbEx) { HandleDbUpdateException(dbEx); RollbackChanges(changesForRollback); await LoadAssignmentsAsync(); } catch (Exception ex) { HandleGenericException("ì‚­ì œ", ex); RollbackChanges(changesForRollback); await LoadAssignmentsAsync(); } } }
        private void ClearSelectedAssignment(object parameter) { if (_context == null || SelectedAssignment == null) return; SelectedAssignment.UserName = null; SelectedAssignment.KnoxId = null; SelectedAssignment.SubPart = null; _context.Entry(SelectedAssignment).State = EntityState.Modified; SelectedAssignment.Administrator = _currentAdmin; StatusBarText = "ë°°ì • í•´ì œë¨. ì €ì¥ í•„ìš”."; }
        #endregion

        #region Helper Methods
        private void HandleGenericException(string operation, Exception ex) { StatusBarText = $"{operation} ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show($"{operation} ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\n{ex.ToString()}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); }
        private void HandleDbUpdateException(DbUpdateException dbEx) { var innerExMsg = dbEx.InnerException?.InnerException?.Message ?? dbEx.InnerException?.Message ?? dbEx.Message; StatusBarText = $"DB ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: {innerExMsg}"; MessageBox.Show($"DB ì‘ì—… ì˜¤ë¥˜:\n{innerExMsg}\n\n{dbEx.ToString()}", "DB ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); try { foreach(var entry in dbEx.Entries) { entry.Reload(); } } catch { /* Reload ì‹¤íŒ¨ ë¬´ì‹œ */ } }
        private string ConvertToUnsecureString(SecureString securePassword) { if (securePassword == null) return string.Empty; IntPtr ptr = IntPtr.Zero; try { ptr = Marshal.SecureStringToGlobalAllocUnicode(securePassword); return Marshal.PtrToStringUni(ptr); } finally { Marshal.ZeroFreeGlobalAllocUnicode(ptr); } }
        #endregion

        #region IDisposable êµ¬í˜„ (DbContext í•´ì œ)
        private bool disposed = false;
        protected virtual void Dispose(bool disposing) { if (!disposed) { if (disposing) { _context?.Dispose(); } disposed = true; } } // DbContext í•´ì œ í™•ì¸
        public void Dispose() { Dispose(true); GC.SuppressFinalize(this); }
        #endregion
    }
}
MasterDataViewModel.cs

(ì´ì „ ìµœì¢… ë²„ì „ê³¼ ë™ì¼ - DbContextë¥¼ ìƒì„±ìì—ì„œ ë°›ìŒ)

C#

using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Data.Entity;
using System.Data.Entity.Infrastructure;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Input;

namespace LockerManagementApp.ViewModels
{
    public class MasterDataViewModel : ViewModelBase
    {
        private readonly LockerDbContext _context; // ìƒì„±ìì—ì„œ ì „ë‹¬ë°›ì€ DbContext ì‚¬ìš©

        public ObservableCollection<LockerType> LockerTypes { get; set; }
        public ObservableCollection<Floor> Floors { get; set; }
        public ObservableCollection<Zone> Zones { get; set; }
        public ObservableCollection<SubPart> SubParts { get; set; }
        public ObservableCollection<Administrator> Administrators { get; set; }

        private object _selectedItem;
        public object SelectedItem { get => _selectedItem; set { if (SetProperty(ref _selectedItem, value)) ((RelayCommand)DeleteItemCommand).RaiseCanExecuteChanged(); } }

        private string _statusMessage;
        public string StatusMessage { get => _statusMessage; set => SetProperty(ref _statusMessage, value); }

        public ICommand LoadAllMasterDataCommand { get; }
        public ICommand AddItemCommand { get; }
        public ICommand DeleteItemCommand { get; }
        public ICommand SaveChangesCommand { get; }

        public MasterDataViewModel(LockerDbContext context) // DbContextë¥¼ ì™¸ë¶€ì—ì„œ ë°›ìŒ
        {
            _context = context ?? throw new ArgumentNullException(nameof(context));
            // ì—¬ê¸°ì„œ new LockerDbContext() í˜¸ì¶œí•˜ì§€ ì•ŠìŒ!

            LockerTypes = new ObservableCollection<LockerType>();
            Floors = new ObservableCollection<Floor>();
            Zones = new ObservableCollection<Zone>();
            SubParts = new ObservableCollection<SubPart>();
            Administrators = new ObservableCollection<Administrator>();

            LoadAllMasterDataCommand = new RelayCommand(async _ => await LoadAllMasterDataAsync());
            AddItemCommand = new RelayCommand(AddItem, CanAddItem);
            DeleteItemCommand = new RelayCommand(DeleteItem, CanDeleteItem);
            SaveChangesCommand = new RelayCommand(async _ => await SaveMasterDataChangesAsync());

            _ = LoadAllMasterDataAsync();
        }

        public async Task LoadAllMasterDataAsync() { StatusMessage = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”© ì¤‘..."; try { var lockerTypes = await _context.LockerTypes.OrderBy(x => x.Name).ToListAsync(); LockerTypes.Clear(); lockerTypes.ForEach(LockerTypes.Add); var floors = await _context.Floors.OrderBy(x => x.Name).ToListAsync(); Floors.Clear(); floors.ForEach(Floors.Add); var zones = await _context.Zones.OrderBy(x => x.Name).ToListAsync(); Zones.Clear(); zones.ForEach(Zones.Add); var subParts = await _context.SubParts.OrderBy(x => x.Name).ToListAsync(); SubParts.Clear(); subParts.ForEach(SubParts.Add); var administrators = await _context.Administrators.OrderBy(x => x.Name).ToListAsync(); Administrators.Clear(); administrators.ForEach(Administrators.Add); StatusMessage = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë“œ ì™„ë£Œ."; } catch (Exception ex) { StatusMessage = $"ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”© ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show(StatusMessage, "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } }
        private bool CanAddItem(object parameter) => parameter is string category && !string.IsNullOrEmpty(category);
        private void AddItem(object parameter) { if (parameter is string category) { try { object newItem = null; switch (category.ToLower()) { case "lockertype": newItem = _context.LockerTypes.Add(new LockerType { Name = "ìƒˆ ì¢…ë¥˜" }); LockerTypes.Add((LockerType)newItem); break; case "floor": newItem = _context.Floors.Add(new Floor { Name = "ìƒˆ ì¸µ" }); Floors.Add((Floor)newItem); break; case "zone": newItem = _context.Zones.Add(new Zone { Name = "ìƒˆ êµ¬ì—­" }); Zones.Add((Zone)newItem); break; case "subpart": newItem = _context.SubParts.Add(new SubPart { Name = "ìƒˆ ì†ŒíŒŒíŠ¸" }); SubParts.Add((SubPart)newItem); break; case "administrator": newItem = _context.Administrators.Add(new Administrator { Name = "ìƒˆ ê´€ë¦¬ì" }); Administrators.Add((Administrator)newItem); break; default: MessageBox.Show("ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬.", "ì˜¤ë¥˜"); return; } SelectedItem = newItem; StatusMessage = "ìƒˆ í•­ëª© ì¶”ê°€ë¨. ì €ì¥ í•„ìš”."; } catch (Exception ex) { StatusMessage = $"í•­ëª© ì¶”ê°€ ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show(StatusMessage, "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } } }
        private bool CanDeleteItem(object parameter) => SelectedItem != null;
        private void DeleteItem(object parameter) { if (SelectedItem == null) return; string itemName = GetItemName(SelectedItem); if (itemName == null) return; string confirmMessage = $"'{itemName}' ì‚­ì œ?"; if (HasAssociatedAssignments(SelectedItem, itemName)) { confirmMessage += "\n\nê²½ê³ : ì‚¬ìš© ì¤‘ì¸ ì‚¬ë¬¼í•¨ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤!"; } if (MessageBox.Show(confirmMessage, "ì‚­ì œ í™•ì¸", MessageBoxButton.YesNo, MessageBoxImage.Warning) == MessageBoxResult.Yes) { try { if (SelectedItem is LockerType lt) { _context.Entry(lt).State = EntityState.Deleted; LockerTypes.Remove(lt); } else if (SelectedItem is Floor f) { _context.Entry(f).State = EntityState.Deleted; Floors.Remove(f); } else if (SelectedItem is Zone z) { _context.Entry(z).State = EntityState.Deleted; Zones.Remove(z); } else if (SelectedItem is SubPart sp) { _context.Entry(sp).State = EntityState.Deleted; SubParts.Remove(sp); } else if (SelectedItem is Administrator ad) { _context.Entry(ad).State = EntityState.Deleted; Administrators.Remove(ad); } else { return; } SelectedItem = null; StatusMessage = "í•­ëª© ì‚­ì œ ëŒ€ê¸° ì¤‘. ì €ì¥ í•„ìš”."; } catch (Exception ex) { StatusMessage = $"í•­ëª© ì‚­ì œ ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show(StatusMessage, "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); _ = LoadAllMasterDataAsync(); } } }
        private string GetItemName(object item) { return item?.GetType().GetProperty("Name")?.GetValue(item)?.ToString(); }
        private bool HasAssociatedAssignments(object item, string itemName) { if (item == null || string.IsNullOrEmpty(itemName)) return false; try { if (item is LockerType) return _context.LockerAssignments.Any(a => a.LockerType == itemName); if (item is Floor) return _context.LockerAssignments.Any(a => a.Floor == itemName); if (item is Zone) return _context.LockerAssignments.Any(a => a.Zone == itemName); if (item is SubPart) return _context.LockerAssignments.Any(a => a.SubPart == itemName); if (item is Administrator) return _context.LockerAssignments.Any(a => a.Administrator == itemName); } catch (Exception ex) { System.Diagnostics.Debug.WriteLine($"ì—°ê´€ ë°ì´í„° í™•ì¸ ì˜¤ë¥˜: {ex.Message}"); return true; } return false; }
        private async Task SaveMasterDataChangesAsync() { StatusMessage = "ë§ˆìŠ¤í„° ë°ì´í„° ì €ì¥ ì¤‘..."; using (var transaction = _context.Database.BeginTransaction()) { try { var modifiedNameEntries = _context.ChangeTracker.Entries().Where(e => e.State == EntityState.Modified && (e.Entity is LockerType || e.Entity is Floor || e.Entity is Zone || e.Entity is SubPart || e.Entity is Administrator)).Select(e => new { Entry = e, OriginalName = e.OriginalValues["Name"]?.ToString(), CurrentName = e.CurrentValues["Name"]?.ToString() }).Where(x => x.OriginalName != null && x.CurrentName != null && x.OriginalName != x.CurrentName).ToList(); foreach (var modified in modifiedNameEntries) { StatusMessage = $"'{modified.OriginalName}' -> '{modified.CurrentName}' ì—°ì‡„ ì—…ë°ì´íŠ¸ ì¤‘..."; int updatedCount = 0; string updateSql = ""; string targetColumn = ""; if (modified.Entry.Entity is LockerType) targetColumn = "LockerType"; else if (modified.Entry.Entity is Floor) targetColumn = "Floor"; else if (modified.Entry.Entity is Zone) targetColumn = "Zone"; else if (modified.Entry.Entity is SubPart) targetColumn = "SubPart"; else if (modified.Entry.Entity is Administrator) targetColumn = "Administrator"; if (!string.IsNullOrEmpty(targetColumn)) { updateSql = $"UPDATE LockerAssignments SET [{targetColumn}] = {{0}} WHERE [{targetColumn}] = {{1}}"; updatedCount = await _context.Database.ExecuteSqlCommandAsync(updateSql, modified.CurrentName, modified.OriginalName); StatusMessage = $"'{modified.OriginalName}' -> '{modified.CurrentName}' ({updatedCount}ê°œ ì—…ë°ì´íŠ¸ ì™„ë£Œ)."; System.Diagnostics.Debug.WriteLine($"Executed: {updateSql} with params '{modified.CurrentName}', '{modified.OriginalName}'. Rows: {updatedCount}"); } } int masterDataChanges = await _context.SaveChangesAsync(); transaction.Commit(); StatusMessage = $"ë§ˆìŠ¤í„° ë°ì´í„° ì €ì¥ ì™„ë£Œ ({masterDataChanges}ê±´)."; } catch (Exception ex) { transaction.Rollback(); StatusMessage = $"ë§ˆìŠ¤í„° ë°ì´í„° ì €ì¥ ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show($"{StatusMessage}\n\n{ex.ToString()}", "ì €ì¥ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); var errorEntries = _context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged && e.State != EntityState.Detached); foreach (var entry in errorEntries.ToList()) { try { entry.Reload(); } catch { entry.State = EntityState.Detached; } } } } await LoadAllMasterDataAsync(); }
    }
}
LogViewModel.cs

(ì´ì „ ìµœì¢… ë²„ì „ê³¼ ë™ì¼ - DbContextë¥¼ ìƒì„±ìì—ì„œ ë°›ìŒ)

C#

using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.ObjectModel;
using System.Data.Entity;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Input;

namespace LockerManagementApp.ViewModels
{
    public class LogViewModel : ViewModelBase
    {
        private readonly LockerDbContext _context; // ìƒì„±ìì—ì„œ ì „ë‹¬ë°›ì€ DbContext ì‚¬ìš©
        public ObservableCollection<AuditLog> AuditLogs { get; set; }
        private string _statusMessage;
        public string StatusMessage { get => _statusMessage; set => SetProperty(ref _statusMessage, value); }
        public ICommand LoadLogsCommand { get; }

        public LogViewModel(LockerDbContext context) // DbContextë¥¼ ì™¸ë¶€ì—ì„œ ë°›ìŒ
        {
            _context = context ?? throw new ArgumentNullException(nameof(context));
            AuditLogs = new ObservableCollection<AuditLog>();
            LoadLogsCommand = new RelayCommand(async _ => await LoadLogsAsync());
            _ = LoadLogsAsync();
        }

        public async Task LoadLogsAsync() { StatusMessage = "ë¡œê·¸ ë¡œë”© ì¤‘..."; try { var logs = await _context.AuditLogs.OrderByDescending(log => log.Timestamp).Take(1000).ToListAsync(); AuditLogs.Clear(); logs.ForEach(AuditLogs.Add); StatusMessage = $"ì´ {AuditLogs.Count}ê°œ ë¡œê·¸ ë¡œë“œ."; } catch (Exception ex) { StatusMessage = $"ë¡œê·¸ ë¡œë”© ì˜¤ë¥˜: {ex.Message}"; MessageBox.Show(StatusMessage, "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error); } }
    }
}
6. Views í´ë”

MainWindow.xaml

(ì´ì „ ìµœì¢… ë²„ì „ê³¼ ë™ì¼ - ComboBox ë°”ì¸ë”© ë“± í™•ì¸)

XML

<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:local="clr-namespace:LockerManagementApp.Views"
    xmlns:viewmodels="clr-namespace:LockerManagementApp.ViewModels"
    xmlns:models="clr-namespace:LockerManagementApp.Models"
    xmlns:infra="clr-namespace:LockerManagementApp.Infrastructure"
    Title="ì‚¬ë¬¼í•¨ ê´€ë¦¬ í”„ë¡œê·¸ë¨ (DevExpress MVVM - .NET Framework 4.8)" Height="750" Width="1300"
    Loaded="MainWindow_Loaded" Closing="MainWindow_Closing"
    >
    <dx:ThemedWindow.DataContext> <viewmodels:MainViewModel/> </dx:ThemedWindow.DataContext>
    <dx:ThemedWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style x:Key="LightBlueHeaderStyle" TargetType="dxg:BaseGridHeader"> <Setter Property="Background" Value="LightBlue"/> <Setter Property="HorizontalContentAlignment" Value="Center"/> <Setter Property="FontWeight" Value="Bold"/> </Style>
        <Style TargetType="dxg:GridColumnHeader" BasedOn="{StaticResource LightBlueHeaderStyle}"/> <Style TargetType="dxg:BandHeaderControl" BasedOn="{StaticResource LightBlueHeaderStyle}"/>
    </dx:ThemedWindow.Resources>
    <Grid>
        <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> <RowDefinition Height="Auto"/> </Grid.RowDefinitions>
        <DockPanel Grid.Row="0" LastChildFill="True">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" Margin="5">
                <TextBlock Text="ë§ˆìŠ¤í„° í‚¤:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <PasswordBox x:Name="MasterPasswordBox" Width="100" VerticalAlignment="Center" infra:PasswordHelper.Attach="True" infra:PasswordHelper.Password="{Binding MasterPasswordInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="í™•ì¸" Margin="5,0,0,0" Command="{Binding CheckMasterPasswordCommand}"/>
            </StackPanel>
            <Border Background="LightGray" Padding="5">
                 <StackPanel Orientation="Horizontal"> <Button Content="ğŸ”„ ìƒˆë¡œê³ ì¹¨" Margin="3" Command="{Binding LoadDataCommand}"/> <Button Content="ğŸ’¾ ë³€ê²½ ì‚¬í•­ ì €ì¥" Margin="3" Command="{Binding SaveChangesCommand}"/> </StackPanel>
            </Border>
        </DockPanel>
        <TabControl Grid.Row="1" Margin="5">
            <TabItem Header="ì‚¬ë¬¼í•¨ ê´€ë¦¬">
                <Grid>
                    <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="WhiteSmoke" Padding="3"> <StackPanel Orientation="Horizontal"> <Button Content="â• ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€" Margin="3" Command="{Binding AddNewCommand}"/> <Button Content="âŒ ì„ íƒ í•­ëª© ì‚­ì œ" Margin="3" Command="{Binding DeleteCommand}"/> <Button Content="ğŸ§¹ ë°°ì • í•´ì œ" Margin="3" Command="{Binding ClearAssignmentCommand}"/> </StackPanel> </Border>
                    <dxg:GridControl Grid.Row="1" ItemsSource="{Binding LockerAssignments}" SelectedItem="{Binding SelectedAssignment, Mode=TwoWay}">
                        <dxg:GridControl.View> <dxg:TableView AllowPerPixelScrolling="True" ShowGroupPanel="True" AllowEditing="True" NavigationStyle="Cell" ShowAutoFilterRow="True" NewItemRowPosition="None" ShowIndicator="True" ShowSearchPanelMode="Always"> <dxg:TableView.RowCellMenuCustomizations> <dxb:BarButtonItem Content="ë°°ì • í•´ì œ" Command="{Binding View.DataContext.ClearAssignmentCommand}" Glyph="{dx:DXImage Svg/Actions/DeleteList.svg}"/> <dxb:BarItemSeparator/> <dxb:BarButtonItem Content="í–‰ ì‚­ì œ" Command="{Binding View.DataContext.DeleteCommand}" Glyph="{dx:DXImage Svg/Actions/Delete.svg}"/> </dxg:TableView.RowCellMenuCustomizations> </dxg:TableView> </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="LockerType" Header="ì¢…ë¥˜" Width="100" Fixed="Left" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllLockerTypes}" DisplayMember="Name" IsTextEditable="False" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Floor" Header="ì¸µ" Width="60" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllFloors}" DisplayMember="Name" IsTextEditable="False" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Zone" Header="êµ¬ì—­" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllZones}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="SpecificLocation" Header="ì„¸ë¶€ ìœ„ì¹˜" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="UserName" Header="ì„±ëª…" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="KnoxId" Header="Knox ID" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="SubPart" Header="ì†ŒíŒŒíŠ¸" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllSubParts}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Administrator" Header="ê´€ë¦¬ ë‹´ë‹¹ì" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllAdministrators}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="TransferStatus" Header="ì „ë°°ë³µì§" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Details" Header="ë‚´ìš©" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Remarks" Header="íŠ¹ì´ì‚¬í•­" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Notes" Header="ë¹„ê³ " Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="LastUpdated" Header="ìµœì¢… ìˆ˜ì •ì¼ì‹œ" Width="150" AllowEditing="False" ReadOnly="True" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Id" Header="ID" Visible="False" ReadOnly="True"/>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>
                </Grid>
            </TabItem>
            <TabItem Header="ë³€ê²½ ë¡œê·¸" DataContext="{Binding LogVM}">
                 <Grid>
                     <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> <RowDefinition Height="Auto"/> </Grid.RowDefinitions>
                     <Button Grid.Row="0" Content="ğŸ”„ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨" Command="{Binding LoadLogsCommand}" HorizontalAlignment="Left" Margin="5"/>
                     <dxg:GridControl Grid.Row="1" ItemsSource="{Binding AuditLogs}">
                         <dxg:GridControl.View> <dxg:TableView AllowPerPixelScrolling="True" AllowEditing="False" ShowGroupPanel="False" ShowAutoFilterRow="True"/> </dxg:GridControl.View>
                         <dxg:GridControl.Columns>
                             <dxg:GridColumn FieldName="Timestamp" Header="ì‹œê°„" Width="150" SortOrder="Descending" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="UserName" Header="ì‚¬ìš©ì" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="Action" Header="ì‘ì—…" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="TableName" Header="í…Œì´ë¸”" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="RecordId" Header="ë ˆì½”ë“œ ID" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="AffectedColumns" Header="ë³€ê²½ ì»¬ëŸ¼" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="OldValues" Header="ë³€ê²½ ì „ ê°’" Width="200" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="NewValues" Header="ë³€ê²½ í›„ ê°’" Width="200" HeaderStyle="{StaticResource LightBlueHeaderStyle}"> <dxg:GridColumn.EditSettings> <dxe:TextEditSettings HorizontalContentAlignment="Left"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                         </dxg:GridControl.Columns>
                     </dxg:GridControl>
                     <StatusBar Grid.Row="2" Background="LightGray"> <StatusBarItem><TextBlock Text="{Binding StatusMessage}" Margin="5,0"/></StatusBarItem> </StatusBar>
                 </Grid>
            </TabItem>
            <TabItem Header="ë§ˆìŠ¤í„° ë°ì´í„° ê´€ë¦¬" DataContext="{Binding MasterDataVM}" Visibility="{Binding DataContext.IsMasterModeEnabled, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                 <Grid>
                     <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> </Grid.RowDefinitions>
                     <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5"> <Button Content="ğŸ’¾ ë§ˆìŠ¤í„° ë°ì´í„° ì €ì¥" Command="{Binding SaveChangesCommand}" Margin="3"/> <Button Content="ğŸ”„ ë§ˆìŠ¤í„° ë°ì´í„° ìƒˆë¡œê³ ì¹¨" Command="{Binding LoadAllMasterDataCommand}" Margin="3"/> <TextBlock Text="{Binding StatusMessage}" Margin="10,0,0,0" VerticalAlignment="Center" Foreground="Gray"/> </StackPanel>
                     <dxlc:LayoutControl Grid.Row="1" Orientation="Vertical">
                         <dxlc:LayoutGroup Header="ì‚¬ë¬¼í•¨ ì¢…ë¥˜" View="GroupBox" Orientation="Vertical"> <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ì¢…ë¥˜ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="LockerType" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel> <dxg:GridControl ItemsSource="{Binding LockerTypes}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì¢…ë¥˜ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl> </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ì¸µ" View="GroupBox" Orientation="Vertical"> <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ì¸µ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Floor" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel> <dxg:GridControl ItemsSource="{Binding Floors}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì¸µ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl> </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="êµ¬ì—­" View="GroupBox" Orientation="Vertical"> <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="êµ¬ì—­ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Zone" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel> <dxg:GridControl ItemsSource="{Binding Zones}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="êµ¬ì—­ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl> </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ì†ŒíŒŒíŠ¸" View="GroupBox" Orientation="Vertical"> <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ì†ŒíŒŒíŠ¸ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="SubPart" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel> <dxg:GridControl ItemsSource="{Binding SubParts}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì†ŒíŒŒíŠ¸ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl> </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ê´€ë¦¬ì" View="GroupBox" Orientation="Vertical"> <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ê´€ë¦¬ì ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Administrator" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel> <dxg:GridControl ItemsSource="{Binding Administrators}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ê´€ë¦¬ì ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl> </dxlc:LayoutGroup>
                     </dxlc:LayoutControl>
                 </Grid>
            </TabItem>
        </TabControl>
        <StatusBar Grid.Row="2" Background="LightGray"> <StatusBarItem><TextBlock Text="{Binding StatusBarText}" Margin="5,0"/></StatusBarItem> </StatusBar>
    </Grid>
</dx:ThemedWindow>
MainWindow.xaml.cs

(ì´ì „ ìµœì¢… ë²„ì „ê³¼ ë™ì¼ - Closing ì´ë²¤íŠ¸ì—ì„œ Dispose í˜¸ì¶œ í™•ì¸)

C#

using DevExpress.Xpf.Core;
using LockerManagementApp.ViewModels;
using System;
using System.ComponentModel;
using System.Windows;

namespace LockerManagementApp.Views
{
    public partial class MainWindow : ThemedWindow
    {
        public MainWindow()
        {
            InitializeComponent();
            // ApplicationThemeHelper.ApplicationThemeName = Theme.Office2019ColorfulName;
        }

        private MainViewModel ViewModel => DataContext as MainViewModel;

        private void MainWindow_Loaded(object sender, RoutedEventArgs e) { }

        // ì°½ì´ ë‹«í ë•Œ ViewModelì˜ Disposeë¥¼ í˜¸ì¶œí•˜ì—¬ DbContext ë¦¬ì†ŒìŠ¤ ì •ë¦¬
        private void MainWindow_Closing(object sender, CancelEventArgs e)
        {
            if (ViewModel is IDisposable disposableViewModel)
            {
                disposableViewModel.Dispose();
            }
        }
    }
}
App.xaml ë° App.xaml.cs

(ì´ì „ .NET Framework 4.8 ë²„ì „ê³¼ ë™ì¼)

ì´ì œ ëª¨ë“  ê´€ë ¨ íŒŒì¼ì— ëŒ€í•œ ì½”ë“œê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ê°•ì¡°í•˜ì§€ë§Œ, App.configì˜ ì—°ê²° ë¬¸ìì—´ì— MultipleActiveResultSets=True; ì˜µì…˜ì„ ê¼­ í™•ì¸í•´ ì£¼ì‹œê³ , ëª¨ë“  ëª¨ë¸ íŒŒì¼(Floor.cs, Zone.cs ë“±)ì´ í”„ë¡œì íŠ¸ì— ì˜¬ë°”ë¥´ê²Œ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„ ë¹Œë“œ ë° ì‹¤í–‰í•´ ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.