-- Create a new database (if it doesn't exist)
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'LockerManagementDB')
BEGIN
    CREATE DATABASE LockerManagementDB;
END
GO

-- Use the new database
USE LockerManagementDB;
GO

-- Drop the table if it already exists (for easy rerunning of the script)
IF OBJECT_ID('dbo.LockerAssignments', 'U') IS NOT NULL
    DROP TABLE dbo.LockerAssignments;
GO

-- Create the main table
CREATE TABLE LockerAssignments (
    Id INT PRIMARY KEY IDENTITY(1,1),             -- Unique ID for each record
    LockerType NVARCHAR(50) NOT NULL,            -- '개인사물함', '락커', '신발장'
    Floor NVARCHAR(10) NOT NULL,                 -- 'B1', '1', '2', '3', '4'
    Zone NVARCHAR(50) NOT NULL,                  -- 'A'~'H', 'B1'~'B4', '기타' etc.
    SpecificLocation NVARCHAR(100) NOT NULL,     -- 수기입 (Manual Input) - Unique identifier for the physical locker
    UserName NVARCHAR(100) NULL,                -- 성명 (수기입) - NULL if vacant
    KnoxId NVARCHAR(100) NULL,                   -- Knox ID (수기입) - NULL if vacant
    SubPart NVARCHAR(50) NULL,                   -- 소파트 ('Main(시생산)', 'MainA'~'Z') - NULL if vacant
    Administrator NVARCHAR(100) NULL,           -- 관리자 ('홍길동A'~'X') - Who manages this record/assignment
    LastUpdated DATETIME2 NOT NULL DEFAULT GETDATE() -- Audit trail: When was it last changed?
);
GO

-- Optional: Add some initial dummy data (e.g., empty lockers)
INSERT INTO LockerAssignments (LockerType, Floor, Zone, SpecificLocation, Administrator, LastUpdated)
VALUES
('개인사물함', '1', 'A', 'A-01', 'System', GETDATE()),
('개인사물함', '1', 'A', 'A-02', 'System', GETDATE()),
('락커', 'B1', 'B1', 'R-B1-01', 'System', GETDATE()),
('신발장', '2', '2F', 'S-2F-01', 'System', GETDATE());

-- Add an example assignment
INSERT INTO LockerAssignments (LockerType, Floor, Zone, SpecificLocation, UserName, KnoxId, SubPart, Administrator, LastUpdated)
VALUES
('개인사물함', '1', 'B', 'B-15', '김철수', 'kimcs', 'MainA', '홍길동A', GETDATE());
GO

-- Add an index for faster lookups, especially if you have many lockers
CREATE INDEX IX_LockerAssignments_Location ON dbo.LockerAssignments (Floor, Zone, SpecificLocation);
CREATE INDEX IX_LockerAssignments_User ON dbo.LockerAssignments (UserName);
GO

PRINT 'Database and Table created successfully.';