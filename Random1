from flask import Flask, render_template, request
import pickle

app = Flask(__name__)

# 모델과 데이터 로드
tfidf = pickle.load(open("tfidf.pkl", "rb"))
tfidf_matrix = pickle.load(open("tfidf_matrix.pkl", "rb"))
data = ...  # 데이터를 로드해야 함 (예: 데이터베이스 또는 파일에서 가져오기)

def find_similar_parts(input_str, top_n=10):
    input_vec = tfidf.transform([input_str])
    cosine_similarities = linear_kernel(input_vec, tfidf_matrix).flatten()
    related_docs_indices = cosine_similarities.argsort()[:-top_n-1:-1]
    return data['업체PN'].iloc[related_docs_indices].tolist()

@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        input1 = request.form['part_code']
        similar_parts = find_similar_parts(input1)
        return render_template('index.html', part_code=input1, similar_parts=similar_parts)
    return render_template('index.html')

if __name__ == '__main__':
    app.run(debug=True)
