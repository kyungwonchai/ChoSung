설정 파일 수정
생성된 ecosystem.config.js 파일을 열고, apps 부분을 아래와 같이 maskrack-api-server에 맞게 수정합니다.

JavaScript

// ecosystem.config.js
module.exports = {
  apps : [{
    name   : "maskrack-api-server", // 1. PM2에서 사용할 이름
    script : "./server.js",         // 2. 실행할 스크립트 파일
    watch  : false,                 // 3. 파일 변경 감지 후 자동 재시작 여부 (개발 시 true 유용)
    env    : {
       "NODE_ENV": "development",
    },
    env_production: {
       "NODE_ENV": "production",
       "API_PORT": 3000              // 4. 운영 환경용 환경 변수 설정
    }
  }]
}
설정 파일로 서버 시작
이제 server.js 파일 대신 설정 파일을 이용하여 서버를 시작합니다. --env production 옵션으로 env_production에 설정된 환경변수를 사용하도록 지정할 수 있습니다.

Bash

# production 환경으로 서버 시작
pm2 start ecosystem.config.js --env production

# 서버 재시작, 중지 등 모든 명령어는 기존과 동일하게 --name으로 지정한 이름을 사용합니다.
pm2 restart maskrack-api-server
pm2 logs maskrack-api-server
이제 maskrack-api-server는 PM2의 관리를 받으며, 훨씬 안정적으로 운영될 준비가 되었습니다. 코드를 수정한 후에는 pm2 restart maskrack-api-server 명령어로 변경 사