래는 요청에 따라 키를 t1 값과 묶어 저장하고, AG 열에 키값을 출력하도록 수정된 코드입니다. 각 키는 t1_키 형태로 저장됩니다.

vba
코드 복사
Sub ProcessSheetData()
    Dim lastRow As Long
    Dim currentRow As Long
    Dim dict As Object
    Dim t1 As String
    Dim key As String
    Dim combinedKey As String
    Dim col As Integer
    Dim tempArr As Variant

    ' 딕셔너리 생성
    Set dict = CreateObject("Scripting.Dictionary")

    ' C3부터 B100000의 마지막 행까지 확인
    lastRow = 주차2_시트.Cells(주차2_시트.Rows.Count, "B").End(xlUp).Row

    ' 초기 t1 값
    t1 = ""

    ' C3부터 마지막 행까지 반복
    For currentRow = 3 To lastRow
        ' C열 값 가져오기
        Dim cValue As String
        cValue = Trim(주차2_시트.Cells(currentRow, "C").Value)

        ' C열 값이 빈 값이 아니면 t1 업데이트
        If cValue <> "" Then
            t1 = cValue
        End If

        ' D열에서 키 추출
        Dim dValue As String
        dValue = Trim(주차2_시트.Cells(currentRow, "D").Value)
        key = GetKey(dValue)

        ' t1과 키를 묶어서 새로운 키 생성
        If t1 <> "" And key <> "" Then
            combinedKey = t1 & "_" & key

            ' 딕셔너리에 키가 없으면 초기화
            If Not dict.exists(combinedKey) Then
                dict(combinedKey) = Array(0, 0, 0, 0, 0, 0) ' F~K 열 초기값
            End If

            ' 딕셔너리에서 배열 복사
            tempArr = dict(combinedKey)

            ' F~K 열 값을 배열에 합산
            For col = 1 To 6
                tempArr(col - 1) = tempArr(col - 1) + Val(주차2_시트.Cells(currentRow, 6 + col).Value)
            Next col

            ' 수정된 배열을 다시 딕셔너리에 저장
            dict(combinedKey) = tempArr

            ' AG 열에 키값 출력
            주차2_시트.Cells(currentRow, "AG").Value = combinedKey

            ' AH 열부터 딕셔너리 값 출력
            For col = 1 To 6
                주차2_시트.Cells(currentRow, 33 + col).Value = tempArr(col - 1)
            Next col
        End If
    Next currentRow

    MsgBox "작업 완료!", vbInformation
End Sub

' 키를 추출하는 함수
Function GetKey(value As String) As String
    Dim i As Long
    Dim char As String
    Dim keyStart As Long
    Dim keyEnd As Long

    keyStart = 0
    keyEnd = InStr(1, value, "/") - 1 ' / 위치 전까지

    If keyEnd > 0 Then
        For i = keyEnd To 1 Step -1
            char = Mid(value, i, 1)
            ' 첫 번째 영어 문자를 발견한 위치
            If char Like "[A-Za-z]" Then
                keyStart = i
                Exit For
            End If
        Next i
    End If

    ' 키 추출
    If keyStart > 0 And keyEnd > 0 Then
        GetKey = Mid(value, keyStart, keyEnd - keyStart + 1)
    Else
        GetKey = "" ' 키가 없으면 빈 문자열 반환
    End If
End Function
주요 변경점
키 묶기:

키를 t1과 결합하여 t1_키 형태로 저장합니다.
결합된 키는 combinedKey 변수에 저장됩니다.
AG 열에 키값 출력:

combinedKey 값을 현재 행의 AG 열에 출력합니다.
딕셔너리 작업:

combinedKey를 딕셔너리의 키로 사용하여 데이터 저장 및 합산을 처리합니다.
사용 방법
코드 삽입:

Excel VBA 편집기(Alt + F11)에서 새 모듈을 삽입하고 코드를 붙여넣습니다.
매크로 실행:

Alt + F8을 눌러 ProcessSheetData 매크로를 실행합니다.
결과 확인:

AG 열에 t1_키 값이 출력됩니다.