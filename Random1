럼 이름을 변경한 새로운 스토어드 프로시저 예시를 드리겠습니다.
MS SQL 스토어드 프로시저 예시

sql

CREATE PROCEDURE sp_InsertOrUpdate
    @N_datek DATE,
    @C_Site_Name NVARCHAR(50),
    @C_Resource_Name NVARCHAR(50),
    @C_Basic_Name__Fix_ NVARCHAR(50)
AS
BEGIN
    DECLARE @sql NVARCHAR(MAX);
    DECLARE @updateCols NVARCHAR(MAX);
    
    -- 업데이트 할 컬럼 명을 가져옵니다.
    SELECT @updateCols = STRING_AGG(column_name, ' = source.' + column_name + ', ') 
    FROM information_schema.columns 
    WHERE table_name = '메인확정' 
    AND column_name NOT IN ('N_datek', 'C_Site_Name', 'C_Resource_Name', 'C_Basic_Name__Fix_');

    -- 마지막 콤마(,) 제거
    SET @updateCols = LEFT(@updateCols, LEN(@updateCols) - 1);

    SET @sql = 'MERGE INTO 메인확정 AS target
                USING (SELECT @N_datek as N_datek, @C_Site_Name as C_Site_Name, @C_Resource_Name as C_Resource_Name, @C_Basic_Name__Fix_ as C_Basic_Name__Fix_) AS source
                ON target.N_datek = source.N_datek AND target.C_Site_Name = source.C_Site_Name AND target.C_Resource_Name = source.C_Resource_Name AND target.C_Basic_Name__Fix_ = source.C_Basic_Name__Fix_
                WHEN MATCHED THEN 
                    UPDATE SET ' + @updateCols +
                'WHEN NOT MATCHED THEN
                    INSERT (N_datek, C_Site_Name, C_Resource_Name, C_Basic_Name__Fix_) VALUES (@N_datek, @C_Site_Name, @C_Resource_Name, @C_Basic_Name__Fix_);';

    EXEC sp_executesql @sql, 
                       N'@N_datek DATE, @C_Site_Name NVARCHAR(50), @C_Resource_Name NVARCHAR(50), @C_Basic_Name__Fix_ NVARCHAR(50)',
                       @N_datek, @C_Site_Name, @C_Resource_Name, @C_Basic_Name__Fix_;
END

간단한 설명을 드리면, 이 스토어드 프로시저는 N_datek, C_Site_Name, C_Resource_Name, C_Basic_Name__Fix_ 이 네 개의 컬럼을 키로 사용합니다. 이 키가 중복되면 나머지 모든 컬럼을 업데이트하고, 중복되지 않으면 새로운 레코드를 삽입합니