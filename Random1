using System;
using System.Data;
using Excel = Microsoft.Office.Interop.Excel;

public DataTable ProcessExcel()
{
    // 1. Excel 파일 열기
    Excel.Application xlApp = new Excel.Application();
    Excel.Workbook xlWorkbook = xlApp.Workbooks.Open(@"your_file_path_here.xlsx");
    Excel._Worksheet xlWorksheet = xlWorkbook.Sheets[1];
    Excel.Range xlRange = xlWorksheet.UsedRange;

    DataTable dt = new DataTable();
    
    // 2행의 값들 중에서 "Basic 모델" 및 "설계변경단계" 값이 있는 컬럼의 인덱스 찾기
    int basicModelIndex = -1;
    int designChangeIndex = -1;
    for (int i = 1; i <= xlRange.Columns.Count; i++)
    {
        if (xlRange.Cells[2, i].Value2.ToString() == "Basic 모델")
            basicModelIndex = i;
        if (xlRange.Cells[2, i].Value2.ToString() == "설계변경단계")
            designChangeIndex = i;
    }

    if (basicModelIndex != -1 && designChangeIndex != -1)
    {
        dt.Columns.Add("Basic 모델");
        dt.Columns.Add("설계변경단계");

        // 3행부터 끝행까지의 데이터 저장
        for (int i = 3; i <= xlRange.Rows.Count; i++)
        {
            DataRow dr = dt.NewRow();
            dr["Basic 모델"] = xlRange.Cells[i, basicModelIndex].Value2?.ToString() ?? "";
            dr["설계변경단계"] = xlRange.Cells[i, designChangeIndex].Value2?.ToString() ?? "";
            dt.Rows.Add(dr);
        }
    }

    // 메모리 해제
    xlWorkbook.Close();
    xlApp.Quit();

    return dt; // DataTable 반환
}
