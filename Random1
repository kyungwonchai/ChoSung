using DevExpress.XtraGrid.Columns;
using DevExpress.XtraGrid.Views.Grid;
using DevExpress.XtraEditors.Repository;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Drawing;
using System.Windows.Forms;

namespace HandleChecker
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            gridControl1.DataSource = GetProcessesData();

            GridView view = gridControl1.MainView as GridView;

            // 프로그레스바 컬럼 설정
            GridColumn progressBarColumn = view.Columns.AddVisible("Progress");
            progressBarColumn.Caption = "핸들 수";
            RepositoryItemProgressBar repoProgressBar = new RepositoryItemProgressBar();
            repoProgressBar.StartColor = Color.SkyBlue;
            repoProgressBar.EndColor = Color.SkyBlue;
            progressBarColumn.ColumnEdit = repoProgressBar;
            progressBarColumn.UnboundType = DevExpress.Data.UnboundColumnType.Integer;
            progressBarColumn.UnboundExpression = "[HandleCount] / 2000"; // 핸들 수에 따른 프로그레스바 조절
        }

        // 프로세스 데이터 가져오기
        private List<ProcessInfo> GetProcessesData()
        {
            List<ProcessInfo> processList = new List<ProcessInfo>();

            foreach (Process process in Process.GetProcesses())
            {
                try
                {
                    processList.Add(new ProcessInfo
                    {
                        ProcessName = process.ProcessName,
                        HandleCount = process.HandleCount
                    });
                }
                catch (Exception)
                {
                    // 핸들 수를 얻을 수 없는 경우 무시
                }
            }

            return processList;
        }

        // 프로세스 정보를 저장하는 클래스
        public class ProcessInfo
        {
            public string ProcessName { get; set; }
            public int HandleCount { get; set; }
        }
    }
}
