ì œ ì›ì¸
SelectedUser ë³€ê²½ ì‹œ ê´€ë ¨ëœ ManagementItemsê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•ŠìŒ.

ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ìì˜ ê²½ìš° ê¸°ë³¸ ManagementItems(3ê°œ) ìë™ ìƒì„± ë¡œì§ì´ í¬í•¨ë˜ì§€ ì•ŠìŒ.

ì‚¬ìš©ìê°€ ìƒˆë¡œ ì¶”ê°€ë˜ë©´ ManagementItemsë¥¼ DBë¡œë¶€í„° ê°€ì ¸ì˜¤ê±°ë‚˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¶”ê°€í•´ì•¼ í•¨.

UIì™€ ViewModelì˜ ë°ì´í„° ë°”ì¸ë”©ì´ ì œëŒ€ë¡œ ë™ê¸°í™”ë˜ì§€ ì•ŠìŒ.

âœ… ìˆ˜ì • ë°©ë²•
MainViewModel.csì—ì„œ SelectedUser ë³€ê²½ ì‹œ ê´€ë ¨ëœ ManagementItemsë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œí•˜ê±°ë‚˜ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¶”ê°€.

ì‚¬ìš©ì ì¶”ê°€ ì‹œ ê¸°ë³¸ ManagementItems 3ê°œë¥¼ ìë™ìœ¼ë¡œ ì¶”ê°€.

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê¸°ì¡´ ì‚¬ìš©ìì˜ ManagementItemsë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œ.

ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ìëŠ” DBì— ì¶”ê°€ë˜ê¸° ì „ì—ë„ ê¸°ë³¸ê°’ìœ¼ë¡œ 3ê°œê°€ ìë™ ìƒì„±ë˜ë„ë¡ ì„¤ì •.

ğŸ”¥ ìˆ˜ì •ëœ ì½”ë“œ ì œê³µ (ì£¼ì„ í¬í•¨)
ğŸ“ MainViewModel.cs (ìˆ˜ì •ë¨)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Windows.Input;
using WPF_DevExpress_Locker_Management.Models;
using WPF_DevExpress_Locker_Management.Services;

namespace WPF_DevExpress_Locker_Management.ViewModels
{
    public class MainViewModel : INotifyPropertyChanged
    {
        private readonly DataRepository _dataRepository;
        public ObservableCollection<User> Users { get; set; }

        private User _selectedUser;
        public User SelectedUser
        {
            get => _selectedUser;
            set
            {
                _selectedUser = value;
                OnPropertyChanged(nameof(SelectedUser));

                if (_selectedUser != null)
                {
                    LoadOrInitializeManagementItems(_selectedUser);
                }
            }
        }

        public ICommand AddUserCommand { get; }
        public ICommand DeleteUserCommand { get; }
        public ICommand SaveAllCommand { get; }

        public MainViewModel()
        {
            _dataRepository = new DataRepository();
            Users = new ObservableCollection<User>(_dataRepository.GetUsers());

            AddUserCommand = new RelayCommand(AddUser);
            DeleteUserCommand = new RelayCommand(DeleteUser);
            SaveAllCommand = new RelayCommand(SaveAll);
        }

        /// <summary>
        /// ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        /// - ìƒˆë¡œìš´ ì‚¬ìš©ì ì¶”ê°€ ì‹œ ê¸°ë³¸ ê´€ë¦¬ í•­ëª© 3ê°œ ìë™ ìƒì„±
        /// </summary>
        private void AddUser()
        {
            var newUser = new User
            {
                UserId = Guid.NewGuid(),
                Name = "New User",
                KnoxId = "NewKnoxId"
            };

            // ê¸°ë³¸ ê´€ë¦¬ í•­ëª© 3ê°œ ìë™ ì¶”ê°€
            newUser.ManagementItems = new ObservableCollection<ManagementItem>
            {
                new ManagementItem { Name = "Locker", IsActive = false },
                new ManagementItem { Name = "Shoe Cabinet", IsActive = false },
                new ManagementItem { Name = "Cabinet", IsActive = false }
            };

            Users.Add(newUser);
            _dataRepository.AddUser(newUser);
            SelectedUser = newUser; // ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ìë¥¼ ì„ íƒ ìƒíƒœë¡œ ì„¤ì •
        }

        /// <summary>
        /// ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
        /// </summary>
        private void DeleteUser()
        {
            if (SelectedUser != null)
            {
                _dataRepository.DeleteUser(SelectedUser.UserId);
                Users.Remove(SelectedUser);
            }
        }

        /// <summary>
        /// ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        /// - ì‚¬ìš©ì ì •ë³´ì™€ ê´€ë¦¬ í•­ëª©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
        /// </summary>
        private void SaveAll()
        {
            if (SelectedUser != null)
            {
                _dataRepository.SaveUser(SelectedUser);
                _dataRepository.SaveManagementItems(SelectedUser.UserId, SelectedUser.ManagementItems);
            }
        }

        /// <summary>
        /// ì‚¬ìš©ì ë³€ê²½ ì‹œ í•´ë‹¹ ì‚¬ìš©ìì˜ ManagementItemsë¥¼ ë¡œë“œí•˜ê±°ë‚˜ ì´ˆê¸°í™”
        /// </summary>
        private void LoadOrInitializeManagementItems(User user)
        {
            var loadedItems = _dataRepository.GetManagementItems(user.UserId);

            if (loadedItems.Any())
            {
                user.ManagementItems = loadedItems; // ê¸°ì¡´ ì‚¬ìš©ìëŠ” DBì— ì €ì¥ëœ í•­ëª© ì‚¬ìš©
            }
            else
            {
                user.ManagementItems = new ObservableCollection<ManagementItem>
                {
                    new ManagementItem { Name = "Locker", IsActive = false },
                    new ManagementItem { Name = "Shoe Cabinet", IsActive = false },
                    new ManagementItem { Name = "Cabinet", IsActive = false }
                };
                _dataRepository.SaveManagementItems(user.UserId, user.ManagementItems); // ê¸°ë³¸ê°’ì„ DBì— ì €ì¥
            }

            OnPropertyChanged(nameof(SelectedUser));
        }

        public event PropertyChangedEventHandler PropertyChanged;
        protected void OnPropertyChanged(string name) => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
    }
}
âœ… ì„¤ëª…
LoadOrInitializeManagementItems() í•¨ìˆ˜ ì¶”ê°€ë¨

ì‚¬ìš©ìê°€ ì„ íƒë  ë•Œë§ˆë‹¤ í˜¸ì¶œë¨.

ê¸°ì¡´ ì‚¬ìš©ìëŠ” DBì—ì„œ ManagementItemsë¥¼ ë¶ˆëŸ¬ì˜´.

ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ìëŠ” ê¸°ë³¸ê°’(Locker, Shoe Cabinet, Cabinet)ì„ DBì— ì €ì¥.

AddUser() í•¨ìˆ˜ ìˆ˜ì •ë¨

ì‚¬ìš©ì ì¶”ê°€ ì‹œ ê¸°ë³¸ ManagementItems 3ê°œê°€ ìë™ìœ¼ë¡œ ì¶”ê°€ë¨.

ìƒˆë¡œ ì¶”ê°€ëœ ì‚¬ìš©ìëŠ” ê¸°ë³¸ê°’ì´ ìë™ìœ¼ë¡œ DBì— ì €ì¥ë¨.

SaveAll() í•¨ìˆ˜ ìˆ˜ì •ë¨

ì‚¬ìš©ìì˜ ëª¨ë“  ì •ë³´ë¥¼ ì €ì¥í•  ë•Œ, ê´€ë ¨ ManagementItemsë„ í•¨ê»˜ ì €ì¥ë¨.

ğŸ“Œ ì‚¬ìš© ë°©ë²•
ì¢Œì¸¡ ì‚¬ìš©ì ëª©ë¡ì—ì„œ ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ê´€ë ¨ ManagementItemsê°€ ë¡œë“œë¨.

ë§Œì•½ ê´€ë ¨ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ìë™ ìƒì„±ë˜ë©°, DBì— ìë™ ì €ì¥ë¨.

ìˆ˜ì • í›„ Save Changes ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ì €ì¥ë¨.
