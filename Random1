이 필드를 추가하고, 이미 추가된 필드는 건너뛰도록 수정하겠습니다.

vba

Sub UpdatePivotTableWithSpecificFields()
    Dim ws As Worksheet
    Dim pt As PivotTable
    Dim pf As PivotField
    Dim field As String
    Dim dataFieldExists As Boolean

    ' "SOP 14주" 시트 설정
    Set ws = ThisWorkbook.Sheets("SOP 14주")

    ' "피벗테이블1" 피벗 테이블 설정
    Set pt = ws.PivotTables("피벗테이블1")

    ' "구분2"를 행 필드로 설정
    Set pf = pt.PivotFields("구분2")
    pf.Orientation = xlRowField
    pf.Position = 1

    ' 피벗 필드를 순회하면서 조건에 맞는 필드를 값 영역에 추가
    For Each pf In pt.PivotFields
        field = pf.Name
        ' 필드 이름이 6자리 숫자이며 2로 시작하는 경우
        If Len(field) = 6 And IsNumeric(field) And Left(field, 1) = "2" Then
            ' 이미 값 필드에 추가되었는지 확인
            dataFieldExists = False
            For Each dataField In pt.DataFields
                If dataField.SourceName = field Then
                    dataFieldExists = True
                    Exit For
                End If
            Next dataField

            ' 값 필드에 아직 추가되지 않았다면 추가
            If Not dataFieldExists Then
                pt.AddDataField pt.PivotFields(field), field, xlSum
            End If
        End If
    Next pf
End Sub

이 코드는 "SOP 14주" 시트의 "피벗테이블1"에서 "구분2"를 행 필드로 설정하고, 조건에 맞는 새로운 필드만 값을 영역에 합계로 추가합니다. 이미 추가된 필드는 건너뛰도록 설정되어 있습니다. VBA 편집기에 이 코드