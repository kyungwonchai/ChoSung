아래는 사용자가 요청한 내용을 충족하는 MSSQL2014 쿼리입니다. Table_modelchangeFullName 테이블에서 time1 순으로 정렬한 다음, 이전 행의 time1 값을 time1before라는 컬럼에 두고, 현재 행의 modeltime3 값이 이전 행의 time1 값보다 작으면 compare1 컬럼에 1을 설정하는 쿼리입니다.

sql
코드 복사
WITH CTE AS (
    SELECT 
        ipadd3, 
        modelname3, 
        modeltime3, 
        no3, 
        time1,
        LAG(time1) OVER (ORDER BY time1) AS time1before
    FROM Table_modelchangeFullName
)
SELECT 
    ipadd3, 
    modelname3, 
    modeltime3, 
    no3, 
    time1, 
    time1before,
    CASE 
        WHEN modeltime3 < time1before THEN 1 
        ELSE 0 
    END AS compare1
FROM CTE;
설명:
LAG() 함수 사용:

LAG() 함수는 현재 행 이전의 값을 가져옵니다.
OVER (ORDER BY time1)를 통해 time1 기준으로 이전 행의 값을 가져옵니다.
WITH CTE:

공통 테이블 표현식(CTE)을 사용하여 이전 행의 time1 값을 계산합니다.
CASE 문:

modeltime3 값이 time1before보다 작으면 compare1에 1을 설정하고, 그렇지 않으면 0을 설정합니다.
결과 컬럼:

최종 결과에 time1, time1before, compare1을 포함하여 각 행의 비교 결과를 확인할 수 있습니다.
출력 예시:
ipadd3	modelname3	modeltime3	no3	time1	time1before	compare1
192.168.0.1	ModelA	2024-12-01	1	2024-12-01 10:00	NULL	0
192.168.0.2	ModelB	2024-11-30	2	2024-12-01 11:00	2024-12-01 10:00	1