Sub ResetAndSetupPivotTable()
    Dim ws As Worksheet
    Dim pt As PivotTable
    Dim pf As PivotField
    Dim field As String
    
    ' "SOP 14주" 시트 설정
    Set ws = ThisWorkbook.Sheets("SOP 14주")

    ' 기존 피벗 테이블 삭제 (있을 경우)
    For Each pt In ws.PivotTables
        If pt.Name = "피벗테이블1" Then
            pt.TableRange2.Clear
        End If
    Next pt

    ' 새 피벗 테이블 생성
    Set pt = ws.PivotTables.Add(PivotCache:=ThisWorkbook.PivotCaches.Create( _
        SourceType:=xlDatabase, SourceData:=ws.UsedRange), TableDestination:=ws.Range("A1"), _
        TableName:="피벗테이블1")

    ' "구분2"를 행 필드로 설정
    Set pf = pt.PivotFields("구분2")
    pf.Orientation = xlRowField
    pf.Position = 1

    ' 피벗 필드를 순회하면서 조건에 맞는 필드를 값 영역에 합계로 추가
    For Each pf In pt.PivotFields
        field = pf.Name
        If Len(field) = 6 And IsNumeric(field) And Left(field, 1) = "2" Then
            ' 해당 필드를 값 영역에 합계로 추가
            pt.AddDataField pt.PivotFields(field), "Sum of " & field, xlSum
        End If
    Next pf
End Sub
