녕하세요. 우분투에서 현재 사용 중인 모든 포트를 방화벽에 등록하고 활성화하는 방법을 안내해 드리겠습니다.

🚨 매우 중요: 실행 전 주의사항

원격 접속(SSH) 차단 위험: 아래 명령어를 실행하기 전에 SSH 포트(기본값: 22)를 먼저 허용해야 합니다. 그렇지 않으면 방화벽이 활성화되는 순간 원격 접속이 끊겨 서버에 접근하지 못할 수 있습니다.

보안 위험: 현재 열려있는 모든 포트를 무조건 허용하는 것은 보안상 권장되지 않습니다. 일시적으로 사용되거나 내부 통신에만 필요한 포트까지 외부에 노출될 수 있기 때문입니다. 반드시 필요한 서비스 포트만 선별하여 허용하는 것이 가장 안전합니다.

1단계: SSH 포트 및 필수 포트 먼저 허용하기
가장 먼저 원격 접속이 끊기지 않도록 SSH 포트를 방화벽에 허용 규칙으로 추가합니다. 웹 서버(80, 443) 등 다른 필수 서비스가 있다면 함께 추가해 주세요.

Bash

# SSH 포트 허용 (필수!)
sudo ufw allow ssh

# 또는 포트 번호로 직접 지정
sudo ufw allow 22/tcp

# 웹서버를 운영하는 경우 (예시)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
2단계: 현재 사용 중인 모든 포트 확인 및 방화벽에 등록
아래 스크립트는 현재 시스템에서 수신 대기(LISTEN) 상태인 모든 TCP 및 UDP 포트를 찾아 UFW(우분투 기본 방화벽)에 허용 규칙을 한 번에 추가합니다.

터미널에 아래 명령어를 그대로 복사하여 붙여넣고 실행하세요.

Bash

# 현재 LISTEN 상태인 모든 포트를 찾아 ufw allow 규칙을 자동으로 추가하는 스크립트
for port in $(sudo ss -lntu | awk 'NR>1 {print $5}' | sed 's/.*:\([0-9]*\)/\1/' | sort -u); do 
  echo "Adding rule for port: $port"
  sudo ufw allow $port
done
위 스크립트는 다음 작업을 수행합니다.

ss -lntu: 현재 LISTEN 상태인 모든 TCP/UDP 포트를 조회합니다.

awk, sed, sort: 포트 번호만 정확히 추출하고 중복을 제거합니다.

for 루프: 추출된 각 포트 번호에 대해 sudo ufw allow [포트번호] 명령을 자동으로 실행합니다.

3단계: 방화벽 활성화 및 상태 확인
모든 규칙이 추가되었다면, 마지막으로 방화벽을 활성화하고 적용된 규칙 목록을 확인합니다.

Bash

# 방화벽 활성화
sudo ufw enable

# 방화벽 활성화 시 시스템 시작 시에도 자동으로 실행됩니다.
# 계속 진행하려면 'y'를 입력하세요.

# 방화벽 상태 및 등록된 규칙 확인