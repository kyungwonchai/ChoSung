using DevExpress.XtraPivotGrid;
using DevExpress.Data;

// 버튼 클릭 이벤트 핸들러
private void btnCalculate_Click(object sender, EventArgs e)
{
    // MSSQL에서 데이터 추리하는 로직

    // PivotGridControl 설정
    pivotGrid.BeginUpdate();
    pivotGrid.DataSource = table_rpa_runlog; // 추리한 데이터를 바인딩

    // 필드 설정
    PivotGridField fieldDate = new PivotGridField();
    fieldDate.FieldName = "rpastart"; // 날짜 필드
    fieldDate.Caption = "날짜";
    fieldDate.Area = PivotArea.RowArea;
    fieldDate.GroupInterval = PivotGroupInterval.Date; // 날짜별 그룹화
    pivotGrid.Fields.Add(fieldDate);

    PivotGridField fieldTotalCount = new PivotGridField();
    fieldTotalCount.FieldName = "mailok"; // 총 횟수 필드
    fieldTotalCount.Caption = "총 횟수";
    fieldTotalCount.Area = PivotArea.DataArea;
    fieldTotalCount.SummaryType = PivotSummaryType.Count;
    pivotGrid.Fields.Add(fieldTotalCount);

    PivotGridField fieldSuccessCount = new PivotGridField();
    fieldSuccessCount.FieldName = "mailok"; // 성공 횟수 필드
    fieldSuccessCount.Caption = "성공 횟수";
    fieldSuccessCount.Area = PivotArea.DataArea;
    fieldSuccessCount.SummaryType = PivotSummaryType.Count;
    fieldSuccessCount.FilterValues.Add(true); // 성공인 경우 필터링
    pivotGrid.Fields.Add(fieldSuccessCount);

    PivotGridField fieldSuccessRate = new PivotGridField();
    fieldSuccessRate.Caption = "성공율";
    fieldSuccessRate.Area = PivotArea.DataArea;
    fieldSuccessRate.SummaryType = PivotSummaryType.Custom; // 사용자 정의 집계
    fieldSuccessRate.CustomTotalSummary += (s, ev) =>
    {
        if (ev.DataField == fieldSuccessRate)
        {
            int totalCount = 0;
            int successCount = 0;
            for (int i = 0; i < ev.RowFieldValues.Length; i++)
            {
                PivotFieldValueEventArgs rowField = ev.RowFieldValues[i];
                PivotFieldValueEventArgs colField = ev.ColumnFieldValues[i];
                if (rowField.Value != null && colField.Value != null)
                {
                    totalCount += Convert.ToInt32(pivotGrid.GetCellValue(ev.DataField, rowField,

User
이어
ChatGPT

colField, null));
successCount += Convert.ToInt32(pivotGrid.GetCellValue(fieldSuccessCount, rowField, colField, null));
}
}
if (totalCount > 0)
{
ev.CustomValue = (double)successCount / totalCount; // 성공율 계산
}
}
};
pivotGrid.Fields.Add(fieldSuccessRate);

scss

pivotGrid.EndUpdate();
