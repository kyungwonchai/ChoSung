립트를 하나로 합쳐 드립니다.

이 스크립트를 실행하면 my_service.py와 my_service.service가 생성되고 즉시 서비스로 등록됩니다.

Python

import os

# 1. 파이썬 스크립트 내용 (5분 루프 예시)
python_script_content = """
import time
import sys
import datetime

def main():
    print(f"[{datetime.datetime.now()}] 서비스가 시작되었습니다.")
    sys.stdout.flush() # 즉시 출력 보장
    
    try:
        while True:
            # 작업 수행 구간
            print(f"[{datetime.datetime.now()}] 5분 주기 작업 수행 중...")
            
            # 5분 대기 (300초)
            time.sleep(300)
            
    except KeyboardInterrupt:
        print("사용자에 의해 종료되었습니다.")
    except Exception as e:
        print(f"에러 발생: {e}")
    finally:
        print("서비스가 종료됩니다.")

if __name__ == "__main__":
    main()
"""

# 2. systemd 서비스 설정 내용
service_config_content = f"""[Unit]
Description=Kyungwon's 5min Loop Service
After=network.target

[Service]
# -u 옵션은 버퍼링 없이 즉시 로그를 journalctl에 찍어줍니다.
ExecStart=/usr/bin/python3 -u {os.getcwd()}/my_service.py
WorkingDirectory={os.getcwd()}
StandardOutput=inherit
StandardError=inherit
Restart=always
RestartSec=10
User={os.getlogin()}

[Install]
WantedBy=multi-user.target
"""

def setup_service():
    # 파일 생성
    with open("my_service.py", "w") as f:
        f.write(python_script_content.strip())
    
    with open("my_service.service", "w") as f:
        f.write(service_config_content.strip())
    
    print("--- 파일 생성 완료 ---")
    
    # 서비스 등록 및 시작 명령어 안내
    print("\\n[실행 방법] 아래 명령어를 순서대로 입력하세요:")
    print(f"1. sudo cp {os.getcwd()}/my_service.service /etc/systemd/system/")
    print("2. sudo systemctl daemon-reload")
    print("3. sudo systemctl enable my_service.service")
    print("4. sudo systemctl start my_service.service")
    print("\\n[로그 확인]")
    print("sudo journalctl -u my_service.service -f")

if __name__ == "__main__":
    setup_service()
3. 조치해야 할 핵심 포인트
파이썬 실행 옵션 변경: python3 뒤에 반드시 **-u**를 붙여서 실행하세요 (python3 -u script.py). 그래야 journalctl에서 멍 때리는 현상이 사라집니다.

Restart=always 확인: 서비스 파일에 이 설정이 있으면 종료되어도 다시 살아나지만, 종료 원인(에러)을 먼저 잡아야 합니다.

종료 코드 확인: 스크립트 내부에서 while True 루프가 의도치 않게 깨지는 구간이 없는지 확인하세요. (예: 예외 처리(try-except)가 없어 에러 발생 시 프로세스 종료)

위 스크립트를 실행해서 서비스를 다시 등록해 보시겠어요? 이렇게 하면 로그가 실시간으로 찍히기 때문에, 왜 종료 신호가 가는지 정확한 에러 메시지를 journalctl에서 확인하실 수 있을 겁니다.

혹시 서비스 파일 설정 중에 특이한 옵션(예: Type=notify)을 사용 중이신가요? 원하신다면 현재 사용 중인 .service 파일 내용을 보여주시면 더 정확히 봐 드릴 수 있습니다.