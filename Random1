Sub CopyPlanToSPI()
    Dim fd As FileDialog
    Dim FileSelected As Variant
    Dim wb1 As Workbook, wb2 As Workbook
    Dim sourceSheet As Worksheet, targetSheet As Worksheet

    ' 파일 선택 대화 상자 설정
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .AllowMultiSelect = True
        .Title = "두 개의 파일 선택: '통합계획'과 'SOP'로 시작하는 파일"
        .Filters.Clear
        .Filters.Add "Excel Files", "*.xlsx, *.xls"

        ' 사용자가 파일을 선택하면 열기
        If .Show = True Then
            For Each FileSelected In .SelectedItems
                If InStr(FileSelected, "통합계획") > 0 Then
                    Set wb1 = Workbooks.Open(FileSelected)
                ElseIf InStr(FileSelected, "SOP") > 0 Then
                    Set wb2 = Workbooks.Open(FileSelected)
                End If
            Next FileSelected
        Else
            MsgBox "파일이 선택되지 않았습니다."
            Exit Sub
        End If
    End With

    ' "당주계획" 시트를 찾아 "SPI계획"에 복사
    If Not wb1 Is Nothing Then
        Set sourceSheet = wb1.Sheets("당주계획")
        Set targetSheet = wb2.Sheets.Add(After:=wb2.Sheets(wb2.Sheets.Count))
        targetSheet.Name = "당주계획1"
        
        sourceSheet.Cells.Copy Destination:=targetSheet.Cells
    Else
        MsgBox "'통합계획'으로 시작하는 파일이 없습니다."
    End If

    ' 파일 닫기
    wb1.Close SaveChanges:=False
    wb2.Close SaveChanges:=True
End Sub
