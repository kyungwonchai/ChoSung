CREATE FUNCTION dbo.SplitString
(
    @String VARCHAR(MAX),
    @Delimiter CHAR(1)
)
RETURNS @Result TABLE (Value VARCHAR(MAX))
AS
BEGIN
    DECLARE @StartIndex INT, @EndIndex INT
    SET @StartIndex = 1
    SET @EndIndex = CHARINDEX(@Delimiter, @String)

    WHILE @EndIndex > 0
    BEGIN
        INSERT INTO @Result (Value)
        SELECT SUBSTRING(@String, @StartIndex, @EndIndex - @StartIndex)

        SET @StartIndex = @EndIndex + 1
        SET @EndIndex = CHARINDEX(@Delimiter, @String, @StartIndex)
    END

    INSERT INTO @Result (Value)
    SELECT SUBSTRING(@String, @StartIndex, LEN(@String) - @StartIndex + 1)

    RETURN
END
