BA에서 FormulaArray 속성을 사용할 때 일반적으로 셀 하나에만 설정할 수 있으며, 여러 셀에 적용하려면 다른 접근 방식이 필요합니다. 이 경우 UNIQUE 및 FILTER 함수는 Excel에서 동적 배열 기능을 사용한 것입니다. VBA에서는 동적 배열 함수를 직접 사용할 수 없기 때문에, 집계용 데이터를 COUNTIFS로 집계한 후 표 형식으로 출력하는 방식을 적용하겠습니다.

아래 코드는 Date1과 Shift1별로 개수를 집계하고, 이를 시트에 기록한 후 차트로 표시하는 방식으로 수정한 것입니다.

수정된 VBA 코드
vba
코드 복사
Sub CreateShift1Chart()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim uniqueDates As Object
    Dim dateCell As Range, shiftCell As Range
    Dim i As Long, j As Long
    Dim dateVal As String, shiftVal As String
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    ' 중복 없는 Date1 및 Shift1 목록 생성
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            If Not uniqueDates.exists(dateVal & "_" & shiftVal) Then
                uniqueDates(dateVal & "_" & shiftVal) = 0
            End If
            uniqueDates(dateVal & "_" & shiftVal) = uniqueDates(dateVal & "_" & shiftVal) + 1
        End If
    Next i
    
    ' 요약 데이터 시트에 작성
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    i = 2
    For Each key In uniqueDates.keys
        summaryWs.Cells(i, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(i, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(i, 3).Value = uniqueDates(key)   ' Count 값
        i = i + 1
    Next key
    
    ' 차트 생성
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "Date1별 Shift1의 개수"
    End With
End Sub
코드 설명
중복 없는 Date1 및 Shift1 데이터 수집: Dictionary를 사용하여 Date1과 Shift1별로 Dup = 1인 데이터의 개수를 집계합니다.
Summary 시트에 데이터 기록: Summary 시트에 Date1, Shift1, 그리고 개수(Count)를 표 형식으로 기록합니다.