구하신대로 피벗 테이블을 역산한 형태로 각 시트를 순회하며 데이터를 세부 형태로 정리한 후, 하나의 시트에 통합하여 테이블 형태로 결과를 생성하는 매크로를 작성하겠습니다. 이 매크로는 각 시트의 데이터를 읽고 Temperature와 Humidity 데이터를 각각 최대값, 최소값, 평균값이 아닌 개별 데이터로 수집해 첫 번째 시트에 집합적으로 출력합니다.

아래는 피벗 테이블을 세부 데이터로 역산하여 하나의 표로 만드는 VBA 코드입니다.

vba
코드 복사
Sub ReversePivotDataToSheet()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim lastRow As Long
    Dim currentRow As Long
    Dim outputRow As Long
    Dim dateValue As Variant
    Dim wsName As String
    Dim i As Long
    
    ' 첫 번째 시트에 요약 테이블 작성
    Set summaryWs = ThisWorkbook.Sheets(1)
    summaryWs.Cells.Clear ' 요약 시트 내용 초기화
    
    ' 헤더 생성
    summaryWs.Range("A1").Value = "Sheet Name"
    summaryWs.Range("B1").Value = "Date"
    summaryWs.Range("C1").Value = "Type"
    summaryWs.Range("D1").Value = "Value"
    outputRow = 2
    
    ' 모든 시트 순회
    For Each ws In ThisWorkbook.Sheets
        ' 요약 시트는 제외하고 진행
        If ws.Name <> summaryWs.Name Then
            ' 날짜 가져오기
            dateValue = ws.Cells(2, 4).Value ' 2행 D열의 날짜 값
            
            ' 데이터의 마지막 행 찾기
            lastRow = ws.Cells(ws.Rows.Count, 2).End(xlUp).Row
            
            ' Temperature와 Humidity 데이터를 개별 값으로 복사
            For i = 4 To lastRow
                If ws.Cells(i, 2).Value = "Temperature" Or ws.Cells(i, 2).Value = "Humidity" Then
                    ' 데이터 추가
                    summaryWs.Cells(outputRow, 1).Value = ws.Name ' 시트 이름
                    summaryWs.Cells(outputRow, 2).Value = dateValue ' 날짜
                    summaryWs.Cells(outputRow, 3).Value = ws.Cells(i, 2).Value ' Type (Temperature or Humidity)
                    summaryWs.Cells(outputRow, 4).Value = ws.Cells(i, 3).Value ' C열의 개별 측정 값
                    outputRow = outputRow + 1 ' 다음 행으로 이동
                End If
            Next i
        End If
    Next ws
    
    ' 사용자에게 완료 메시지 출력
    MsgBox "모든 시트의 Temperature와 Humidity 데이터를 세부 데이터로 복사하여 완료했습니다.", vbInformation
End Sub
코드 설명
첫 번째 시트 요약: summaryWs는 첫 번째 시트를 지정하여 모든 데이터를 집계하는 시트로 사용합니다. 기존 데이터를 지우고 새로운 결과를 넣습니다.

헤더 생성: Sheet Name, Date, Type, Value 네 가지 열로 요약 테이블을 구성합니다.

시트 순회: 모든 시트를 순회하면서 요약 시트는 제외합니다.

데이터 읽기: 각 시트에서 B열이 Temperature 또는 Humidity인 행의 C열 값을 가져와 날짜와 함께 요약 시트에 추가합니다.

출력: 각 데이터를 첫 번째 시트에 한 줄씩 추가하여 Temperature와 Humidity의 모든 개별 값을 순서대로 나열합니다.

완료 메시지: 작업이 완료되면 메시지를 출력하여 사용자에게 알려줍니다.