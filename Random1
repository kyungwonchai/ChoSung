ì§€ ì˜¤ë¥˜ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

MainViewModel.cs ì˜¤ë¥˜: LoadMasterDataAsync ë©”ì„œë“œ ë‚´ì—ì„œ MasterDataVM.LoadAllMasterData()ë¥¼ í˜¸ì¶œí•˜ëŠ”ë°, MasterDataViewModelì—ëŠ” LoadAllMasterDataAsync()ë¼ëŠ” ë¹„ë™ê¸° ë©”ì„œë“œê°€ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ awaitë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
MainWindow.xaml ì˜¤ë¥˜: DevExpressì˜ GridControl ìì²´ì—ëŠ” IsReadOnly ì†ì„±ì´ ì§ì ‘ì ìœ¼ë¡œ ì—†ìŠµë‹ˆë‹¤. ì½ê¸° ì „ìš© ë™ì‘ì€ ë³´í†µ GridControl.View (ì—¬ê¸°ì„œëŠ” TableView)ì˜ AllowEditing ì†ì„±ì„ Falseë¡œ ì„¤ì •í•˜ê±°ë‚˜, ê°œë³„ GridColumnì˜ ReadOnly ë˜ëŠ” AllowEditing ì†ì„±ì„ ì„¤ì •í•˜ì—¬ ì œì–´í•©ë‹ˆë‹¤. ë¡œê·¸ íƒ­ì˜ ê·¸ë¦¬ë“œëŠ” ì „ì²´ê°€ ì½ê¸° ì „ìš©ì´ì–´ì•¼ í•˜ë¯€ë¡œ, í•´ë‹¹ TableViewì˜ AllowEditing ì†ì„±ì„ Falseë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì˜¬ë°”ë¥¸ ë°©ë²•ì…ë‹ˆë‹¤. (ì´ì „ ì½”ë“œì— ì´ë¯¸ AllowEditing="False"ê°€ ìˆì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ , GridControl íƒœê·¸ì— ë¶ˆí•„ìš”í•˜ê²Œ ì¶”ê°€ëœ IsReadOnlyê°€ ìˆë‹¤ë©´ ì œê±°í•©ë‹ˆë‹¤.)
ì˜¤ë¥˜ê°€ ë°œìƒí•œ ë‘ íŒŒì¼(MainViewModel.cs, MainWindow.xaml)ì˜ ìˆ˜ì •ëœ ì „ì²´ ì½”ë“œë¥¼ ì—¬ê¸°ì— ë°”ë¡œ ì‘ì„±í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

1. ViewModels/MainViewModel.cs (ìˆ˜ì •)

LoadMasterDataAsync ë©”ì„œë“œ ë‚´ë¶€ì˜ MasterDataVM?.LoadAllMasterData(); í˜¸ì¶œì„ await MasterDataVM?.LoadAllMasterDataAsync();ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.

C#

using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Configuration; // AppSettings ì‚¬ìš©
using System.Data.Entity;
using System.Data.Entity.Infrastructure;
using System.Linq;
using System.Security; // SecureString ì‚¬ìš©
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Input;
using System.Runtime.InteropServices; // SecureString ë³€í™˜ìš©

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ë©”ì¸ ViewModel í´ë˜ìŠ¤ (.NET Framework 4.8 ë²„ì „ - ê¸°ëŠ¥ ì¶”ê°€)
    /// </summary>
    public class MainViewModel : ViewModelBase, IDisposable
    {
        private LockerDbContext _context;
        private ObservableCollection<LockerAssignment> _lockerAssignments;
        private LockerAssignment _selectedAssignment;
        private string _statusBarText = "ì¤€ë¹„ ì™„ë£Œ";
        private string _currentAdmin = "í™ê¸¸ë™A";

        // --- ë§ˆìŠ¤í„° í‚¤ ê´€ë ¨ ---
        private SecureString _masterPasswordInput;
        private bool _isMasterModeEnabled = false;

        // --- ë§ˆìŠ¤í„° ë°ì´í„° ëª©ë¡ (ComboBoxìš©) ---
        private ObservableCollection<LockerType> _allLockerTypes;
        private ObservableCollection<Floor> _allFloors;
        private ObservableCollection<Zone> _allZones;
        private ObservableCollection<SubPart> _allSubParts;
        private ObservableCollection<Administrator> _allAdministrators;

        // --- ìì‹ ViewModel ì¸ìŠ¤í„´ìŠ¤ ---
        public MasterDataViewModel MasterDataVM { get; private set; }
        public LogViewModel LogVM { get; private set; }


        #region Public Properties

        public ObservableCollection<LockerAssignment> LockerAssignments
        {
            get => _lockerAssignments;
            set => SetProperty(ref _lockerAssignments, value);
        }

        public LockerAssignment SelectedAssignment
        {
            get => _selectedAssignment;
            set
            {
                if (SetProperty(ref _selectedAssignment, value))
                {
                    ((RelayCommand)DeleteCommand).RaiseCanExecuteChanged();
                    ((RelayCommand)ClearAssignmentCommand).RaiseCanExecuteChanged();
                }
            }
        }

        public string StatusBarText { get => _statusBarText; set => SetProperty(ref _statusBarText, value); }

        public SecureString MasterPasswordInput { get => _masterPasswordInput; set => SetProperty(ref _masterPasswordInput, value); }
        public bool IsMasterModeEnabled { get => _isMasterModeEnabled; set => SetProperty(ref _isMasterModeEnabled, value); }

        public ObservableCollection<LockerType> AllLockerTypes { get => _allLockerTypes; set => SetProperty(ref _allLockerTypes, value); }
        public ObservableCollection<Floor> AllFloors { get => _allFloors; set => SetProperty(ref _allFloors, value); }
        public ObservableCollection<Zone> AllZones { get => _allZones; set => SetProperty(ref _allZones, value); }
        public ObservableCollection<SubPart> AllSubParts { get => _allSubParts; set => SetProperty(ref _allSubParts, value); }
        public ObservableCollection<Administrator> AllAdministrators { get => _allAdministrators; set => SetProperty(ref _allAdministrators, value); }

        #endregion

        #region Commands
        public ICommand LoadDataCommand { get; }
        public ICommand SaveChangesCommand { get; }
        public ICommand AddNewCommand { get; }
        public ICommand DeleteCommand { get; }
        public ICommand ClearAssignmentCommand { get; }
        public ICommand CheckMasterPasswordCommand { get; }
        public ICommand RefreshMasterDataCommand { get; }

        #endregion

        public MainViewModel()
        {
            try { _context = new LockerDbContext(); }
            catch (Exception ex)
            {
                 MessageBox.Show($"ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\n{ex.ToString()}", "ì´ˆê¸°í™” ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                 StatusBarText = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜!";
                 return;
            }

            _lockerAssignments = new ObservableCollection<LockerAssignment>();
            _allLockerTypes = new ObservableCollection<LockerType>();
            _allFloors = new ObservableCollection<Floor>();
            _allZones = new ObservableCollection<Zone>();
            _allSubParts = new ObservableCollection<SubPart>();
            _allAdministrators = new ObservableCollection<Administrator>();

            // ìì‹ ViewModel ìƒì„± ì‹œ DbContext ì „ë‹¬
            MasterDataVM = new MasterDataViewModel(_context);
            LogVM = new LogViewModel(_context);

            // Command ì´ˆê¸°í™”
            LoadDataCommand = new RelayCommand(async _ => await LoadInitialDataAsync());
            SaveChangesCommand = new RelayCommand(async _ => await SaveChangesAsync());
            AddNewCommand = new RelayCommand(AddNewLocker);
            DeleteCommand = new RelayCommand(async _ => await DeleteSelectedAsync(), _ => SelectedAssignment != null);
            ClearAssignmentCommand = new RelayCommand(ClearSelectedAssignment, _ => SelectedAssignment != null && SelectedAssignment.IsAssigned);
            CheckMasterPasswordCommand = new RelayCommand(CheckMasterPassword);
            RefreshMasterDataCommand = new RelayCommand(async _ => await LoadMasterDataAsync());

            // ìƒì„± ì‹œ ë°ì´í„° ë¡œë“œ
            _ = LoadInitialDataAsync();
        }

        /// <summary>
        /// ì´ˆê¸° ë°ì´í„° (ì‚¬ë¬¼í•¨ ë°°ì • ëª©ë¡ ë° ë§ˆìŠ¤í„° ë°ì´í„° ëª©ë¡) ë¡œë“œ
        /// </summary>
        private async Task LoadInitialDataAsync()
        {
            await LoadAssignmentsAsync();
            await LoadMasterDataAsync(); // ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë“œ í˜¸ì¶œ
        }

        /// <summary>
        /// ì‚¬ë¬¼í•¨ ë°°ì • ëª©ë¡ ë¡œë“œ
        /// </summary>
        private async Task LoadAssignmentsAsync()
        {
            if (_context == null) return;
            StatusBarText = "ì‚¬ë¬¼í•¨ ëª©ë¡ ë¡œë”© ì¤‘...";
            try
            {
                var assignments = await _context.LockerAssignments
                                               .OrderBy(l => l.Floor).ThenBy(l => l.Zone).ThenBy(l => l.SpecificLocation)
                                               .ToListAsync();
                LockerAssignments = new ObservableCollection<LockerAssignment>(assignments);
                StatusBarText = $"ì´ {LockerAssignments.Count}ê°œì˜ ì‚¬ë¬¼í•¨ ì •ë³´ë¥¼ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.";
            }
            catch (Exception ex) { HandleDataAccessException("ì‚¬ë¬¼í•¨ ëª©ë¡ ë¡œë”©", ex); }
        }

        /// <summary>
        /// ë§ˆìŠ¤í„° ë°ì´í„° ëª©ë¡ (ì½¤ë³´ë°•ìŠ¤ìš©) ë¡œë“œ ë° MasterDataViewModel ê°±ì‹ 
        /// </summary>
        private async Task LoadMasterDataAsync()
        {
            if (_context == null) return;
            StatusBarText = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”© ì¤‘...";
            try
            {
                // ê° ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë“œ ë° ObservableCollection ì—…ë°ì´íŠ¸
                AllLockerTypes = new ObservableCollection<LockerType>(await _context.LockerTypes.OrderBy(t => t.Name).ToListAsync());
                AllFloors = new ObservableCollection<Floor>(await _context.Floors.OrderBy(f => f.Name).ToListAsync());
                AllZones = new ObservableCollection<Zone>(await _context.Zones.OrderBy(z => z.Name).ToListAsync());
                AllSubParts = new ObservableCollection<SubPart>(await _context.SubParts.OrderBy(p => p.Name).ToListAsync());
                AllAdministrators = new ObservableCollection<Administrator>(await _context.Administrators.OrderBy(a => a.Name).ToListAsync());
                StatusBarText = "ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë“œ ì™„ë£Œ.";

                // *** ìˆ˜ì •ëœ ë¶€ë¶„: MasterDataViewModelì˜ ë¹„ë™ê¸° ë¡œë“œ ë©”ì„œë“œ í˜¸ì¶œ ***
                if (MasterDataVM != null)
                {
                    await MasterDataVM.LoadAllMasterDataAsync(); // ë¹„ë™ê¸° ë©”ì„œë“œ í˜¸ì¶œ
                }
            }
            catch (Exception ex) { HandleDataAccessException("ë§ˆìŠ¤í„° ë°ì´í„° ë¡œë”©", ex); }
        }


        /// <summary>
        /// ë§ˆìŠ¤í„° í‚¤ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        /// </summary>
        private void CheckMasterPassword(object parameter)
        {
            try
            {
                string storedMasterKey = ConfigurationManager.AppSettings["MasterKey"];
                if (string.IsNullOrEmpty(storedMasterKey))
                {
                    MessageBox.Show("ì„¤ì • íŒŒì¼(App.config)ì— ë§ˆìŠ¤í„° í‚¤ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning);
                    return;
                }

                string plainPassword = ConvertToUnsecureString(MasterPasswordInput);

                if (plainPassword == storedMasterKey)
                {
                    IsMasterModeEnabled = true;
                    StatusBarText = "ë§ˆìŠ¤í„° ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
                    MessageBox.Show("ë§ˆìŠ¤í„° í‚¤ í™•ì¸ ì™„ë£Œ.", "ì„±ê³µ", MessageBoxButton.OK, MessageBoxImage.Information);
                }
                else
                {
                    IsMasterModeEnabled = false;
                    MessageBox.Show("ë§ˆìŠ¤í„° í‚¤ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"ë§ˆìŠ¤í„° í‚¤ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {ex.Message}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        // --- ê¸°ì¡´ SaveChangesAsync, AddNewLocker, DeleteSelectedAsync, ClearSelectedAssignment ë“± ---
        private async Task SaveChangesAsync()
        {
             if (_context == null) return;
            StatusBarText = "ë³€ê²½ ì‚¬í•­ ì €ì¥ ì¤‘...";
            try
            {
                 var changedEntries = _context.ChangeTracker.Entries<LockerAssignment>()
                    .Where(e => e.State == EntityState.Added || e.State == EntityState.Modified);
                 var allItemsToCheck = LockerAssignments.ToList();
                 var duplicates = allItemsToCheck
                    .GroupBy(l => new { l.Floor, l.Zone, l.SpecificLocation })
                    .Where(g => g.Count() > 1)
                    .Select(g => g.Key);
                 if (duplicates.Any()) { MessageBox.Show($"ì €ì¥ ë¶ˆê°€: ì¤‘ë³µ ìœ„ì¹˜ ë°œê²¬ - {string.Join(", ", duplicates.Select(d => $"{d.Floor}-{d.Zone}-{d.SpecificLocation}"))}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning); RollbackChanges(_context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged).ToList()); return; }
                foreach(var entry in changedEntries) { entry.Entity.Administrator = _currentAdmin; }
                int changedCount = await _context.SaveChangesAsync(); // ë¡œê·¸ ê¸°ë¡ì€ DbContextì—ì„œ ì²˜ë¦¬
                StatusBarText = $"ì„±ê³µì ìœ¼ë¡œ {changedCount}ê°œì˜ ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í–ˆìŠµë‹ˆë‹¤.";
            }
            catch (DbUpdateException dbEx) { HandleDbUpdateException(dbEx); RollbackChanges(_context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged).ToList()); }
            catch (Exception ex) { HandleGenericException("ì €ì¥", ex); RollbackChanges(_context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged).ToList()); }
        }
        private void RollbackChanges(IEnumerable<DbEntityEntry> changedEntries)
        {
            if (_context == null) return;
            foreach (var entry in changedEntries.ToList())
            {
                switch (entry.State)
                {
                    case EntityState.Modified: entry.CurrentValues.SetValues(entry.OriginalValues); entry.State = EntityState.Unchanged; break;
                    case EntityState.Added: entry.State = EntityState.Detached; if (entry.Entity is LockerAssignment addedEntity && LockerAssignments.Contains(addedEntity)) LockerAssignments.Remove(addedEntity); break;
                    case EntityState.Deleted: entry.State = EntityState.Unchanged; break;
                }
            }
             StatusBarText = "ë³€ê²½ ì‚¬í•­ì´ ë¡¤ë°±ë˜ì—ˆìŠµë‹ˆë‹¤.";
        }
        private void AddNewLocker(object parameter)
        {
            if (_context == null) return;
            var newAssignment = new LockerAssignment { LockerType = AllLockerTypes.FirstOrDefault()?.Name ?? "ê°œì¸ì‚¬ë¬¼í•¨", Floor = AllFloors.FirstOrDefault()?.Name ?? "1", Zone = AllZones.FirstOrDefault()?.Name ?? "A", SpecificLocation = "ìƒˆ ìœ„ì¹˜-" + Guid.NewGuid().ToString("N").Substring(0, 4), Administrator = _currentAdmin, LastUpdated = DateTime.Now };
            LockerAssignments.Add(newAssignment);
            _context.LockerAssignments.Add(newAssignment);
            SelectedAssignment = newAssignment;
            StatusBarText = "ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€ë¨. ì €ì¥ í•„ìš”.";
        }
        private async Task DeleteSelectedAsync()
        {
             if (_context == null || SelectedAssignment == null) return;
            if (MessageBox.Show($"'{SelectedAssignment.Floor}-{SelectedAssignment.Zone}-{SelectedAssignment.SpecificLocation}' ì‚¬ë¬¼í•¨ ì •ë³´ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", "ì‚­ì œ í™•ì¸", MessageBoxButton.YesNo, MessageBoxImage.Warning) == MessageBoxResult.Yes)
            {
                StatusBarText = "ì‚­ì œ ì¤‘...";
                try
                {
                    var assignmentToDelete = SelectedAssignment;
                    var entry = _context.Entry(assignmentToDelete);
                    if (entry.State == EntityState.Detached) { _context.LockerAssignments.Attach(assignmentToDelete); }
                     _context.LockerAssignments.Remove(assignmentToDelete);
                    int changedCount = await _context.SaveChangesAsync();
                    LockerAssignments.Remove(assignmentToDelete); SelectedAssignment = null;
                    StatusBarText = $"ì„±ê³µì ìœ¼ë¡œ {changedCount}ê°œì˜ ë ˆì½”ë“œë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.";
                }
                catch (DbUpdateException dbEx) { HandleDbUpdateException(dbEx); await LoadAssignmentsAsync(); }
                catch (Exception ex) { HandleGenericException("ì‚­ì œ", ex); await LoadAssignmentsAsync(); }
            }
        }
        private void ClearSelectedAssignment(object parameter)
        {
             if (_context == null || SelectedAssignment == null) return;
            SelectedAssignment.UserName = null; SelectedAssignment.KnoxId = null; SelectedAssignment.SubPart = null;
            _context.Entry(SelectedAssignment).State = EntityState.Modified; SelectedAssignment.Administrator = _currentAdmin;
            StatusBarText = "ë°°ì • í•´ì œë¨. ì €ì¥ í•„ìš”.";
        }
        // --- ê¸°ì¡´ ë©”ì„œë“œ ë ---

        /// <summary>
        /// ë°ì´í„° ì ‘ê·¼ ì¤‘ ë°œìƒí•˜ëŠ” ì¼ë°˜ ì˜ˆì™¸ ì²˜ë¦¬
        /// </summary>
        private void HandleGenericException(string operation, Exception ex)
        {
            StatusBarText = $"{operation} ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {ex.Message}";
            MessageBox.Show($"{operation} ì¤‘ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n{ex.ToString()}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
        }
         /// <summary>
        /// ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì˜ˆì™¸ ì²˜ë¦¬
        /// </summary>
        private void HandleDbUpdateException(DbUpdateException dbEx)
        {
            var innerExceptionMessage = dbEx.InnerException?.InnerException?.Message ?? dbEx.InnerException?.Message ?? dbEx.Message;
            StatusBarText = $"ë°ì´í„° ì €ì¥/ì‚­ì œ ì˜¤ë¥˜: {innerExceptionMessage}";
            MessageBox.Show($"ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n{innerExceptionMessage}", "DB ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
             // ì˜¤ë¥˜ ë°œìƒ ì—”í‹°í‹° ìƒíƒœ ë³µì› ì‹œë„
            try {
                foreach(var entry in dbEx.Entries) { entry.Reload(); } // DB ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°
            } catch { /* Reload ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ */ }
        }

        /// <summary>
        /// SecureStringì„ ì¼ë°˜ stringìœ¼ë¡œ ë³€í™˜ (ë©”ëª¨ë¦¬ ë³´ì•ˆ ì£¼ì˜)
        /// </summary>
        private string ConvertToUnsecureString(SecureString securePassword)
        {
            if (securePassword == null) return string.Empty;
            IntPtr unmanagedString = IntPtr.Zero;
            try
            {
                unmanagedString = Marshal.SecureStringToGlobalAllocUnicode(securePassword);
                return Marshal.PtrToStringUni(unmanagedString);
            }
            finally { Marshal.ZeroFreeGlobalAllocUnicode(unmanagedString); }
        }


        #region IDisposable êµ¬í˜„
        private bool disposed = false;
        protected virtual void Dispose(bool disposing) { if (!disposed) { if (disposing) { _context?.Dispose(); } disposed = true; } }
        public void Dispose() { Dispose(true); GC.SuppressFinalize(this); }
        #endregion
    }
}
 1 2. Views/MainWindow.xaml (ìˆ˜ì •) Â  
1.
github.com
github.com

ë¡œê·¸ íƒ­ì˜ GridControlì—ì„œ IsReadOnly="True" ì†ì„±ì„ ì œê±°í•©ë‹ˆë‹¤. í•´ë‹¹ TableViewì—ëŠ” ì´ë¯¸ AllowEditing="False"ê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì½ê¸° ì „ìš©ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

XML

<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:local="clr-namespace:LockerManagementApp.Views"
    xmlns:viewmodels="clr-namespace:LockerManagementApp.ViewModels"
    xmlns:models="clr-namespace:LockerManagementApp.Models"
    xmlns:infra="clr-namespace:LockerManagementApp.Infrastructure"
    Title="ì‚¬ë¬¼í•¨ ê´€ë¦¬ í”„ë¡œê·¸ë¨ (DevExpress MVVM - .NET Framework 4.8)" Height="750" Width="1300"
    Loaded="MainWindow_Loaded" Closing="MainWindow_Closing"
    >

    <dx:ThemedWindow.DataContext>
        <viewmodels:MainViewModel/>
    </dx:ThemedWindow.DataContext>

    <dx:ThemedWindow.Resources>
        <Style x:Key="AlignCenterCellStyle" TargetType="dxe:TextEditSettings"> <Setter Property="HorizontalContentAlignment" Value="Center"/> </Style>
        <Style x:Key="AlignCenterGridCellStyle" TargetType="dxg:CellContentPresenter"> <Setter Property="HorizontalAlignment" Value="Center"/> </Style>
        <Style x:Key="LightBlueHeaderStyle" TargetType="dxg:BaseGridHeader"> <Setter Property="Background" Value="LightBlue"/> <Setter Property="HorizontalContentAlignment" Value="Center"/> <Setter Property="FontWeight" Value="Bold"/> </Style>
        <Style TargetType="dxg:GridColumnHeader" BasedOn="{StaticResource LightBlueHeaderStyle}"/>
        <Style TargetType="dxg:BandHeaderControl" BasedOn="{StaticResource LightBlueHeaderStyle}"/>
    </dx:ThemedWindow.Resources>

    <Grid>
        <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" LastChildFill="True">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" Margin="5">
                <TextBlock Text="ë§ˆìŠ¤í„° í‚¤:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <PasswordBox x:Name="MasterPasswordBox" Width="100" VerticalAlignment="Center" infra:PasswordHelper.Attach="True" infra:PasswordHelper.Password="{Binding MasterPasswordInput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="í™•ì¸" Margin="5,0,0,0" Command="{Binding CheckMasterPasswordCommand}"/>
            </StackPanel>
            <Border Background="LightGray" Padding="5">
                 <StackPanel Orientation="Horizontal">
                    <Button Content="ğŸ”„ ìƒˆë¡œê³ ì¹¨" Margin="3" Command="{Binding LoadDataCommand}" ToolTip="ì „ì²´ ë°ì´í„°(ì‚¬ë¬¼í•¨, ë§ˆìŠ¤í„°)ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤."/>
                    <Button Content="ğŸ’¾ ë³€ê²½ ì‚¬í•­ ì €ì¥" Margin="3" Command="{Binding SaveChangesCommand}" ToolTip="í˜„ì¬ íƒ­ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•©ë‹ˆë‹¤."/>
                </StackPanel>
            </Border>
        </DockPanel>

        <TabControl Grid.Row="1" Margin="5">
            <TabItem Header="ì‚¬ë¬¼í•¨ ê´€ë¦¬">
                <Grid>
                    <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> </Grid.RowDefinitions>
                    <Border Grid.Row="0" Background="WhiteSmoke" Padding="3">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="â• ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€" Margin="3" Command="{Binding AddNewCommand}"/>
                            <Button Content="âŒ ì„ íƒ í•­ëª© ì‚­ì œ" Margin="3" Command="{Binding DeleteCommand}"/>
                            <Button Content="ğŸ§¹ ë°°ì • í•´ì œ" Margin="3" Command="{Binding ClearAssignmentCommand}"/>
                        </StackPanel>
                    </Border>
                    <dxg:GridControl Grid.Row="1" ItemsSource="{Binding LockerAssignments}" SelectedItem="{Binding SelectedAssignment, Mode=TwoWay}">
                        <dxg:GridControl.View>
                            <dxg:TableView AllowPerPixelScrolling="True" ShowGroupPanel="True" AllowEditing="True" NavigationStyle="Cell" ShowAutoFilterRow="True" NewItemRowPosition="None" ShowIndicator="True" ShowSearchPanelMode="Always">
                                <dxg:TableView.RowCellMenuCustomizations>
                                     <dxb:BarButtonItem Content="ì„ íƒ í•­ëª© ë°°ì • í•´ì œ" Command="{Binding View.DataContext.ClearAssignmentCommand}" Glyph="{dx:DXImage Svg/Actions/DeleteList.svg}"/>
                                     <dxb:BarItemSeparator/>
                                     <dxb:BarButtonItem Content="ì„ íƒ í–‰ ì‚­ì œ" Command="{Binding View.DataContext.DeleteCommand}" Glyph="{dx:DXImage Svg/Actions/Delete.svg}"/>
                                </dxg:TableView.RowCellMenuCustomizations>
                            </dxg:TableView>
                        </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="LockerType" Header="ì¢…ë¥˜" Width="100" Fixed="Left" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllLockerTypes}" DisplayMember="Name" IsTextEditable="False" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="Floor" Header="ì¸µ" Width="60" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllFloors}" DisplayMember="Name" IsTextEditable="False" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Zone" Header="êµ¬ì—­" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllZones}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="SpecificLocation" Header="ì„¸ë¶€ ìœ„ì¹˜" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                            <dxg:GridColumn FieldName="UserName" Header="ì„±ëª…" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                            <dxg:GridColumn FieldName="KnoxId" Header="Knox ID" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                            <dxg:GridColumn FieldName="SubPart" Header="ì†ŒíŒŒíŠ¸" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllSubParts}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="Administrator" Header="ê´€ë¦¬ ë‹´ë‹¹ì" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:ComboBoxEditSettings ItemsSource="{Binding AllAdministrators}" DisplayMember="Name" IsTextEditable="True" HorizontalContentAlignment="Center"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="TransferStatus" Header="ì „ë°°ë³µì§" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                             <dxg:GridColumn FieldName="Details" Header="ë‚´ìš©" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                             <dxg:GridColumn FieldName="Remarks" Header="íŠ¹ì´ì‚¬í•­" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                             <dxg:GridColumn FieldName="Notes" Header="ë¹„ê³ " Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                            <dxg:GridColumn FieldName="LastUpdated" Header="ìµœì¢… ìˆ˜ì •ì¼ì‹œ" Width="150" AllowEditing="False" ReadOnly="True" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Id" Header="ID" Visible="False" ReadOnly="True"/>
                        </dxg:GridControl.Columns>
                    </dxg:GridControl>
                </Grid>
            </TabItem>

            <TabItem Header="ë³€ê²½ ë¡œê·¸" DataContext="{Binding LogVM}">
                 <Grid>
                     <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> <RowDefinition Height="Auto"/> </Grid.RowDefinitions>
                     <Button Grid.Row="0" Content="ğŸ”„ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨" Command="{Binding LoadLogsCommand}" HorizontalAlignment="Left" Margin="5"/>
                     <dxg:GridControl Grid.Row="1" ItemsSource="{Binding AuditLogs}" AutoGenerateColumns="None" SelectionMode="Row">
                         <dxg:GridControl.View>
                             <dxg:TableView AllowPerPixelScrolling="True" AllowEditing="False" ShowGroupPanel="False" ShowAutoFilterRow="True"/>
                         </dxg:GridControl.View>
                         <dxg:GridControl.Columns>
                             <dxg:GridColumn FieldName="Timestamp" Header="ì‹œê°„" Width="150" SortOrder="Descending" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"> <dxg:GridColumn.EditSettings> <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True"/> </dxg:GridColumn.EditSettings> </dxg:GridColumn>
                             <dxg:GridColumn FieldName="UserName" Header="ì‚¬ìš©ì" Width="100" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                             <dxg:GridColumn FieldName="Action" Header="ì‘ì—…" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                             <dxg:GridColumn FieldName="TableName" Header="í…Œì´ë¸”" Width="120" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                             <dxg:GridColumn FieldName="RecordId" Header="ë ˆì½”ë“œ ID" Width="80" HeaderStyle="{StaticResource LightBlueHeaderStyle}" CellStyle="{StaticResource AlignCenterGridCellStyle}"/>
                             <dxg:GridColumn FieldName="AffectedColumns" Header="ë³€ê²½ ì»¬ëŸ¼" Width="150" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                             <dxg:GridColumn FieldName="OldValues" Header="ë³€ê²½ ì „ ê°’" Width="200" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                             <dxg:GridColumn FieldName="NewValues" Header="ë³€ê²½ í›„ ê°’" Width="200" HeaderStyle="{StaticResource LightBlueHeaderStyle}"/>
                         </dxg:GridControl.Columns>
                     </dxg:GridControl>
                     <StatusBar Grid.Row="2" Background="LightGray"> <StatusBarItem><TextBlock Text="{Binding StatusMessage}" Margin="5,0"/></StatusBarItem> </StatusBar>
                 </Grid>
            </TabItem>

            <TabItem Header="ë§ˆìŠ¤í„° ë°ì´í„° ê´€ë¦¬" DataContext="{Binding MasterDataVM}"
                     Visibility="{Binding DataContext.IsMasterModeEnabled, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}, FallbackValue=Collapsed}">
                     <Grid>
                     <Grid.RowDefinitions> <RowDefinition Height="Auto"/> <RowDefinition Height="*"/> </Grid.RowDefinitions>
                     <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5">
                         <Button Content="ğŸ’¾ ë§ˆìŠ¤í„° ë°ì´í„° ì €ì¥" Command="{Binding SaveChangesCommand}" Margin="3"/>
                         <Button Content="ğŸ”„ ë§ˆìŠ¤í„° ë°ì´í„° ìƒˆë¡œê³ ì¹¨" Command="{Binding LoadAllMasterDataCommand}" Margin="3"/>
                         <TextBlock Text="{Binding StatusMessage}" Margin="10,0,0,0" VerticalAlignment="Center" Foreground="Gray"/>
                     </StackPanel>
                     <dxlc:LayoutControl Grid.Row="1" Orientation="Vertical">
                         <dxlc:LayoutGroup Header="ì‚¬ë¬¼í•¨ ì¢…ë¥˜" View="GroupBox" Orientation="Vertical">
                             <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                 <Button Content="ì¢…ë¥˜ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="LockerType" Margin="0,0,5,0"/>
                                 <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" />
                                 </StackPanel>
                             <dxg:GridControl ItemsSource="{Binding LockerTypes}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200">
                                 <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View>
                                 <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì¢…ë¥˜ ì´ë¦„"/> </dxg:GridControl.Columns>
                             </dxg:GridControl>
                         </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ì¸µ" View="GroupBox" Orientation="Vertical">
                              <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ì¸µ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Floor" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel>
                              <dxg:GridControl ItemsSource="{Binding Floors}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì¸µ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl>
                         </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="êµ¬ì—­" View="GroupBox" Orientation="Vertical">
                              <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="êµ¬ì—­ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Zone" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel>
                              <dxg:GridControl ItemsSource="{Binding Zones}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="êµ¬ì—­ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl>
                         </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ì†ŒíŒŒíŠ¸" View="GroupBox" Orientation="Vertical">
                              <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ì†ŒíŒŒíŠ¸ ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="SubPart" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel>
                              <dxg:GridControl ItemsSource="{Binding SubParts}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ì†ŒíŒŒíŠ¸ ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl>
                         </dxlc:LayoutGroup>
                         <dxlc:LayoutGroup Header="ê´€ë¦¬ì" View="GroupBox" Orientation="Vertical">
                              <StackPanel Orientation="Horizontal" Margin="0,0,0,5"> <Button Content="ê´€ë¦¬ì ì¶”ê°€" Command="{Binding AddItemCommand}" CommandParameter="Administrator" Margin="0,0,5,0"/> <Button Content="ì„ íƒ ì‚­ì œ" Command="{Binding DeleteItemCommand}" /> </StackPanel>
                              <dxg:GridControl ItemsSource="{Binding Administrators}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" Height="150" MaxHeight="200"> <dxg:GridControl.View><dxg:TableView AllowEditing="True" NewItemRowPosition="None"/></dxg:GridControl.View> <dxg:GridControl.Columns> <dxg:GridColumn FieldName="Name" Header="ê´€ë¦¬ì ì´ë¦„"/> </dxg:GridControl.Columns> </dxg:GridControl>
                         </dxlc:LayoutGroup>
                     </dxlc:LayoutControl>
                 </Grid>
            </TabItem>

        </TabControl>

        <StatusBar Grid.Row="2" Background="LightGray">
            <StatusBarItem><TextBlock Text="{Binding StatusBarText}" Margin="5,0"/></StatusBarItem>
        </StatusBar>
    </Grid>
