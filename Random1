using DevExpress.XtraGrid.Views.Grid;
using System.Linq;

public partial class MainForm : Form
{
    public MainForm()
    {
        InitializeComponent();

        // 폼 로드 이벤트에서 모든 GridControl에 이벤트 핸들러와 컨텍스트 메뉴를 추가합니다.
        Load += MainForm_Load;
    }

    private void MainForm_Load(object sender, EventArgs e)
    {
        // MainForm에서 모든 GridControl을 찾아서 처리합니다.
        AddContextMenuAndEventHandlers(this);
    }

    private void AddContextMenuAndEventHandlers(Control control)
    {
        // 현재 컨트롤이 GridControl인지 확인합니다.
        if (control is DevExpress.XtraGrid.GridControl gridControl)
        {
            // GridView를 가져옵니다.
            GridView gridView = gridControl.MainView as GridView;
            if (gridView == null)
                return;

            // 컨텍스트 메뉴를 생성합니다.
            ContextMenu contextMenu = new ContextMenu();

            // 메뉴 아이템을 생성하고 컨텍스트 메뉴에 추가합니다.
            MenuItem menuItem1 = new MenuItem("메뉴 항목 1");
            menuItem1.Click += MenuItem1_Click;
            contextMenu.MenuItems.Add(menuItem1);

            MenuItem menuItem2 = new MenuItem("메뉴 항목 2");
            menuItem2.Click += MenuItem2_Click;
            contextMenu.MenuItems.Add(menuItem2);

            // GridView에 컨텍스트 메뉴를 설정합니다.
            gridView.GridControl.ContextMenu = contextMenu;

            // 추가로 이벤트 핸들러를 등록하려면 아래와 같이 처리합니다.
            gridView.DoubleClick += GridView_DoubleClick;
            // 다른 이벤트 핸들러들을 등록하려면 필요한 이벤트에 맞게 처리하면 됩니다.
        }

        // 현재 컨트롤의 자식 컨트롤들도 처리합니다.
        foreach (Control childControl in control.Controls)
        {
            AddContextMenuAndEventHandlers(childControl);
        }
    }

    private void MenuItem1_Click(object sender, EventArgs e)
    {
        // 메뉴 항목 1을 클릭했을 때의 동작을 구현합니다.
        MessageBox.Show("메뉴 항목 1이 클릭되었습니다.");
    }

    private void MenuItem2_Click(object sender, EventArgs e)
    {
        // 메뉴 항목 2를 클릭했을 때의 동작을 구현합니다.
        MessageBox.Show("메뉴 항목 2가 클릭되었습니다.");
    }

    private void GridView_DoubleClick(object sender, EventArgs e)
    {
        // GridView를 더블 클릭했을 때의 동작을 구현합니다.
        // 예를 들어, 선택된 행을 처리하거나 수정 폼을 엽니다.
        GridView gridView = sender as GridView;
        if (gridView != null && gridView.FocusedRowHandle >= 0)
        {
            // 처리할 작업을 수행합니다.
        }
    }
}
