using System;
using System.IO;
using System.Linq;

class Program
{
    static void Main()
    {
        string basePath = @"D:\_rpa_blackboxpckwblackbox"; // 대상 폴더 경로

        // 현재 날짜 가져오기
        DateTime now = DateTime.Now;
        string currentMonth = now.ToString("yyyyMM");
        string prevMonth = now.AddMonths(-1).ToString("yyyyMM");

        // 폴더 목록 가져오기 (yyyyMM 형식만 필터링)
        var folders = Directory.GetDirectories(basePath)
            .Select(Path.GetFileName) // 폴더명만 추출
            .Where(name => name.Length == 6 && name.All(char.IsDigit)) // 숫자 6자리 필터링
            .ToList();

        // 유지할 폴더 리스트
        var keepFolders = new[] { currentMonth, prevMonth };

        foreach (var folder in folders)
        {
            string fullPath = Path.Combine(basePath, folder);
            if (!keepFolders.Contains(folder))
            {
                try
                {
                    Directory.Delete(fullPath, true); // 강제 삭제 (하위 폴더 및 파일 포함)
                    Console.WriteLine($"[삭제 완료] {fullPath}");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"[삭제 실패] {fullPath} - {ex.Message}");
                }
            }
        }
        
        Console.WriteLine("정리 작업 완료!");
    }
}
