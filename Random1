ë‹˜, ì•Œê² ìŠµë‹ˆë‹¤. ì´ì œ ë‹¨ìˆœ ë·°ì–´ë¥¼ ë„˜ì–´, ë¼ì¸ë³„ë¡œ ë¬¸ì„œë¥¼ ê´€ë¦¬í•˜ê³  ìë™ìœ¼ë¡œ ìµœì‹  íŒŒì¼ì„ ë¡œë”©í•˜ëŠ” 'ìŠ¤ë§ˆíŠ¸ ë·°ì–´'ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ëŠ” ì‘ì—…ì´êµ°ìš”. ë§ì”€í•˜ì‹  ê¸°ëŠ¥ë“¤, ì•„ì£¼ ì¤‘ìš”í•œ í¬ì¸íŠ¸ì…ë‹ˆë‹¤.

ë¼ì¸(Line) ê¸°ë°˜ íŒŒì¼ ëª©ë¡: íŒŒì¼ ì´ë¦„(2ë¼ì¸_íŒŒì¼ëª….pdf)ì„ ë¶„ì„í•´ì„œ, ë¨¼ì € 'ë¼ì¸'ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ë¼ì¸ì˜ íŒŒì¼ë§Œ ë³´ì´ë„ë¡ í•©ë‹ˆë‹¤.

ìë™ ì •ë ¬ ë° í•˜ì´ë¼ì´íŠ¸: íŒŒì¼ ëª©ë¡ì€ í•­ìƒ ìµœì‹  ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬ë˜ê³ , ê°€ì¥ ìµœì‹  íŒŒì¼ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ ëˆˆì— ë„ê²Œ í‘œì‹œí•©ë‹ˆë‹¤.

ì„¸ì…˜ ìœ ì§€ ë° ìë™ ë¡œë”©: ì•±ì„ ê»ë‹¤ ì¼œë„ ë§ˆì§€ë§‰ì— ì„ íƒí–ˆë˜ 'ë¼ì¸'ì„ ê¸°ì–µí•˜ê³ , ì‹œì‘ ì‹œ í•´ë‹¹ ë¼ì¸ì˜ ê°€ì¥ ìµœì‹  íŒŒì¼ì„ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.

ì´ ëª¨ë“  'ìµœì²¨ë‹¨' ê¸°ëŠ¥ì„ ë°˜ì˜í•˜ì—¬ MainActivity.ktë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

## 1. MainActivity.kt ìµœì¢… ì½”ë“œ ìˆ˜ì •
ì´ë²ˆ ìˆ˜ì •ì€ íŒŒì¼ ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ë°©ì‹ê³¼ ì•± ì‹œì‘ ì‹œì˜ ë™ì‘ì„ ë³€ê²½í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤. SharedPreferencesë¼ëŠ” ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ ì„ íƒì„ ê¸°ê¸°ì— ì €ì¥í•˜ê³  ê¸°ì–µí•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

MainActivity.kt íŒŒì¼ ì „ì²´ë¥¼ ì•„ë˜ ì½”ë“œë¡œ êµì²´í•´ì£¼ì„¸ìš”.

Kotlin

package com.kyungwon.reellistviewer

import android.content.Context
import android.content.SharedPreferences
import android.graphics.Typeface
import android.hardware.Sensor
import android.hardware.SensorEvent
import android.hardware.SensorEventListener
import android.hardware.SensorManager
import android.os.Bundle
import android.text.Spannable
import android.text.SpannableString
import android.text.style.ForegroundColorSpan
import android.util.Log
import android.view.GestureDetector
import android.view.MotionEvent
import android.view.View
import android.widget.ArrayAdapter
import android.widget.Button
import android.widget.LinearLayout
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.core.content.ContextCompat
import androidx.core.view.GestureDetectorCompat
import androidx.core.view.WindowCompat
import androidx.core.view.WindowInsetsCompat
import androidx.core.view.WindowInsetsControllerCompat
import androidx.core.view.setMargins
import androidx.lifecycle.lifecycleScope
import com.github.barteksc.pdfviewer.listener.OnLoadCompleteListener
import com.github.barteksc.pdfviewer.listener.OnPageErrorListener
import com.kyungwon.reellistviewer.databinding.ActivityMainBinding
import jcifs.CIFSContext
import jcifs.config.PropertyConfiguration
import jcifs.context.BaseContext
import jcifs.smb.NtlmPasswordAuthenticator
import jcifs.smb.SmbFile
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.util.Properties

class MainActivity : AppCompatActivity(), OnLoadCompleteListener, OnPageErrorListener, SensorEventListener {

    private lateinit var binding: ActivityMainBinding

    // --- PC ê³µìœ í´ë” ì ‘ì† ì •ë³´ ---
    private val SMB_IP = "192.1.1.5"
    private val SMB_SHARED_FOLDER = "tempshare"
    private val SMB_USER = "win10"
    private val SMB_PASS = "tltmxpa2@"

    // --- UI ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ ---
    private var totalPdfPages = 0
    private val skippedButtons = mutableSetOf<Int>()
    private val currentButtons = mutableListOf<Button>()
    private var selectedButton: Button? = null
    private lateinit var gestureDetector: GestureDetectorCompat
    private var tappedButton: Button? = null

    // --- ì§€ìê³„ ì„¼ì„œ ê´€ë ¨ ë³€ìˆ˜ ---
    private lateinit var sensorManager: SensorManager
    private val accelerometerReading = FloatArray(3)
    private val magnetometerReading = FloatArray(3)
    private val rotationMatrix = FloatArray(9)
    private val orientationAngles = FloatArray(3)
    private var isGeomagneticModeOn = false
    private var currentDirection = Direction.OTHER

    // --- ğŸ’¡ ì„¸ì…˜ ìœ ì§€ë¥¼ ìœ„í•œ SharedPreferences ---
    private lateinit var prefs: SharedPreferences
    private val PREFS_FILENAME = "com.kyungwon.reellistviewer.prefs"
    private val KEY_LAST_LINE = "last_selected_line"

    enum class Direction { EAST, WEST, OTHER }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        hideSystemUI()

        // ğŸ’¡ SharedPreferences ì´ˆê¸°í™”
        prefs = getSharedPreferences(PREFS_FILENAME, Context.MODE_PRIVATE)

        setupGestureDetector()
        setupEventListeners()
        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager

        // ğŸ’¡ ì•± ì‹œì‘ ì‹œ ë§ˆì§€ë§‰ ì„¸ì…˜ ìë™ ë¡œë“œ
        loadLatestFileFromLastLine()
    }

    // (onResume, onPause, hideSystemUI ë“±ì€ ì´ì „ê³¼ ë™ì¼)

    private fun setupEventListeners() {
        // ğŸ’¡ Open ReelList ë²„íŠ¼ì€ ì´ì œ ë¼ì¸ ì„ íƒ ì°½ì„ ë„ì›€
        binding.btnOpenFile.setOnLongClickListener {
            lifecycleScope.launch(Dispatchers.IO) {
                showLineSelectionDialog()
            }
            true
        }
        binding.compassView.setOnLongClickListener {
            isGeomagneticModeOn = !isGeomagneticModeOn
            val modeText = if (isGeomagneticModeOn) "On" else "Off"
            Toast.makeText(this, "ì§€ìê³„ ì˜ì¡´ ëª¨ë“œ: $modeText", Toast.LENGTH_SHORT).show()
            binding.compassView.setGeomagneticMode(isGeomagneticModeOn)
            if (!isGeomagneticModeOn) {
                currentDirection = Direction.OTHER
            }
            updateButtonsAndUI()
            true
        }
    }

    // ğŸ’¡ --- ìƒˆë¡œìš´ í•¨ìˆ˜ë“¤ ---

    /**
     * ë§ˆì§€ë§‰ìœ¼ë¡œ ì„ íƒí•œ ë¼ì¸ì„ ê¸°ì–µí•˜ì—¬, í•´ë‹¹ ë¼ì¸ì˜ ìµœì‹  PDFë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
     */
    private fun loadLatestFileFromLastLine() {
        val lastLine = prefs.getString(KEY_LAST_LINE, null)
        if (lastLine.isNullOrEmpty()) {
            Toast.makeText(this, "ë¼ì¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", Toast.LENGTH_SHORT).show()
            return
        }

        Toast.makeText(this, "'$lastLine'ì˜ ìµœì‹  íŒŒì¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...", Toast.LENGTH_SHORT).show()
        lifecycleScope.launch(Dispatchers.IO) {
            try {
                val allFiles = listSmbFiles()
                val latestFile = allFiles
                    .filter { it.name.startsWith("${lastLine}_") }
                    .maxByOrNull { it.lastModified() }

                if (latestFile != null) {
                    loadPdfFromSmbFile(latestFile)
                } else {
                    withContext(Dispatchers.Main) {
                        Toast.makeText(this@MainActivity, "'$lastLine'ì— íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
                    }
                }
            } catch (e: Exception) {
                Log.e("SmbTask", "ìë™ ë¡œë“œ ì‹¤íŒ¨", e)
                withContext(Dispatchers.Main) {
                    Toast.makeText(this@MainActivity, "ìë™ ë¡œë“œ ì‹¤íŒ¨: ${e.message}", Toast.LENGTH_LONG).show()
                }
            }
        }
    }

    /**
     * ê³µìœ  í´ë”ì˜ PDF ëª©ë¡ì—ì„œ 'ë¼ì¸' ëª©ë¡ì„ ì¶”ì¶œí•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
     */
    private suspend fun showLineSelectionDialog() {
        try {
            val allFiles = listSmbFiles()
            // íŒŒì¼ëª…ì—ì„œ ë¼ì¸ ì´ë¦„ ì¶”ì¶œ (ì˜ˆ: "2ë¼ì¸_íŒŒì¼.pdf" -> "2ë¼ì¸")
            val lineNames = allFiles
                .mapNotNull { it.name.split('_').firstOrNull() }
                .distinct()
                .sorted()

            if (lineNames.isEmpty()) {
                withContext(Dispatchers.Main) { Toast.makeText(this@MainActivity, "PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show() }
                return
            }

            withContext(Dispatchers.Main) {
                AlertDialog.Builder(this@MainActivity)
                    .setTitle("ë¼ì¸ ì„ íƒ")
                    .setItems(lineNames.toTypedArray()) { _, which ->
                        val selectedLine = lineNames[which]
                        // ì„ íƒí•œ ë¼ì¸ ì €ì¥
                        prefs.edit().putString(KEY_LAST_LINE, selectedLine).apply()
                        // í•´ë‹¹ ë¼ì¸ì˜ íŒŒì¼ ëª©ë¡ ë³´ì—¬ì£¼ê¸°
                        lifecycleScope.launch(Dispatchers.IO) {
                            showReelListDialog(selectedLine, allFiles)
                        }
                    }
                    .show()
            }

        } catch (e: Exception) {
            Log.e("SmbTask", "ë¼ì¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨", e)
            withContext(Dispatchers.Main) {
                Toast.makeText(this@MainActivity, "ë¼ì¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${e.message}", Toast.LENGTH_LONG).show()
            }
        }
    }

    /**
     * ì„ íƒëœ ë¼ì¸ì— í•´ë‹¹í•˜ëŠ” PDF íŒŒì¼ ëª©ë¡ì„ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.
     * ê°€ì¥ ìµœì‹  íŒŒì¼ì€ íŒŒë€ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ë©ë‹ˆë‹¤.
     */
    private suspend fun showReelListDialog(selectedLine: String, allFiles: List<SmbFile>) {
        // ì„ íƒëœ ë¼ì¸ì˜ íŒŒì¼ë“¤ì„ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
        val filesInLine = allFiles
            .filter { it.name.startsWith("${selectedLine}_") }
            .sortedByDescending { it.lastModified() }

        if (filesInLine.isEmpty()) {
            withContext(Dispatchers.Main) { Toast.makeText(this@MainActivity, "ì„ íƒí•œ ë¼ì¸ì— íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show() }
            return
        }

        // í‘œì‹œí•  íŒŒì¼ ì´ë¦„ ëª©ë¡ ìƒì„± (ë¼ì¸ëª…, .pdf ì œê±°)
        val displayNames = filesInLine.map {
            it.name.removePrefix("${selectedLine}_").removeSuffix(".pdf")
        }

        withContext(Dispatchers.Main) {
            // ğŸ’¡ ìµœì‹  íŒŒì¼(ì²« ë²ˆì§¸ í•­ëª©)ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•œ ì–´ëŒ‘í„°
            val adapter = ArrayAdapter<SpannableString>(this@MainActivity, android.R.layout.simple_list_item_1)
            displayNames.forEachIndexed { index, name ->
                val spannable = SpannableString(name)
                if (index == 0) { // ì²« ë²ˆì§¸ í•­ëª©(ìµœì‹ )
                    spannable.setSpan(ForegroundColorSpan(ContextCompat.getColor(this@MainActivity, android.R.color.holo_blue_dark)), 0, name.length, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)
                }
                adapter.add(spannable)
            }

            AlertDialog.Builder(this@MainActivity)
                .setTitle("ë¦´ë¦¬ìŠ¤íŠ¸ ì„ íƒ ($selectedLine)")
                .setAdapter(adapter) { _, which ->
                    val selectedFile = filesInLine[which]
                    lifecycleScope.launch(Dispatchers.IO) {
                        loadPdfFromSmbFile(selectedFile)
                    }
                }
                .show()
        }
    }

    /**
     * SMB ê³µìœ  í´ë”ì— ì ‘ì†í•˜ì—¬ íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ê³µí†µ í•¨ìˆ˜
     */
    private suspend fun listSmbFiles(): List<SmbFile> {
        val smbUrl = "smb://$SMB_IP/$SMB_SHARED_FOLDER/"
        val properties = Properties().apply {
            put("jcifs.smb.client.minVersion", "SMB300")
            put("jcifs.smb.client.maxVersion", "SMB311")
        }
        val config = PropertyConfiguration(properties)
        val cifsContext: CIFSContext = BaseContext(config)
        val auth = NtlmPasswordAuthenticator(null, SMB_USER, SMB_PASS)
        val context = cifsContext.withCredentials(auth)
        val dir = SmbFile(smbUrl, context)
        return dir.listFiles { f -> f.name.endsWith(".pdf", ignoreCase = true) }.toList()
    }
    
    // (ì´í•˜ loadPdfFromSmbFile, onPageError ë“± ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì€ ì´ì „ê³¼ ë™ì¼)
    private fun onResume() { /* ... */ }
    private fun onPause() { /* ... */ }
    private fun hideSystemUI() { /* ... */ }
    private fun setupGestureDetector() { /* ... */ }
    override fun loadComplete(nbPages: Int) { /* ... */ }
    private fun updateButtonsAndUI() { /* ... */ }
    private fun regenerateButtons(count: Int) { /* ... */ }
    private fun createPageButton(number: Int, layoutParams: LinearLayout.LayoutParams? = null): Button { /* ... */ }
    private fun updateAllButtonStyles() { /* ... */ }
    private fun mapLogicalToPhysical(logicalButtonNum: Int): Int { /* ... */ }
    private fun onPageButtonClick(button: Button) { /* ... */ }
    private fun onPageButtonLongClick(view: View) { /* ... */ }
    override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) { /* ... */ }
    override fun onSensorChanged(event: SensorEvent) { /* ... */ }
    private fun dpToPx(dp: Int): Int { /* ... */ }
    private suspend fun loadPdfFromSmbFile(smbFile: SmbFile) { /* ... */ }
    override fun onPageError(page:Int,t:Throwable){ /* ... */ }
}
(ì´ì „ê³¼ ë™ì¼í•œ ì½”ë“œëŠ” /* ... */ ë¡œ ì¶•ì•½í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œë¡œëŠ” MainActivity.kt íŒŒì¼ ì „ì²´ë¥¼ ìœ„ ì½”ë“œë¡œ ë®ì–´ì“°ì‹œë©´ ë©ë‹ˆë‹¤.)

## í•µì‹¬ ë³€ê²½ ì‚¬í•­
SharedPreferences ì¶”ê°€: onCreateì—ì„œ ì´ˆê¸°í™”í•˜ì—¬ ì‚¬ìš©ìì˜ ë§ˆì§€ë§‰ 'ë¼ì¸' ì„ íƒì„ ì €ì¥í•©ë‹ˆë‹¤.

loadLatestFileFromLastLine(): ì•± ì‹œì‘ ì‹œ SharedPreferencesì— ì €ì¥ëœ ë¼ì¸ ê°’ì„ ì½ì–´, í•´ë‹¹ ë¼ì¸ì˜ ìµœì‹  íŒŒì¼ì„ ìë™ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

showLineSelectionDialog(): btnOpenFileì„ ê¸¸ê²Œ ëˆŒë €ì„ ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤. SMB í´ë”ì˜ ëª¨ë“  PDF íŒŒì¼ëª…ì„ ë¶„ì„í•˜ì—¬ ê³ ìœ í•œ 'ë¼ì¸' ëª©ë¡ì„ ë§Œë“¤ì–´ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.

showReelListDialog(): ë¼ì¸ ì„ íƒ í›„ ì‹¤í–‰ë©ë‹ˆë‹¤. í•´ë‹¹ ë¼ì¸ì˜ íŒŒì¼ë§Œ í•„í„°ë§í•˜ì—¬ ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³ , ArrayAdapterì™€ SpannableStringì„ ì´ìš©í•´ ì²« ë²ˆì§¸ í•­ëª©(ê°€ì¥ ìµœì‹  íŒŒì¼)ì„ íŒŒë€ìƒ‰ìœ¼ë¡œ ë§Œë“¤ì–´ ë³´ì—¬ì¤ë‹ˆë‹¤.

listSmbFiles(): SMB ì ‘ì† ë° íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ë³µ ì½”ë“œë¥¼ ë³„ë„ì˜ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.