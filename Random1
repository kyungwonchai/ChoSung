using DevExpress.XtraEditors;
using DevExpress.XtraEditors.Repository;
using System;
using System.Diagnostics;
using System.IO;
using System.Windows.Forms;

public partial class JupyterNotebookOpener : Form
{
    private string notebookFolderPath = @"c:\aaaabbbb";

    public JupyterNotebookOpener()
    {
        InitializeComponent();
        ListNotebooks();
        InitializeTreeList();
    }

    private void ListNotebooks()
    {
        // SearchOption.AllDirectories를 사용하여 모든 하위 폴더를 검색합니다.
        string[] notebookFiles = Directory.GetFiles(notebookFolderPath, "*.ipynb", SearchOption.AllDirectories);
        foreach (var file in notebookFiles)
        {
            string fileName = Path.GetFileName(file);
            // 파일 경로에서 notebookFolderPath를 제거하여 상대 경로를 얻습니다.
            string relativePath = file.Substring(notebookFolderPath.Length + 1);
            listBoxControl.Items.Add(relativePath);
        }
    }

    private void InitializeTreeList()
    {
        treeList1.Columns.Add(new DevExpress.XtraTreeList.Columns.TreeListColumn() { Caption = "Notebooks", Visible = true });
        treeList1.BeginUnboundLoad();

        string[] notebookFiles = Directory.GetFiles(notebookFolderPath, "*.ipynb", SearchOption.AllDirectories);
        foreach (var file in notebookFiles)
        {
            // 상대 경로를 얻습니다.
            string relativePath = file.Substring(notebookFolderPath.Length + 1);
            treeList1.AppendNode(new object[] { relativePath }, -1);
        }

        treeList1.EndUnboundLoad();

        // ButtonEdit 리포지토리 아이템을 생성하고 버튼 클릭 이벤트를 설정합니다.
        RepositoryItemButtonEdit ribe = new RepositoryItemButtonEdit();
        ribe.Buttons[0].Kind = DevExpress.XtraEditors.Controls.ButtonPredefines.Glyph;
        ribe.ButtonClick += (sender, e) =>
        {
            // 버튼이 클릭되면 해당 파일을 엽니다.
            var buttonEdit = sender as ButtonEdit;
            string filePath = Path.Combine(notebookFolderPath, buttonEdit.EditValue.ToString());
            Process.Start(filePath);
        };
        treeList1.RepositoryItems.Add(ribe);

        // 모든 노드에 ButtonEdit 리포지토리 아이템을 설정합니다.
        foreach (DevExpress.XtraTreeList.Nodes.TreeListNode node in treeList1.Nodes)
        {
            treeList1.SetRepositoryItem(node, ribe);
        }
    }
}
