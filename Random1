using Excel = Microsoft.Office.Interop.Excel;
using System.Data;

// 엑셀 파일 경로
string filePath = "경로\\파일이름.xlsx";

// Excel Application 인스턴스 생성
Excel.Application excelApp = new Excel.Application();

// Workbook 열기
Excel.Workbook workbook = excelApp.Workbooks.Open(filePath);

// 마스터 시트 읽기
Excel.Worksheet masterSheet = workbook.Sheets["마스터 시트명"];
Excel.Range masterRange = masterSheet.UsedRange;

// 데이터 테이블 생성
DataTable masterTB = new DataTable();

// 컬럼 생성
int columnCount = masterRange.Columns.Count;
for (int col = 1; col <= columnCount; col++)
{
    string columnName = masterRange.Cells[1, col].Value2.ToString();
    masterTB.Columns.Add(columnName);
}

// 데이터 가져오기
object[,] masterValues = masterRange.Value;

// 데이터 행 추가
int rowCount = masterRange.Rows.Count;
for (int row = 2; row <= rowCount; row++)
{
    DataRow dataRow = masterTB.NewRow();
    for (int col = 1; col <= columnCount; col++)
    {
        object value = masterValues[row, col];
        dataRow[col - 1] = value != null ? value.ToString() : string.Empty;
    }
    masterTB.Rows.Add(dataRow);
}

// 불출 시트 읽기
Excel.Worksheet bulSheet = workbook.Sheets["불출 시트명"];
Excel.Range bulRange = bulSheet.UsedRange;

// 데이터 테이블 생성
DataTable bulTB = new DataTable();

// 컬럼 생성
columnCount = bulRange.Columns.Count;
for (int col = 1; col <= columnCount; col++)
{
    string columnName = bulRange.Cells[1, col].Value2.ToString();
    bulTB.Columns.Add(columnName);
}

// 데이터 가져오기
object[,] bulValues = bulRange.Value;

// 데이터 행 추가
rowCount = bulRange.Rows.Count;
for (int row = 2; row <= rowCount; row++)
{
    DataRow dataRow = bulTB.NewRow();
    for (int col = 1; col <= columnCount; col++)
    {
        object value = bulValues[row, col];
        dataRow[col - 1] = value != null ? value.ToString() : string.Empty;
    }
    bulTB.Rows.Add(dataRow);
}

// Excel 파일과 관련된 리소스 해제
workbook.Close();
excelApp.Quit();
System.Runtime.InteropServices.Marshal.ReleaseComObject(workbook);
System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);

// 사용이 완료된 COM 개체를 제거
GC.Collect();
