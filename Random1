using System;
using System.Drawing;
using System.Drawing.Printing;
using System.Windows.Forms;

namespace PrintPreviewWithPrinterSelection
{
    public partial class Form1 : Form
    {
        private PrintDocument printDocument;

        public Form1()
        {
            InitializeComponent();

            // 프린트 문서 초기화
            printDocument = new PrintDocument();
            printDocument.PrintPage += PrintDocument_PrintPage;
        }

        // 미리보기 버튼 클릭 이벤트 핸들러
        private void btnPreview_Click(object sender, EventArgs e)
        {
            using (PrintPreviewDialog printPreviewDialog = new PrintPreviewDialog())
            {
                // PrintDocument를 PrintPreviewDialog에 할당합니다.
                printPreviewDialog.Document = printDocument;

                // 미리보기 창을 엽니다.
                if (printPreviewDialog.ShowDialog() == DialogResult.OK)
                {
                    // 미리보기 창에서 확인 버튼을 누른 경우에만 PrintDialog를 엽니다.
                    // PrintDialog를 통해 사용자가 다른 프린터를 선택할 수 있습니다.
                    using (PrintDialog printDialog = new PrintDialog())
                    {
                        // 프린터 선택 대화상자에서 프린터를 선택합니다.
                        if (printDialog.ShowDialog() == DialogResult.OK)
                        {
                            // 선택한 프린터를 사용하여 PrintDocument에 할당합니다.
                            printDocument.PrinterSettings = printDialog.PrinterSettings;

                            // 프린트 작업을 수행합니다.
                            printDocument.Print();
                        }
                    }
                }
            }
        }

        // PrintDocument_PrintPage 이벤트 핸들러 (프린트할 내용 설정)
        private void PrintDocument_PrintPage(object sender, PrintPageEventArgs e)
        {
            // 여기에 프린트할 내용을 설정합니다.
            // 예를 들어, 그림이나 텍스트를 그리거나 PrintDocument의 설정을 변경할 수 있습니다.
            // e.Graphics를 사용하여 출력될 그래픽 개체를 그리고 설정할 수 있습니다.

            // 이 예제에서는 단순히 미리보기 페이지에 "프린트할 내용입니다."라는 텍스트를 그립니다.
            e.Graphics.DrawString("프린트할 내용입니다.", new Font("Arial", 12), Brushes.Black, new PointF(50, 50));
        }
    }
}
