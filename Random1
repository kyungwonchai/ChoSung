import os
import subprocess
import shutil

def run(cmd):
    try:
        subprocess.run(cmd, shell=True, check=True)
    except subprocess.CalledProcessError as e:
        print(f"Error: {e}")

def setup_zsh_beauty():
    print("ğŸ¨ í„°ë¯¸ë„ ì˜ˆìˆ í™” ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤...")

    # 1. Zsh ë° í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜
    run("sudo apt update && sudo apt install -y zsh git curl fontconfig")

    # 2. MesloLGS NF í°íŠ¸ ì„¤ì¹˜ (Powerlevel10k ìµœì í™” í°íŠ¸)
    font_dir = os.path.expanduser("~/.local/share/fonts")
    os.makedirs(font_dir, exist_ok=True)
    urls = [
        "https://github.com/romkatv/dotfiles-public/raw/master/.local/share/fonts/NerdFonts/MesloLGS%20NF%20Regular.ttf",
        "https://github.com/romkatv/dotfiles-public/raw/master/.local/share/fonts/NerdFonts/MesloLGS%20NF%20Bold.ttf",
        "https://github.com/romkatv/dotfiles-public/raw/master/.local/share/fonts/NerdFonts/MesloLGS%20NF%20Italic.ttf",
        "https://github.com/romkatv/dotfiles-public/raw/master/.local/share/fonts/NerdFonts/MesloLGS%20NF%20Bold%20Italic.ttf"
    ]
    for url in urls:
        run(f"wget -P {font_dir} {url}")
    run("fc-cache -fv")

    # 3. Oh My Zsh ì„¤ì¹˜ (ì´ë¯¸ ìˆìœ¼ë©´ ê±´ë„ˆëœ€)
    omz_path = os.path.expanduser("~/.oh-my-zsh")
    if not os.path.exists(omz_path):
        run('sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended')

    # 4. í…Œë§ˆ ë° í”ŒëŸ¬ê·¸ì¸ í´ë¡ 
    custom_path = os.path.expanduser("~/.oh-my-zsh/custom")
    run(f"git clone --depth=1 https://github.com/romkatv/powerlevel10k.git {custom_path}/themes/powerlevel10k")
    run(f"git clone https://github.com/zsh-users/zsh-autosuggestions {custom_path}/plugins/zsh-autosuggestions")
    run(f"git clone https://github.com/zsh-users/zsh-syntax-highlighting.git {custom_path}/plugins/zsh-syntax-highlighting")

    # 5. .zshrc ì„¤ì • ë³€ê²½
    zshrc_path = os.path.expanduser("~/.zshrc")
    with open(zshrc_path, "r") as f:
        content = f.read()

    content = content.replace('ZSH_THEME="robbyrussell"', 'ZSH_THEME="powerlevel10k/powerlevel10k"')
    if "zsh-autosuggestions" not in content:
        content = content.replace('plugins=(git)', 'plugins=(git zsh-autosuggestions zsh-syntax-highlighting)')

    with open(zshrc_path, "w") as f:
        f.write(content)

    print("\nâœ¨ ì„¤ì¹˜ ì™„ë£Œ! í„°ë¯¸ë„ì„ ì¬ì‹œì‘í•˜ë©´ Powerlevel10k ì„¤ì • ë§ˆë²•ì‚¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤.")
    print("ğŸ‘‰ ì¤‘ìš”: í„°ë¯¸ë„ ì„¤ì •ì—ì„œ í°íŠ¸ë¥¼ 'MesloLGS NF'ë¡œ ë³€ê²½í•´ ì£¼ì„¸ìš”!")

if __name__ == "__main__":
    setup_zsh_beauty()