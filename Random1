래는 수정된 VBA 코드입니다. 이번 버전에서는 다음과 같은 사항을 반영했습니다:

Axes(xlCategory).Title.Caption과 Axes(xlValue).Title.Caption 대신, 타이틀 설정을 제외하여 오류를 방지했습니다.
X축 간격을 완전히 제거하여 각 차트를 바로 이어서 배치합니다.
수정된 VBA 코드
vba
코드 복사
Sub CreateSummaryAndLineDetailsChartsCompact()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim lineDetailsWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim lineData As Object
    Dim i As Long
    Dim dateVal As String, shiftVal As String, lineVal As String
    Dim rowCounter As Long, colCounter As Long
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트(Summary) 및 라인별 시트(LineDetails)가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    Set lineDetailsWs = ThisWorkbook.Sheets("LineDetails")
    If Not lineDetailsWs Is Nothing Then lineDetailsWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    Set lineDetailsWs = ThisWorkbook.Sheets.Add
    lineDetailsWs.Name = "LineDetails"
    
    ' Line1별로 날짜와 Shift1별 개수를 저장할 딕셔너리 생성
    Set lineData = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            lineVal = CStr(ws.Cells(i, 1).Value)  ' 숫자를 문자열로 변환하여 Dictionary 키로 사용
            
            ' Line1, Date1, Shift1 기준으로 개수 누적
            If Not lineData.exists(lineVal) Then
                Set lineData(lineVal) = CreateObject("Scripting.Dictionary")
            End If
            
            If Not lineData(lineVal).exists(dateVal) Then
                Set lineData(lineVal)(dateVal) = CreateObject("Scripting.Dictionary")
                lineData(lineVal)(dateVal)("day") = 0
                lineData(lineVal)(dateVal)("night") = 0
            End If
            
            lineData(lineVal)(dateVal)(shiftVal) = lineData(lineVal)(dateVal)(shiftVal) + 1
        End If
    Next i
    
    ' Summary 시트에 전체 Date1, Shift1 차트 기록 및 생성
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    rowCounter = 2
    Dim uniqueDates As Object
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    
    ' 날짜별 및 Shift1별 데이터 수집
    For Each lineKey In lineData.keys
        For Each dateKey In lineData(lineKey).keys
            shiftVal = "day"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
            
            shiftVal = "night"
            If Not uniqueDates.exists(dateKey & "_" & shiftVal) Then
                uniqueDates(dateKey & "_" & shiftVal) = 0
            End If
            uniqueDates(dateKey & "_" & shiftVal) = uniqueDates(dateKey & "_" & shiftVal) + lineData(lineKey)(dateKey)(shiftVal)
        Next dateKey
    Next lineKey
    
    ' Summary 시트에 데이터 작성
    For Each key In uniqueDates.keys
        summaryWs.Cells(rowCounter, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(rowCounter, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(rowCounter, 3).Value = uniqueDates(key)   ' Count 값
        rowCounter = rowCounter + 1
    Next key
    
    ' 전체 Date1, Shift1 차트 생성 - Y축 제한 없음
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "전체 Date1별 Day/Night 횟수"
    End With
    
    ' LineDetails 시트에 각 Line1별 날짜와 Shift1 개수 가로 배치 및 차트 생성
    lineDetailsWs.Cells(1, 1).Value = "Line별 날짜별 Day/Night 횟수"
    
    ' Line1 값 순서대로 정렬
    Dim sortedKeys As Collection
    Set sortedKeys = New Collection
    Dim lineKey As Variant
    For Each lineKey In lineData.keys
        Dim idx As Long
        For idx = 1 To sortedKeys.Count
            If CLng(lineKey) < CLng(sortedKeys(idx)) Then Exit For
        Next idx
        If idx > sortedKeys.Count Then
            sortedKeys.Add lineKey
        Else
            sortedKeys.Add lineKey, , idx
        End If
    Next lineKey
    
    colCounter = 1
    For Each lineKey In sortedKeys
        lineDetailsWs.Cells(2, colCounter).Value = "Line1: " & lineKey
        lineDetailsWs.Cells(3, colCounter).Value = "Date1"
        lineDetailsWs.Cells(3, colCounter + 1).Value = "Day Count"
        lineDetailsWs.Cells(3, colCounter + 2).Value = "Night Count"
        
        rowCounter = 4
        
        ' 날짜별 데이터 기록
        For Each dateKey In lineData(lineKey).keys
            lineDetailsWs.Cells(rowCounter, colCounter).Value = dateKey
            lineDetailsWs.Cells(rowCounter, colCounter + 1).Value = lineData(lineKey)(dateKey)("day")
            lineDetailsWs.Cells(rowCounter, colCounter + 2).Value = lineData(lineKey)(dateKey)("night")
            rowCounter = rowCounter + 1
        Next dateKey
        
        ' 각 Line1의 차트를 Y 위치 동일하게 하고 X 간격을 없애 배치, Y축 최대값 200 설정
        Set chart = lineDetailsWs.ChartObjects.Add(Left:=colCounter * 140, Width:=375, Top:=50, Height:=300)
        With chart.Chart
            .SetSourceData Source:=lineDetailsWs.Range(lineDetailsWs.Cells(3, colCounter), _
                                                      lineDetailsWs.Cells(rowCounter - 1, colCounter + 2))
            .ChartType = xlColumnClustered
            .HasTitle = True
            .ChartTitle.Text = "Line1: " & lineKey & "의 Date1별 Day/Night 횟수"
            .Axes(xlValue).MaximumScale = 200
            .Axes(xlValue).MajorUnit = 100
            .Axes(xlValue).MajorGridlines.Format.Line.Weight = 1
        End With
        
        colCounter = colCounter + 4 ' 다음 Line1 데이터 및 차트를 위한 간격 설정
    Next lineKey
End Sub
주요 수정 사항
타이틀 설정 제거: Axes(xlCategory).Title.Caption 및 Axes(xlValue).Title.Caption 설정을 제거하여 오류를 방지했습니다.
차트 간 X축 간격 제거: LineDetails 시트에서 차트를 이어서 배치하여 차트 간의 X축 간격이 없습니다.
차트 Y축 설정:
Summary 시트 차트: Y축 제한 없이 생성됩니다.