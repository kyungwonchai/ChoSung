import openpyxl
from datetime import datetime

def process_excel_and_create_dict(file_path):
    # 엑셀 파일 로드
    wb = openpyxl.load_workbook(file_path, data_only=True)
    sheet = wb.active

    # B2 셀 검증
    if sheet['B2'].value != 'Reel 번호':
        raise ValueError('B2셀에 "Reel 번호"가 아닙니다.')

    # 데이터 추출 및 딕셔너리 저장
    keys = ('I', 'E', 'D')
    unique_values = {}
    for row in sheet.iter_rows(min_row=3, min_col=2, max_col=sheet.max_column):
        # D열 값이 있는지 확인하고, 없으면 무시
        if row[3].value is not None:
            # 키 생성을 위한 값들을 추출합니다.
            key_parts = [datetime.today().strftime('%Y%m%d')]
            key_parts.extend(row[sheet[letter+'1'].column-1].value for letter in keys)
            key = '_'.join(str(part) for part in key_parts if part is not None)

            # 중복 키 방지를 위한 검사
            if key not in unique_values:
                unique_values[key] = row[sheet['P'+'1'].column-1].value

    return unique_values

# 함수 호출 예
# dictionary_values = process_excel_and_create_dict('파일경로.xlsx')
# for key, value in dictionary_values.items():
#     print(f"{key}: {value}")
