L을 사용하여 주어진 조건에 맞게 데이터를 인서트하거나 업데이트하는 방법을 보여줍니다.
C# 코드

csharp

using System;
using System.Data.SqlClient;

namespace YourNamespace
{
    class Program
    {
        static void Main(string[] args)
        {
            string connectionString = "Server=your_server;Database=your_database;User Id=your_username;Password=your_password;";

            string[] columns = new string[] { "C_Site_Name", "C_Resource_Name", "C_Basic_Name__Fix_" }; // 이 부분은 실제 컬럼 명으로 대체해주세요
            string dateWithQuotes = "your_date"; // 이 부분은 실제 날짜 데이터로 대체해주세요
            string numbb = "your_number"; // 이 부분은 실제 숫자 데이터로 대체해주세요
            string formatted_time = DateTime.Now.ToString("HH:mm:ss");

            string insertQuery = $"INSERT INTO T_메인확정 ({string.Join(",", columns)}, N_number, N_time, N_datek) " +
                                 $"VALUES ({dateWithQuotes}, {numbb}, '{formatted_time}', CONVERT(varchar, GETDATE(), 112))";

            string updateQuery = $"UPDATE T_메인확정 SET N_number = {numbb}, N_time = '{formatted_time}', N_datek = CONVERT(varchar, GETDATE(), 112) " +
                                 $"WHERE C_Site_Name = 'YourSiteName' AND C_Resource_Name = 'YourResourceName' AND C_Basic_Name__Fix_ = 'YourBasicNameFix'";  // 이 부분은 실제 키 값으로 대체해주세요

            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                try
                {
                    connection.Open();

                    SqlCommand command = new SqlCommand(insertQuery, connection);
                    int rowsAffected = command.ExecuteNonQuery();

                    if (rowsAffected == 0)
                    {
                        command = new SqlCommand(updateQuery, connection);
                        command.ExecuteNonQuery();
                    }
                }
                catch (SqlException ex)
                {
                    if (ex.Number == 2627 || ex.Number == 2601)  // 중복 키 에러
                    {
                        SqlCommand command = new SqlCommand(updateQuery, connection);
                        command.ExecuteNonQuery();
                    }
                    else
                    {
                        Console.WriteLine("SQL Error: " + ex.Message);
                    }
                }
                finally
                {
                    connection.Close();
                }
            }
        }
    }
}

이 코드는 처음에 INSERT 쿼리를 실행하고, 중복 키 에러가 발생하면 UPDATE 쿼리를 실행합니다. 에러 코드 2627과 2601은 SQL Server에서 발생하는 중복 키 에러입니다.

C_Site_Name, C_Resource_Name, C_Basic_Name__Fix_ 등의 키 컬럼 값은 실제 값으로 대체해주세요. 이렇게 하면 키가 겹칠 경우 키가 아닌 모든 컬럼의 값을 업데이트할 수 있습니다.