CREATE TRIGGER ProductsTrigger
ON Products
AFTER UPDATE, INSERT, DELETE
AS
BEGIN
    -- 업데이트 시 백업 테이블 업데이트
    IF EXISTS (SELECT * FROM inserted) -- 업데이트
    BEGIN
        UPDATE ProductsBackup
        SET * = i.*, BackupMessage = 'Updated'
        FROM ProductsBackup b
        INNER JOIN inserted i ON b.ProductID = i.ProductID;
    END

    -- 추가 시 백업 테이블 추가
    IF EXISTS (SELECT * FROM inserted) -- 추가
    BEGIN
        INSERT INTO ProductsBackup
        SELECT i.*, 'Added'
        FROM inserted i;
    END

    -- 삭제 시 백업 테이블에서 삭제
    IF EXISTS (SELECT * FROM deleted) -- 삭제
    BEGIN
        DELETE FROM ProductsBackup
        WHERE ProductID IN (SELECT ProductID FROM deleted);

        INSERT INTO ProductsBackup
        SELECT d.*, 'Deleted'
        FROM deleted d;
    END
END
