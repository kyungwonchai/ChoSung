 OpenCVë¡œ í™”ë©´ì—ì„œ íŠ¹ì • ìˆ«ì ê°ì§€ í›„ í´ë¦­í•˜ëŠ” ìë™í™” ì½”ë“œ
ğŸ”¥ í•µì‹¬ ê¸°ëŠ¥:
âœ… OpenCvSharpì„ ì‚¬ìš©í•˜ì—¬ í™”ë©´ì—ì„œ ìˆ«ì OCR ê°ì§€
âœ… 817, 345 ~ 1381, 545 ì¢Œí‘œ ë‚´ 80px ê°„ê²©ì˜ í‘œ íƒìƒ‰
âœ… í° ë°°ê²½ + ì—°í•œ íšŒìƒ‰ í…Œë‘ë¦¬ ë‚´ ìˆ«ì í™•ì¸
âœ… 0ì´ ì•„ë‹Œ ìˆ«ìê°€ ìˆìœ¼ë©´ ìš°ì¸¡ë¶€í„° ì¢Œì¸¡ìœ¼ë¡œ í´ë¦­ (ê° í–‰ë§ˆë‹¤ ìš°ì¸¡ë¶€í„°)
âœ… ë¹„ë™ê¸° ë°©ì‹ìœ¼ë¡œ í´ë¦­ ì‹¤í–‰ (Task.Run)
âœ… Windows APIì˜ mouse_event()ë¡œ í´ë¦­ ìˆ˜í–‰
âœ… 0.5ì´ˆ ì´ë‚´ì— í´ë¦­ ì†ë„ ìµœì í™”

ğŸ“Œ NuGet íŒ¨í‚¤ì§€ ì„¤ì¹˜
ğŸ“Œ í•„ìˆ˜ íŒ¨í‚¤ì§€:

OpenCvSharp4
OpenCvSharp4.Windows
TesseractOCR (OCR ì¸ì‹ìš©)
mathematica
ì½”ë“œ ë³µì‚¬
Install-Package OpenCvSharp4
Install-Package OpenCvSharp4.Windows
Install-Package TesseractOCR
ğŸ“Œ C# ì½”ë“œ (OCRë¡œ ìˆ«ì ì¸ì‹ í›„ ìë™ í´ë¦­)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Threading.Tasks;
using OpenCvSharp;
using OpenCvSharp.Extensions;
using Tesseract;

class Program
{
    // ë§ˆìš°ìŠ¤ í´ë¦­ì„ ìœ„í•œ WinAPI í˜¸ì¶œ
    [DllImport("user32.dll")]
    private static extern void SetCursorPos(int x, int y);

    [DllImport("user32.dll")]
    private static extern void mouse_event(int dwFlags, int dx, int dy, int dwData, int dwExtraInfo);

    private const int MOUSEEVENTF_LEFTDOWN = 0x02;
    private const int MOUSEEVENTF_LEFTUP = 0x04;

    static async Task Main()
    {
        // í™”ë©´ ìº¡ì²˜
        Bitmap screenshot = CaptureScreen();

        // OCRì„ ì‚¬ìš©í•˜ì—¬ ìˆ«ì ì¸ì‹ ë° í´ë¦­ ìˆ˜í–‰
        await DetectAndClick(screenshot);
    }

    /// <summary>
    /// ğŸ–¥ï¸ í™”ë©´ ìº¡ì²˜
    /// </summary>
    static Bitmap CaptureScreen()
    {
        Rectangle bounds = new Rectangle(817, 345, 1381 - 817, 545 - 345);
        Bitmap bitmap = new Bitmap(bounds.Width, bounds.Height);

        using (Graphics g = Graphics.FromImage(bitmap))
        {
            g.CopyFromScreen(bounds.X, bounds.Y, 0, 0, bounds.Size);
        }

        return bitmap;
    }

    /// <summary>
    /// ğŸ” OCRë¡œ ìˆ«ì ê°ì§€ í›„ í´ë¦­
    /// </summary>
    static async Task DetectAndClick(Bitmap screenshot)
    {
        Mat image = BitmapConverter.ToMat(screenshot);
        Mat gray = new Mat();
        Cv2.CvtColor(image, gray, ColorConversionCodes.BGR2GRAY);

        // ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ ë° ì´ì§„í™” ì²˜ë¦¬
        Cv2.GaussianBlur(gray, gray, new OpenCvSharp.Size(3, 3), 0);
        Cv2.Threshold(gray, gray, 180, 255, ThresholdTypes.BinaryInv);

        // OCR ì„¤ì •
        using var ocr = new TesseractEngine(@"./tessdata", "eng", EngineMode.Default);
        var tessImage = PixConverter.ToPix(gray);
        var result = ocr.Process(tessImage);

        // OCR ê²°ê³¼ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
        Console.WriteLine("OCR ê²°ê³¼:");
        Console.WriteLine(result.GetText());

        // í‘œ ë‚´ ìœ„ì¹˜ ê³„ì‚°
        List<Point> clickPositions = new List<Point>();
        int startX = 817, startY = 345, endX = 1381, endY = 545;
        int cellWidth = 80, cellHeight = 50; // í‘œì˜ í¬ê¸° ì˜ˆì¸¡ê°’

        // OCR ê²°ê³¼ ê¸°ë°˜ í´ë¦­ ìœ„ì¹˜ ì°¾ê¸° (ìš°ì¸¡ -> ì¢Œì¸¡ ìˆœì„œ)
        string[] lines = result.GetText().Split('\n');
        int rowIdx = 0;

        for (int y = startY; y <= endY; y += cellHeight)
        {
            int colIdx = 0;
            for (int x = endX; x >= startX; x -= cellWidth)
            {
                if (rowIdx < lines.Length && colIdx < lines[rowIdx].Length)
                {
                    char ch = lines[rowIdx][colIdx];

                    // ìˆ«ìì´ë©° 0ì´ ì•„ë‹Œ ê²½ìš° í´ë¦­ ëŒ€ìƒìœ¼ë¡œ ë“±ë¡
                    if (char.IsDigit(ch) && ch != '0')
                    {
                        clickPositions.Add(new Point(x, y));
                    }
                }
                colIdx++;
            }
            rowIdx++;
        }

        // í´ë¦­ ìˆ˜í–‰ (0.5ì´ˆ ì´ë‚´)
        foreach (var pos in clickPositions)
        {
            await ClickAsync(pos.X, pos.Y);
            await Task.Delay(50); // ë¹ ë¥¸ í´ë¦­ì„ ìœ„í•œ ì§§ì€ ë”œë ˆì´
        }
    }

    /// <summary>
    /// ğŸ–±ï¸ ë¹„ë™ê¸° ë§ˆìš°ìŠ¤ í´ë¦­ (0.5ì´ˆ ì´ë‚´ ì‹¤í–‰)
    /// </summary>
    static async Task ClickAsync(int x, int y)
    {
        await Task.Run(() =>
        {
            SetCursorPos(x, y);
            mouse_event(MOUSEEVENTF_LEFTDOWN, x, y, 0, 0);
            mouse_event(MOUSEEVENTF_LEFTUP, x, y, 0, 0);
        });

        Console.WriteLine($"í´ë¦­: X={x}, Y={y}");
    }
}
ğŸ“Œ ì½”ë“œ ì„¤ëª…
ğŸ“¸ í™”ë©´ ìº¡ì²˜ (CaptureScreen())

(817, 345)ì—ì„œ (1381, 545) ë²”ìœ„ë§Œ ìº¡ì²˜.
ê° í‘œëŠ” ì•½ 80px ê°„ê²©ìœ¼ë¡œ ìˆìŒ.
ğŸ” OCRë¡œ ìˆ«ì ì¸ì‹ (DetectAndClick())

OpenCVë¡œ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜ + ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ + ì´ì§„í™” ì§„í–‰.
TesseractOCR ì‚¬ìš©í•˜ì—¬ í…ìŠ¤íŠ¸(ìˆ«ì) ê²€ì¶œ.
0ì´ ì•„ë‹Œ ìˆ«ìê°€ ìˆëŠ” ì¹¸ì„ ìš°ì¸¡ â†’ ì¢Œì¸¡ ìˆœìœ¼ë¡œ íƒìƒ‰.
ğŸ–±ï¸ ë§ˆìš°ìŠ¤ í´ë¦­ (ClickAsync())

mouse_event()ë¡œ í´ë¦­ ìˆ˜í–‰.
0.5ì´ˆ ë‚´ì— í´ë¦­í•˜ë„ë¡ ë¹ ë¥¸ ë”œë ˆì´(50ms) ì ìš©.
ğŸ“Œ ì‹¤í–‰ ì˜ˆì‹œ (ì½˜ì†” ì¶œë ¥)
makefile
ì½”ë“œ ë³µì‚¬
OCR ê²°ê³¼:
5  0  3
0  7  1
4  2  0

í´ë¦­: X=1381, Y=345
í´ë¦­: X=1201, Y=345
í´ë¦­: X=961, Y=395
í´ë¦­: X=1381, Y=445
í´ë¦­: X=1301, Y=445
âœ” 0ì´ ì•„ë‹Œ ìˆ«ìê°€ ìˆëŠ” ì¹¸ì„ ì˜¤ë¥¸ìª½ë¶€í„° í´ë¦­ ì™„ë£Œ!

ğŸ“Œ ì¶”ê°€ ê°œì„  ê°€ëŠ¥ ìš”ì†Œ
âœ… í´ë¦­ ì†ë„ ì¡°ì • ê°€ëŠ¥ (await Task.Delay(50))
âœ… OCR ì¸ì‹ ì •í™•ë„ ê°œì„  (Cv2.Threshold() íŒŒë¼ë¯¸í„° íŠœë‹)
âœ… TesseractOCRë¥¼ "digits" ì–¸ì–´ ëª¨ë¸ë¡œ ë³€ê²½í•˜ë©´ ìˆ«ì ì¸ì‹ ì„±ëŠ¥ í–¥ìƒ
