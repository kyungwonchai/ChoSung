using System;
using System.Data.SqlClient;
using System.Timers;

namespace DataUpdater
{
    class Program
    {
        private static Timer timer;
        private static readonly string connectionString = "Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password=myPassword;";

        static void Main(string[] args)
        {
            // 사용자가 깨어있는 시간 설정 (예: 9시부터 23시까지)
            TimeSpan startTime = new TimeSpan(9, 0, 0);
            TimeSpan endTime = new TimeSpan(23, 0, 0);

            // 1분마다 업데이트하는 타이머 설정
            timer = new Timer(60000); // 60000 밀리초 = 1분
            timer.Elapsed += (sender, e) => UpdateDataIfAwake(startTime, endTime);
            timer.Start();

            Console.WriteLine("Press Enter to exit...");
            Console.ReadLine();
        }

        private static void UpdateDataIfAwake(TimeSpan startTime, TimeSpan endTime)
        {
            TimeSpan currentTime = DateTime.Now.TimeOfDay;

            if (currentTime >= startTime && currentTime <= endTime)
            {
                UpdateData();
            }
            else
            {
                Console.WriteLine("현재 사용자가 깨어있지 않은 시간입니다.");
            }
        }

        private static void UpdateData()
        {
            try
            {
                using (SqlConnection connection = new SqlConnection(connectionString))
                {
                    connection.Open();

                    string query = "UPDATE myTable SET myColumn = @newValue WHERE someCondition = @conditionValue";

                    using (SqlCommand command = new SqlCommand(query, connection))
                    {
                        command.Parameters.AddWithValue("@newValue", "updatedValue");
                        command.Parameters.AddWithValue("@conditionValue", "someConditionValue");

                        int rowsAffected = command.ExecuteNonQuery();
                        Console.WriteLine($"업데이트 성공: {rowsAffected}개의 행이 업데이트됨");
                    }
                }
            }
            catch (SqlException ex)
            {
                Console.WriteLine($"데이터베이스 연결 실패: {ex.Message}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"예기치 않은 오류 발생: {ex.Message}");
            }
        }
    }
}
