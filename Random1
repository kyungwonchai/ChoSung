문서 목적: 이 문서는 AI 기반 코드 처리 엔진(이하 'AI')에게 C# 프로젝트의 전면적인 리팩토링 및 안정화 작업을 지시하기 위한 공식 명령 명세서입니다. AI는 이 문서에 기술된 절차, 규칙, 철학을 단 하나의 예외 없이 준수해야 합니다.

작업 핵심 철학: "선(先) 전면 개선, 후(後) 안정화". 코드의 품질을 산발적으로 개선하는 것이 아니라, 전문가가 프로젝트 전체를 한 번에 재설계하듯, 가능한 모든 개선 사항을 코드베이스 전체에 먼저 적용합니다. 그 후, 오직 그 결과물이 완벽하게 컴파일되도록 만드는 '안정화' 단계에 집중합니다.

Phase 0: 사전 준비 및 환경 설정 (Pre-computation & Environment Setup)
이유: 본격적인 코드 수정에 앞서, 작업의 안정성을 보장하고 필요한 모든 정보를 사전에 확보하기 위함입니다.

0.1: 작업 대상 식별: 현재 AI의 작업 세션 또는 활성 환경에 로드된 Visual Studio 솔루션(.sln)을 이번 작업의 유일한 대상으로 확정하십시오.

0.2: 메타데이터 추출 및 저장: 대상 솔루션으로부터 다음의 핵심 데이터들을 추출하여 내부 변수에 저장하고, 작업이 끝날 때까지 이 데이터를 일관되게 사용하십시오.

SolutionName: 솔루션 파일의 이름 (예: MyProject.sln)
SolutionRootPath: 솔루션 파일이 위치한 최상위 디렉토리의 절대 경로
DotNetVersion: 프로젝트 파일들(.csproj)을 분석하여 확인한 원본 .NET Framework 버전
BuildConfig: 솔루션에 정의된 기본 빌드 구성 (예: Debug|Any CPU)
0.3: 백업 건너뛰기 확인: 경고: 사용자의 명시적인 지시에 따라, 원본 소스 코드 백업 단계를 건너뜁니다. 이 작업은 안전망 없이 원본 코드를 직접 수정하므로, 모든 변경 사항은 되돌릴 수 없습니다. 각별한 주의가 필요합니다.

Phase 1: 전역 코드 리팩토링 (Global Code Refactoring)
이유: 이 단계의 목표는 코드베이스를 '최상의 상태'로 한 번에 변환하는 것입니다.

1.1: 작업 철학의 이해: 이 단계는 단 한 번의 원자적(Atomic)인 작업으로, 프로젝트 전체를 분석하고 가능한 모든 개선점을 적용하는 과정입니다.

1.2: 종합 분석 지시: 솔루션에 포함된 모든 C# 소스 코드 파일(.cs)에 대해 심층 분석을 시작하여 코드 간의 모든 상호 의존성을 파악해야 합니다.

1.3: 다중 개선 항목 동시 적용: 1.2의 분석 모델을 바탕으로, 아래 체크리스트의 모든 항목에 해당하는 개선 사항을 코드베이스 전체에 걸쳐 적용하십시오.

[리팩토링 체크리스트]
안정성 확보 (Ensuring Stability): 잠재적인 모든 리소스 누수 지점을 찾아 수정하십시오.
구조적 개선 (Structural Improvement): 과도하게 비대한 클래스나 메서드를 논리적인 단위로 분할하십시오.
군더더기 제거 (Code Bloat Removal) - 신규 필수 항목:
명령 1 (미사용 코드 제거): 솔루션 전체를 분석하여 절대로 호출되지 않는 private 메서드, 필드, 프로퍼티를 모두 찾아 과감히 삭제하십시오. public 멤버라도 솔루션 내에서 전혀 참조되지 않는다면 삭제 대상입니다.
명령 2 (미사용 참조 제거): 프로젝트 파일(.csproj)에 명시된 어셈블리 참조 목록과 실제 코드에서 사용되는 타입을 비교하여, 전혀 사용되지 않는 DLL 참조는 과감히 제거하십시오.
명령 3 (미사용 using 지시문 정리): 모든 C# 파일 상단의 불필요한 using 지시문을 모두 정리하십시오.
이유: 불필요한 코드는 컴파일 시간을 늘리고, 코드베이스를 혼란스럽게 하며, 잠재적인 유지보수 비용을 증가시킵니다. 이를 제거하면 프로젝트가 더 가볍고 명확해집니다.
설계 품질 향상 (Enhancing Design Quality): SOLID 원칙과 디자인 패턴을 코드의 맥락에 맞게 적용하십시오.
비동기 처리 및 스레드 안전성 강화 (최우선 필수 항목):
명령 1 (적극적인 async/await 도입): 데이터베이스 쿼리, 파일 입출력, 네트워크 요청 등 모든 동기적 I/O 및 장기 실행 작업을 찾아내어 async/await 기반의 비동기 코드로 전환하십시오. 이것은 선택이 아닌 필수입니다.
명령 2 (UI 스레드 접근 규칙 절대 준수): WinForms/WPF 환경에서, 백그라운드 스레드(Task)의 작업 결과를 UI 컨트롤에 반영해야 할 경우, 반드시 Invoke/BeginInvoke (WinForms) 또는 Dispatcher (WPF)를 통해 UI 스레드로 작업을 마샬링해야 합니다. 백그라운드 스레드에서 UI 객체를 직접 접근하는 코드는 절대 있어서는 안 되며, 발견 즉시 수정해야 합니다.
명령 3 (비동기 안티패턴 방지): 이벤트 핸들러를 제외하고는 async void 사용을 피하고, 동기화 컨텍스트가 필요 없는 라이브러리 성격의 코드에서는 ConfigureAwait(false)를 적극적으로 사용하여 잠재적인 데드락(Deadlock)을 원천적으로 예방하십시오.
Phase 2: 빌드 안정화 루프 (Build Stabilization Loop)
이유: 1단계의 대규모 변경으로 인해 발생한 컴파일 오류를 체계적으로 해결하기 위함입니다. 이 단계의 유일한 목표는 '컴파일 성공'입니다.

2.1: 루프의 목적 명확화: 당신은 이제부터 '리팩터'가 아닌 '버그 픽서'의 역할을 수행합니다. 코드의 의미나 구조를 바꾸려 해서는 안 됩니다.

2.2: 실행 프로토콜: 최대 50회 또는 빌드가 성공할 때까지 아래의 'A-B-C' 단계를 반복하십시오.

A. 빌드 시도 및 로그 생성:

필수 행동: MSBuild 커맨드를 실행하고, 모든 출력 및 에러를 1.log 파일에 덮어쓰기 형태로 저장해야 합니다. (msbuild ... > 1.log 2>&1)
B. 결과 분석: 1.log 파일의 내용을 읽고 빌드 성공 또는 실패 여부를 확인합니다.

C. 오류 수정 (빌드 실패 시):

명령 1 (최우선 순위 오류 처리 - sDatabaseServer.dll): 에러 원인이 smdDBConnection 클래스 참조 누락일 경우, 다음 절차를 따르십시오:

분석: sDatabaseServer.dll을 생성하는 프로젝트의 가장 최근 빌드 출력 폴더 경로(예: bin\Debug)를 파악합니다.
조치: 에러가 발생한 프로젝트의 참조 목록에서, sDatabaseServer.dll의 참조 경로가 위 경로로 올바르게 설정되도록 수정하거나 추가합니다.
주의: 이 DLL은 삭제하거나 내용을 변경해서는 안 됩니다.
조치 후, 즉시 A단계로 돌아갑니다.
명령 2 (일반 오류 처리): 위 경우가 아니라면, 로그에 기록된 가장 첫 번째 에러에만 집중하여, 문제를 해결하기 위한 최소한의 코드 수정만을 적용합니다.

명령 3 (루프 계속): 수정 조치를 적용한 후, 즉시 A단계로 돌아가 빌드를 다시 시도합니다.

Phase 3: 최종 보고 및 완료 (Final Reporting & Completion)
이유: 사용자가 AI의 모든 작업을 명확하게 추적하고, "코드가 바뀌었는지 아닌지"에 대한 의문 없이, 어떤 코드가 왜 변경되었는지 완전히 이해할 수 있도록 하기 위함입니다.

3.1: 보고서 생성: D:\refactoringhistory\{SolutionFolderName}\{SolutionName}_{yyyyMMddHHmmss}.txt 경로에 최종 보고 파일을 생성하십시오.
3.2: 보고서 내용 명세 (상세 감사 추적)
명령: 생성된 파일에 다음 내용을 '반드시' 극도로 상세하게 기록하십시오.
1. 작업 요약: "전역 리팩토링 후 빌드 안정화 작업 완료. 총 빌드 시도 횟수: [실제 시도 횟수]회."
2. 상세 변경 로그: 1단계와 2단계에서 발생한 모든 코드 수정 내역을 단 하나도 빠짐없이 기록해야 합니다. 각 항목은 아래의 명확한 형식을 따라야 합니다:
--------------------------------------------------
[변경 유형]: "미사용 private 메서드 삭제"
[대상 파일]: C:\...\MyProject\Utils\LegacyHelper.cs

[변경 전 (Before)]:
// 라인 85-90
private void ObsoleteCalculation()
{
    // ... (code that is never called)
}

[변경 후 (After)]:
// (해당 코드 블록 전체 삭제됨)
--------------------------------------------------
[변경 유형]: "비동기 전환"
[대상 파일]: C:\...\MyProject\Services\DataService.cs

[변경 전 (Before)]:
// 라인 50-55
public string GetData()
{
    var client = new WebClient();
    return client.DownloadString("http://example.com");
}

[변경 후 (After)]:
// 라인 50-56
public async Task<string> GetDataAsync()
{
    using (var client = new HttpClient())
    {
        return await client.GetStringAsync("http://example.com");
    }
}
--------------------------------------------------
설명: 이 로그는 단순한 요약이 아닙니다. Git Diff와 같이 모든 변경 사항을 명확하게 대조하고 감사할 수 있는 **상세 감사 추적(Audit Trail)**이어야만 합니다.
전역 불변 규칙 (Global Immutable Rules)
경고: 아래 규칙들은 이 명세서의 다른 어떤 지시보다도 우선하며, 모든 단계에서 항상 유효합니다.

실행 절대 금지: 컴파일된 .exe 파일은 어떤 이유로도 실행되어서는 안 됩니다.
password 문자열 취급: 이 단어는 일반 텍스트로 간주하며, 수정 대상에서 제외하지 않습니다.
실제 자격 증명 보호: 명백한 데이터베이스 연결 문자열 등은 절대 수정해서는 안 됩니다.