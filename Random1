는 코드를 수정하여 딕셔너리에 값이 제대로 할당되도록 보장한 버전입니다. 이 문제는 딕셔너리에 값을 배열로 저장하고 수정하는 과정에서 발생했을 가능성이 높으므로, 배열을 복사하여 수정한 뒤 다시 딕셔너리에 넣는 방식으로 수정했습니다.

vba
코드 복사
Sub ProcessSheetData()
    Dim lastRow As Long
    Dim currentRow As Long
    Dim dict As Object
    Dim t1 As String
    Dim key As String
    Dim col As Integer
    Dim tempArr As Variant

    ' 딕셔너리 생성
    Set dict = CreateObject("Scripting.Dictionary")

    ' C3부터 B100000의 마지막 행까지 확인
    lastRow = 주차2_시트.Cells(주차2_시트.Rows.Count, "B").End(xlUp).Row

    ' 초기 t1 값
    t1 = ""

    ' C3부터 마지막 행까지 반복
    For currentRow = 3 To lastRow
        ' C열 값 가져오기
        Dim cValue As String
        cValue = Trim(주차2_시트.Cells(currentRow, "C").Value)

        ' C열 값이 빈 값이 아니면 t1 업데이트
        If cValue <> "" Then
            t1 = cValue
        End If

        ' D열에서 키 추출
        Dim dValue As String
        dValue = Trim(주차2_시트.Cells(currentRow, "D").Value)
        key = GetKey(dValue)

        ' 키가 유효하고 t1이 비어 있지 않으면 딕셔너리에 저장 및 AH 열 뒤로 출력
        If key <> "" And t1 <> "" Then
            ' 딕셔너리에 키가 없으면 초기화
            If Not dict.exists(key) Then
                dict(key) = Array(0, 0, 0, 0, 0, 0) ' F~K 열 초기값
            End If

            ' 딕셔너리에서 배열 복사
            tempArr = dict(key)

            ' F~K 열 값을 배열에 합산
            For col = 1 To 6
                tempArr(col - 1) = tempArr(col - 1) + Val(주차2_시트.Cells(currentRow, 6 + col).Value)
            Next col

            ' 수정된 배열을 다시 딕셔너리에 저장
            dict(key) = tempArr

            ' AH 열부터 딕셔너리 값 출력
            For col = 1 To 6
                주차2_시트.Cells(currentRow, 33 + col).Value = tempArr(col - 1)
            Next col
        End If
    Next currentRow

    MsgBox "작업 완료!", vbInformation
End Sub

' 키를 추출하는 함수
Function GetKey(value As String) As String
    Dim i As Long
    Dim char As String
    Dim keyStart As Long
    Dim keyEnd As Long

    keyStart = 0
    keyEnd = InStr(1, value, "/") - 1 ' / 위치 전까지

    If keyEnd > 0 Then
        For i = keyEnd To 1 Step -1
            char = Mid(value, i, 1)
            ' 첫 번째 영어 문자를 발견한 위치
            If char Like "[A-Za-z]" Then
                keyStart = i
                Exit For
            End If
        Next i
    End If

    ' 키 추출
    If keyStart > 0 And keyEnd > 0 Then
        GetKey = Mid(value, keyStart, keyEnd - keyStart + 1)
    Else
        GetKey = "" ' 키가 없으면 빈 문자열 반환
    End If
End Function
주요 수정 내용
딕셔너리 값 수정 방식 변경:

dict(key) 값을 바로 수정하지 않고, 배열로 복사하여 수정 후 다시 저장하는 방식으로 변경했습니다.
배열 복사 및 수정:

딕셔너리에서 값을 tempArr에 복사합니다.
tempArr 값을 수정한 뒤, 다시 dict(key)에 저장합니다.
값 출력:

수정된 배열 값(tempArr)을 AH 열부터 출력합니다.
사용 방법
VBA 편집기에서 코드 삽입:

Excel VBA 편집기에서 코드를 붙여넣습니다.
매크로 실행:

Alt + F8을 눌러 ProcessSheetData 매크로를 실행합니다.
결과 확인:
