SELECT 
    rp.partcode,
    rp.partcount,
    rp.lastupdate,
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) THEN 
        CASE WHEN pm.inout_value = 'in' THEN pm.inout_count 
             WHEN pm.inout_value = 'incancel' THEN -pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_in_this_week`,
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) THEN 
        CASE WHEN pm.inout_value = 'out' THEN -pm.inout_count 
             WHEN pm.inout_value = 'outcancel' THEN pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_out_this_week`,
    -- Repeat for each of the last 4 weeks
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) - 1 THEN 
        CASE WHEN pm.inout_value = 'in' THEN pm.inout_count 
             WHEN pm.inout_value = 'incancel' THEN -pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_in_last_week`,
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) - 1 THEN 
        CASE WHEN pm.inout_value = 'out' THEN -pm.inout_count 
             WHEN pm.inout_value = 'outcancel' THEN pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_out_last_week`,
    -- Continue for weeks -2, -3, and -4 in similar fashion
    SUM(CASE WHEN YEARWEEK(pm.inputdate) = YEARWEEK(CURDATE()) - 2 THEN 
        CASE WHEN pm.inout_value = 'in' THEN pm.inout_count 
             WHEN pm.inout_value = 'incancel' THEN -pm.inout_count 
             ELSE 0 
        END 
    ELSE 0 END) AS `total_in_two_weeks_ago`,
    -- Add more for total_out_two_weeks_ago, and so on for weeks -3, -4
    -- Remember to adjust the CASE WHEN YEARWEEK for each additional week
FROM 
    smd.tbl_repare_part_remain rp
JOIN 
    smd.tbl_repare_partmanage pm ON rp.partcode = pm.partcode
GROUP BY 
    rp.partcode, rp.partcount, rp.lastupdate;
