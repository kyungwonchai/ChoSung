using System;
using System.Data;
using System.Data.SqlClient;

namespace WpfAppWithProcedure
{
    public partial class MainWindow : Window
    {
        // 멤버 변수로 DataTable 정의
        private DataTable dataTable;

        public MainWindow()
        {
            InitializeComponent();
            // 데이터 로딩 함수 호출
            LoadDataFromProcedure();
        }

        // 프로시저에서 데이터를 가져와 DataTable에 저장하는 함수
        private void LoadDataFromProcedure()
        {
            string connectionString = "Data Source=YourServer;Initial Catalog=YourDatabase;User ID=YourUser;Password=YourPassword";
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                using (SqlCommand command = new SqlCommand("YourStoredProcedureName", connection))
                {
                    command.CommandType = CommandType.StoredProcedure;

                    SqlDataAdapter adapter = new SqlDataAdapter(command);
                    dataTable = new DataTable();
                    adapter.Fill(dataTable);
                }
            }
        }

        // DataTable의 변경사항을 DB에 반영하는 함수
        private void UpdateDatabase()
        {
            string connectionString = "Data Source=YourServer;Initial Catalog=YourDatabase;User ID=YourUser;Password=YourPassword";
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();
                using (SqlCommand command = new SqlCommand("YourStoredProcedureName", connection))
                {
                    command.CommandType = CommandType.StoredProcedure;

                    SqlDataAdapter adapter = new SqlDataAdapter(command);
                    SqlCommandBuilder builder = new SqlCommandBuilder(adapter);

                    adapter.Update(dataTable);
                }
            }
        }

        // 버튼 클릭 등을 통해 UpdateDatabase 함수를 호출
        private void UpdateButton_Click(object sender, RoutedEventArgs e)
        {
            UpdateDatabase();
            MessageBox.Show("데이터베이스 업데이트 완료");
        }
    }
}
