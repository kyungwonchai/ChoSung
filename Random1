메라의 자동 초점 기능이 실시간으로 작동하지 않는 문제를 해결하기 위해서는 카메라 설정을 최적화하고, 가능한 경우 카메라의 특정 초점 모드를 활용해야 합니다. 현재 사용 중인 JourneyApps ZXing 라이브러리에서는 초점 모드와 관련된 설정을 CameraSettings를 통해 관리할 수 있습니다. 아래 코드를 통해 실시간으로 초점을 조정하고, 더 자주 자동 초점을 수행하도록 설정합니다.

수정된 MainActivity.kt
kotlin
코드 복사
package com.dxmxsmd.mobilechecker

import android.Manifest
import android.content.pm.PackageManager
import android.os.Bundle
import android.os.Handler
import android.os.Looper
import android.widget.TextView
import androidx.activity.ComponentActivity
import androidx.activity.result.contract.ActivityResultContracts
import androidx.core.content.ContextCompat
import com.google.zxing.BarcodeFormat
import com.google.zxing.ResultPoint
import com.journeyapps.barcodescanner.CameraSettings
import com.journeyapps.barcodescanner.DecoratedBarcodeView
import com.journeyapps.barcodescanner.BarcodeCallback
import com.journeyapps.barcodescanner.BarcodeResult
import com.journeyapps.barcodescanner.DefaultDecoderFactory

class MainActivity : ComponentActivity() {

    private lateinit var barcodeView: DecoratedBarcodeView
    private val focusHandler = Handler(Looper.getMainLooper())
    private val focusInterval: Long = 100 // 초점 조정 간격 (밀리초)

    private val requestPermissionLauncher =
        registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted: Boolean ->
            if (isGranted) {
                setupBarcodeView()
            } else {
                // 권한이 거부된 경우 처리
            }
        }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
            != PackageManager.PERMISSION_GRANTED) {
            requestPermissionLauncher.launch(Manifest.permission.CAMERA)
        } else {
            setupBarcodeView()
        }
    }

    private fun setupBarcodeView() {
        barcodeView = findViewById(R.id.camera_preview)

        // 카메라 설정: 자동 초점 및 프리뷰 활성화
        val cameraSettings = CameraSettings()
        cameraSettings.isAutoFocusEnabled = true
        cameraSettings.focusMode = CameraSettings.FocusMode.CONTINUOUS // 연속 초점 모드 사용
        barcodeView.barcodeView.cameraSettings = cameraSettings

        // 실시간 초점 조정(가능한 경우)
        focusHandler.postDelayed(object : Runnable {
            override fun run() {
                barcodeView.barcodeView.cameraInstance?.autoFocus() // 가능한 경우 수동으로 초점 재조정
                focusHandler.postDelayed(this, focusInterval)
            }
        }, focusInterval)

        // QR 코드와 바코드를 모두 인식할 수 있도록 설정
        val formats = listOf(BarcodeFormat.QR_CODE, BarcodeFormat.CODE_39, BarcodeFormat.CODE_128)
        barcodeView.barcodeView.decoderFactory = DefaultDecoderFactory(formats)

        barcodeView.decodeContinuous(object : BarcodeCallback {
            override fun barcodeResult(result: BarcodeResult?) {
                result?.let {
                    findViewById<TextView>(R.id.text_view_result).text =
                        "Scanned: ${it.text} (${it.barcodeFormat})"
                }
            }

            override fun possibleResultPoints(resultPoints: List<ResultPoint>) {
                // Optional: handle potential result points here
            }
        })
    }

    override fun onResume() {
        super.onResume()
        barcodeView.resume()
    }

    override fun onPause() {
        super.onPause()
        barcodeView.pause()
        focusHandler.removeCallbacksAndMessages(null)  // 초점 조정 중지
    }
}
주요 변경 사항:
CameraSettings의 focusMode 설정: CameraSettings.FocusMode.CONTINUOUS는 연속 자동 초점 모드로, 카메라가 계속해서 초점을 조정하려고 시도합니다. 이 모드는 특히 바코드나 QR 코드를 인식할 때 유용합니다.

수동 초점 조정: 가능한 경우, autoFocus() 메서드를 통해 추가적인 수동 초점 조정을 수행합니다. 이 방법은 카메라가 제공하는 초점 제어에 따라 효과가 다를 수 있습니다.

실시간 초점 조정 간격: focusHandler를 사용해 100밀리초마다 초점을 재조정하도록 설정했습니다. 이 간격은 필요에 따라 조정할 수 있습니다.

추가 팁:
카메라 거리: 카메라와 QR 코드/바코드 사이의 적절한 거리를 유지하는 것이 중요합니다. 너무 가까운 거리에서는 오히려 초점이 맞지 않을 수 있습니다.
환경 조명: 조명이 충분하지 않으면 자동 초점이 제대로 작동하지 않을 수 있으므로, 가능한 밝은 환경에서 테스트하세요.
이 설정으로 실시간 자동 초점 조정이 자주 수행되며, QR 코드와 바코드를 인식할 때 초점이 계속 맞춰지도록 개선됩니