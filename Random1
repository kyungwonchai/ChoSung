는 수정된 VBA 코드입니다. 이 코드는 각 날짜별로 Line1 값에 따라 day와 night 횟수를 계산하여 차트를 생성합니다.

Date1과 Shift1의 개수를 날짜 순서로 정렬한 차트를 생성합니다.
각 날짜별로 Line1 값을 기준으로 day와 night 횟수를 차트로 표현합니다.
VBA 코드
vba
코드 복사
Sub CreateShiftAndLineCharts()
    Dim ws As Worksheet
    Dim summaryWs As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim uniqueDates As Object, lineData As Object
    Dim i As Long
    Dim dateVal As String, shiftVal As String, lineVal As String
    Dim rowCounter As Long
    
    ' 데이터가 있는 시트 설정
    Set ws = ThisWorkbook.Sheets("Data")
    
    ' 요약 시트가 이미 있으면 삭제하고 새로 생성
    On Error Resume Next
    Set summaryWs = ThisWorkbook.Sheets("Summary")
    If Not summaryWs Is Nothing Then summaryWs.Delete
    On Error GoTo 0
    
    Set summaryWs = ThisWorkbook.Sheets.Add
    summaryWs.Name = "Summary"
    
    ' 날짜별 Shift1 개수를 저장할 딕셔너리 생성
    Set uniqueDates = CreateObject("Scripting.Dictionary")
    Set lineData = CreateObject("Scripting.Dictionary")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' Date1이 11월 4일 이후이고 Dup = 1인 데이터만 사용
    For i = 2 To lastRow
        If ws.Cells(i, 7).Value >= "2024-11-04" And ws.Cells(i, 10).Value = 1 Then
            dateVal = ws.Cells(i, 7).Value
            shiftVal = ws.Cells(i, 8).Value
            lineVal = ws.Cells(i, 1).Value
            
            ' Date1과 Shift1 기준으로 개수 누적
            If Not uniqueDates.exists(dateVal & "_" & shiftVal) Then
                uniqueDates(dateVal & "_" & shiftVal) = 0
            End If
            uniqueDates(dateVal & "_" & shiftVal) = uniqueDates(dateVal & "_" & shiftVal) + 1
            
            ' Line1별로 Shift1 개수를 저장
            If Not lineData.exists(dateVal & "_" & lineVal) Then
                Set lineData(dateVal & "_" & lineVal) = CreateObject("Scripting.Dictionary")
                lineData(dateVal & "_" & lineVal).Add "day", 0
                lineData(dateVal & "_" & lineVal).Add "night", 0
            End If
            lineData(dateVal & "_" & lineVal)(shiftVal) = lineData(dateVal & "_" & lineVal)(shiftVal) + 1
        End If
    Next i
    
    ' 요약 데이터 시트에 기록 (Date1, Shift1 별로)
    summaryWs.Range("A1").Value = "Date1"
    summaryWs.Range("B1").Value = "Shift1"
    summaryWs.Range("C1").Value = "Count"
    
    rowCounter = 2
    For Each key In uniqueDates.keys
        summaryWs.Cells(rowCounter, 1).Value = Split(key, "_")(0) ' Date1 값
        summaryWs.Cells(rowCounter, 2).Value = Split(key, "_")(1) ' Shift1 값
        summaryWs.Cells(rowCounter, 3).Value = uniqueDates(key)   ' Count 값
        rowCounter = rowCounter + 1
    Next key
    
    ' Date1과 Shift1 차트 생성
    Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=summaryWs.Range("A1:C" & summaryWs.Cells(summaryWs.Rows.Count, "A").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "Date1별 Shift1의 개수 (Day/Night)"
    End With
    
    ' 각 날짜별 Line1의 day/night 횟수 차트 생성
    Dim dateKey As Variant
    Dim lineIndex As Integer
    lineIndex = 1
    
    For Each dateKey In lineData.keys
        Dim lineSummaryRow As Long
        summaryWs.Cells(rowCounter, 1).Value = "Date1: " & Split(dateKey, "_")(0)
        summaryWs.Cells(rowCounter, 2).Value = "Line1: " & Split(dateKey, "_")(1)
        rowCounter = rowCounter + 1
        
        ' day/night 횟수 기록
        summaryWs.Cells(rowCounter, 1).Value = "Shift1"
        summaryWs.Cells(rowCounter, 2).Value = "Count"
        lineSummaryRow = rowCounter
        
        summaryWs.Cells(rowCounter + 1, 1).Value = "day"
        summaryWs.Cells(rowCounter + 1, 2).Value = lineData(dateKey)("day")
        summaryWs.Cells(rowCounter + 2, 1).Value = "night"
        summaryWs.Cells(rowCounter + 2, 2).Value = lineData(dateKey)("night")
        
        rowCounter = rowCounter + 3
        
        ' Line1별 day/night 횟수 차트 생성
        Set chart = summaryWs.ChartObjects.Add(Left:=100, Width:=375, Top:=350 + (lineIndex - 1) * 300, Height:=300)
        With chart.Chart
            .SetSourceData Source:=summaryWs.Range(summaryWs.Cells(lineSummaryRow + 1, 1), summaryWs.Cells(lineSummaryRow + 2, 2))
            .ChartType = xlColumnClustered
            .HasTitle = True
            .ChartTitle.Text = "Date1: " & Split(dateKey, "_")(0) & " / Line1: " & Split(dateKey, "_")(1) & "의 Day/Night 횟수"
        End With
        
        lineIndex = lineIndex + 1
    Next dateKey
End Sub
코드 설명
Date1과 Shift1별 개수 차트:

Summary 시트에 Date1과 Shift1별 개수를 집계하여 기록하고, 이를 클러스터형 막대 차트로 생성합니다.
각 날짜별 Line1의 day/night 횟수 차트:

각 Date1에 대해 Line1의 고유 값을 기준으로 day와 night 횟수를 계산합니다.
각 Date1 및 Line1에 대해 개별 차트를 생성하여 day와 night 횟수를 시각화합니다.
차트 배치:
