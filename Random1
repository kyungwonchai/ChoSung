New chat
Model: Default (GPT-3.5)
User
win10, win7에서 지금 시간 동기화서버의 주소정보와 PC시간을 mssql 특정 DB로 전달하는 winform c# 코드좀
ChatGPT

아래는 Windows 10 및 Windows 7에서 현재 시간을 동기화 서버에서 가져와서 MSSQL 특정 데이터베이스로 전달하는 WinForms C# 코드의 예입니다.

csharp

using System;
using System.Data.SqlClient;
using System.Windows.Forms;

namespace TimeSyncApp
{
    public partial class MainForm : Form
    {
        // MSSQL 연결 문자열
        private string connectionString = "Data Source=YourServer;Initial Catalog=YourDatabase;User ID=YourUsername;Password=YourPassword";

        public MainForm()
        {
            InitializeComponent();
        }

        private void syncButton_Click(object sender, EventArgs e)
        {
            // 현재 시간 가져오기
            DateTime currentTime = GetNetworkTime();

            // MSSQL에 연결하여 현재 시간 전달
            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                try
                {
                    connection.Open();

                    SqlCommand command = new SqlCommand("INSERT INTO TimeTable (SyncTime) VALUES (@SyncTime)", connection);
                    command.Parameters.AddWithValue("@SyncTime", currentTime);
                    command.ExecuteNonQuery();

                    MessageBox.Show("시간 동기화 및 전달 완료");
                }
                catch (Exception ex)
                {
                    MessageBox.Show("오류 발생: " + ex.Message);
                }
            }
        }

        // 시간 동기화 서버에서 현재 시간 가져오기
        private DateTime GetNetworkTime()
        {
            const string ntpServer = "time.windows.com"; // 시간 동기화 서버 주소

            try
            {
                using (var client = new System.Net.Sockets.Socket(System.Net.Sockets.AddressFamily.InterNetwork, System.Net.Sockets.SocketType.Stream, System.Net.Sockets.ProtocolType.Tcp))
                {
                    client.Connect(ntpServer, 123);

                    byte[] buffer = new byte[48];
                    buffer[0] = 0x1B;

                    client.Send(buffer);
                    client.Receive(buffer);
                    client.Close();

                    ulong intPart = BitConverter.ToUInt32(buffer, 40);
                    ulong fractPart = BitConverter.ToUInt32(buffer, 44);

                    ulong milliseconds = (intPart * 1000) + ((fractPart * 1000) / 0x100000000L);

                    DateTime networkDateTime = (new DateTime(1900, 1, 1)).AddMilliseconds((long)milliseconds);

                    return networkDateTime;
                }
            }
            catch
            {
                throw new Exception("시간 동기화 서버에 연결할 수 없습니다.");
            }
        }
    }
}

위의 코드는 MainForm이라는 WinForms 폼을 기반으로합니다. syncButton_Click 이벤트 핸들러에서 syncButton 클릭 시 시간 동기화 및 MSSQL 데이터베이스로 현재 시간을 전달하는 작업을 수행합니다.

connectionString 변수를 해당 MSSQL 서버 및 데이터베이스에 맞게 설정해야합니다. GetNetworkTime 메서드는 시간 동기화 서버에서 현재 시간을 가져오는 데 사용됩니다.

주의: 이 코드는 단순히 예시이며, 실제 응용 프로그램에서 사용하기 위해서는 예외 처리 및 유효성 검사 등을 추가해야할 수도 있습니다. 또한, 필요에 따라 MSSQL
2 / 2
ChatGPT may produce inaccurate information about people, places, or facts. ChatGPT May 12 Version

New chat
