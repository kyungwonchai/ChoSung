은 C# WinForms 애플리케이션에서 네트워크 폴더에 접근하여 파일을 복사한 후 연결을 끊는 코드 예제입니다. 이 코드는 System.Management 네임스페이스를 사용하여 네트워크 폴더를 매핑하고, System.IO를 사용하여 파일을 복사한 뒤 연결을 해제합니다.

먼저, 프로젝트에 System.Management를 추가해야 합니다. 이를 위해서는 프로젝트 참조에 System.Management를 추가하세요.

그런 다음, 다음 코드를 사용하세요:

csharp
코드 복사
using System;
using System.IO;
using System.Management;
using System.Windows.Forms;

namespace NetworkFolderAccess
{
    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent();
        }

        private void AccessNetworkFolder()
        {
            string networkPath = @"\\network\path\to\folder";
            string username = "abc";
            string password = "rtyuy";

            try
            {
                // 네트워크 폴더 연결
                ConnectToNetworkFolder(networkPath, username, password);

                // 파일 복사 작업 수행
                string sourceFile = Path.Combine(networkPath, "sourceFile.txt");
                string destinationFile = @"C:\local\path\destinationFile.txt";
                File.Copy(sourceFile, destinationFile, true);

                MessageBox.Show("파일 복사 완료");
            }
            catch (Exception ex)
            {
                MessageBox.Show("오류 발생: " + ex.Message);
            }
            finally
            {
                // 네트워크 폴더 연결 해제
                DisconnectFromNetworkFolder(networkPath);
            }
        }

        private void ConnectToNetworkFolder(string networkPath, string username, string password)
        {
            ManagementClass managementClass = new ManagementClass("Win32_NetworkConnection");
            ManagementBaseObject inParams = managementClass.GetMethodParameters("AddConnection");

            inParams["LocalName"] = null;
            inParams["RemoteName"] = networkPath;
            inParams["UserName"] = username;
            inParams["Password"] = password;

            ManagementBaseObject outParams = managementClass.InvokeMethod("AddConnection", inParams, null);

            if (outParams != null && (uint)outParams["ReturnValue"] != 0)
            {
                throw new Exception("네트워크 폴더 연결 실패: " + outParams["ReturnValue"]);
            }
        }

        private void DisconnectFromNetworkFolder(string networkPath)
        {
            ManagementClass managementClass = new ManagementClass("Win32_NetworkConnection");

            foreach (ManagementObject networkConnection in managementClass.GetInstances())
            {
                if (networkConnection["RemoteName"].ToString().Equals(networkPath, StringComparison.OrdinalIgnoreCase))
                {
                    networkConnection.Delete();
                }
            }
        }

        private void btnExecute_Click(object sender, EventArgs e)
        {
            AccessNetworkFolder();
        }
    }
}
이 코드는 AccessNetworkFolder 메서드를 통해 네트워크 폴더에 접근하고, 파일을 복사한 뒤 연결을 해제하는 예제입니다. ConnectToNetworkFolder와 DisconnectFromNetworkFolder 메서드를 사용하여 네트워크 폴더를 연결하고 해제합니다.

btnExecute 버튼 클릭 이벤트 핸들러에서 AccessNetworkFolder 메서드를 호출하도록 구성되어 있습니다. 이 버튼을 클릭하면 네트워크 폴더에 접근하여 파일을 복사하고 연결을 해제합