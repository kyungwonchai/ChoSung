OP 파일의 데이터를 주차별 파일의 병합된 셀 옆에 정확히 복사하도록 수정한 VBA 매크로입니다.

VBA 코드
vba
코드 복사
Sub ProcessMergedCellsComplete()
    Dim wbSOP As Workbook, wbWeek As Workbook
    Dim wsS1 As Worksheet, wsTarget As Worksheet
    Dim cell As Range, mergeRange As Range
    Dim sourceRange As Range, targetRange As Range
    Dim mergeValue As String
    Dim sourceRowStart As Long, sourceRowEnd As Long
    Dim targetRowStart As Long, targetRowEnd As Long
    Dim foundTarget As Boolean

    ' SOP 파일 찾기 (사내 일별계획 포함된 시트 찾기)
    For Each wbSOP In Application.Workbooks
        If InStr(1, wbSOP.Name, "SOP") > 0 Then
            Exit For
        End If
    Next wbSOP

    ' 주차별 파일 찾기
    For Each wbWeek In Application.Workbooks
        If InStr(1, wbWeek.Name, "SMD") > 0 Then
            Exit For
        End If
    Next wbWeek

    ' SOP 또는 SMD 파일 없을 경우
    If wbSOP Is Nothing Or wbWeek Is Nothing Then
        MsgBox "SOP 또는 주차별 파일이 열려 있지 않습니다.", vbCritical
        Exit Sub
    End If

    ' 사내 일별계획 시트 찾기
    For Each wsS1 In wbSOP.Worksheets
        If InStr(wsS1.Name, "사내") > 0 And InStr(wsS1.Name, "일별계획") > 0 Then
            Exit For
        End If
    Next wsS1

    If wsS1 Is Nothing Then
        MsgBox "사내 일별계획 시트를 찾을 수 없습니다.", vbCritical
        Exit Sub
    End If

    ' 병합된 셀 처리 (C열 기준)
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If Not cell.MergeArea Is Nothing Then
            ' 병합된 셀 영역
            Set mergeRange = cell.MergeArea
            mergeValue = mergeRange.Cells(1, 1).Value ' 병합된 셀 값
            sourceRowStart = mergeRange.Row ' 병합 영역의 시작 행
            sourceRowEnd = sourceRowStart + mergeRange.Rows.Count - 1 ' 병합 영역의 끝 행

            ' 병합된 셀 옆의 E열에서 "SM-" 포함된 값 찾기
            For sourceRowStart = sourceRowStart To sourceRowEnd
                If InStr(wsS1.Cells(sourceRowStart, "E").Value, "SM-") > 0 Then
                    ' 복사할 데이터 정의 (D열, F~K열)
                    Set sourceRange = wsS1.Range(wsS1.Cells(sourceRowStart, "E"), wsS1.Cells(sourceRowStart, "K"))
                    
                    ' 주차별 파일에서 병합된 셀 찾기
                    For Each wsTarget In wbWeek.Worksheets
                        If InStr(wsTarget.Name, mergeValue) > 0 Then
                            For Each targetCell In wsTarget.Range("C2:C" & wsTarget.Cells(wsTarget.Rows.Count, "C").End(xlUp).Row)
                                If Not targetCell.MergeArea Is Nothing And targetCell.MergeArea.Cells(1, 1).Value = mergeValue Then
                                    ' 대상 병합 셀 정보
                                    Set targetRange = targetCell.MergeArea
                                    targetRowStart = targetRange.Row
                                    targetRowEnd = targetRowStart + targetRange.Rows.Count - 1
                                    
                                    ' D열과 F~K열에 값 복사
                                    wsTarget.Cells(targetRowStart, "D").Value = wsS1.Cells(sourceRowStart, "E").Value
                                    wsTarget.Range(wsTarget.Cells(targetRowStart, "F"), wsTarget.Cells(targetRowEnd, "K")).Value = _
                                        wsS1.Range(wsS1.Cells(sourceRowStart, "F"), wsS1.Cells(sourceRowStart, "K")).Value
                                    
                                    ' 색칠: 복사 영역(노랑), 대상 영역(파랑)
                                    sourceRange.Interior.Color = RGB(255, 255, 0) ' 노랑
                                    targetRange.Interior.Color = RGB(0, 176, 240) ' 파랑
                                    foundTarget = True
                                    Exit For
                                End If
                            Next targetCell
                        End If
                        If foundTarget Then Exit For
                    Next wsTarget
                End If
            Next sourceRowStart
        End If
    Next cell

    ' 완료 메시지
    MsgBox "모든 병합된 셀 처리가 완료되었습니다. 복사 영역은 노랑, 대상 영역은 파랑으로 표시됩니다.", vbInformation
End Sub
코드 설명
병합된 셀 처리:

wsS1(사내 일별계획) 시트에서 병합된 셀(C열)을 탐색합니다.
병합된 셀의 시작 행과 끝 행을 계산하여 E열의 데이터를 확인합니다.
E열 값 확인:

E열에서 "SM-"이 포함된 값을 찾습니다.
복사 대상은 해당 행의 E열부터 K열까지의 데이터입니다.
주차별 시트의 병합된 셀 탐색:

주차별 파일의 모든 시트를 탐색하며, 병합된 셀(C열)에서 mergeValue와 동일한 값을 찾습니다.
데이터 복사:

대상 병합 셀 옆(D열)에 E열 값을 복사합니다.
대상 병합 셀 우측(F~K열)에 원본 F~K열 값을 복사합니다.
색칠:

원본 데이터(복사 영역): 노랑 (RGB(255, 255, 0))
복사된 데이터(붙이는 영역): 파랑 (RGB(0, 176, 240))
사용 방법
VBA 편집기 열기: Alt + F11
모듈 추가: 삽입 > 모듈
코드 붙여넣기: 위 코드를 붙여넣습니다.
매크로 실행:
Alt + F8 > ProcessMergedCellsComplete 선택 > 실행
결과
복사 소스 영역: 노란색으로 표시됩니다.
복사 대상 영역: 파란색으로 표시됩니다.