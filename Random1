using System;
using System.Data;
using System.Linq;

class Program
{
    static void Main()
    {
        DataTable dataTable = new DataTable(); // 예시용 DataTable
        // 여기에 dataTable을 초기화하는 코드를 추가해주세요.

        var query = from row in dataTable.AsEnumerable()
                    group row by row.Field<string>("nkey") into grp
                    orderby grp.Key
                    select grp.OrderByDescending(r => r.Field<string>("설변단계"))
                               .ThenByDescending(r => r.Field<string>("라인")).First();

        DataTable dataTable2 = query.CopyToDataTable();

        // 결과 확인
        foreach (DataRow row in dataTable2.Rows)
        {
            Console.WriteLine(row["nkey"]);
        }
    }
}
