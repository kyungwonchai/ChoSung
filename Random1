1. DatabaseScript.sql
sql
ì½”ë“œ ë³µì‚¬
-- DatabaseScript.sql
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” MS SQL Server 2014ì—ì„œ LockerManagementDB ë°ì´í„°ë² ì´ìŠ¤ ë°
-- LockerAssignments, MasterSelections, ChangeLogs í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.
-- LockerAssignments í…Œì´ë¸”ì€ ì‚¬ë¬¼í•¨ ë°°ì • ì •ë³´ë¥¼ ì €ì¥í•˜ë©°, ì¶”ê°€ ì»¬ëŸ¼(ì „ë°°ë³µì§, ë‚´ìš©, íŠ¹ì´ì‚¬í•­, ë¹„ê³ )ë„ í¬í•¨í•©ë‹ˆë‹¤.
-- MasterSelections í…Œì´ë¸”ì€ ê´€ë¦¬ í•­ëª©(ê´€ë¦¬í•­ëª©, ì¸µ, êµ¬ì—­, ì†ŒíŒŒíŠ¸, ê´€ë¦¬ì)ì˜ ì„ íƒ í•­ëª©ë“¤ì„ ì €ì¥í•©ë‹ˆë‹¤.
-- ChangeLogs í…Œì´ë¸”ì€ ëª¨ë“  ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ ì‘ì—…ì˜ ë¡œê·¸ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

-- 1) ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± (ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´)
IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'LockerManagementDB')
BEGIN
    CREATE DATABASE LockerManagementDB;
END
GO

-- ìƒì„±ëœ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©
USE LockerManagementDB;
GO

-- 2) LockerAssignments í…Œì´ë¸” ìƒì„±
IF OBJECT_ID('dbo.LockerAssignments', 'U') IS NOT NULL
    DROP TABLE dbo.LockerAssignments;
GO

CREATE TABLE LockerAssignments (
    Id INT PRIMARY KEY IDENTITY(1,1),             -- ê³ ìœ  ì‹ë³„ì (ìë™ ì¦ê°€)
    LockerType NVARCHAR(50) NOT NULL,             -- ê´€ë¦¬ í•­ëª© (ì˜ˆ: 'ê°œì¸ì‚¬ë¬¼í•¨', 'ë½ì»¤', 'ì‹ ë°œì¥')
    Floor NVARCHAR(10) NOT NULL,                  -- ì¸µ (ì˜ˆ: 'B1', '1', '2', '3', '4')
    Zone NVARCHAR(50) NOT NULL,                   -- êµ¬ì—­ (ì˜ˆ: 'A'~'H', 'B1'~'B4', 'ê¸°íƒ€')
    SpecificLocation NVARCHAR(100) NOT NULL,      -- ì„¸ë¶€ ìœ„ì¹˜ (ìˆ˜ê¸°ì…ë ¥)
    UserName NVARCHAR(100) NULL,                  -- ì‚¬ìš©ì ì„±ëª… (ìˆ˜ê¸°ì…ë ¥)
    KnoxId NVARCHAR(100) NULL,                    -- Knox ID (ìˆ˜ê¸°ì…ë ¥)
    SubPart NVARCHAR(50) NULL,                    -- ì†ŒíŒŒíŠ¸ (ì˜ˆ: 'Main(ì‹œìƒì‚°)', 'MainA'~'MainZ')
    Administrator NVARCHAR(100) NULL,             -- ê´€ë¦¬ì (ì˜ˆ: 'í™ê¸¸ë™A'~'í™ê¸¸ë™X')
    ì „ë°°ë³µì§ NVARCHAR(100) NULL,                   -- ì¶”ê°€ ì»¬ëŸ¼: ì „ë°°ë³µì§
    ë‚´ìš© NVARCHAR(MAX) NULL,                      -- ì¶”ê°€ ì»¬ëŸ¼: ë‚´ìš©
    íŠ¹ì´ì‚¬í•­ NVARCHAR(MAX) NULL,                  -- ì¶”ê°€ ì»¬ëŸ¼: íŠ¹ì´ì‚¬í•­
    ë¹„ê³  NVARCHAR(MAX) NULL,                      -- ì¶”ê°€ ì»¬ëŸ¼: ë¹„ê³ 
    LastUpdated DATETIME2 NOT NULL DEFAULT GETDATE()  -- ë§ˆì§€ë§‰ ìˆ˜ì •ì¼ì‹œ (ë³€ê²½ ì¶”ì )
);
GO

-- ì´ˆê¸° ë°ì´í„° ì‚½ì… (ì˜µì…˜)
INSERT INTO LockerAssignments (LockerType, Floor, Zone, SpecificLocation, Administrator, LastUpdated)
VALUES
('ê°œì¸ì‚¬ë¬¼í•¨', '1', 'A', 'A-01', 'System', GETDATE()),
('ê°œì¸ì‚¬ë¬¼í•¨', '1', 'A', 'A-02', 'System', GETDATE()),
('ë½ì»¤', 'B1', 'B1', 'R-B1-01', 'System', GETDATE()),
('ì‹ ë°œì¥', '2', '2F', 'S-2F-01', 'System', GETDATE());

INSERT INTO LockerAssignments (LockerType, Floor, Zone, SpecificLocation, UserName, KnoxId, SubPart, Administrator, LastUpdated)
VALUES
('ê°œì¸ì‚¬ë¬¼í•¨', '1', 'B', 'B-15', 'ê¹€ì² ìˆ˜', 'kimcs', 'MainA', 'í™ê¸¸ë™A', GETDATE());
GO

-- ì¸ë±ìŠ¤ ìƒì„± (ê²€ìƒ‰ ì„±ëŠ¥ í–¥ìƒ)
CREATE INDEX IX_LockerAssignments_Location ON dbo.LockerAssignments (Floor, Zone, SpecificLocation);
CREATE INDEX IX_LockerAssignments_User ON dbo.LockerAssignments (UserName);
GO

-- 3) MasterSelections í…Œì´ë¸” ìƒì„± (ê´€ë¦¬ í•­ëª© ë“± ì„ íƒ ëª©ë¡ ì €ì¥)
IF OBJECT_ID('dbo.MasterSelections', 'U') IS NOT NULL
    DROP TABLE dbo.MasterSelections;
GO

CREATE TABLE MasterSelections (
    Id INT PRIMARY KEY IDENTITY(1,1),              -- ê³ ìœ  ì‹ë³„ì
    Category NVARCHAR(50) NOT NULL,                -- ì¹´í…Œê³ ë¦¬ (ì˜ˆ: 'LockerType', 'Floor', 'Zone', 'SubPart', 'Administrator')
    Value NVARCHAR(50) NOT NULL                    -- ì„ íƒ í•­ëª© ê°’
);
GO

-- ì´ˆê¸° MasterSelections ë°ì´í„° ì‚½ì… (ì˜ˆì‹œ)
INSERT INTO MasterSelections (Category, Value) VALUES
('LockerType', 'ê°œì¸ì‚¬ë¬¼í•¨'),
('LockerType', 'ë½ì»¤'),
('LockerType', 'ì‹ ë°œì¥'),
('Floor', 'B1'),
('Floor', '1'),
('Floor', '2'),
('Floor', '3'),
('Floor', '4'),
('Zone', 'A'),
('Zone', 'B'),
('Zone', 'C'),
('Zone', 'D'),
('Zone', 'E'),
('Zone', 'F'),
('Zone', 'G'),
('Zone', 'H'),
('Zone', 'B1'),
('Zone', 'B2'),
('Zone', 'B3'),
('Zone', 'B4'),
('Zone', 'ê¸°íƒ€'),
('SubPart', 'Main(ì‹œìƒì‚°)'),
('SubPart', 'MainA'),
('SubPart', 'MainB'),
('SubPart', 'MainC'),
('SubPart', 'MainD'),
('Administrator', 'í™ê¸¸ë™A'),
('Administrator', 'í™ê¸¸ë™B'),
('Administrator', 'í™ê¸¸ë™C');
GO

-- 4) ChangeLogs í…Œì´ë¸” ìƒì„± (ëª¨ë“  ì‘ì—… ë¡œê·¸ ê¸°ë¡)
IF OBJECT_ID('dbo.ChangeLogs', 'U') IS NOT NULL
    DROP TABLE dbo.ChangeLogs;
GO

CREATE TABLE ChangeLogs (
    Id INT PRIMARY KEY IDENTITY(1,1),             -- ê³ ìœ  ì‹ë³„ì
    LogTime DATETIME2 NOT NULL DEFAULT GETDATE(), -- ë¡œê·¸ ë°œìƒ ì‹œê°„
    Operation NVARCHAR(50) NOT NULL,              -- ì‘ì—… ìœ í˜• (ì˜ˆ: ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ)
    UserName NVARCHAR(100) NULL,                  -- ì‘ì—…ì
    Description NVARCHAR(MAX) NOT NULL            -- ì‘ì—… ì„¤ëª…
);
GO

PRINT 'ë°ì´í„°ë² ì´ìŠ¤ ë° í…Œì´ë¸” ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
2. App.config
xml
ì½”ë“œ ë³µì‚¬
<?xml version="1.0" encoding="utf-8"?>
<!-- App.config: ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„± íŒŒì¼ (ì—°ê²° ë¬¸ìì—´ ë° EF ì„¤ì • í¬í•¨) -->
<configuration>
  <configSections>
    <section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
  </configSections>

  <connectionStrings>
    <!-- ì„œë²„ëª… ë° ë°ì´í„°ë² ì´ìŠ¤ëª…ì„ ì‹¤ì œ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì • -->
    <add name="LockerDbConnection"
         connectionString="Server=YOUR_SERVER_NAME;Database=LockerManagementDB;Trusted_Connection=True;"
         providerName="System.Data.SqlClient"/>
  </connectionStrings>

  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.8" />
  </startup>

  <entityFramework>
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework">
      <parameters>
        <parameter value="mssqllocaldb" />
      </parameters>
    </defaultConnectionFactory>
    <providers>
      <provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
    </providers>
  </entityFramework>
</configuration>
3. Models/LockerAssignment.cs
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Collections.Generic; // EqualityComparer ì‚¬ìš©
using System.ComponentModel;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using System.Runtime.CompilerServices;

namespace LockerManagementApp.Models
{
    /// <summary>
    /// ì‚¬ë¬¼í•¨ ë°°ì • ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°ì´í„° ëª¨ë¸ í´ë˜ìŠ¤ (ì¶”ê°€ ì»¬ëŸ¼ í¬í•¨)
    /// INotifyPropertyChangedë¥¼ êµ¬í˜„í•˜ì—¬ ì†ì„± ë³€ê²½ ì‹œ UIê°€ ìë™ ê°±ì‹ ë©ë‹ˆë‹¤.
    /// </summary>
    [Table("LockerAssignments")]
    public class LockerAssignment : INotifyPropertyChanged
    {
        // ë‚´ë¶€ í•„ë“œ ì„ ì–¸
        private int _id;
        private string _lockerType = string.Empty;
        private string _floor = string.Empty;
        private string _zone = string.Empty;
        private string _specificLocation = string.Empty;
        private string _userName;
        private string _knoxId;
        private string _subPart;
        private string _administrator;
        private string _ì „ë°°ë³µì§;
        private string _ë‚´ìš©;
        private string _íŠ¹ì´ì‚¬í•­;
        private string _ë¹„ê³ ;
        private DateTime _lastUpdated = DateTime.Now;

        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int Id
        {
            get => _id;
            set => SetProperty(ref _id, value);
        }

        [Required(ErrorMessage = "ì‚¬ë¬¼í•¨ ì¢…ë¥˜ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(50)]
        public string LockerType
        {
            get => _lockerType;
            set => SetProperty(ref _lockerType, value);
        }

        [Required(ErrorMessage = "ì¸µ ì •ë³´ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(10)]
        public string Floor
        {
            get => _floor;
            set => SetProperty(ref _floor, value);
        }

        [Required(ErrorMessage = "êµ¬ì—­ ì •ë³´ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(50)]
        public string Zone
        {
            get => _zone;
            set => SetProperty(ref _zone, value);
        }

        [Required(ErrorMessage = "ì„¸ë¶€ ìœ„ì¹˜ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(100)]
        public string SpecificLocation
        {
            get => _specificLocation;
            set => SetProperty(ref _specificLocation, value);
        }

        [StringLength(100)]
        public string UserName
        {
            get => _userName;
            set
            {
                if (SetProperty(ref _userName, value))
                    OnPropertyChanged(nameof(IsAssigned));
            }
        }

        [StringLength(100)]
        public string KnoxId
        {
            get => _knoxId;
            set => SetProperty(ref _knoxId, value);
        }

        [StringLength(50)]
        public string SubPart
        {
            get => _subPart;
            set => SetProperty(ref _subPart, value);
        }

        [StringLength(100)]
        public string Administrator
        {
            get => _administrator;
            set => SetProperty(ref _administrator, value);
        }

        // ì¶”ê°€ ì»¬ëŸ¼ë“¤
        [StringLength(100)]
        public string ì „ë°°ë³µì§
        {
            get => _ì „ë°°ë³µì§;
            set => SetProperty(ref _ì „ë°°ë³µì§, value);
        }

        public string ë‚´ìš©
        {
            get => _ë‚´ìš©;
            set => SetProperty(ref _ë‚´ìš©, value);
        }

        public string íŠ¹ì´ì‚¬í•­
        {
            get => _íŠ¹ì´ì‚¬í•­;
            set => SetProperty(ref _íŠ¹ì´ì‚¬í•­, value);
        }

        public string ë¹„ê³ 
        {
            get => _ë¹„ê³ ;
            set => SetProperty(ref _ë¹„ê³ , value);
        }

        public DateTime LastUpdated
        {
            get => _lastUpdated;
            set => SetProperty(ref _lastUpdated, value);
        }

        [NotMapped]
        public bool IsAssigned => !string.IsNullOrWhiteSpace(UserName);

        public override string ToString()
        {
            return $"{Floor}-{Zone}-{SpecificLocation}: {(IsAssigned ? UserName : "(ë¹„ì–´ ìˆìŒ)")}";
        }

        // INotifyPropertyChanged êµ¬í˜„
        public event PropertyChangedEventHandler PropertyChanged;
        protected virtual void OnPropertyChanged([CallerMemberName]string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
        protected bool SetProperty<T>(ref T storage, T value, [CallerMemberName]string propertyName = null)
        {
            if (EqualityComparer<T>.Default.Equals(storage, value))
                return false;
            storage = value;
            OnPropertyChanged(propertyName);
            return true;
        }
    }
}
4. Models/MasterSelection.cs
csharp
ì½”ë“œ ë³µì‚¬
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace LockerManagementApp.Models
{
    /// <summary>
    /// ë§ˆìŠ¤í„° ì„ íƒ í•­ëª© ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë°ì´í„° ëª¨ë¸ í´ë˜ìŠ¤
    /// ê´€ë¦¬í•­ëª©, ì¸µ, êµ¬ì—­, ì†ŒíŒŒíŠ¸, ê´€ë¦¬ìë¥¼ í¬í•¨í•˜ì—¬ ì„ íƒ ê°€ëŠ¥í•œ ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
    /// </summary>
    [Table("MasterSelections")]
    public class MasterSelection
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int Id { get; set; }

        [Required(ErrorMessage = "ì¹´í…Œê³ ë¦¬ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(50)]
        public string Category { get; set; }

        [Required(ErrorMessage = "ê°’ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(50)]
        public string Value { get; set; }
    }
}
5. Models/ChangeLog.cs
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace LockerManagementApp.Models
{
    /// <summary>
    /// ì‹œìŠ¤í…œ ë¡œê·¸ ì •ë³´ë¥¼ ê¸°ë¡í•˜ëŠ” ë°ì´í„° ëª¨ë¸ í´ë˜ìŠ¤
    /// ëª¨ë“  ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ì‘ì—…ì˜ ë¡œê·¸ë¥¼ ChangeLogs í…Œì´ë¸”ì— ì €ì¥í•©ë‹ˆë‹¤.
    /// </summary>
    [Table("ChangeLogs")]
    public class ChangeLog
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int Id { get; set; }

        // ë¡œê·¸ê°€ ë°œìƒí•œ ì‹œê°„ (ìë™ ì„¤ì •)
        public DateTime LogTime { get; set; } = DateTime.Now;

        [Required(ErrorMessage = "ì‘ì—… ìœ í˜•ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        [StringLength(50)]
        public string Operation { get; set; }  // ì˜ˆ: "ì¶”ê°€", "ìˆ˜ì •", "ì‚­ì œ"

        [StringLength(100)]
        public string UserName { get; set; }

        [Required(ErrorMessage = "ì„¤ëª…ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")]
        public string Description { get; set; }
    }
}
6. Data/LockerDbContext.cs
csharp
ì½”ë“œ ë³µì‚¬
using LockerManagementApp.Models;
using System;
using System.Data.Entity;
using System.Linq;
using System.Threading.Tasks;

namespace LockerManagementApp.Data
{
    /// <summary>
    /// Entity Framework 6 DbContext í´ë˜ìŠ¤
    /// LockerAssignments, MasterSelections, ChangeLogs í…Œì´ë¸”ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
    /// </summary>
    public class LockerDbContext : DbContext
    {
        public DbSet<LockerAssignment> LockerAssignments { get; set; }
        public DbSet<MasterSelection> MasterSelections { get; set; }
        public DbSet<ChangeLog> ChangeLogs { get; set; }

        public LockerDbContext() : base("name=LockerDbConnection")
        {
            // App.configì˜ ì—°ê²° ë¬¸ìì—´ì„ ì‚¬ìš©
        }

        protected override void OnModelCreating(DbModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);
        }

        public override int SaveChanges()
        {
            UpdateTimestamps();
            return base.SaveChanges();
        }

        public override Task<int> SaveChangesAsync()
        {
            UpdateTimestamps();
            return base.SaveChangesAsync();
        }

        /// <summary>
        /// ì¶”ê°€ í˜¹ì€ ìˆ˜ì •ëœ LockerAssignment ì—”í‹°í‹°ì˜ LastUpdated ê°’ì„ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        /// </summary>
        private void UpdateTimestamps()
        {
            var entries = ChangeTracker.Entries<LockerAssignment>()
                .Where(e => e.State == EntityState.Added || e.State == EntityState.Modified);

            foreach (var entry in entries)
                entry.Entity.LastUpdated = DateTime.Now;
        }

        /// <summary>
        /// ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ëŠ” í—¬í¼ ë©”ì„œë“œ
        /// </summary>
        public void AddChangeLog(string operation, string userName, string description)
        {
            ChangeLogs.Add(new ChangeLog {
                Operation = operation,
                UserName = userName,
                Description = description,
                LogTime = DateTime.Now
            });
        }
    }
}
7. Infrastructure/ViewModelBase.cs
csharp
ì½”ë“œ ë³µì‚¬
using System.Collections.Generic;
using System.ComponentModel;
using System.Runtime.CompilerServices;

namespace LockerManagementApp.Infrastructure
{
    /// <summary>
    /// ëª¨ë“  ViewModelì˜ ê¸°ë³¸ í´ë˜ìŠ¤ (INotifyPropertyChanged êµ¬í˜„)
    /// </summary>
    public abstract class ViewModelBase : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;
        protected virtual void OnPropertyChanged([CallerMemberName]string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
        protected bool SetProperty<T>(ref T storage, T value, [CallerMemberName]string propertyName = null)
        {
            if (EqualityComparer<T>.Default.Equals(storage, value))
                return false;
            storage = value;
            OnPropertyChanged(propertyName);
            return true;
        }
    }
}
8. Infrastructure/RelayCommand.cs
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Windows.Input;

namespace LockerManagementApp.Infrastructure
{
    /// <summary>
    /// RelayCommand í´ë˜ìŠ¤: ICommand ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¡œ, ì»¤ë§¨ë“œ ì‹¤í–‰ ë° í™œì„±í™” ì—¬ë¶€ë¥¼ ì œì–´í•©ë‹ˆë‹¤.
    /// </summary>
    public class RelayCommand : ICommand
    {
        private readonly Action<object> _execute;
        private readonly Predicate<object> _canExecute;

        public event EventHandler CanExecuteChanged
        {
            add    { CommandManager.RequerySuggested += value; }
            remove { CommandManager.RequerySuggested -= value; }
        }

        public RelayCommand(Action<object> execute, Predicate<object> canExecute = null)
        {
            _execute = execute ?? throw new ArgumentNullException(nameof(execute));
            _canExecute = canExecute;
        }

        public bool CanExecute(object parameter) => _canExecute == null || _canExecute(parameter);
        public void Execute(object parameter) => _execute(parameter);
        public void RaiseCanExecuteChanged() => CommandManager.InvalidateRequerySuggested();
    }
}
9. ViewModels/MainViewModel.cs
csharp
ì½”ë“œ ë³µì‚¬
using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Data.Entity;
using System.Data.Entity.Infrastructure;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ì‚¬ë¬¼í•¨ ê´€ë¦¬ ViewModel
    /// ë°ì´í„° ë¡œë“œ, ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ ë° ì‘ì—… ë¡œê·¸ ê¸°ë¡ ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤.
    /// </summary>
    public class MainViewModel : ViewModelBase, IDisposable
    {
        private LockerDbContext _context;
        private ObservableCollection<LockerAssignment> _lockerAssignments;
        private LockerAssignment _selectedAssignment;
        private string _statusBarText = "ì¤€ë¹„ ì™„ë£Œ";
        private string _currentAdmin = "í™ê¸¸ë™A"; // ì˜ˆì œ ê´€ë¦¬ì

        public ObservableCollection<LockerAssignment> LockerAssignments
        {
            get => _lockerAssignments;
            set => SetProperty(ref _lockerAssignments, value);
        }

        public LockerAssignment SelectedAssignment
        {
            get => _selectedAssignment;
            set
            {
                if (SetProperty(ref _selectedAssignment, value))
                {
                    ((RelayCommand)DeleteCommand).RaiseCanExecuteChanged();
                    ((RelayCommand)ClearAssignmentCommand).RaiseCanExecuteChanged();
                }
            }
        }

        public string StatusBarText
        {
            get => _statusBarText;
            set => SetProperty(ref _statusBarText, value);
        }

        // ëª…ë ¹ë“¤
        public RelayCommand LoadDataCommand { get; }
        public RelayCommand SaveChangesCommand { get; }
        public RelayCommand AddNewCommand { get; }
        public RelayCommand DeleteCommand { get; }
        public RelayCommand ClearAssignmentCommand { get; }

        public MainViewModel()
        {
            try { _context = new LockerDbContext(); }
            catch (Exception ex)
            {
                MessageBox.Show($"ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸ ìƒì„± ì˜¤ë¥˜: {ex}", "ì´ˆê¸°í™” ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                StatusBarText = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜!";
                return;
            }
            LockerAssignments = new ObservableCollection<LockerAssignment>();

            // ì»¤ë§¨ë“œ ì´ˆê¸°í™”
            LoadDataCommand = new RelayCommand(async _ => await LoadDataAsync());
            SaveChangesCommand = new RelayCommand(async _ => await SaveChangesAsync());
            AddNewCommand = new RelayCommand(AddNewLocker);
            DeleteCommand = new RelayCommand(async _ => await DeleteSelectedAsync(), _ => SelectedAssignment != null);
            ClearAssignmentCommand = new RelayCommand(_ => ClearSelectedAssignment(), _ => SelectedAssignment != null && SelectedAssignment.IsAssigned);

            _ = LoadDataAsync();
        }

        public async Task LoadDataAsync()
        {
            if (_context == null) return;
            StatusBarText = "ë°ì´í„° ë¡œë”© ì¤‘...";
            try
            {
                var assignments = await _context.LockerAssignments
                                    .OrderBy(l => l.Floor)
                                    .ThenBy(l => l.Zone)
                                    .ThenBy(l => l.SpecificLocation)
                                    .ToListAsync();
                LockerAssignments = new ObservableCollection<LockerAssignment>(assignments);
                StatusBarText = $"ì´ {LockerAssignments.Count}ê°œ ë ˆì½”ë“œ ë¡œë“œ ì™„ë£Œ.";
            }
            catch (Exception ex)
            {
                StatusBarText = $"ë¡œë“œ ì˜¤ë¥˜: {ex.Message}";
                MessageBox.Show($"ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {ex.Message}", "ë¡œë“œ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
            }
        }

        public async Task SaveChangesAsync()
        {
            if (_context == null) return;
            StatusBarText = "ë³€ê²½ ì‚¬í•­ ì €ì¥ ì¤‘...";
            try
            {
                var changedEntries = _context.ChangeTracker.Entries<LockerAssignment>()
                    .Where(e => e.State == EntityState.Added || e.State == EntityState.Modified)
                    .ToList();

                // ì¤‘ë³µ ê²€ì‚¬ (ë¬¼ë¦¬ì  ìœ„ì¹˜ ì¤‘ë³µ)
                var duplicates = LockerAssignments.GroupBy(l => new { l.Floor, l.Zone, l.SpecificLocation })
                                    .Where(g => g.Count() > 1)
                                    .Select(g => $"{g.Key.Floor}-{g.Key.Zone}-{g.Key.SpecificLocation}");
                if (duplicates.Any())
                {
                    MessageBox.Show($"ì €ì¥ ì‹¤íŒ¨: ì¤‘ë³µ ìœ„ì¹˜ ë°œê²¬ - {string.Join(", ", duplicates)}", "ì¤‘ë³µ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Warning);
                    StatusBarText = "ì¤‘ë³µìœ¼ë¡œ ì €ì¥ ì‹¤íŒ¨.";
                    RollbackChanges(changedEntries);
                    return;
                }

                // ê´€ë¦¬ì ì •ë³´ ì—…ë°ì´íŠ¸ ë° ê° ì‘ì—…ë³„ ë¡œê·¸ ê¸°ë¡
                foreach (var entry in changedEntries)
                {
                    entry.Entity.Administrator = _currentAdmin;
                    if (entry.State == EntityState.Added)
                        _context.AddChangeLog("ì¶”ê°€", _currentAdmin, $"ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€: {entry.Entity}");
                    else if (entry.State == EntityState.Modified)
                        _context.AddChangeLog("ìˆ˜ì •", _currentAdmin, $"ì‚¬ë¬¼í•¨ ìˆ˜ì •: {entry.Entity}");
                }

                int count = await _context.SaveChangesAsync();
                StatusBarText = $"ì´ {count}ê±´ ë³€ê²½ ì €ì¥ ì™„ë£Œ.";
            }
            catch (DbUpdateException dbEx)
            {
                string err = dbEx.InnerException?.Message ?? dbEx.Message;
                StatusBarText = $"ì €ì¥ ì˜¤ë¥˜: {err}";
                MessageBox.Show($"ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {err}", "ì €ì¥ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                RollbackChanges(_context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged));
            }
            catch (Exception ex)
            {
                StatusBarText = $"ì €ì¥ ì˜¤ë¥˜: {ex.Message}";
                MessageBox.Show($"ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ: {ex.Message}", "ì €ì¥ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                RollbackChanges(_context.ChangeTracker.Entries().Where(e => e.State != EntityState.Unchanged));
            }
        }

        private void RollbackChanges(IEnumerable<DbEntityEntry> changedEntries)
        {
            if (_context == null) return;
            foreach (var entry in changedEntries.ToList())
            {
                switch (entry.State)
                {
                    case EntityState.Modified:
                        entry.CurrentValues.SetValues(entry.OriginalValues);
                        entry.State = EntityState.Unchanged;
                        break;
                    case EntityState.Added:
                        entry.State = EntityState.Detached;
                        if (entry.Entity is LockerAssignment addEntity)
                            LockerAssignments.Remove(addEntity);
                        break;
                    case EntityState.Deleted:
                        entry.State = EntityState.Unchanged;
                        break;
                }
            }
            StatusBarText = "ë³€ê²½ ì‚¬í•­ ë¡¤ë°± ì™„ë£Œ.";
        }

        private void AddNewLocker(object parameter)
        {
            if (_context == null) return;
            var newAssignment = new LockerAssignment
            {
                LockerType = "ê°œì¸ì‚¬ë¬¼í•¨",
                Floor = "1",
                Zone = "A",
                SpecificLocation = "ìƒˆ ìœ„ì¹˜-" + Guid.NewGuid().ToString().Substring(0, 4),
                Administrator = _currentAdmin,
                LastUpdated = DateTime.Now
            };
            LockerAssignments.Add(newAssignment);
            _context.LockerAssignments.Add(newAssignment);
            SelectedAssignment = newAssignment;
            StatusBarText = "ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€ë¨. ì„¸ë¶€ ì •ë³´ ì…ë ¥ í›„ ì €ì¥í•˜ì„¸ìš”.";
        }

        private async Task DeleteSelectedAsync()
        {
            if (_context == null || SelectedAssignment == null) return;
            if (MessageBox.Show($"'{SelectedAssignment.Floor}-{SelectedAssignment.Zone}-{SelectedAssignment.SpecificLocation}' ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                                "ì‚­ì œ í™•ì¸", MessageBoxButton.YesNo, MessageBoxImage.Warning) == MessageBoxResult.Yes)
            {
                try
                {
                    _context.LockerAssignments.Remove(SelectedAssignment);
                    _context.AddChangeLog("ì‚­ì œ", _currentAdmin, $"ì‚¬ë¬¼í•¨ ì‚­ì œ: {SelectedAssignment}");
                    int count = await _context.SaveChangesAsync();
                    LockerAssignments.Remove(SelectedAssignment);
                    SelectedAssignment = null;
                    StatusBarText = $"ì´ {count}ê±´ ì‚­ì œ ì™„ë£Œ.";
                }
                catch (DbUpdateException dbEx)
                {
                    string err = dbEx.InnerException?.Message ?? dbEx.Message;
                    StatusBarText = $"ì‚­ì œ ì˜¤ë¥˜: {err}";
                    MessageBox.Show($"ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {err}", "ì‚­ì œ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                    await LoadDataAsync();
                }
                catch (Exception ex)
                {
                    StatusBarText = $"ì‚­ì œ ì˜¤ë¥˜: {ex.Message}";
                    MessageBox.Show($"ì‚­ì œ ì¤‘ ì˜ˆì™¸ ë°œìƒ: {ex.Message}", "ì‚­ì œ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                    await LoadDataAsync();
                }
            }
        }

        private void ClearSelectedAssignment()
        {
            if (_context == null || SelectedAssignment == null) return;
            SelectedAssignment.UserName = null;
            SelectedAssignment.KnoxId = null;
            SelectedAssignment.SubPart = null;
            _context.Entry(SelectedAssignment).State = EntityState.Modified;
            SelectedAssignment.Administrator = _currentAdmin;
            _context.AddChangeLog("ìˆ˜ì •", _currentAdmin, $"ë°°ì • í•´ì œ: {SelectedAssignment}");
            StatusBarText = $"'{SelectedAssignment.Floor}-{SelectedAssignment.Zone}-{SelectedAssignment.SpecificLocation}' ë°°ì • í•´ì œë¨.";
        }

        #region IDisposable êµ¬í˜„
        private bool disposed = false;
        public void Dispose()
        {
            if (!disposed)
            {
                _context?.Dispose();
                disposed = true;
            }
            GC.SuppressFinalize(this);
        }
        #endregion
    }
}
10. ViewModels/MasterSettingsViewModel.cs
csharp
ì½”ë“œ ë³µì‚¬
using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.ObjectModel;
using System.Data.Entity;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ë§ˆìŠ¤í„° ì„¤ì • ViewModel
    /// ê´€ë¦¬ í•­ëª©, ì¸µ, êµ¬ì—­, ì†ŒíŒŒíŠ¸, ê´€ë¦¬ì ë“±ì˜ ì„ íƒ í•­ëª©ì„ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œí•˜ê³ ,
    /// ë³€ê²½ ì‹œ ê¸°ì¡´ LockerAssignments ë ˆì½”ë“œì˜ ê°’ë„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    /// </summary>
    public class MasterSettingsViewModel : ViewModelBase, IDisposable
    {
        private LockerDbContext _context;
        private ObservableCollection<MasterSelection> _masterSelections;
        private MasterSelection _selectedMasterSelection;
        private string _statusMessage = "ë§ˆìŠ¤í„° ì„¤ì • ì¤€ë¹„ ì™„ë£Œ.";

        public ObservableCollection<MasterSelection> MasterSelections
        {
            get => _masterSelections;
            set => SetProperty(ref _masterSelections, value);
        }

        public MasterSelection SelectedMasterSelection
        {
            get => _selectedMasterSelection;
            set => SetProperty(ref _selectedMasterSelection, value);
        }

        public string StatusMessage
        {
            get => _statusMessage;
            set => SetProperty(ref _statusMessage, value);
        }

        // ëª…ë ¹ë“¤
        public RelayCommand LoadMasterSelectionsCommand { get; }
        public RelayCommand SaveMasterSelectionCommand { get; }
        public RelayCommand AddMasterSelectionCommand { get; }
        public RelayCommand DeleteMasterSelectionCommand { get; }
        public RelayCommand UpdateRelatedRecordsCommand { get; }

        public MasterSettingsViewModel()
        {
            try { _context = new LockerDbContext(); }
            catch (Exception ex)
            {
                MessageBox.Show($"DbContext ìƒì„± ì˜¤ë¥˜: {ex}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                StatusMessage = "DB ì—°ê²° ì˜¤ë¥˜";
                return;
            }

            MasterSelections = new ObservableCollection<MasterSelection>();
            LoadMasterSelectionsCommand = new RelayCommand(async _ => await LoadMasterSelectionsAsync());
            SaveMasterSelectionCommand = new RelayCommand(async _ => await SaveMasterSelectionAsync(), _ => SelectedMasterSelection != null);
            AddMasterSelectionCommand = new RelayCommand(async _ => await AddMasterSelectionAsync());
            DeleteMasterSelectionCommand = new RelayCommand(async _ => await DeleteMasterSelectionAsync(), _ => SelectedMasterSelection != null);
            UpdateRelatedRecordsCommand = new RelayCommand(async _ => await UpdateRelatedRecordsAsync(), _ => SelectedMasterSelection != null);

            _ = LoadMasterSelectionsAsync();
        }

        public async Task LoadMasterSelectionsAsync()
        {
            if (_context == null) return;
            try
            {
                var selections = await _context.MasterSelections
                                    .OrderBy(m => m.Category)
                                    .ThenBy(m => m.Value)
                                    .ToListAsync();
                MasterSelections = new ObservableCollection<MasterSelection>(selections);
                StatusMessage = $"ì´ {MasterSelections.Count}ê°œ ë¡œë“œ ì™„ë£Œ.";
            }
            catch (Exception ex)
            {
                StatusMessage = $"ë¡œë“œ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        public async Task SaveMasterSelectionAsync()
        {
            if (_context == null || SelectedMasterSelection == null) return;
            try
            {
                // ì‹ ê·œ í•­ëª©ì´ë©´ Added, ê¸°ì¡´ì´ë©´ Modified ì²˜ë¦¬
                _context.Entry(SelectedMasterSelection).State = SelectedMasterSelection.Id == 0
                    ? EntityState.Added : EntityState.Modified;
                _context.AddChangeLog("ë§ˆìŠ¤í„° ìˆ˜ì •", "ê´€ë¦¬ì", $"ë§ˆìŠ¤í„° í•­ëª© ì €ì¥: {SelectedMasterSelection.Category} - {SelectedMasterSelection.Value}");
                await _context.SaveChangesAsync();
                StatusMessage = "ì €ì¥ ì™„ë£Œ.";
                await LoadMasterSelectionsAsync();
            }
            catch (Exception ex)
            {
                StatusMessage = $"ì €ì¥ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        public async Task AddMasterSelectionAsync()
        {
            if (_context == null) return;
            try
            {
                var newSelection = new MasterSelection { Category = "ìƒˆ ì¹´í…Œê³ ë¦¬", Value = "ìƒˆ ê°’" };
                _context.MasterSelections.Add(newSelection);
                _context.AddChangeLog("ë§ˆìŠ¤í„° ì¶”ê°€", "ê´€ë¦¬ì", $"ìƒˆ í•­ëª© ì¶”ê°€: {newSelection.Category} - {newSelection.Value}");
                await _context.SaveChangesAsync();
                MasterSelections.Add(newSelection);
                SelectedMasterSelection = newSelection;
                StatusMessage = "ìƒˆ í•­ëª© ì¶”ê°€ ì™„ë£Œ.";
            }
            catch (Exception ex)
            {
                StatusMessage = $"ì¶”ê°€ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        public async Task DeleteMasterSelectionAsync()
        {
            if (_context == null || SelectedMasterSelection == null) return;
            try
            {
                _context.MasterSelections.Remove(SelectedMasterSelection);
                _context.AddChangeLog("ë§ˆìŠ¤í„° ì‚­ì œ", "ê´€ë¦¬ì", $"ì‚­ì œ í•­ëª©: {SelectedMasterSelection.Category} - {SelectedMasterSelection.Value}");
                await _context.SaveChangesAsync();
                MasterSelections.Remove(SelectedMasterSelection);
                SelectedMasterSelection = null;
                StatusMessage = "ì‚­ì œ ì™„ë£Œ.";
            }
            catch (Exception ex)
            {
                StatusMessage = $"ì‚­ì œ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        /// <summary>
        /// ë§ˆìŠ¤í„° í•­ëª© ë³€ê²½ ì‹œ, ê¸°ì¡´ LockerAssignments í…Œì´ë¸”ì˜ í•´ë‹¹ ê°’(ì˜ˆ: ì†ŒíŒŒíŠ¸, ê´€ë¦¬í•­ëª© ë“±)ì„ ì¼ê´„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        /// </summary>
        public async Task UpdateRelatedRecordsAsync()
        {
            if (_context == null || SelectedMasterSelection == null) return;
            try
            {
                // ê° ì¹´í…Œê³ ë¦¬ë³„ë¡œ í•´ë‹¹ ê°’ì´ ê°™ì€ ë ˆì½”ë“œë¥¼ ì°¾ì•„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                if (SelectedMasterSelection.Category == "SubPart")
                {
                    var records = _context.LockerAssignments.Where(x => x.SubPart == SelectedMasterSelection.Value);
                    foreach (var record in records)
                        record.SubPart = SelectedMasterSelection.Value;
                }
                else if (SelectedMasterSelection.Category == "LockerType")
                {
                    var records = _context.LockerAssignments.Where(x => x.LockerType == SelectedMasterSelection.Value);
                    foreach (var record in records)
                        record.LockerType = SelectedMasterSelection.Value;
                }
                else if (SelectedMasterSelection.Category == "Floor")
                {
                    var records = _context.LockerAssignments.Where(x => x.Floor == SelectedMasterSelection.Value);
                    foreach (var record in records)
                        record.Floor = SelectedMasterSelection.Value;
                }
                else if (SelectedMasterSelection.Category == "Zone")
                {
                    var records = _context.LockerAssignments.Where(x => x.Zone == SelectedMasterSelection.Value);
                    foreach (var record in records)
                        record.Zone = SelectedMasterSelection.Value;
                }
                else if (SelectedMasterSelection.Category == "Administrator")
                {
                    var records = _context.LockerAssignments.Where(x => x.Administrator == SelectedMasterSelection.Value);
                    foreach (var record in records)
                        record.Administrator = SelectedMasterSelection.Value;
                }
                _context.AddChangeLog("ë§ˆìŠ¤í„° ì—…ë°ì´íŠ¸", "ê´€ë¦¬ì", $"ê´€ë ¨ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸: {SelectedMasterSelection.Category} - {SelectedMasterSelection.Value}");
                await _context.SaveChangesAsync();
                StatusMessage = "ê´€ë ¨ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ.";
                await LoadMasterSelectionsAsync();
            }
            catch (Exception ex)
            {
                StatusMessage = $"ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        #region IDisposable êµ¬í˜„
        private bool disposed = false;
        public void Dispose()
        {
            if (!disposed)
            {
                _context?.Dispose();
                disposed = true;
            }
            GC.SuppressFinalize(this);
        }
        #endregion
    }
}
11. ViewModels/LogViewModel.cs
csharp
ì½”ë“œ ë³µì‚¬
using LockerManagementApp.Data;
using LockerManagementApp.Models;
using LockerManagementApp.Infrastructure;
using System;
using System.Collections.ObjectModel;
using System.Data.Entity;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ë¡œê·¸ ë³´ê¸° ViewModel
    /// ChangeLogs í…Œì´ë¸”ì˜ ì‘ì—… ë¡œê·¸ë¥¼ ë¡œë“œí•˜ì—¬ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
    /// </summary>
    public class LogViewModel : ViewModelBase, IDisposable
    {
        private LockerDbContext _context;
        private ObservableCollection<ChangeLog> _logs;
        private string _statusMessage = "ë¡œê·¸ ë¡œë“œ ì¤€ë¹„ ì™„ë£Œ.";

        public ObservableCollection<ChangeLog> Logs
        {
            get => _logs;
            set => SetProperty(ref _logs, value);
        }

        public string StatusMessage
        {
            get => _statusMessage;
            set => SetProperty(ref _statusMessage, value);
        }

        public RelayCommand LoadLogsCommand { get; }

        public LogViewModel()
        {
            try { _context = new LockerDbContext(); }
            catch (Exception ex)
            {
                MessageBox.Show($"DbContext ìƒì„± ì˜¤ë¥˜: {ex}", "ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
                StatusMessage = "DB ì—°ê²° ì˜¤ë¥˜";
                return;
            }
            Logs = new ObservableCollection<ChangeLog>();
            LoadLogsCommand = new RelayCommand(async _ => await LoadLogsAsync());
            _ = LoadLogsAsync();
        }

        public async Task LoadLogsAsync()
        {
            if (_context == null) return;
            try
            {
                var logs = await _context.ChangeLogs.OrderByDescending(l => l.LogTime).ToListAsync();
                Logs = new ObservableCollection<ChangeLog>(logs);
                StatusMessage = $"ì´ {Logs.Count}ê±´ ë¡œë“œ ì™„ë£Œ.";
            }
            catch (Exception ex)
            {
                StatusMessage = $"ë¡œê·¸ ë¡œë“œ ì˜¤ë¥˜: {ex.Message}";
            }
        }

        #region IDisposable êµ¬í˜„
        private bool disposed = false;
        public void Dispose()
        {
            if (!disposed)
            {
                _context?.Dispose();
                disposed = true;
            }
            GC.SuppressFinalize(this);
        }
        #endregion
    }
}
12. ViewModels/MainWindowViewModel.cs
csharp
ì½”ë“œ ë³µì‚¬
using LockerManagementApp.Infrastructure;

namespace LockerManagementApp.ViewModels
{
    /// <summary>
    /// ë©”ì¸ ìœˆë„ìš°ì˜ ì¢…í•© ViewModel
    /// ì‚¬ë¬¼í•¨ ê´€ë¦¬(MainViewModel), ë¡œê·¸(LogViewModel), ë§ˆìŠ¤í„° ì„¤ì •(MasterSettingsViewModel)
    /// ì„¸ ê°œì˜ ê°œë³„ ViewModelì„ í¬í•¨í•©ë‹ˆë‹¤.
    /// </summary>
    public class MainWindowViewModel : ViewModelBase
    {
        public MainViewModel MainVM { get; set; }
        public LogViewModel LogVM { get; set; }
        public MasterSettingsViewModel MasterVM { get; set; }

        public MainWindowViewModel()
        {
            MainVM = new MainViewModel();
            LogVM = new LogViewModel();
            MasterVM = new MasterSettingsViewModel();
        }
    }
}
13. Views/MainWindow.xaml
xml
ì½”ë“œ ë³µì‚¬
<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:local="clr-namespace:LockerManagementApp.Views"
    xmlns:vm="clr-namespace:LockerManagementApp.ViewModels"
    Title="ì‚¬ë¬¼í•¨ ê´€ë¦¬ í”„ë¡œê·¸ë¨ (DevExpress MVVM - .NET Framework 4.8)" Height="700" Width="1200"
    Loaded="MainWindow_Loaded" Closing="MainWindow_Closing">

    <!-- ë©”ì¸ ìœˆë„ìš°ì˜ DataContextëŠ” MainWindowViewModel -->
    <dx:ThemedWindow.DataContext>
        <vm:MainWindowViewModel/>
    </dx:ThemedWindow.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ìƒë‹¨ ì˜ì—­: ì¢Œì¸¡ì—ëŠ” ê°ì¢… ê¸°ëŠ¥ ë²„íŠ¼, ìš°ì¸¡ì—ëŠ” ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë° ë¡œê·¸ì¸ ë²„íŠ¼ -->
        <DockPanel Grid.Row="0" Background="LightGray" LastChildFill="False" Margin="0,0,0,5">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                <Button Content="ğŸ”„ ë¡œë“œ/ìƒˆë¡œê³ ì¹¨" Margin="3" Command="{Binding MainVM.LoadDataCommand}" ToolTip="ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìµœì‹  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤."/>
                <Button Content="ğŸ’¾ ë³€ê²½ ì‚¬í•­ ì €ì¥" Margin="3" Command="{Binding MainVM.SaveChangesCommand}" ToolTip="ë³€ê²½ëœ ë‚´ìš©ì„ ì €ì¥í•©ë‹ˆë‹¤."/>
                <Button Content="â• ìƒˆ ì‚¬ë¬¼í•¨ ì¶”ê°€" Margin="3" Command="{Binding MainVM.AddNewCommand}" ToolTip="ìƒˆë¡œìš´ ì‚¬ë¬¼í•¨ ì¶”ê°€"/>
                <Button Content="âŒ ì„ íƒ í•­ëª© ì‚­ì œ" Margin="3" Command="{Binding MainVM.DeleteCommand}" ToolTip="ì„ íƒëœ í•­ëª© ì‚­ì œ"/>
                <Button Content="ğŸ§¹ ë°°ì • í•´ì œ" Margin="3" Command="{Binding MainVM.ClearAssignmentCommand}" ToolTip="ë°°ì • í•´ì œ"/>
            </StackPanel>
            <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜ì—­ -->
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center" Margin="0,0,10,0">
                <TextBlock Text="ê´€ë¦¬ì ë¹„ë²ˆ:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <PasswordBox x:Name="AdminPasswordBox" Width="120" VerticalAlignment="Center"/>
                <Button Content="ë¡œê·¸ì¸" Margin="5,0,0,0" Click="AdminLogin_Click"/>
            </StackPanel>
        </DockPanel>

        <!-- íƒ­ì»¨íŠ¸ë¡¤: ì‚¬ë¬¼í•¨ ê´€ë¦¬, ë¡œê·¸, ë§ˆìŠ¤í„° ì„¤ì • -->
        <TabControl Grid.Row="1" x:Name="MainTabControl">
            <!-- [1] ì‚¬ë¬¼í•¨ ê´€ë¦¬ íƒ­ -->
            <TabItem Header="ì‚¬ë¬¼í•¨ ê´€ë¦¬">
                <dxg:GridControl ItemsSource="{Binding MainVM.LockerAssignments}" SelectedItem="{Binding MainVM.SelectedAssignment, Mode=TwoWay}"
                                 AutoGenerateColumns="None" EnableSmartColumnsGeneration="False" SelectionMode="Row">
                    <dxg:GridControl.View>
                        <dxg:TableView AllowPerPixelScrolling="True" ShowTotalSummary="False" ShowGroupPanel="True"
                                        AllowEditing="True" NavigationStyle="Cell" ShowAutoFilterRow="True"
                                        NewItemRowPosition="None" ShowIndicator="True" ShowSearchPanelMode="Always"
                                        ShowSearchPanelFindButton="True" ShowSearchPanelCloseButton="True"
                                        SearchPanelHighlightResults="True"/>
                    </dxg:GridControl.View>
                    <dxg:GridControl.Columns>
                        <dxg:GridColumn FieldName="LockerType" Header="ì¢…ë¥˜" Width="100" Fixed="Left">
                            <dxg:GridColumn.EditSettings>
                                <!-- ê´€ë¦¬í•­ëª©: MasterSelections ì¤‘ LockerTypeì— í•´ë‹¹í•˜ëŠ” ëª©ë¡ ë°”ì¸ë”© -->
                                <dxe:ComboBoxEditSettings ItemsSource="{Binding MainVM.MasterLockerTypes}" IsTextEditable="False"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="Floor" Header="ì¸µ" Width="60">
                            <dxg:GridColumn.EditSettings>
                                <dxe:ComboBoxEditSettings ItemsSource="{Binding MainVM.MasterFloors}" IsTextEditable="False"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="Zone" Header="êµ¬ì—­" Width="80">
                            <dxg:GridColumn.EditSettings>
                                <dxe:ComboBoxEditSettings ItemsSource="{Binding MainVM.MasterZones}" IsTextEditable="True"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="SpecificLocation" Header="ì„¸ë¶€ ìœ„ì¹˜" Width="120"/>
                        <dxg:GridColumn FieldName="UserName" Header="ì„±ëª…" Width="100"/>
                        <dxg:GridColumn FieldName="KnoxId" Header="Knox ID" Width="100"/>
                        <dxg:GridColumn FieldName="SubPart" Header="ì†ŒíŒŒíŠ¸" Width="120">
                            <dxg:GridColumn.EditSettings>
                                <dxe:ComboBoxEditSettings ItemsSource="{Binding MainVM.MasterSubParts}" IsTextEditable="True"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="Administrator" Header="ê´€ë¦¬ ë‹´ë‹¹ì" Width="120">
                            <dxg:GridColumn.EditSettings>
                                <dxe:ComboBoxEditSettings ItemsSource="{Binding MainVM.MasterAdministrators}" IsTextEditable="True"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <!-- ì¶”ê°€ ì»¬ëŸ¼ë“¤ -->
                        <dxg:GridColumn FieldName="ì „ë°°ë³µì§" Header="ì „ë°°ë³µì§" Width="120"/>
                        <dxg:GridColumn FieldName="ë‚´ìš©" Header="ë‚´ìš©" Width="150"/>
                        <dxg:GridColumn FieldName="íŠ¹ì´ì‚¬í•­" Header="íŠ¹ì´ì‚¬í•­" Width="150"/>
                        <dxg:GridColumn FieldName="ë¹„ê³ " Header="ë¹„ê³ " Width="150"/>
                        <dxg:GridColumn FieldName="LastUpdated" Header="ìµœì¢… ìˆ˜ì •ì¼ì‹œ" Width="150" AllowEditing="False" ReadOnly="True">
                            <dxg:GridColumn.EditSettings>
                                <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True"/>
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                    </dxg:GridControl.Columns>
                    <!-- ì»¬ëŸ¼ í—¤ë”ì™€ ì…€ ì¤‘ì•™ ì •ë ¬, í—¤ë” ë°°ê²½ìƒ‰: í•˜ëŠ˜ìƒ‰ ì ìš© -->
                    <dxg:GridControl.Resources>
                        <Style TargetType="dxg:ColumnHeaderContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="Background" Value="LightSkyBlue"/>
                        </Style>
                        <Style TargetType="dxg:CellContentPresenter">
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        </Style>
                    </dxg:GridControl.Resources>
                </dxg:GridControl>
            </TabItem>

            <!-- [2] ë¡œê·¸ íƒ­ (ëˆ„êµ¬ë‚˜ ì¡°íšŒ ê°€ëŠ¥) -->
            <TabItem Header="ë¡œê·¸">
                <DockPanel>
                    <Button Content="ë¡œê·¸ ìƒˆë¡œê³ ì¹¨" DockPanel.Dock="Top" Margin="5" Command="{Binding LogVM.LoadLogsCommand}"/>
                    <dxg:GridControl ItemsSource="{Binding LogVM.Logs}" AutoGenerateColumns="False" EnableSmartColumnsGeneration="False">
                        <dxg:GridControl.View>
                            <dxg:TableView ShowGroupPanel="False" AutoWidth="True"/>
                        </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="LogTime" Header="ë¡œê·¸ ì‹œê°„" Width="150"/>
                            <dxg:GridColumn FieldName="Operation" Header="ì‘ì—…" Width="100"/>
                            <dxg:GridColumn FieldName="UserName" Header="ì‚¬ìš©ì" Width="100"/>
                            <dxg:GridColumn FieldName="Description" Header="ì„¤ëª…" Width="400"/>
                        </dxg:GridControl.Columns>
                        <dxg:GridControl.Resources>
                            <Style TargetType="dxg:ColumnHeaderContentPresenter">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Background" Value="LightSkyBlue"/>
                            </Style>
                            <Style TargetType="dxg:CellContentPresenter">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </dxg:GridControl.Resources>
                    </dxg:GridControl>
                </DockPanel>
            </TabItem>

            <!-- [3] ë§ˆìŠ¤í„° ì„¤ì • íƒ­ (ê´€ë¦¬ì ë¡œê·¸ì¸ í›„ í™œì„±í™”) -->
            <TabItem Header="ë§ˆìŠ¤í„° ì„¤ì •" x:Name="MasterSettingsTab" Visibility="Collapsed">
                <DockPanel>
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="5">
                        <Button Content="ìƒˆ í•­ëª© ì¶”ê°€" Margin="3" Command="{Binding MasterVM.AddMasterSelectionCommand}"/>
                        <Button Content="ì €ì¥" Margin="3" Command="{Binding MasterVM.SaveMasterSelectionCommand}"/>
                        <Button Content="ì‚­ì œ" Margin="3" Command="{Binding MasterVM.DeleteMasterSelectionCommand}"/>
                        <Button Content="ê´€ë ¨ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸" Margin="3" Command="{Binding MasterVM.UpdateRelatedRecordsCommand}"/>
                    </StackPanel>
                    <dxg:GridControl ItemsSource="{Binding MasterVM.MasterSelections}" SelectedItem="{Binding MasterVM.SelectedMasterSelection, Mode=TwoWay}" AutoGenerateColumns="False" EnableSmartColumnsGeneration="False">
                        <dxg:GridControl.View>
                            <dxg:TableView ShowGroupPanel="False" AutoWidth="True"/>
                        </dxg:GridControl.View>
                        <dxg:GridControl.Columns>
                            <dxg:GridColumn FieldName="Category" Header="ì¹´í…Œê³ ë¦¬" Width="150"/>
                            <dxg:GridColumn FieldName="Value" Header="ê°’" Width="150"/>
                        </dxg:GridControl.Columns>
                        <dxg:GridControl.Resources>
                            <Style TargetType="dxg:ColumnHeaderContentPresenter">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="Background" Value="LightSkyBlue"/>
                            </Style>
                            <Style TargetType="dxg:CellContentPresenter">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </dxg:GridControl.Resources>
                    </dxg:GridControl>
                </DockPanel>
            </TabItem>
        </TabControl>
    </Grid>
</dx:ThemedWindow>
14. Views/MainWindow.xaml.cs
csharp
ì½”ë“œ ë³µì‚¬
using DevExpress.Xpf.Core;
using LockerManagementApp.ViewModels;
using System;
using System.ComponentModel;
using System.Windows;

namespace LockerManagementApp.Views
{
    /// <summary>
    /// MainWindow.xaml ì½”ë“œ ë¹„í•˜ì¸ë“œ
    /// ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬, ê´€ë¦¬ì ë¹„ë²ˆ ì²´í¬ ë° ê° ViewModel dispose ì²˜ë¦¬ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
    /// </summary>
    public partial class MainWindow : ThemedWindow
    {
        // ê´€ë¦¬ì ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ (ì˜ˆì‹œ)
        private const string MasterPassword = "Admin@123";

        public MainWindow()
        {
            InitializeComponent();
        }

        // DataContextëŠ” MainWindowViewModelë¡œ ìºìŠ¤íŒ…
        private MainWindowViewModel ViewModel => DataContext as MainWindowViewModel;

        private void MainWindow_Loaded(object sender, RoutedEventArgs e)
        {
            // í•„ìš” ì‹œ ì¶”ê°€ ì´ˆê¸°í™” ì²˜ë¦¬
        }

        private void MainWindow_Closing(object sender, CancelEventArgs e)
        {
            // ê° í•˜ìœ„ ViewModelì˜ Dispose í˜¸ì¶œ
            ViewModel.MainVM.Dispose();
            ViewModel.LogVM.Dispose();
            ViewModel.MasterVM.Dispose();
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        private void AdminLogin_Click(object sender, RoutedEventArgs e)
        {
            if (AdminPasswordBox.Password == MasterPassword)
            {
                // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì‹œ ë§ˆìŠ¤í„° ì„¤ì • íƒ­ ë³´ì´ê¸°
                MasterSettingsTab.Visibility = Visibility.Visible;
                MessageBox.Show("ê´€ë¦¬ì ë¡œê·¸ì¸ ì„±ê³µ. ë§ˆìŠ¤í„° ì„¤ì • íƒ­ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", "ë¡œê·¸ì¸ ì„±ê³µ", MessageBoxButton.OK, MessageBoxImage.Information);
            }
            else
            {
                MessageBox.Show("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "ë¡œê·¸ì¸ ì‹¤íŒ¨", MessageBoxButton.OK, MessageBoxImage.Warning);
            }
        }
    }
}
15. App.xaml
xml
ì½”ë“œ ë³µì‚¬
<Application x:Class="LockerManagementApp.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             StartupUri="Views/MainWindow.xaml">
    <Application.Resources>
    </Application.Resources>
</Application>
16. App.xaml.cs
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Diagnostics;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Threading;

namespace LockerManagementApp
{
    /// <summary>
    /// App.xaml ì½”ë“œ ë¹„í•˜ì¸ë“œ: ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì • í¬í•¨
    /// </summary>
    public partial class App : Application
    {
        protected override void OnStartup(StartupEventArgs e)
        {
            base.OnStartup(e);
            SetupGlobalExceptionHandling();
        }

        private void SetupGlobalExceptionHandling()
        {
            DispatcherUnhandledException += (s, ex) =>
            {
                LogAndShowException(ex.Exception, "UI ìŠ¤ë ˆë“œ ì˜ˆì™¸");
                ex.Handled = true;
            };
            TaskScheduler.UnobservedTaskException += (s, ex) =>
            {
                LogAndShowException(ex.Exception, "ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì˜ˆì™¸");
                ex.SetObserved();
            };
            AppDomain.CurrentDomain.UnhandledException += (s, ex) =>
            {
                LogAndShowException((Exception)ex.ExceptionObject, "AppDomain ì˜ˆì™¸");
            };
        }

        private void LogAndShowException(Exception exception, string source)
        {
            string errorMessage = $"ì˜ˆì™¸ ë°œìƒ ({source}):\n\n{exception}";
            Debug.WriteLine(errorMessage);
            try
            {
                MessageBox.Show(errorMessage, "ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜", MessageBoxButton.OK, MessageBoxImage.Error);
            }
            catch (Exception msgEx)
            {
                Debug.WriteLine($"ë©”ì‹œì§€ ë°•ìŠ¤ ì˜¤ë¥˜: {msgEx}");
            }
        }