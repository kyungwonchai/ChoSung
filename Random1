ë„¤, ì•Œê² ìŠµë‹ˆë‹¤. ì œê°€ ì´ì „ ë‹µë³€ë“¤ì—ì„œ ì—¬ëŸ¬ íŒŒì¼ì— ê±¸ì³ ìˆ˜ì • ì‚¬í•­ì„ ì•ˆë‚´í•´ ë“œë¦¬ë‹¤ ë³´ë‹ˆ í˜¼ë€ìŠ¤ëŸ¬ìš°ì…¨ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. "ê¸€ë§ˆë‹¤ ë¹„ë°€ë²ˆí˜¸ ì ìš©" ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ìµœì¢…ì ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” íŒŒì¼ë“¤ì˜ ì „ì²´ ì½”ë“œë¥¼ ë‹¤ì‹œ í•œë²ˆ ëª…í™•í•˜ê²Œ ì •ë¦¬í•´ì„œ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ìˆ˜ì •ì´ í•„ìš”í•œ ì£¼ìš” íŒŒì¼:

models.py: Post ëª¨ë¸ì— ë¹„ë°€ë²ˆí˜¸ ê´€ë ¨ í•„ë“œ ë° ë©”ì„œë“œ ì¶”ê°€.
app.py: ë¹„ë°€ë²ˆí˜¸ ì„¤ì •/í™•ì¸ ë¡œì§ ë° ê´€ë ¨ ë¼ìš°íŠ¸ ìˆ˜ì •.
templates/edit_post.html: ê¸€ ì‘ì„±/ìˆ˜ì • ì‹œ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • UI ì¶”ê°€.
templates/view_post.html: ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ëœ ê¸€ ë³´ê¸° ì²˜ë¦¬.
templates/index.html (ì„ íƒì  ìˆ˜ì •): ëª©ë¡ì— ë¹„ë°€ê¸€ í‘œì‹œ.
ì¤‘ìš”: ì•„ë˜ ì½”ë“œë¥¼ ì ìš©í•˜ì‹œê¸° ì „ì—, ê¸°ì¡´ board.db íŒŒì¼ì„ ì‚­ì œí•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. (ì´ì „ì— ì´ ì‘ì—…ì„ í•˜ì…¨ë‹¤ë©´ ë°˜ë³µí•  í•„ìš”ëŠ” ì—†ì§€ë§Œ, í™•ì‹¤í•˜ê²Œ í•˜ê¸° ìœ„í•´ ê¶Œì¥í•©ë‹ˆë‹¤.)

1. flask_board/models.py (ì „ì²´ ì½”ë“œ)

Python

from flask_sqlalchemy import SQLAlchemy
from datetime import datetime, timezone
import re
from werkzeug.security import generate_password_hash, check_password_hash # ë¹„ë°€ë²ˆí˜¸ í•´ì‹±ì„ ìœ„í•´ ì¶”ê°€

db = SQLAlchemy()

def slugify(text_to_slugify):
    """
    ë¬¸ìì—´ë¡œë¶€í„° URL ì¹œí™”ì ì¸ ìŠ¬ëŸ¬ê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    """
    if not text_to_slugify:
        return "default-slug" # ê¸°ë³¸ê°’
        
    text_processed = str(text_to_slugify)
    # í•œê¸€ ë“±ì„ ê³ ë ¤í•˜ì—¬ ìœ ë‹ˆì½”ë“œ ë‹¨ì–´ ë¬¸ì(\w)ë¥¼ ì‚¬ìš©í•˜ê³ , re.UNICODE í”Œë˜ê·¸ëŠ” Python 3ì—ì„œ ê¸°ë³¸ ë™ì‘
    text_processed = re.sub(r'[^\w\s-]', '', text_processed).strip().lower()
    text_processed = re.sub(r'[-\s]+', '-', text_processed)
    
    if not text_processed: # ëª¨ë“  ë¬¸ìê°€ ì œê±°ëœ ê²½ìš°
        return "default-slug" 
    return text_processed

class Category(db.Model):
    __tablename__ = 'category'
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False, unique=True)
    slug = db.Column(db.String(120), nullable=False, unique=True)
    posts_in_category = db.relationship('Post', back_populates='category', lazy='dynamic', foreign_keys='Post.category_id')

    def __init__(self, name):
        self.name = name
        self.slug = self._generate_unique_slug(name)

    def _generate_unique_slug(self, name_to_slug):
        base_slug = slugify(name_to_slug)
        current_slug_candidate = base_slug
        counter = 1
        while Category.query.filter_by(slug=current_slug_candidate).first():
            current_slug_candidate = f"{base_slug}-{counter}"
            counter += 1
        return current_slug_candidate

    def __repr__(self):
        return f'<Category {self.name}>'

class Post(db.Model):
    __tablename__ = 'post'
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    slug = db.Column(db.String(200), unique=True, nullable=False)
    content = db.Column(db.Text, nullable=False)
    timestamp = db.Column(db.DateTime, index=True, default=lambda: datetime.now(timezone.utc))
    category_id = db.Column(db.Integer, db.ForeignKey('category.id'), nullable=True)
    category = db.relationship('Category', back_populates='posts_in_category', foreign_keys=[category_id])

    # --- ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ ê¸°ëŠ¥ ì¶”ê°€ ---
    password_hash = db.Column(db.String(256), nullable=True) 
    is_password_protected = db.Column(db.Boolean, default=False, nullable=False)
    # --- ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ ê¸°ëŠ¥ ì¶”ê°€ ë ---

    def __init__(self, title, content, category_id=None, slug_text=None): # password ê´€ë ¨ ì¸ì ì œê±°, set_passwordë¡œ ì²˜ë¦¬
        self.title = title
        self.content = content
        self.category_id = category_id
        
        # is_password_protectedì™€ password_hashëŠ” set_password ë˜ëŠ” ëª…ì‹œì  í•´ì œë¥¼ í†µí•´ ê´€ë¦¬
        self.is_password_protected = False # ê¸°ë³¸ê°’
        self.password_hash = None      # ê¸°ë³¸ê°’

        if slug_text:
            self.slug = slug_text
        else:
            self.slug = self._generate_unique_slug(self.title)

    def _generate_unique_slug(self, title_to_slug):
        base_slug = slugify(title_to_slug)
        current_slug_candidate = base_slug
        counter = 1
        while Post.query.filter_by(slug=current_slug_candidate).first():
            current_slug_candidate = f"{base_slug}-{counter}"
            counter += 1
        return current_slug_candidate

    # --- ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ ë©”ì„œë“œ ---
    def set_password(self, password):
        if password: # ë¹„ë°€ë²ˆí˜¸ê°€ ì œê³µëœ ê²½ìš° (ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹˜)
            self.password_hash = generate_password_hash(password)
            self.is_password_protected = True
        else: # ë¹„ë°€ë²ˆí˜¸ê°€ ì œê³µë˜ì§€ ì•Šê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° (ë³´í˜¸ í•´ì œ)
            self.password_hash = None
            self.is_password_protected = False

    def check_password(self, password):
        if not self.password_hash or not self.is_password_protected: # í•´ì‹œê°€ ì—†ê±°ë‚˜ ë³´í˜¸ í”Œë˜ê·¸ê°€ êº¼ì ¸ìˆìœ¼ë©´ False
            return False
        return check_password_hash(self.password_hash, password)
    # --- ê²Œì‹œê¸€ ë¹„ë°€ë²ˆí˜¸ ë©”ì„œë“œ ë ---

    def __repr__(self):
        return f'<Post {self.title}>'
2. flask_board/app.py (ì „ì²´ ì½”ë“œ - ë¹„ë°€ë²ˆí˜¸ ë¡œì§ ì¤‘ì  ìˆ˜ì •)

Python

import os
import uuid
import re
from functools import wraps
from datetime import datetime, timezone, timedelta

from flask import (
    Flask, render_template, request, redirect, url_for, flash, session, jsonify, abort
)
from werkzeug.utils import secure_filename

# --- ì‚¬ìš©ì ì •ì˜ ëª¨ë“ˆ ì„í¬íŠ¸ ---
try:
    from config import Config
except ImportError:
    print("CRITICAL: config.py not found. Using emergency defaults.")
    class Config: # ì„ì‹œ Config
        SECRET_KEY = os.environ.get('SECRET_KEY') or 'emergency_secret_key_please_set_properly'
        SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or 'sqlite:///board.db'
        SQLALCHEMY_TRACK_MODIFICATIONS = False
        ADMIN_PASSWORD = os.environ.get('ADMIN_PASSWORD') or 'kkkwww'
        UPLOAD_FOLDER = os.path.join(os.path.abspath(os.path.dirname(__file__)), 'static/uploads')
        ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}
        MAX_CONTENT_LENGTH = 50 * 1024 * 1024 # ì˜ˆì‹œ: 50MB (í…ŒìŠ¤íŠ¸ í›„ ì‹¤ì œ ì›í•˜ëŠ” ê°’ìœ¼ë¡œ!)

try:
    from models import db, Post, Category
except ImportError:
    print("CRITICAL: models.py not found or models cannot be imported.")
    db = None; Post = None; Category = None

app = Flask(__name__)
app.config.from_object(Config)

if db: 
    db.init_app(app)
else:
    print("CRITICAL: Database (db) object not initialized from models.py.")


upload_folder_path = app.config.get('UPLOAD_FOLDER', './static/uploads_fallback')
if not os.path.exists(upload_folder_path):
    try: os.makedirs(upload_folder_path)
    except OSError as e: app.logger.error(f"Error creating upload folder {upload_folder_path}: {e}")

def allowed_file(filename):
    return '.' in filename and \
           filename.rsplit('.', 1)[1].lower() in app.config.get('ALLOWED_EXTENSIONS', {'png', 'jpg', 'jpeg', 'gif'})

# --- ì¸ì¦ ë° ì „ì—­ ë³€ìˆ˜ ---
def is_admin_logged_in(): return session.get('is_admin_logged_in', False)

@app.context_processor
def inject_global_vars():
    all_cats = []
    if Category:
        try: all_cats = Category.query.order_by(Category.name).all()
        except Exception as e: app.logger.error(f"Error fetching categories for context: {e}")
    return dict(is_admin=is_admin_logged_in(), now=datetime.now(timezone.utc), all_categories=all_cats)

def admin_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if not is_admin_logged_in():
            flash('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning'); return redirect(url_for('login', next=request.url))
        return f(*args, **kwargs)
    return decorated_function

@app.route('/login', methods=['GET', 'POST'])
def login():
    if is_admin_logged_in(): return redirect(url_for('index'))
    if request.method == 'POST':
        password = request.form.get('password')
        if password == app.config['ADMIN_PASSWORD']:
            session['is_admin_logged_in'] = True; session.permanent = True
            app.permanent_session_lifetime = timedelta(days=7)
            flash('ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success'); return redirect(request.args.get('next') or url_for('index'))
        else: flash('ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.', 'danger')
    return render_template('login.html')

@app.route('/logout')
def logout():
    session.pop('is_admin_logged_in', None); flash('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info'); return redirect(url_for('index'))

# --- ê²Œì‹œíŒ ë¼ìš°íŠ¸ ---
@app.route('/')
def index():
    if not Post: flash("ê²Œì‹œê¸€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "danger"); return render_template('index.html', posts_pagination=None, current_category=None)
    page = request.args.get('page', 1, type=int)
    posts_pagination = Post.query.order_by(Post.timestamp.desc()).paginate(page=page, per_page=10, error_out=False)
    return render_template('index.html', posts_pagination=posts_pagination, current_category=None)

@app.route('/post/<string:slug>', methods=['GET', 'POST'])
def view_post(slug):
    if not Post: abort(500, description="Post model not available.")
    post_instance = Post.query.filter_by(slug=slug).first_or_404()
    session_key_for_post_unlock = f'unlocked_post_{post_instance.id}'
    is_unlocked_in_session = session.get(session_key_for_post_unlock, False)

    if post_instance.is_password_protected and post_instance.password_hash: # ë³´í˜¸ í”Œë˜ê·¸ì™€ í•´ì‹œ ë‘˜ ë‹¤ í™•ì¸
        if is_unlocked_in_session:
            return render_template('view_post.html', post=post_instance, show_password_form=False)
        else:
            if request.method == 'POST':
                submitted_password = request.form.get('post_password_view')
                if post_instance.check_password(submitted_password): # check_passwordëŠ” í•´ì‹œ ì¡´ì¬ ì‹œì—ë§Œ ìœ íš¨
                    session[session_key_for_post_unlock] = True
                    flash('ë¹„ë°€ë²ˆí˜¸ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')
                    return redirect(url_for('view_post', slug=post_instance.slug))
                else:
                    flash('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'danger')
            return render_template('view_post.html', post=post_instance, show_password_form=True)
    else: # ë³´í˜¸ë˜ì§€ ì•Šì•˜ê±°ë‚˜, ë³´í˜¸ í”Œë˜ê·¸ëŠ” Trueì¸ë° í•´ì‹œê°€ ì—†ëŠ” ë¹„ì •ìƒ ìƒíƒœ í¬í•¨
        if post_instance.is_password_protected and not post_instance.password_hash:
             app.logger.warning(f"Post ID {post_instance.id} is marked protected but has no password hash.")
        return render_template('view_post.html', post=post_instance, show_password_form=False)


@app.route('/new', methods=['GET', 'POST'])
@admin_required
def new_post():
    cats = []; 
    if Category: 
        try: cats = Category.query.order_by(Category.name).all()
        except Exception as e: app.logger.error(f"Error fetching categories: {e}")

    if request.method == 'POST':
        title = request.form.get('title')
        content = request.form.get('content')
        category_id_str = request.form.get('category_id')
        
        is_protected_from_form = request.form.get('is_password_protected_checkbox') == 'y'
        password_from_form = request.form.get('post_password_input')

        if not title or not content:
            flash('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning')
            return render_template('edit_post.html', title=title, content=content, categories=cats, post=None, selected_category_id=category_id_str)

        processed_category_id = int(category_id_str) if category_id_str and category_id_str.isdigit() else None

        try:
            if not Post: raise Exception("Post model not available.")
            new_post_obj = Post(title=title, content=content, category_id=processed_category_id)
            
            if is_protected_from_form:
                if password_from_form: # ë³´í˜¸ ì²´í¬ & ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ë¨
                    new_post_obj.set_password(password_from_form) # is_password_protectedë„ Trueë¡œ ì„¤ì •ë¨
                else: # ìƒˆ ê¸€ì¸ë° ë³´í˜¸ ì²´í¬í•˜ê³  ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì•ˆ í•œ ê²½ìš°
                    flash('ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë¥¼ ì„ íƒí–ˆì§€ë§Œ, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë³´í˜¸ë˜ì§€ ì•Šì€ ê¸€ë¡œ ì €ì¥ë©ë‹ˆë‹¤.', 'warning')
                    new_post_obj.is_password_protected = False 
                    new_post_obj.password_hash = None
            else: # ë³´í˜¸ ì²´í¬ ì•ˆ í•¨
                new_post_obj.is_password_protected = False
                new_post_obj.password_hash = None
            
            db.session.add(new_post_obj)
            db.session.commit()
            flash('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')
            return redirect(url_for('view_post', slug=new_post_obj.slug))
        except Exception as e:
            db.session.rollback(); app.logger.error(f"Error creating post: {e}")
            flash(f'ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜: {str(e)}', 'danger')
            return render_template('edit_post.html', title=title, content=content, categories=cats, post=None, selected_category_id=category_id_str)

    return render_template('edit_post.html', categories=cats, post=None, selected_category_id=None)


@app.route('/edit/<string:slug>', methods=['GET', 'POST'])
@admin_required
def edit_post(slug):
    if not Post or not Category: abort(500)
    post_to_edit = Post.query.filter_by(slug=slug).first_or_404()
    cats = []
    try: cats = Category.query.order_by(Category.name).all()
    except Exception as e: app.logger.error(f"Error fetching categories: {e}")
    
    selected_category_id = str(post_to_edit.category_id) if post_to_edit.category_id is not None else ""
    
    if request.method == 'POST':
        original_title = post_to_edit.title
        post_to_edit.title = request.form.get('title')
        post_to_edit.content = request.form.get('content')
        category_id_str = request.form.get('category_id')
        selected_category_id = category_id_str

        is_protected_from_form = request.form.get('is_password_protected_checkbox') == 'y'
        password_from_form = request.form.get('post_password_input')

        if not post_to_edit.title or not post_to_edit.content:
            flash('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning')
            return render_template('edit_post.html', post=post_to_edit, categories=cats, title=post_to_edit.title, content=post_to_edit.content, selected_category_id=selected_category_id)

        processed_category_id = int(category_id_str) if category_id_str and category_id_str.isdigit() else None
        post_to_edit.category_id = processed_category_id

        if is_protected_from_form:
            # "ë³´í˜¸" ì²´í¬ ì‹œ
            if password_from_form: # ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì…ë ¥ëœ ê²½ìš° -> ë¹„ë°€ë²ˆí˜¸ ë³€ê²½/ì„¤ì •
                post_to_edit.set_password(password_from_form)
            elif post_to_edit.password_hash: # ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì—†ê³ , ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ” ê²½ìš° -> ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ ìœ ì§€, ë³´í˜¸ ìƒíƒœ ìœ ì§€
                post_to_edit.is_password_protected = True # ëª…ì‹œì ìœ¼ë¡œ ë³´í˜¸ ìƒíƒœ ìœ ì§€
            else: # ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì—†ê³ , ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ë„ ì—†ëŠ” ê²½ìš° -> ë³´í˜¸í•  ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ìœ¼ë¯€ë¡œ ë³´í˜¸ í•´ì œ
                flash('ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ë¥¼ ì„ íƒí–ˆì§€ë§Œ, ì„¤ì •í•  ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤. ë³´í˜¸ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'warning')
                post_to_edit.is_password_protected = False
                post_to_edit.password_hash = None
        else: # "ë³´í˜¸" ì²´í¬ í•´ì œ ì‹œ -> ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ í•´ì œ
            post_to_edit.set_password(None) # password_hash = None, is_password_protected = False ë¡œ ì„¤ì •ë¨

        if original_title != post_to_edit.title:
            post_to_edit.slug = post_to_edit._generate_unique_slug(post_to_edit.title)
        post_to_edit.timestamp = datetime.now(timezone.utc)
        
        try:
            db.session.commit()
            flash('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')
            return redirect(url_for('view_post', slug=post_to_edit.slug))
        except Exception as e:
            db.session.rollback(); app.logger.error(f"Error editing post {slug}: {e}")
            flash(f'ê²Œì‹œê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: {str(e)}', 'danger')
            return render_template('edit_post.html', post=post_to_edit, categories=cats, title=post_to_edit.title, content=post_to_edit.content, selected_category_id=selected_category_id)

    return render_template('edit_post.html', post=post_to_edit, categories=cats, title=post_to_edit.title, content=post_to_edit.content, selected_category_id=selected_category_id)

# --- ë‚˜ë¨¸ì§€ ë¼ìš°íŠ¸ (delete_post, upload_image, ì¹´í…Œê³ ë¦¬ ê´€ë¦¬, ë””ë²„ê·¸, ì‹¤í–‰ ë¶€ë¶„) ---
# ì´ ë¶€ë¶„ì€ ì´ì „ ë‹µë³€ì˜ ìµœì¢… app.py ì½”ë“œì™€ ë™ì¼í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.
# ê³µê°„ ì ˆì•½ì„ ìœ„í•´ ì—¬ê¸°ì— ëª¨ë“  ì½”ë“œë¥¼ ë‹¤ì‹œ ë°˜ë³µí•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤.
# ì´ì „ì— ì œê³µí•´ë“œë¦° app.py ì „ì²´ ì½”ë“œì—ì„œ ìœ„ new_post, edit_post, view_post ë¶€ë¶„ë§Œ
# ì§€ê¸ˆ ë“œë¦° ë‚´ìš©ìœ¼ë¡œ êµì²´í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

@app.route('/delete/<string:slug>', methods=['POST'])
@admin_required
def delete_post(slug):
    if not Post: abort(500)
    post_to_delete = Post.query.filter_by(slug=slug).first_or_404()
    try:
        db.session.delete(post_to_delete); db.session.commit()
        flash('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success')
    except Exception as e:
        db.session.rollback(); app.logger.error(f"Error deleting post {slug}: {e}"); flash(f'ì‚­ì œ ì˜¤ë¥˜: {str(e)}', 'danger')
    return redirect(url_for('index'))

@app.route('/upload_image', methods=['POST'])
@admin_required
def upload_image():
    if 'file' not in request.files: return jsonify({'error': {'message': 'No file part'}}), 400
    file = request.files['file']
    if file.filename == '': return jsonify({'error': {'message': 'No selected file'}}), 400
    if file and allowed_file(file.filename):
        original_filename = secure_filename(file.filename); filename_prefix = str(uuid.uuid4())[:8]
        base, ext = os.path.splitext(original_filename); safe_base = re.sub(r'[^\w-]', '', base)[:50]
        filename = f"{filename_prefix}_{safe_base}{ext}"; counter = 1; temp_filename_to_check = filename
        upload_path = app.config.get('UPLOAD_FOLDER', './static/uploads_fallback')
        final_filepath = os.path.join(upload_path, temp_filename_to_check)
        while os.path.exists(final_filepath):
            temp_filename_to_check = f"{filename_prefix}_{safe_base}_{counter}{ext}"
            final_filepath = os.path.join(upload_path, temp_filename_to_check); counter += 1
        filename = temp_filename_to_check
        try:
            file.save(final_filepath); image_url = url_for('static', filename=f'uploads/{filename}') 
            return jsonify({'location': image_url})
        except Exception as e:
            app.logger.error(f"Image upload failed: {e}, filepath: {final_filepath}")
            return jsonify({'error': {'message': f'Image upload failed: {str(e)}'}}), 500
    return jsonify({'error': {'message': f'Allowed types: {app.config.get("ALLOWED_EXTENSIONS", set())}'}}), 400

@app.route('/admin/categories')
@admin_required
def admin_categories(): return render_template('admin_categories.html')

@app.route('/admin/category/new', methods=['GET', 'POST'])
@admin_required
def new_category():
    if not Category: abort(500)
    if request.method == 'POST':
        name = request.form.get('name')
        if not name: flash('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning')
        else:
            try:
                if Category.query.filter_by(name=name).first(): flash('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ ì´ë¦„.', 'warning')
                else:
                    db.session.add(Category(name=name)); db.session.commit()
                    flash(f'ì¹´í…Œê³ ë¦¬ "{name}" ì¶”ê°€ ì™„ë£Œ.', 'success'); return redirect(url_for('admin_categories'))
            except Exception as e:
                db.session.rollback(); app.logger.error(f"Error creating category: {e}"); flash(f'ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì˜¤ë¥˜: {str(e)}', 'danger')
        return render_template('edit_category.html', category_name=name, category=None)
    return render_template('edit_category.html', category=None, category_name='')

@app.route('/admin/category/edit/<int:category_id>', methods=['GET', 'POST'])
@admin_required
def edit_category(category_id):
    if not Category: abort(500)
    category_to_edit = Category.query.get_or_404(category_id); category_name_for_form = category_to_edit.name
    if request.method == 'POST':
        new_name = request.form.get('name'); category_name_for_form = new_name
        if not new_name: flash('ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning')
        elif new_name == category_to_edit.name: flash('ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', 'info'); return redirect(url_for('admin_categories'))
        else:
            try:
                if Category.query.filter(Category.name == new_name, Category.id != category_id).first(): flash('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ ì´ë¦„.', 'warning')
                else:
                    original_name = category_to_edit.name; category_to_edit.name = new_name
                    category_to_edit.slug = category_to_edit._generate_unique_slug(new_name); db.session.commit()
                    flash(f'ì¹´í…Œê³ ë¦¬ "{original_name}"ì´ "{new_name}"(ìœ¼)ë¡œ ìˆ˜ì • ì™„ë£Œ.', 'success'); return redirect(url_for('admin_categories'))
            except Exception as e:
                db.session.rollback(); app.logger.error(f"Error editing category: {e}"); flash(f'ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì˜¤ë¥˜: {str(e)}', 'danger')
        return render_template('edit_category.html', category=category_to_edit, category_name=category_name_for_form)
    return render_template('edit_category.html', category=category_to_edit, category_name=category_name_for_form)

@app.route('/admin/category/delete/<int:category_id>', methods=['POST'])
@admin_required
def delete_category(category_id):
    if not Category: abort(500)
    category_to_delete = Category.query.get_or_404(category_id)
    if category_to_delete.posts_in_category.count() > 0:
        flash(f'"{category_to_delete.name}"ì— ì†í•œ ê¸€ì´ ìˆì–´ ì‚­ì œ ë¶ˆê°€.', 'danger'); return redirect(url_for('admin_categories'))
    try:
        db.session.delete(category_to_delete); db.session.commit(); flash(f'ì¹´í…Œê³ ë¦¬ "{category_to_delete.name}" ì‚­ì œ ì™„ë£Œ.', 'success')
    except Exception as e:
        db.session.rollback(); app.logger.error(f"Error deleting category: {e}"); flash(f'ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì˜¤ë¥˜: {str(e)}', 'danger')
    return redirect(url_for('admin_categories'))

@app.route('/category/<string:slug>')
def posts_by_category(slug):
    if not Category or not Post: abort(500)
    category = Category.query.filter_by(slug=slug).first_or_404(); page = request.args.get('page', 1, type=int)
    posts_pagination = category.posts_in_category.order_by(Post.timestamp.desc()).paginate(page=page, per_page=10, error_out=False)
    return render_template('index.html', posts_pagination=posts_pagination, current_category=category)

@app.cli.command('init-db')
def init_db_cli_command():
    if db is None: print("DB not initialized."); return
    with app.app_context(): db.drop_all(); db.create_all()
    print('Initialized the database.')

_db_initialized_flag = False
@app.before_request
def ensure_tables_exist():
    global _db_initialized_flag
    if not _db_initialized_flag and db is not None:
        with app.app_context(): db.create_all()
        _db_initialized_flag = True

@app.route('/debug_config_check')
def debug_config_check():
    max_size = app.config.get('MAX_CONTENT_LENGTH')
    if max_size is None: return "MAX_CONTENT_LENGTH is not set."
    is_5gb = (max_size == 5000 * 1024 * 1024)
    return f"MAX_CONTENT_LENGTH: {max_size} bytes. Is this 5GB? {is_5gb}"

if __name__ == '__main__':
    if db is not None:
        with app.app_context(): db.create_all() 
    app.run(host='10.244.122.25', port=8099, debug=True, threaded=True)
3. templates/view_post.html (ì „ì²´ ì½”ë“œ - ë¹„ë°€ë²ˆí˜¸ í¼ ë° ë‚´ìš© í‘œì‹œ ë¡œì§ í¬í•¨)

HTML

{% extends "base.html" %}

{% block title %}{{ post.title }} - ë‚˜ì˜ ê²Œì‹œíŒ{% endblock %}

{% block content %}
{# base.htmlì—ì„œ col-md-9 ì•ˆìœ¼ë¡œ ì´ë™í–ˆìœ¼ë¯€ë¡œ, ì´ divëŠ” í•„ìš” ì—†ì„ ìˆ˜ ìˆìŒ. ë ˆì´ì•„ì›ƒì— ë”°ë¼ ì¡°ì ˆ. #}
{# <div class="container mt-4"> #}

    {# show_password_form í”Œë˜ê·¸ëŠ” app.pyì˜ view_post ë¼ìš°íŠ¸ì—ì„œ ì „ë‹¬ë¨ #}
    {% if show_password_form %}
        {# --- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í¼ --- #}
        <div class="password-form-container mt-5 p-4 border rounded bg-light shadow-sm">
            <h4 class="mb-3 text-center">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h4>
            <p class="text-center text-muted">ì´ ê²Œì‹œê¸€ì€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³´í˜¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‚´ìš©ì„ ë³´ì‹œë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <form method="POST" action="{{ url_for('view_post', slug=post.slug) }}">
                <div class="form-group">
                    <label for="post_password_view_input" class="sr-only">ë¹„ë°€ë²ˆí˜¸:</label> {# sr-only for accessibility #}
                    <input type="password" class="form-control form-control-lg" id="post_password_view_input" name="post_password_view" placeholder="ë¹„ë°€ë²ˆí˜¸" required autofocus>
                </div>
                <button type="submit" class="btn btn-primary btn-block">í™•ì¸</button>
                <div class="text-center mt-3">
                    <a href="{{ url_for('index') }}" class="btn btn-link btn-sm">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                </div>
            </form>
        </div>
        {# --- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í¼ ë --- #}
    {% else %}
        {# --- ì‹¤ì œ ê²Œì‹œê¸€ ë‚´ìš© --- #}
        <article class="mt-4">
            <header class="mb-4 pb-3 border-bottom">
                <h1>{{ post.title }}</h1>
                <div class="text-muted">
                    <small>
                        ì‘ì„±ì¼: {{ post.timestamp.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }} (UTC)
                        {% if post.category %}
                            | ì¹´í…Œê³ ë¦¬: <a href="{{ url_for('posts_by_category', slug=post.category.slug) }}">{{ post.category.name }}</a>
                        {% endif %}
                        {% if post.is_password_protected and post.password_hash %} {# ë¹„ë°€ê¸€ í‘œì‹œ (í•´ì‹œê°€ ì‹¤ì œë¡œ ìˆì„ ë•Œë§Œ) #}
                            | <span class="text-danger font-weight-bold">ğŸ”’ ë¹„ë°€ê¸€</span>
                        {% endif %}
                    </small>
                </div>
                {% if is_admin %}
                    <div class="mt-2">
                        <a href="{{ url_for('edit_post', slug=post.slug) }}" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</a>
                        <form action="{{ url_for('delete_post', slug=post.slug) }}" method="POST" class="d-inline" onsubmit="return confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
                        </form>
                    </div>
                {% endif %}
            </header>
            <section class="post-content lead"> {# 'lead' í´ë˜ìŠ¤ ì¶”ê°€ë¡œ ë³¸ë¬¸ í…ìŠ¤íŠ¸ ì•½ê°„ í¬ê²Œ #}
                {{ post.content | safe }}
            </section>
        </article>
        <hr class="my-4">
        <a href="{{ url_for('index') }}" class="btn btn-outline-primary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        {# --- ì‹¤ì œ ê²Œì‹œê¸€ ë‚´ìš© ë --- #}
    {% endif %}

{# </div> #}
{% endblock %}
4. templates/index.html (ë¹„ë°€ê¸€ ì•„ì´ì½˜ í‘œì‹œ ë¶€ë¶„ë§Œ ìˆ˜ì • - ì„ íƒ ì‚¬í•­)

HTML

{# ... index.htmlì˜ ê²Œì‹œê¸€ ë£¨í”„ ë‚´ <small> íƒœê·¸ ì•ˆìª½ ... #}
<small class="text-muted">
    ì‘ì„±ì¼: {{ post_item.timestamp.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }} (UTC)
    {% if post_item.category %}
        | ì¹´í…Œê³ ë¦¬: <a href="{{ url_for('posts_by_category', slug=post_item.category.slug) }}">{{ post_item.category.name }}</a>
    {% endif %}
    {% if post_item.is_password_protected and post_item.password_hash %} {# ë¹„ë°€ê¸€ í‘œì‹œ (í•´ì‹œê°€ ì‹¤ì œë¡œ ìˆì„ ë•Œë§Œ) #}
        | <span class="text-danger" title="ë¹„ë°€ê¸€">ğŸ”’</span>
    {% endif %}
</small>
{# ... #}
templates/edit_post.htmlì€ ì´ì „ ë‹µë³€("ì•„ì”¨ë°œ ëê³  edit post ìˆ˜ì •ëœ ìµœì¢…ì„ë‹¬ë¼ê³  ìˆ˜ì •í•œê±¸ ë˜ëŠ”ê±¸ ë‹¬ë¼ê³ ")ì—ì„œ ë“œë¦° ìµœì¢… ë²„ì „ì„ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤. (ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œê°€ í•­ìƒ ë³´ì´ëŠ” ë²„ì „)

ì ìš© ìˆœì„œ:

ìœ„ì— ì œê³µëœ models.py, app.py, templates/view_post.html, templates/index.html (ì„ íƒ) ì½”ë“œë¡œ í•´ë‹¹ íŒŒì¼ë“¤ì„ ì™„ì „íˆ êµì²´í•©ë‹ˆë‹¤.
templates/edit_post.htmlì€ ì´ì „ ë‹µë³€ì—ì„œ ë“œë¦° "ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ í•­ìƒ í‘œì‹œ" ë²„ì „ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ (board.db)ì„ ì‚­ì œí•©ë‹ˆë‹¤.
Flask ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤.