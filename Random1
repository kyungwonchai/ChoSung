using System;
using System.Drawing;
using System.Windows.Forms;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        try
        {
            // 엑셀 어플리케이션 시작
            Excel.Application excelApp = new Excel.Application();
            excelApp.Visible = false;

            // 엑셀 파일 열기
            Excel.Workbook workbook = excelApp.Workbooks.Open("파일경로.xlsx"); // 엑셀 파일 경로 입력
            Excel.Worksheet worksheet = workbook.ActiveSheet;

            // 셀 복사
            Excel.Range range = worksheet.Range["A1:B2"]; // 복사할 셀 범위 지정
            range.Copy();

            // 범위를 이미지로 변환
            Excel.Range imageRange = worksheet.Paste();

            // 이미지를 클립보드로 복사
            Image image = GetImageFromRange(imageRange);
            Clipboard.SetImage(image);

            // 이미지를 파일로 저장
            string filePath = "이미지파일경로.png"; // 저장할 이미지 파일 경로와 확장자 지정
            image.Save(filePath, System.Drawing.Imaging.ImageFormat.Png);

            // 엑셀 종료
            workbook.Close(false);
            excelApp.Quit();

            Console.WriteLine("이미지가 성공적으로 저장되었습니다.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("에러: " + ex.Message);
        }
    }

    static Image GetImageFromRange(Excel.Range range)
    {
        // 범위의 크기 가져오기
        int width = range.Width * 6; // 6은 셀의 너비 조정에 사용할 배율입니다.
        int height = range.Height * 18; // 18은 셀의 높이 조정에 사용할 배율입니다.

        // 이미지로 변환
        Bitmap image = new Bitmap(width, height);
        Graphics graphics = Graphics.FromImage(image);
        graphics.CopyFromScreen(range.Left, range.Top, 0, 0, range.Size);

        return image;
    }
}
