public partial class MainForm : Form
{
    private List<string> playbackFiles = new List<string>();
    private int currentFileIndex = 0;

    public MainForm()
    {
        InitializeComponent();

        LoadVideoFiles();

        videoView1.SourceProvider.MediaPlayer.EndReached += OnMediaPlayerEndReached;
    }

    private void LoadVideoFiles()
    {
        string[] files = Directory.GetFiles(@"D:\11", "recording*.mp4", SearchOption.AllDirectories);

        foreach (var file in files)
        {
            playbackFiles.Add(file);
            listBox1.Items.Add(Path.GetFileName(file));
        }
    }

    private void listBox1_SelectedIndexChanged(object sender, EventArgs e)
    {
        currentFileIndex = listBox1.SelectedIndex;
        PlayFile(currentFileIndex);
    }

    private void PlayFile(int index)
    {
        if (index >= 0 && index < playbackFiles.Count)
        {
            string filePath = playbackFiles[index];
            videoView1.SourceProvider.MediaPlayer.Stop(); // 이전 재생 중지
            videoView1.SourceProvider.MediaPlayer.Play(new Uri(filePath));
        }
    }

    private void OnMediaPlayerEndReached(object sender, EventArgs e)
    {
        // 다음 파일 재생
        currentFileIndex++;
        if (currentFileIndex < playbackFiles.Count)
        {
            PlayFile(currentFileIndex);
        }
        else
        {
            // 재생 목록 끝에 도달한 경우 원하는 동작 수행
        }
    }

    private void trackBar1_Scroll(object sender, EventArgs e)
    {
        double position = trackBar1.Value / (double)trackBar1.Maximum;
        videoView1.SourceProvider.MediaPlayer.Position = position;

        // 시간 표시
        TimeSpan time = TimeSpan.FromSeconds(videoView1.SourceProvider.MediaPlayer.Length * position);
        lblTime.Text = time.ToString(@"hh\:mm\:ss");
    }
}
