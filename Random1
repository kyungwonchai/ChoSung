import pyodbc
from openpyxl import load_workbook

# MSSQL 서버 연결 설정
server = 'your_server'
database = 'your_database'
username = 'your_username'
password = 'your_password'
conn_str = f'DRIVER={{SQL Server}};SERVER={server};DATABASE={database};UID={username};PWD={password}'

# 엑셀 파일 로드
file_path = 'your_file_path.xlsx'
wb = load_workbook(file_path)
sheet = wb.active

# 컬럼명 가져오기
columns = []
for cell in sheet[2]:
    column_name = cell.value
    if column_name.startswith('C_'):
        columns.append(column_name)

# 데이터 업로드
with pyodbc.connect(conn_str) as conn:
    cursor = conn.cursor()

    for row in sheet.iter_rows(min_row=3, values_only=True):
        data = dict(zip(columns, row))
        insert_query = "INSERT INTO your_table ({}) VALUES ({})".format(
            ', '.join(columns),
            ', '.join(['?'] * len(columns))
        )
        cursor.execute(insert_query, tuple(data.values()))  # 튜플로 데이터 전달

    conn.commit()
