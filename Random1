using System;
using System.Net.Http;
using System.Text;
using System.Threading.Tasks;

namespace MailSenderExample
{
    public static class MailSender
    {
        private static readonly HttpClient client = new HttpClient();
        private static readonly string apiUrl = "http://oo/stt/ssc.net/mail/api/v2.0/mails/send";

        public static async Task SendMail(string userId, string accessToken, string subject, string contents, string senderEmailAddress, string recipientEmailAddress)
        {
            // API 요청 데이터 구성
            var requestData = new
            {
                body = new
                {
                    subject,
                    contents,
                    sender = new
                    {
                        emailAddress = senderEmailAddress,
                        recipientType = "TO"
                    },
                    recipients = new[]
                    {
                        new
                        {
                            emailAddress = recipientEmailAddress,
                            recipientType = "TO"
                        }
                    }
                }
            };

            // 요청 데이터를 JSON 형식으로 직렬화
            var jsonPayload = Newtonsoft.Json.JsonConvert.SerializeObject(requestData);

            // API 호출을 위한 HTTP 요청 설정
            var request = new HttpRequestMessage(HttpMethod.Post, apiUrl + "?userid=" + userId);
            request.Headers.Add("Authorization", $"Bearer {accessToken}");
            request.Content = new StringContent(jsonPayload, Encoding.UTF8, "application/json");

            // API 호출
            var response = await client.SendAsync(request);

            if (response.IsSuccessStatusCode)
            {
                Console.WriteLine("메일이 성공적으로 발송되었습니다.");
            }
            else
            {
                Console.WriteLine("메일 발송에 실패하였습니다.");
            }
        }
    }

    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent();
        }

        private async void btnSendMail_Click(object sender, EventArgs e)
        {
            string userId = "kk아이디";
            string accessToken = "여기에_접근_토큰_값_입력";
            string subject = "메일 제목";
            string contents = "메일 본문";
            string senderEmailAddress = "sgsg@abc.com";
            string recipientEmailAddress = "knoxposgg@abc.com";

            await MailSender.SendMail(userId, accessToken, subject, contents, senderEmailAddress, recipientEmailAddress);
        }
    }
}
