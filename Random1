using System;
using System.Diagnostics;
using System.IO;
using System.Threading.Tasks;

namespace ScreenRecorder
{
    class Program
    {
        static async Task Main(string[] args)
        {
            // 저장 경로
            string path = @"D:\blackbox";
            if (!Directory.Exists(path))
            {
                Directory.CreateDirectory(path);
            }

            // 녹화 시작
            Console.WriteLine("녹화 시작");
            for (int i = 0; i < 10080; i++) // 1주일 동안 10분 단위로 녹화 (60 * 24 * 7 / 10 = 10080)
            {
                string fileName = Path.Combine(path, DateTime.Now.ToString("yyyyMMddHHmm") + ".mp4");
                using (Process process = new Process())
                {
                    // ffmpeg 명령어를 사용하여 화면 녹화 (낮은 화질로 설정)
                    process.StartInfo.FileName = "ffmpeg";
                    process.StartInfo.Arguments = $"-f dshow -i video=\"ScreenCaptureRecorder\" -vcodec libx264 -crf 40 -preset ultrafast -t 00:10:00 {fileName}";
                    process.StartInfo.RedirectStandardOutput = true;
                    process.StartInfo.UseShellExecute = false;
                    process.StartInfo.CreateNoWindow = true;
                    process.Start();

                    await process.WaitForExitAsync(); // 10분 동안 녹화
                }
                Console.WriteLine($"{fileName} 저장 완료");
            }
            Console.WriteLine("녹화 종료");
        }
    }
}
