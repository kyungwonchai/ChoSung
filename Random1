DECLARE @columns NVARCHAR(MAX) = '', @sql NVARCHAR(MAX);

-- module1의 고유 값을 기반으로 컬럼 목록 생성
SELECT @columns += QUOTENAME(module1) + ','
FROM (SELECT DISTINCT module1 FROM YourSecondTable) AS Modules;
SET @columns = LEFT(@columns, LEN(@columns) - 1); -- 마지막 콤마 제거

-- 동적 SQL 구성
SET @sql = N'SELECT f.sensor, AVG(f.val1) AS valavg1, f.unit, f.lcl, f.ucl, ' + @columns + '
             FROM (
                 SELECT a.sensor, a.val1, b.unit, b.lcl, b.ucl
                 FROM YourSecondTable a
                 JOIN YourFirstTable b ON a.sensor = b.sensor
             ) AS f
             PIVOT (
                 SUM(f.val1)
                 FOR f.module1 IN (' + @columns + ')
             ) AS pv
             GROUP BY f.sensor, f.unit, f.lcl, f.ucl';

EXEC sp_executesql @sql;
