using System;
using System.Collections.Generic;
using DevExpress.XtraSpreadsheet;
using DevExpress.XtraSpreadsheet.Commands;

public class SpreadsheetController
{
    private XtraTabControl tabControl;
    private ListBox listBoxSheets;

    public SpreadsheetController(XtraTabControl tabControl, ListBox listBoxSheets)
    {
        this.tabControl = tabControl;
        this.listBoxSheets = listBoxSheets;

        // 탭 컨트롤에 이벤트 핸들러 등록
        tabControl.SelectedPageChanged += OnTabSelectedPageChanged;

        // 리스트 박스에 이벤트 핸들러 등록
        listBoxSheets.DoubleClick += OnListBoxSheetDoubleClick;
    }

    // 탭이 선택될 때 호출되는 이벤트 핸들러
    private void OnTabSelectedPageChanged(object sender, TabPageChangedEventArgs e)
    {
        // 선택된 탭 페이지에서 해당하는 스프레드시트 컨트롤 가져오기
        var spreadsheetControl = e.Page.Controls.OfType<SpreadsheetControl>().FirstOrDefault();

        if (spreadsheetControl != null)
        {
            // 해당 탭 페이지의 스프레드시트 컨트롤에서 시트 이름들을 가져와서 리스트 박스에 세로로 나열
            listBoxSheets.Items.Clear();

            WorksheetCollection worksheets = spreadsheetControl.Document.Worksheets;
            foreach (Worksheet sheet in worksheets)
            {
                listBoxSheets.Items.Add(sheet.Name);
            }
        }
    }

    // 리스트 박스에서 항목을 더블 클릭했을 때 호출되는 이벤트 핸들러
    private void OnListBoxSheetDoubleClick(object sender, EventArgs e)
    {
        // 리스트 박스에서 선택된 항목의 시트 이름 가져오기
        string selectedSheetName = listBoxSheets.SelectedItem as string;

        // 선택된 탭 페이지에서 해당하는 스프레드시트 컨트롤 가져오기
        var selectedTabPage = tabControl.SelectedTabPage;
        var spreadsheetControl = selectedTabPage.Controls.OfType<SpreadsheetControl>().FirstOrDefault();

        if (spreadsheetControl != null && !string.IsNullOrEmpty(selectedSheetName))
        {
            // 해당 시트 이름으로 스프레드시트의 시트 선택
            spreadsheetControl.Document.Worksheets.ActiveWorksheet = spreadsheetControl.Document.Worksheets[selectedSheetName];
        }
    }
}
