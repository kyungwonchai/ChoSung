네, 라즈베리파이 와치독 설정에서 repair-maximum과 retry-timeout은 완전히 별개의 개념입니다. 두 옵션은 시스템 장애 발생 시 와치독 데몬이 문제를 처리하는 과정에서 서로 다른 단계에 작용합니다.

핵심적인 차이를 먼저 요약하면 다음과 같습니다.

항목	retry-timeout	repair-maximum
목적	테스트 실패의 확정	실패 확정 후 복구 시도 횟수 제한
역할	일시적인 오류인지, 지속적인 문제인지 재확인	복구 스크립트의 무한 실행 방지
동작 시점	특정 테스트(예: 부하율)가 최초로 실패했을 때	테스트 실패가 최종적으로 확정된 후
## 각 옵션에 대한 상세 설명
두 옵션이 어떻게 연계되어 동작하는지 전체 흐름과 함께 살펴보겠습니다.

1. retry-timeout (재시도 타임아웃)
이 옵션은 와치독 데몬이 시스템 상태를 점검하는 테스트가 실패했을 때, 바로 시스템이 죽었다고 판단하지 않고 잠시 기다렸다가 다시 한번 확인하기 위해 존재합니다. 시스템 부하가 일시적으로 급증하는 등 단발성 이슈로 인해 불필요한 재부팅을 하는 것을 방지하는 역할을 합니다.

동작 방식:

와치독 데몬이 주기적으로 시스템 상태를 체크합니다. (예: max-load-1 = 24 설정은 1분 평균 부하가 24를 넘는지 확인)

만약 부하가 25로 측정되어 테스트가 최초로 실패합니다.

이때 retry-timeout이 60초로 설정되어 있다면, 와치독은 즉시 시스템을 비정상으로 판단하지 않고 60초를 기다립니다.

60초 후에 다시 부하율을 체크합니다.

재시도 성공: 부하가 정상 범위로 돌아왔다면, 일시적인 문제로 간주하고 정상 작동 상태로 돌아갑니다.

재시도 실패: 여전히 부하가 높다면, 와치독은 이제 "시스템에 정말 문제가 생겼다"고 최종적으로 확정합니다.

설정 파일 (/etc/watchdog.conf) 예시:

코드 스니펫

# 1분 평균 부하가 24를 넘으면 테스트 실패로 간주
max-load-1 = 24

# 테스트 실패 시, 60초 후에 다시 테스트
# 이 값을 0으로 설정하면 재시도 없이 바로 실패로 확정
retry-timeout = 60
2. repair-maximum (최대 복구 시도 횟수)
이 옵션은 retry-timeout을 거쳐 시스템 장애가 최종적으로 확정되었을 때, 바로 재부팅을 유발하는 대신 사용자가 지정한 복구 스크립트를 실행하여 자체적으로 문제를 해결하도록 시도할 때 사용됩니다. repair-maximum은 이 복구 스크립트의 실행 횟수를 제한하는 역할을 합니다.

동작 방식:

위의 retry-timeout 단계에서 문제가 지속되는 것으로 최종 확정되었습니다.

와치독 데몬은 repair-binary 옵션에 지정된 스크립트가 있는지 확인합니다.

스크립트가 있다면, repair-maximum에 설정된 횟수만큼 복구를 시도합니다. (기본값: 1)

복구 스크립트를 실행하고, 다음 테스트 주기에서 상태를 다시 확인합니다.

복구 성공: 시스템 상태가 정상으로 돌아왔다면, 복구 시도 카운트는 초기화되고 와치독은 정상 작동 상태로 돌아갑니다.

복구 실패: 복구 스크립트를 실행했음에도 여전히 시스템 상태가 비정상이면, 복구 시도 카운트를 1 증가시키고 repair-maximum 값과 비교합니다.

최대 횟수 도달: 복구 시도가 repair-maximum에 도달하면, 와치독은 "복구를 포기"하고 /dev/watchdog 파일에 신호를 보내는 것을 중단합니다. 그 결과, 하드웨어 와치독 타이머가 만료되어 시스템이 강제로 재부팅됩니다.

설정 파일 (/etc/watchdog.conf) 예시:

코드 스니펫

# 문제가 확정되면 이 스크립트를 실행
repair-binary = /usr/sbin/repair

# 위 repair 스크립트는 최대 1번만 실행
# 만약 1번 실행 후에도 문제가 해결되지 않으면 재부팅 절차로 넘어감
repair-maximum = 1 
## 전체 동작 흐름 요약
두 옵션은 다음과 같은 순서로 동작합니다.

정상 상태 ➜ 1. 테스트 최초 실패 (예: 부하 임계치 초과) ➜ 2. 재시도 대기 (retry-timeout 만큼 대기) ➜ 3. 테스트 재시도 후 최종 실패 확정 ➜ 4. 복구 시도 (repair-binary 실행, repair-maximum 횟수 내) ➜ 5. 복구 실패 시 재부팅 (와치독 신호 중단)