using DevExpress.XtraCharts;
using DevExpress.XtraEditors;
using System;
using System.Data;
using System.Drawing;
using System.Windows.Forms;

namespace WinFormsApp
{
    public partial class MainForm : XtraForm
    {
        private ChartControl chartControl;

        public MainForm()
        {
            InitializeComponent();
            InitializeChartControl();
            AddSampleData();
        }

        private void InitializeChartControl()
        {
            chartControl = new ChartControl();
            chartControl.Dock = DockStyle.Fill;
            chartControl.ToolTipController = new ToolTipController();
            chartControl.ToolTipController.GetActiveObjectInfo += ToolTipController_GetActiveObjectInfo;
            Controls.Add(chartControl);
        }

        private void AddSampleData()
        {
            // 예시 데이터를 DataTable로 생성
            DataTable data = new DataTable();
            data.Columns.Add("과제명", typeof(string));
            data.Columns.Add("시작시간", typeof(DateTime));
            data.Columns.Add("종료시간", typeof(DateTime));

            // 예시 데이터 추가
            data.Rows.Add("과제 1", DateTime.Now.Date.AddHours(8), DateTime.Now.Date.AddHours(10));
            data.Rows.Add("과제 2", DateTime.Now.Date.AddHours(12), DateTime.Now.Date.AddHours(14));
            data.Rows.Add("과제 3", DateTime.Now.Date.AddHours(16), DateTime.Now.Date.AddHours(18));

            // 차트 데이터 소스 설정
            chartControl.DataSource = data;

            // 시리즈 생성
            Series series = new Series("과제", ViewType.Pie);
            series.ArgumentDataMember = "과제명";
            series.ValueDataMembers.AddRange("시작시간", "종료시간");
            series.PointOptions.ValueNumericOptions.Format = NumericFormat.DateTime;

            // 차트에 시리즈 추가
            chartControl.Series.Add(series);

            // 시리즈 라벨 설정
            PieSeriesLabel label = (PieSeriesLabel)series.Label;
            label.Position = PieSeriesLabelPosition.Inside;
            label.ResolveOverlappingMode = ResolveOverlappingMode.Default;
            label.TextPattern = "{A}";

            // 반지름 설정
            ((SimpleDiagram)chartControl.Diagram).PieAutoSize = false;
            ((SimpleDiagram)chartControl.Diagram).RadiusPercentage = 70;
        }

        private void ToolTipController_GetActiveObjectInfo(object sender, ToolTipControllerGetActiveObjectInfoEventArgs e)
        {
            if (e.InfoType == ToolTipControlInfoType.PieSeriesPoint)
            {
                PieSeriesPoint point = e.SelectedObject as PieSeriesPoint;
                if (point != null)
                {
                    string taskName = point.Argument;
                    DateTime startTime = point.Values[0].DateTimeValue;
                    DateTime endTime = point.Values[1].DateTimeValue;

                    SuperToolTip toolTip = new SuperToolTip();
                    toolTip.Items.AddTitle("과제 정보");
                    toolTip.Items.Add(taskName);
                    toolTip.Items.Add("시작 시간: " + startTime.ToString("HH:mm"));
                    toolTip.Items.Add("종료 시간: " + endTime.ToString("HH:mm"));

                    e.Info = new ToolTipControlInfo(point, toolTip);
                }
            }
        }
    }
}
