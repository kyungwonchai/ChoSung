래는 셀 값에 특정 문자열이 포함되어 있는지 확인할 수 있도록 InStr 함수를 사용하여 수정된 매크로입니다. 요청한 대로 Left 대신 "포함 여부"를 기준으로 값들을 처리합니다.

수정된 VBA 매크로 코드
vba
코드 복사
Sub ProcessOpenWorkbooks()
    Dim wbA As Workbook, wbB As Workbook
    Dim wsS1 As Worksheet, wsTarget As Worksheet
    Dim cell As Range
    Dim CH1 As String, SH1 As String
    Dim y1 As Range, y2 As Range
    Dim targetRow As Long

    ' 열린 파일 중 SOP와 SMD로 시작하는 파일 찾기
    For Each wbA In Application.Workbooks
        If InStr(1, wbA.Name, "SOP") > 0 Then Exit For
    Next wbA

    For Each wbB In Application.Workbooks
        If InStr(1, wbB.Name, "SMD") > 0 Then Exit For
    Next wbB

    If wbA Is Nothing Or wbB Is Nothing Then
        MsgBox "SOP 또는 SMD로 시작하는 파일이 모두 열려있지 않습니다."
        Exit Sub
    End If

    ' S1 시트 찾기 (사내와 외주 포함된 시트)
    For Each wsS1 In wbA.Worksheets
        If InStr(wsS1.Name, "사내") > 0 And InStr(wsS1.Name, "외주") > 0 Then Exit For
    Next wsS1

    If wsS1 Is Nothing Then
        MsgBox "A 파일에 '사내'와 '외주'가 포함된 시트를 찾을 수 없습니다."
        Exit Sub
    End If

    ' S1에서 CH1 찾기 (C열에서 "W"와 숫자 2개, "일별 생산계획" 포함)
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If InStr(cell.Value, "W") > 0 And IsNumeric(Mid(cell.Value, InStr(cell.Value, "W") + 1, 2)) And InStr(cell.Value, "일별 생산계획") > 0 Then
            CH1 = Mid(cell.Value, InStr(cell.Value, "W"), 3) ' W55 추출
            SH1 = Mid(CH1, 2, 2) & "주차" ' 주차 생성
            Exit For
        End If
    Next cell

    If CH1 = "" Or SH1 = "" Then
        MsgBox "CH1 또는 SH1 값을 찾을 수 없습니다."
        Exit Sub
    End If

    ' y1, y2 설정
    For Each cell In wsS1.Range("C150:C" & wsS1.Cells(wsS1.Rows.Count, "C").End(xlUp).Row)
        If cell.MergeArea Is Nothing = False Then ' 병합 셀 확인
            Dim mergeRow As Long
            mergeRow = cell.Row
            If InStr(wsS1.Cells(mergeRow, "E").Value, "SM-") > 0 Then
                ' y1, y2 정의
                Set y1 = wsS1.Cells(mergeRow, "E")
                Set y2 = wsS1.Range(wsS1.Cells(mergeRow, "F"), wsS1.Cells(mergeRow, "K"))
                Exit For
            End If
        End If
    Next cell

    If y1 Is Nothing Or y2 Is Nothing Then
        MsgBox "y1 또는 y2 값을 찾을 수 없습니다."
        Exit Sub
    End If

    ' B 파일에서 SH1 시트 찾기
    For Each wsTarget In wbB.Worksheets
        If InStr(wsTarget.Name, SH1) > 0 Then Exit For
    Next wsTarget

    If wsTarget Is Nothing Then
        MsgBox "B 파일에 '" & SH1 & "' 시트를 찾을 수 없습니다."
        Exit Sub
    End If

    ' z1, z2로 데이터 복사
    targetRow = wsTarget.Cells(wsTarget.Rows.Count, "D").End(xlUp).Row + 1
    wsTarget.Cells(targetRow, "D").Value = y1.Value ' z1에 복사
    wsTarget.Range(wsTarget.Cells(targetRow, "F"), wsTarget.Cells(targetRow, "K")).Value = y2.Value ' z2에 복사

    ' 완료 메시지
    MsgBox "데이터 복사가 완료되었습니다."
End Sub
주요 변경 사항
InStr 사용:

셀 값에서 W와 숫자가 포함된 위치를 확인하여 CH1 값을 추출합니다.
InStr(cell.Value, "일별 생산계획")로 "일별 생산계획" 문자열 포함 여부를 체크합니다.
병합 셀 확인:

MergeArea 속성을 이용하여 병합된 셀을 감지합니다.
SOP와 SMD 포함 여부:

열린 워크북 이름에서 InStr로 "SOP"와 "SMD" 문자열을 체크합니다.