알겠습니다. 이전 설명에서 누락된 부분을 보완하여 InputAccessibilityService에서 블루투스 서비스로부터 데이터를 받아 특정 애플리케이션의 입력 필드에 값을 넣는 이벤트 처리 로직과 서비스가 연결되었을 때 실행되는 코드를 더 자세히 설명하겠습니다.

InputAccessibilityService.kt 코드 보완
이 코드는 Accessibility Service가 활성화되면 실행되며, 블루투스 서비스로부터 전송된 데이터를 받아 대상 애플리케이션의 입력 필드에 자동으로 입력하는 로직을 포함합니다.

kotlin
코드 복사
import android.accessibilityservice.AccessibilityService
import android.content.BroadcastReceiver
import android.content.Context
import android.content.Intent
import android.content.IntentFilter
import android.view.accessibility.AccessibilityEvent
import android.view.accessibility.AccessibilityNodeInfo
import android.os.Bundle

class InputAccessibilityService : AccessibilityService() {
    private val dataReceiver = object : BroadcastReceiver() {
        override fun onReceive(context: Context, intent: Intent) {
            // "data"라는 키로 브로드캐스트된 데이터를 받습니다.
            val scannedData = intent.getStringExtra("data")
            // 받은 데이터를 입력 필드에 넣는 메서드를 호출합니다.
            scannedData?.let { insertTextIntoInputField(it) }
        }
    }

    override fun onServiceConnected() {
        super.onServiceConnected()
        // 브로드캐스트 리시버를 등록합니다. 데이터를 받을 인텐트 필터를 설정합니다.
        val intentFilter = IntentFilter("com.example.bluetooth.DATA_RECEIVED")
        registerReceiver(dataReceiver, intentFilter)
    }

    override fun onInterrupt() {
        // 서비스가 중단될 때 호출됩니다.
    }

    override fun onDestroy() {
        // 서비스가 종료될 때 리시버를 해제합니다.
        unregisterReceiver(dataReceiver)
        super.onDestroy()
    }

    override fun onAccessibilityEvent(event: AccessibilityEvent?) {
        // 현재 예제에서는 사용하지 않습니다.
    }

    private fun insertTextIntoInputField(text: String) {
        // 현재 활성화된 창의 루트 노드를 가져옵니다.
        val rootNode = rootInActiveWindow ?: return
        // 특정 입력 필드를 찾습니다. ID는 대상 앱의 구체적인 입력 필드 ID로 수정해야 합니다.
        val inputFields = rootNode.findAccessibilityNodeInfosByViewId("com.example.targetapp:id/inputField")
        for (field in inputFields) {
            // 입력 필드에 데이터를 설정하는 액션을 실행합니다.
            val arguments = Bundle()
            arguments.putCharSequence(AccessibilityNodeInfo.ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE, text)
            field.performAction(AccessibilityNodeInfo.ACTION_SET_TEXT, arguments)
        }
    }
}
설명:
onServiceConnected: Accessibility Service가 시스템 서비스에 연결되었을 때 호출됩니다. 이 메서드에서 브로드캐스트 리시버를 등록하고, 이 리시버는 블루투스 서비스로부터 데이터를 받아 처리합니다.
BroadcastReceiver: com.example.bluetooth.DATA_RECEIVED 액션으로 브로드캐스트된 인텐트를 수신하며, 이 인텐트에 포함된 데이터를 insertTextIntoInputField 메서드를 통해 입력 필드에 넣습니다.
insertTextIntoInputField: 해당 메서드는 받은 텍스트를 찾은 입력 필드에 삽입합니다. 입력 필드 ID는 대상 앱에 따라 적절히 수정해야 합니다.
이 코드는 Accessibility Service와 BroadcastReceiver를 사용하여 외부 데이터를 앱 내 입력 필드에 자동으로 삽입하는 예제입니다. 실제로 사용하기 전에는 대상 애플리케이션의 정확한 입력 필드 ID를 확인하고 코드에 반영해야 합니다.






