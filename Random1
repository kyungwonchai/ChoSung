using DevExpress.XtraBars;
using DevExpress.XtraBars.Ribbon;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

public partial class MainForm : RibbonForm
{
    // ë²„íŠ¼ ì„¤ì •ì„ ìœ„í•œ í´ë˜ìŠ¤ ì •ì˜
    public class ButtonConfig
    {
        public string PageName { get; set; }   // ë¦¬ë³¸ í˜ì´ì§€ ì´ë¦„
        public string GroupName { get; set; }  // ê·¸ë£¹ ì´ë¦„
        public string ButtonName { get; set; } // ë²„íŠ¼ ì´ë¦„
        public string Caption { get; set; }    // ë²„íŠ¼ ìº¡ì…˜
        public string Tag { get; set; }        // ë²„íŠ¼ íƒœê·¸
        public RibbonItemStyles Style { get; set; }  // ë²„íŠ¼ ìŠ¤íƒ€ì¼
    }

    // ë²„íŠ¼ ì„¤ì • ë¦¬ìŠ¤íŠ¸
    private List<ButtonConfig> buttonConfigs = new List<ButtonConfig>
    {
        new ButtonConfig { PageName = "File", GroupName = "FileOperations", ButtonName = "btnNew", Caption = "ìƒˆë¡œ ë§Œë“¤ê¸°", Tag = "NewDocument", Style = RibbonItemStyles.Large },
        new ButtonConfig { PageName = "File", GroupName = "FileOperations", ButtonName = "btnOpen", Caption = "ì—´ê¸°", Tag = "OpenDocument", Style = RibbonItemStyles.Large },
        new ButtonConfig { PageName = "File", GroupName = "FileOperations", ButtonName = "btnSave", Caption = "ì €ì¥", Tag = "SaveDocument", Style = RibbonItemStyles.Large },
        new ButtonConfig { PageName = "File", GroupName = "Print", ButtonName = "btnPrint", Caption = "ì¸ì‡„", Tag = "PrintDocument", Style = RibbonItemStyles.Large },
        new ButtonConfig { PageName = "Help", GroupName = "Support", ButtonName = "btnHelp", Caption = "ë„ì›€ë§", Tag = "Help", Style = RibbonItemStyles.SmallWithText }
    };

    private Dictionary<string, RibbonPage> pageCache = new Dictionary<string, RibbonPage>();  // ğŸ“Œ í˜ì´ì§€ ìºì‹±
    private Dictionary<string, RibbonPageGroup> groupCache = new Dictionary<string, RibbonPageGroup>();  // ğŸ“Œ ê·¸ë£¹ ìºì‹±

    public MainForm()
    {
        InitializeComponent();

        // ì»¤ìŠ¤í…€ ë²„íŠ¼ ì¶”ê°€
        AddCustomButtons();

        // ì²´í¬ë°•ìŠ¤ ìƒì„±
        CheckBox toggleButtonVisibilityCheckBox = new CheckBox
        {
            Text = "ì»¤ìŠ¤í…€ ë²„íŠ¼ í‘œì‹œ",
            Checked = true,
            AutoSize = true,
            Dock = DockStyle.Top
        };

        toggleButtonVisibilityCheckBox.CheckedChanged += ToggleButtonVisibilityCheckBox_CheckedChanged;
        this.Controls.Add(toggleButtonVisibilityCheckBox);
    }

    private void AddCustomButtons()
    {
        foreach (var config in buttonConfigs)
        {
            // ğŸ“Œ **í˜ì´ì§€ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)**
            if (!pageCache.TryGetValue(config.PageName, out RibbonPage page))
            {
                page = ribbonK.Pages.FirstOrDefault(p => p.Name == config.PageName);
                if (page == null)
                {
                    page = new RibbonPage(config.PageName) { Text = config.PageName };
                    ribbonK.Pages.Add(page);
                }
                pageCache[config.PageName] = page;
            }

            // ğŸ“Œ **ê·¸ë£¹ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)**
            string groupKey = $"{config.PageName}_{config.GroupName}";
            if (!groupCache.TryGetValue(groupKey, out RibbonPageGroup group))
            {
                group = page.Groups.FirstOrDefault(g => g.Name == config.GroupName);
                if (group == null)
                {
                    group = new RibbonPageGroup(config.GroupName) { Text = config.GroupName };
                    page.Groups.Add(group);
                }
                groupCache[groupKey] = group;
            }

            // ğŸ“Œ **ë²„íŠ¼ì´ ì´ë¯¸ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„ ì¶”ê°€**
            if (!ribbonK.Items.OfType<BarButtonItem>().Any(b => b.Name == config.ButtonName))
            {
                BarButtonItem newButton = new BarButtonItem
                {
                    Name = config.ButtonName,
                    Caption = config.Caption,
                    Tag = config.Tag,
                    Id = ribbonK.Manager.GetNewItemId(),
                    ImageOptions = { Image = Properties.Resources.Donut },
                    RibbonStyle = config.Style
                };

                // ğŸ“Œ **ê·¸ë£¹ì— ë²„íŠ¼ ì¶”ê°€**
                group.ItemLinks.Add(newButton);
            }
        }
    }

    private void ToggleButtonVisibilityCheckBox_CheckedChanged(object sender, System.EventArgs e)
    {
        bool isChecked = (sender as CheckBox).Checked;

        // ğŸ“Œ **ë²„íŠ¼ ê°€ì‹œì„± ë³€ê²½**
        foreach (var config in buttonConfigs)
        {
            BarButtonItem button = ribbonK.Items.OfType<BarButtonItem>().FirstOrDefault(b => b.Name == config.ButtonName);
            if (button != null)
            {
                button.Visibility = isChecked ? BarItemVisibility.Always : BarItemVisibility.Never;
            }
        }
    }