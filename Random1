using System;
using System.Data;
using System.Data.SqlClient;
using System.Windows.Forms;
using DevExpress.XtraCharts;

namespace YourNamespace
{
    public partial class YourForm : Form
    {
        private string connectionString = "Your_MSSQL_Connection_String";

        public YourForm()
        {
            InitializeComponent();
        }

        private void YourForm_Load(object sender, EventArgs e)
        {
            // 데이터 가져오기
            DataTable data = GetDataFromMSSQL();

            // 차트 생성
            ChartControl chartControl = new ChartControl();

            // 도넛 시리즈 생성 및 설정
            Series donutSeries = new Series("SuccessRate", ViewType.Doughnut);
            donutSeries.Points.Add(new SeriesPoint("SuccessRate", Convert.ToDouble(data.Rows[0]["SuccessRate"])));
            donutSeries.Label.TextPattern = "{A}: {VP:P0}";
            donutSeries.Label.Font = new Font("Arial", 14, FontStyle.Bold);
            donutSeries.Label.Position = PieSeriesLabelPosition.TwoColumns;
            chartControl.Series.Add(donutSeries);

            // 막대 시리즈 생성 및 설정
            Series barSeries = new Series("AttemptCount", ViewType.Bar);
            barSeries.Points.Add(new SeriesPoint("AttemptCount", Convert.ToDouble(data.Rows[0]["AttemptCount"])));
            chartControl.Series.Add(barSeries);

            // 선 시리즈 생성 및 설정
            Series lineSeries = new Series("SuccessRate", ViewType.Line);
            lineSeries.Points.Add(new SeriesPoint("SuccessRate", Convert.ToDouble(data.Rows[0]["SuccessRate"])));
            chartControl.Series.Add(lineSeries);

            // 시리즈 축 연결
            ((XYDiagram)chartControl.Diagram).SecondaryAxesY.Clear();
            ((XYDiagram)chartControl.Diagram).SecondaryAxesY.Add(new SecondaryAxisY("Secondary Axis"));
            ((LineSeriesView)lineSeries.View).AxisY = ((XYDiagram)chartControl.Diagram).SecondaryAxesY[0];

            // 차트 옵션 설정
            chartControl.Titles.Add(new ChartTitle());
            chartControl.Titles[0].Text = "Recent Performance";
            chartControl.Legend.Visible = false;

            // 차트를 Form에 추가
            chartControl.Dock = DockStyle.Fill;
            Controls.Add(chartControl);
        }

        private DataTable GetDataFromMSSQL()
        {
            DataTable dataTable = new DataTable();

            using (SqlConnection connection = new SqlConnection(connectionString))
            {
                // 쿼리 작성 (예시)
                string query = "SELECT '2023-01-01 ~ 2023-01-10' AS Period, '87 (7/8)' AS SuccessRate, 7 AS AttemptCount, 8 AS FailureCount, 'IPAddress' AS IPAddress";

                // 쿼리 실행
                using (SqlCommand command = new SqlCommand(query, connection))
                {
                    connection.Open();
                    SqlDataReader reader = command.ExecuteReader();

                    // 결과를 DataTable에 로드
                    dataTable.Load(reader);

                    reader.Close();
                }
            }

            return dataTable;
        }
    }
}
