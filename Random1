씀하신 요구 사항에 따라 스캐너 포트 및 타겟 포트 설정의 각 콤보박스에 기본 선택 항목을 추가하고, 사용자가 선택할 수 있도록 수정하겠습니다. 또한, 포트가 정상적으로 열리면 파란색, 열리지 않으면 빨간색으로 표시되도록 하겠습니다.

수정된 MainWindow.xaml.cs
csharp
코드 복사
using System;
using System.IO.Ports;
using System.Linq;
using System.Net;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;

namespace ScanValueTrans
{
    public partial class MainWindow : Window
    {
        private SettingsManager settingsManager;
        private SerialPortManager serialPortManager;
        private SocketServer socketServer;

        public MainWindow()
        {
            InitializeComponent();
            Initialize();
        }

        private void Initialize()
        {
            settingsManager = SettingsManager.Instance;
            serialPortManager = SerialPortManager.Instance;
            socketServer = SocketServer.Instance;

            // IP 주소 표시 및 QR 코드 생성
            string ipAddress = GetLocalIPAddress();
            IpAddressTextBlock.Text = ipAddress;

            // 기본 선택 값 설정
            InitializeComboBoxes();

            // 이전에 설정된 포트 값 불러오기
            LoadSavedSettings();

            // 포트 목록 새로고침
            RefreshPorts();

            // 소켓 서버 시작 (이전에 저장된 포트 값으로)
            string savedPort = settingsManager.GetSetting("Port");
            if (!string.IsNullOrEmpty(savedPort))
            {
                StartSocketServer(int.Parse(savedPort));
            }
        }

        private void InitializeComboBoxes()
        {
            // 기본 BaudRate 값 설정
            ScannerBaudRateComboBox.ItemsSource = new string[] { "9600", "19200", "38400", "57600", "115200" };
            ScannerBaudRateComboBox.SelectedIndex = 0;  // 기본값 설정

            // 기본 Parity 값 설정
            ScannerParityComboBox.ItemsSource = Enum.GetNames(typeof(Parity));
            ScannerParityComboBox.SelectedIndex = 0;  // 기본값 설정

            // 기본 DataBits 값 설정
            ScannerDataBitsComboBox.ItemsSource = new string[] { "5", "6", "7", "8" };
            ScannerDataBitsComboBox.SelectedIndex = 3;  // 기본값 설정 (8)

            // 기본 StopBits 값 설정
            ScannerStopBitsComboBox.ItemsSource = Enum.GetNames(typeof(StopBits));
            ScannerStopBitsComboBox.SelectedIndex = 1;  // 기본값 설정 (One)
        }

        private void LoadSavedSettings()
        {
            // 스캐너 포트 설정 로드
            ScannerPortComboBox.SelectedItem = settingsManager.GetSetting("ScannerPort");
            ScannerBaudRateComboBox.SelectedItem = settingsManager.GetSetting("ScannerBaudRate");
            ScannerParityComboBox.SelectedItem = settingsManager.GetSetting("ScannerParity");
            ScannerDataBitsComboBox.SelectedItem = settingsManager.GetSetting("ScannerDataBits");
            ScannerStopBitsComboBox.SelectedItem = settingsManager.GetSetting("ScannerStopBits");

            // 타겟 포트 설정 로드
            for (int i = 0; i < 5; i++)
            {
                var portControl = FindName($"TargetPortConfig{i + 1}") as PortConfigControl;
                portControl?.LoadPortSettings(i + 1);
            }
        }

        private void SaveSettings()
        {
            // 스캐너 포트 설정 저장
            settingsManager.SaveSetting("ScannerPort", ScannerPortComboBox.SelectedItem?.ToString());
            settingsManager.SaveSetting("ScannerBaudRate", ScannerBaudRateComboBox.SelectedItem?.ToString());
            settingsManager.SaveSetting("ScannerParity", ScannerParityComboBox.SelectedItem?.ToString());
            settingsManager.SaveSetting("ScannerDataBits", ScannerDataBitsComboBox.SelectedItem?.ToString());
            settingsManager.SaveSetting("ScannerStopBits", ScannerStopBitsComboBox.SelectedItem?.ToString());
        }

        private void RefreshPorts_Click(object sender, RoutedEventArgs e)
        {
            RefreshPorts();
        }

        private void RefreshPorts()
        {
            try
            {
                // 사용 가능한 포트 이름 가져오기
                string[] portNames = SerialPort.GetPortNames();

                // 스캐너 포트 콤보박스 갱신
                ScannerPortComboBox.ItemsSource = portNames;
                ScannerPortComboBox.SelectedIndex = 0;  // 첫 번째 포트 기본 선택

                // 타겟 포트 콤보박스 갱신
                for (int i = 0; i < 5; i++)
                {
                    var portControl = FindName($"TargetPortConfig{i + 1}") as PortConfigControl;
                    portControl?.RefreshPortList(portNames);
                }

                LogMessage("COM 포트 목록이 갱신되었습니다.");
            }
            catch (Exception ex)
            {
                LogMessage($"포트 목록 갱신 중 오류 발생: {ex.Message}");
            }
        }

        private string GetLocalIPAddress()
        {
            string localIP = "127.0.0.1"; // 기본 IP 설정

            try
            {
                foreach (var ip in Dns.GetHostAddresses(Dns.GetHostName()))
                {
                    if (ip.AddressFamily == System.Net.Sockets.AddressFamily.InterNetwork)
                    {
                        localIP = ip.ToString();
                        break;
                    }
                }
            }
            catch (Exception ex)
            {
                LogMessage($"IP 주소를 가져오는 중 오류 발생: {ex.Message}");
            }

            return localIP;
        }

        private void StartSocketServer(int port)
        {
            try
            {
                socketServer.Start(port);
                settingsManager.SaveSetting("Port", port.ToString());
                GenerateQRCode(IpAddressTextBlock.Text, port.ToString());
            }
            catch (Exception ex)
            {
                LogMessage($"소켓 서버 시작 중 오류 발생: {ex.Message}");
            }
        }

        private void GenerateQRCode(string ipAddress, string port)
        {
            try
            {
                string qrContent = $"{ipAddress}:{port}";
                var qrCodeImage = new QRCodeGenerator().GenerateQRCode(qrContent);
                QrCodeImage.Source = qrCodeImage;
            }
            catch (Exception ex)
            {
                LogMessage($"QR 코드 생성 중 오류 발생: {ex.Message}");
            }
        }

        private void LogMessage(string message)
        {
            Dispatcher.Invoke(() =>
            {
                string timestamp = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
                LogListBox.Items.Add($"{timestamp} - {message}");

                if (LogListBox.Items.Count > 100)
                {
                    LogListBox.Items.RemoveAt(0);
                }
            });
        }

        private void ScannerPortComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            try
            {
                if (ScannerPortComboBox.SelectedItem == null) return;

                string selectedPort = ScannerPortComboBox.SelectedItem.ToString();
                string baudRate = ScannerBaudRateComboBox.SelectedItem?.ToString() ?? "9600";
                string parity = ScannerParityComboBox.SelectedItem?.ToString() ?? "None";
                string dataBits = ScannerDataBitsComboBox.SelectedItem?.ToString() ?? "8";
                string stopBits = ScannerStopBitsComboBox.SelectedItem?.ToString() ?? "One";

                serialPortManager.OpenScannerPort(selectedPort, int.Parse(baudRate), 
                    (Parity)Enum.Parse(typeof(Parity), parity), int.Parse(dataBits), 
                    (StopBits)Enum.Parse(typeof(StopBits), stopBits));

                // 포트가 정상적으로 열리면 파란색, 열리지 않으면 빨간색으로 표시
                if (serialPortManager.ScannerPort.IsOpen)
                {
                    ScannerPortComboBox.Foreground = Brushes.Blue;
                    LogMessage($"스캐너 포트 {selectedPort}가 설정되었습니다.");
                }
                else
                {
                    ScannerPortComboBox.Foreground = Brushes.Red;
                    LogMessage($"스캐너 포트 {selectedPort}를 열 수 없습니다.");
                }

                SaveSettings();
            }
            catch (UnauthorizedAccessException ex)
            {
                LogMessage($"스캐너 포트 {ScannerPortComboBox.SelectedItem} 접근 권한이 없습니다: {ex.Message}");
                ScannerPortComboBox.Foreground = Brushes.Red;
            }
            catch (IOException ex)
            {
                LogMessage($"스캐너 포트 {ScannerPortComboBox.SelectedItem}에서 I/O 오류 발생: {ex.Message}");
                ScannerPortComboBox.Foreground = Brushes.Red;
            }
            catch (ArgumentException ex)
            {
                LogMessage($"스캐너 포트 설정이 잘못되었습니다: {ex.Message}");
                ScannerPortComboBox.Foreground = Brushes.Red;
            }
            catch (Exception ex)
            {
                LogMessage($"스캐너 포트 설정 중 오류 발생: {ex.Message}");
                ScannerPortComboBox.Foreground = Brushes.Red;
            }
        }
    }
}
주요 변경 사항 및 설명:
콤보박스 기본값 설정:

InitializeComboBoxes() 메서드를 통해 스캐너 포트 설정(baud rate, parity, data bits, stop bits)의 기본값을 설정했습니다. 사용자가 이를 수정할 수 있습니다.
포트 정상 여부에 따른 색상 변경:

스캐너 포트를 설정할 때 포트가 정상적으로 열리면 ScannerPortComboBox의 글자 색상이 파란색(Blue)으로, 포트를 열 수 없으면 빨간색(Red)으로 변경됩니다.
포트 목록 새로고침:

RefreshPorts() 메서드에서 스캐너 및 타겟 포트 콤보박스를 갱신하고, 첫 번째 포트를 기본 선택으로 설정했습니다.
이제 스캐너 및 타겟 포트 설정이 올바르게 작동하며, 포트가 정상적으로 열리면 파란색, 열리지 않으면 빨간색으로 표시됩니다. 추가적인 수정이나 요청이 필요하면 언제든지 말씀해 주