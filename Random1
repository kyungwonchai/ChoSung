using ScreenRecorderLib;
using System;
using System.Timers;

namespace ScreenRecorderExample
{
    class Program
    {
        static Recorder _recorder;
        static Timer _timer;
        static int _fileCounter = 0;

        static void Main(string[] args)
        {
            // 1분마다 이벤트를 발생시키는 타이머 설정
            _timer = new Timer(60000);
            _timer.Elapsed += OnTimedEvent;
            _timer.AutoReset = true;
            _timer.Start();

            // 녹화 옵션 설정 (기본 설정 사용)
            RecorderOptions options = new RecorderOptions();

            // 녹화 시작
            _recorder = Recorder.CreateRecorder(options);
            _recorder.OnRecordingComplete += Recorder_OnRecordingComplete;
            _recorder.Record($"recording{_fileCounter}.mp4");

            Console.WriteLine("녹화 시작. 종료하려면 키를 누르세요...");
            Console.ReadKey();
            
            // 녹화 정지
            _recorder.Stop();
        }

        private static void OnTimedEvent(Object source, ElapsedEventArgs e)
        {
            // 현재 녹화 중단
            _recorder.Stop();

            // 파일명 변경
            _fileCounter++;
            string fileName = $"recording{_fileCounter}.mp4";

            // 다시 녹화 시작
            _recorder.Record(fileName);
            Console.WriteLine($"{fileName} 저장 시작.");
        }

        private static void Recorder_OnRecordingComplete(object sender, RecordingCompleteEventArgs e)
        {
            Console.WriteLine("녹화 완료.");
        }
    }
}
