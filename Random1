from flask import Flask, send_file
import pymssql
from openpyxl import Workbook
import io

app = Flask(__name__)

@app.route('/')
def open_excel():
    # MSSQLDB 연결 설정
    server = 'YourServerName'
    database = 'YourDatabaseName'
    username = 'YourUsername'
    password = 'YourPassword'

    # 연결 생성
    conn = pymssql.connect(server=server, database=database, user=username, password=password)
    cursor = conn.cursor()

    # 쿼리 실행하여 데이터 가져오기
    query = 'SELECT * FROM YourTableName'
    cursor.execute(query)

    # 데이터를 스프레드시트로 로드
    workbook = Workbook()
    worksheet = workbook.active
    for row in cursor:
        worksheet.append(row)

    # 파일 저장 및 인코딩
    temp_file = io.BytesIO()
    workbook.save(temp_file)
    temp_file.seek(0)

    # 파일 다운로드
    return send_file(temp_file, as_attachment=True, mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                     attachment_filename='temp.xlsx')

if __name__ == '__main__':
    app.run()
