using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;

public class Program
{
    [DllImport("user32.dll", SetLastError = true)]
    public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

    [DllImport("user32.dll", SetLastError = true)]
    public static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint processId);

    public static void Main()
    {
        Excel.Application xlApp = new Excel.Application();
        xlApp.Visible = true;

        // 1초 대기 (Excel 애플리케이션이 완전히 시작되기를 기다림)
        System.Threading.Thread.Sleep(1000);

        IntPtr hwnd = FindWindow(null, xlApp.Caption);
        if (hwnd != IntPtr.Zero)
        {
            uint processId;
            GetWindowThreadProcessId(hwnd, out processId);
            Process excelProcess = Process.GetProcessById((int)processId);

            // 이제 excelProcess.Handle을 사용하여 프로세스 핸들을 얻을 수 있습니다.
        }
        else
        {
            Console.WriteLine("Excel window not found!");
        }
    }
}
