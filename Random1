ë„¤, ì•Œê² ìŠµë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ ë…¼ì˜í•œ ëª¨ë“  ê¸°ëŠ¥(API ê¸°ë°˜, ìˆ˜ë™/AI ê°œì…, í˜‘ì—…, ë¡œê¹…)ì„ í¬í•¨í•˜ëŠ” **'ì§€ëŠ¥í˜• ì‘ì—… í ì‹œìŠ¤í…œ'**ì„ ìš°ë¶„íˆ¬ 24.04 LTS ì„œë²„ 1ëŒ€ì— Docker Composeë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œë¡œ êµ¬ì¶•í•˜ëŠ” ì „ì²´ ê³¼ì •ì„ A to Zë¡œ, ë§¤ìš° ìƒì„¸í•˜ê²Œ ì•ˆë‚´í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ğŸš€ ìµœì¢… ì•„í‚¤í…ì²˜
ìš°ë¦¬ëŠ” 'ê³µìœ  ì£¼ë°©' ë¹„ìœ ì²˜ëŸ¼, í•˜ë‚˜ì˜ ìš°ë¶„íˆ¬ ì„œë²„(ì£¼ë°© ê±´ë¬¼) ì•ˆì— ê¸°ëŠ¥ë³„ë¡œ ë¶„ë¦¬ëœ ì»¨í…Œì´ë„ˆ(ì „ë¬¸ ì‹ë‹¹)ë“¤ì„ Docker Compose(ì„¤ê³„ë„)ë¥¼ ì´ìš©í•´ êµ¬ì¶•í•  ê²ƒì…ë‹ˆë‹¤.

[ì‹œìŠ¤í…œ êµ¬ì„±ë„]

[ì‚¬ìš©ì PC / ë¡œë´‡ / AI]  <-- (HTTP ìš”ì²­) -->  [ â“µ API ì„œë²„ (FastAPI) ]
                                                |
                               +----------------+----------------+
                               |                |                |
                       [ â“¶ Redis ]      [ â“· PostgreSQL ]      [ ... ]
                       (ì‘ì—… í)        (ì‘ì—…ë¡œê·¸/DB)
## âš™ï¸ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ í™˜ê²½ ì„¤ì •
ê°€ì¥ ë¨¼ì €, í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ í´ë”ì™€ ê¸°ë³¸ ì„¤ê³„ë„(docker-compose.yml)ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.

1. í”„ë¡œì íŠ¸ í´ë” ìƒì„±
ìš°ë¶„íˆ¬ ì„œë²„ì— SSHë¡œ ì ‘ì†í•˜ì—¬ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

Bash

# í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ í´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
mkdir intelligent_queue && cd intelligent_queue

# API ì„œë²„ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹´ì„ í´ë”ë¥¼ ë¯¸ë¦¬ ë§Œë“­ë‹ˆë‹¤.
mkdir api
2. docker-compose.yml ì‘ì„± (ì‹œìŠ¤í…œ ì „ì²´ ì„¤ê³„ë„)
intelligent_queue í´ë” ì•ˆì— docker-compose.yml íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ì‘ì„±í•©ë‹ˆë‹¤. ì´ íŒŒì¼ì´ ìš°ë¦¬ ì‹œìŠ¤í…œì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œë¥¼ ì •ì˜í•˜ê³  ì—°ê²°í•˜ëŠ” ì‹¬ì¥ë¶€ì…ë‹ˆë‹¤.

YAML

version: '3.8'

services:
  # 1. API ì„œë²„: ëª¨ë“  ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê´€ë¬¸
  api_server:
    container_name: api_server
    # ./api í´ë”ì— ìˆëŠ” Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ
    build: ./api
    # ì™¸ë¶€ 8000 í¬íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆ 8000 í¬íŠ¸ë¡œ ì—°ê²°
    ports:
      - "8000:8000"
    # ì†ŒìŠ¤ ì½”ë“œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ë„ë¡ ë³¼ë¥¨ ì„¤ì • (ê°œë°œ í¸ì˜ì„±)
    volumes:
      - ./api:/app
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (DB, Redis ì ‘ì† ì •ë³´)
    environment:
      - DATABASE_URL=postgresql://user:password@database:5432/mydatabase
      - REDIS_HOST=message_queue
    # DBì™€ Redisê°€ ë¨¼ì € ì‹¤í–‰ëœ í›„ì— API ì„œë²„ê°€ ì‹¤í–‰ë˜ë„ë¡ ì˜ì¡´ì„± ì„¤ì •
    depends_on:
      - database
      - message_queue

  # 2. ë©”ì‹œì§€ í: ì‘ì—… ëŒ€ê¸°ì—´ì„ ê´€ë¦¬
  message_queue:
    container_name: message_queue
    image: "redis:7-alpine"
    ports:
      - "6379:6379"

  # 3. ë°ì´í„°ë² ì´ìŠ¤: ëª¨ë“  ë¡œê·¸ì™€ ì˜êµ¬ ë°ì´í„°ë¥¼ ì €ì¥
  database:
    container_name: database
    image: "postgres:15-alpine"
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=mydatabase
    volumes:
      # ì»¨í…Œì´ë„ˆê°€ ì‚­ì œë¼ë„ ë°ì´í„°ëŠ” ë³´ì¡´ë˜ë„ë¡ ë³¼ë¥¨ ì—°ê²°
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
## ğŸ 2ë‹¨ê³„: API ì„œë²„ ê°œë°œ (FastAPI)
ì´ì œ ì‹œìŠ¤í…œì˜ ë‘ë‡Œ ì—­í• ì„ í•  API ì„œë²„ì˜ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

1. api/requirements.txt ì‘ì„± (í•„ìš”í•œ íŒŒì´ì¬ ë¼ì´ë¸ŒëŸ¬ë¦¬)
api í´ë” ì•ˆì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡ íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.

Plaintext

fastapi
uvicorn[standard]
redis
psycopg2-binary
sqlalchemy
2. api/main.py ì‘ì„± (API í•µì‹¬ ë¡œì§)
api í´ë” ì•ˆì— APIì˜ ëª¨ë“  ê¸°ëŠ¥ì„ ë‹´ì€ ë©”ì¸ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

Python

from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import redis
import psycopg2
from psycopg2.extras import RealDictCursor
import json
import os
from datetime import datetime

# --- ì„¤ì • ---
REDIS_HOST = os.getenv("REDIS_HOST", "localhost")
DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://user:password@localhost/mydatabase")

# --- FastAPI ì•± ì´ˆê¸°í™” ---
app = FastAPI(title="ì§€ëŠ¥í˜• ì‘ì—… í ì‹œìŠ¤í…œ API")

# --- Redis ë° DB ì—°ê²° ---
# Redisì—ì„œëŠ” 'wait_queue'ë¼ëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ì‘ì—… íë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
r = redis.Redis(host=REDIS_HOST, port=6379, db=0, decode_responses=True)
db_conn = psycopg2.connect(DATABASE_URL)

# --- ë°ì´í„° ëª¨ë¸ ì •ì˜ (Pydantic) ---
class Job(BaseModel):
    job_id: str
    description: str
    priority: int = 10 # ìš°ì„ ìˆœìœ„ (ë‚®ì„ìˆ˜ë¡ ë†’ìŒ)
    details: dict

# --- API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ ---

@app.on_event("startup")
async def startup_event():
    # í”„ë¡œê·¸ë¨ ì‹œì‘ ì‹œ DBì— ë¡œê·¸ í…Œì´ë¸” ìƒì„±
    with db_conn.cursor() as cursor:
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS job_logs (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
                actor_id VARCHAR(100),
                action VARCHAR(50),
                job_id VARCHAR(100),
                reason TEXT,
                details JSONB
            );
        """)
        db_conn.commit()

def log_action(actor_id, action, job_id, reason, details={}):
    """ëª¨ë“  ë³€ê²½ ì‚¬í•­ì„ DBì— ê¸°ë¡í•˜ëŠ” í•¨ìˆ˜"""
    with db_conn.cursor() as cursor:
        cursor.execute(
            "INSERT INTO job_logs (actor_id, action, job_id, reason, details) VALUES (%s, %s, %s, %s, %s)",
            (actor_id, action, job_id, reason, json.dumps(details))
        )
        db_conn.commit()

@app.post("/jobs", summary="ì‹ ê·œ ì‘ì—… ì¶”ê°€")
async def add_job(job: Job, actor_id: str = "System"):
    job_json = job.model_dump_json()
    # lpush: íì˜ ë§¨ ì•ì— ì‘ì—…ì„ ì¶”ê°€ (ìš°ì„ ìˆœìœ„ëŠ” ë‚˜ì¤‘ì— ì •ë ¬ ë¡œì§ì—ì„œ ì‚¬ìš©)
    r.lpush("wait_queue", job_json)
    log_action(actor_id, "ADD_JOB", job.job_id, "ì‹ ê·œ ì‘ì—… ë“±ë¡")
    return {"message": "Job added successfully", "job": job}

@app.get("/jobs", summary="í˜„ì¬ ëŒ€ê¸° í ì¡°íšŒ")
async def get_jobs():
    queue_json = r.lrange("wait_queue", 0, -1)
    queue = [json.loads(j) for j in queue_json]
    return {"queue": queue}

@app.post("/jobs/{job_id}/claim", summary="ì‘ì—… ê°€ì ¸ê°€ê¸° (ìˆ˜ë™ ì²˜ë¦¬)")
async def claim_job(job_id: str, actor_id: str, reason: str):
    # ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” job_idë¥¼ ì°¾ì•„ ì •í™•íˆ ì œê±°í•˜ëŠ” ë¡œì§ì´ í•„ìš”
    # ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ë§¨ ë’¤ ì‘ì—…ì„ ê°€ì ¸ê°„ë‹¤ê³  ê°€ì •
    job_json = r.rpop("wait_queue")
    if not job_json:
        raise HTTPException(status_code=404, detail="No jobs in queue")
    
    job_data = json.loads(job_json)
    log_action(actor_id, "CLAIM_JOB", job_data['job_id'], reason, details=job_data)
    return {"message": f"Job {job_data['job_id']} claimed by {actor_id}", "claimed_job": job_data}

# TODO: AI ì¬ì •ë ¬, ìš°ì„ ìˆœìœ„ ìˆ˜ì • ë“±ì˜ API ì¶”ê°€ ...
3. api/Dockerfile ì‘ì„± (API ì„œë²„ ì„¤ê³„ë„)
ë§ˆì§€ë§‰ìœ¼ë¡œ api í´ë”ì— API ì„œë²„ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“œëŠ” ì„¤ê³„ë„ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

Dockerfile

FROM python:3.9-slim

WORKDIR /app

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
COPY . .

# FastAPI ì„œë²„ ì‹¤í–‰
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
## ğŸ¬ 3ë‹¨ê³„: ì‹œìŠ¤í…œ ì „ì²´ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
ì´ì œ ëª¨ë“  ì¤€ë¹„ê°€ ëë‚¬ìŠµë‹ˆë‹¤. ëª…ë ¹ì–´ í•œ ì¤„ë¡œ ì‹œìŠ¤í…œ ì „ì²´ë¥¼ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸í•´ ë´…ë‹ˆë‹¤.

1. ì‹œìŠ¤í…œ ì‹œì‘
intelligent_queue í´ë”(ìµœìƒìœ„ í´ë”)ì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

Bash

# --build ì˜µì…˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ìƒˆë¡œ ë¹Œë“œí•˜ë©° ëª¨ë“  ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œ(-d)ë¡œ ì‹¤í–‰
docker-compose up --build -d
docker-compose ps ëª…ë ¹ì–´ë¡œ 3ê°œì˜ ì»¨í…Œì´ë„ˆ(api_server, message_queue, database)ê°€ ëª¨ë‘ Up ìƒíƒœì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.

2. API í…ŒìŠ¤íŠ¸ (í„°ë¯¸ë„ì—ì„œ curl ì‚¬ìš©)
(A) ì‹ ê·œ ì‘ì—… 2ê°œ ì¶”ê°€:

Bash

curl -X POST "http://localhost:8000/jobs?actor_id=Manager_Lee" -H "Content-Type: application/json" -d '{"job_id": "TASK-001", "description": "Bêµ¬ì—­ ìì¬ ì¤€ë¹„", "priority": 5, "details": {"material": "2222-008888"}}'
curl -X POST "http://localhost:8000/jobs?actor_id=Robot_01" -H "Content-Type: application/json" -d '{"job_id": "TASK-002", "description": "Cêµ¬ì—­ í”¼ë” êµì²´", "priority": 10, "details": {"feeder": "15R"}}'
(B) í˜„ì¬ í ìƒíƒœ í™•ì¸:

Bash

curl http://localhost:8000/jobs
ë°©ê¸ˆ ì¶”ê°€í•œ 2ê°œì˜ ì‘ì—…ì´ íì— ë“¤ì–´ìˆëŠ” ê²ƒì„ JSON í˜•íƒœë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

(C) PC-B ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì‘ì—… ê°€ì ¸ê°€ê¸°:

Bash

curl -X POST "http://localhost:8000/jobs/TASK-002/claim?actor_id=PC-B&reason=ê¸´ê¸‰ë¼ì¸ì •ì§€ìš”ì²­"
(D) ë‹¤ì‹œ í ìƒíƒœ í™•ì¸:

Bash

curl http://localhost:8000/jobs
ì‘ì—… í•˜ë‚˜ê°€ íì—ì„œ ì‚¬ë¼ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì˜ job_logs í…Œì´ë¸”ì—ëŠ” 'PC-B'ê°€ 'ê¸´ê¸‰ë¼ì¸ì •ì§€ìš”ì²­' ì‚¬ìœ ë¡œ ì‘ì—…ì„ ê°€ì ¸ê°”ë‹¤ëŠ” ë¡œê·¸ê°€ ê¸°ë¡ë˜ì–´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.