using System;

namespace StringManipulation
{
    class Program
    {
        static void Main(string[] args)
        {
            string C = "gsgsgBSM-sgsgsg_5_005";
            string prefix = "BSM-";
            int startIndex = C.IndexOf(prefix);

            if (startIndex != -1)
            {
                int endIndex = C.IndexOf(' ', startIndex);
                if (endIndex == -1) endIndex = C.Length;

                string targetString = C.Substring(startIndex, endIndex - startIndex);
                string[] parts = targetString.Split('_');

                if (parts.Length >= 3)
                {
                    if (int.TryParse(parts[parts.Length - 1], out int lastNumber))
                    {
                        lastNumber++;
                        parts[parts.Length - 1] = lastNumber.ToString("D3");
                    }
                }
                else
                {
                    parts[parts.Length - 1] += "_001";
                }

                string newString = string.Join('_', parts);
                C = C.Replace(targetString, newString);
            }

            Console.WriteLine("Modified string: " + C);
        }
    }
}
