MySQL에서 smd.management_mobile_checksheet 테이블에서 check_time이 18개월 이상 지난 데이터를 백업 테이블로 이동시키고 원본 테이블에서 삭제하는 작업을 수행하려면 다음과 같은 단계를 따릅니다:

백업 테이블 생성:
백업 데이터를 저장할 테이블을 생성합니다. 원본 테이블과 동일한 구조를 유지하는 것이 좋습니다.

sql
코드 복사
CREATE TABLE IF NOT EXISTS smd.management_mobile_checksheet_backup AS 
SELECT * FROM smd.management_mobile_checksheet WHERE 1=0;
백업 및 삭제를 수행하는 쿼리:
check_time이 18개월 이상 지난 데이터를 백업 테이블로 이동시키고 원본 테이블에서 삭제합니다.

sql
코드 복사
INSERT INTO smd.management_mobile_checksheet_backup 
SELECT * FROM smd.management_mobile_checksheet 
WHERE check_time < NOW() - INTERVAL 18 MONTH;

DELETE FROM smd.management_mobile_checksheet 
WHERE check_time < NOW() - INTERVAL 18 MONTH;
이벤트 작업 등록:
매일 한 번 이 작업을 수행하도록 이벤트를 등록합니다.

sql
코드 복사
CREATE EVENT IF NOT EXISTS backup_and_delete_old_checksheet_data
ON SCHEDULE EVERY 1 DAY
STARTS CURRENT_TIMESTAMP
DO
BEGIN
    INSERT INTO smd.management_mobile_checksheet_backup 
    SELECT * FROM smd.management_mobile_checksheet 
    WHERE check_time < NOW() - INTERVAL 18 MONTH;

    DELETE FROM smd.management_mobile_checksheet 
    WHERE check_time < NOW() - INTERVAL 18 MONTH;
END;
설명:
백업 테이블 생성: 백업 테이블은 원본 테이블과 동일한 구조를 가지며, WHERE 1=0 조건을 사용하여 빈 테이블을 생성합니다.
데이터 이동 및 삭제: INSERT INTO ... SELECT ... WHERE ... 구문으로 데이터를 백업 테이블로 이동시킨 후, DELETE FROM ... WHERE ... 구문으로 원본 테이블에서 데이터를 삭제합니다.
이벤트 작업 등록: MySQL 이벤트 스케줄러를 사용하여 매일 한 번 이 작업을 자동으로 실행합니다.
이 쿼리들을 사용하여 18개월이 지난 데이터를 백업하고 삭제하는 작업을 자동화할 수 있습니