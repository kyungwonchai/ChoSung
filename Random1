령이 Windows에서 제공하는 COM 포트 정보를 열지 않고도 확인할 수 있지만, .NET의 System.IO.Ports.SerialPort 클래스는 포트를 열어야만 일부 설정 값을 읽을 수 있습니다.

하지만, **Windows Management Instrumentation (WMI)**를 사용하면 포트를 열지 않고도 COM 포트 정보에 접근할 수 있습니다. WMI는 시스템 정보를 쿼리할 수 있는 강력한 도구로, COM 포트의 Baud Rate, Parity 등의 정보를 가져올 수 있습니다.

다음은 WPF MVVM 패턴에서 WMI를 사용해 COM 포트 정보를 열지 않고 조회하는 방법입니다.

1. View (XAML)
MainWindow.xaml에서 ListBox와 Button을 추가하여 UI를 구성합니다.

xml
코드 복사
<Window x:Class="ComPortViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="COM Port Viewer" Height="400" Width="500">
    <Grid>
        <Button Content="Load COM Port Settings" 
                Command="{Binding LoadComPortSettingsCommand}" 
                Width="150" Height="30" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Top" 
                Margin="0,10,0,0"/>
        
        <ListBox ItemsSource="{Binding ComPortDetails}" 
                 Width="400" Height="300" 
                 HorizontalAlignment="Center" 
                 VerticalAlignment="Center" 
                 Margin="0,50,0,0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding}"/>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</Window>
2. ViewModel
MainViewModel.cs 파일을 생성하고, WMI 쿼리를 통해 COM 포트 설정을 불러오는 코드를 작성합니다.

csharp
코드 복사
using System;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Management;
using System.Runtime.CompilerServices;
using System.Windows.Input;

namespace ComPortViewer
{
    public class MainViewModel : INotifyPropertyChanged
    {
        // COM 포트 세부 정보 저장
        public ObservableCollection<string> ComPortDetails { get; private set; }

        // COM 포트를 로드하는 명령
        public ICommand LoadComPortSettingsCommand { get; private set; }

        public MainViewModel()
        {
            // 컬렉션 초기화
            ComPortDetails = new ObservableCollection<string>();

            // 명령 초기화
            LoadComPortSettingsCommand = new RelayCommand(LoadComPortSettings);
        }

        // COM 포트 설정을 로드하는 메서드
        private void LoadComPortSettings()
        {
            // 기존 포트 설정 정보 지우기
            ComPortDetails.Clear();

            // WMI 쿼리를 통해 COM 포트 정보를 가져옴
            using (var searcher = new ManagementObjectSearcher("SELECT * FROM Win32_SerialPort"))
            {
                foreach (ManagementObject queryObj in searcher.Get())
                {
                    ComPortDetails.Add($"Port: {queryObj["DeviceID"]}");
                    ComPortDetails.Add($"Name: {queryObj["Name"]}");
                    ComPortDetails.Add($"Baud Rate: {queryObj["MaxBaudRate"]}");
                    ComPortDetails.Add($"ProviderType: {queryObj["ProviderType"]}");
                    ComPortDetails.Add($"Status: {queryObj["Status"]}");
                    ComPortDetails.Add($"Parity: {queryObj["Parity"]}");
                    ComPortDetails.Add($"Stop Bits: {queryObj["StopBits"]}");
                    ComPortDetails.Add("-----------");
                }
            }
        }

        // INotifyPropertyChanged 구현
        public event PropertyChangedEventHandler PropertyChanged;
        protected void OnPropertyChanged([CallerMemberName] string propertyName = null)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }

    // RelayCommand 클래스 - ICommand 구현체
    public class RelayCommand : ICommand
    {
        private readonly Action _execute;
        private readonly Func<bool> _canExecute;

        public RelayCommand(Action execute, Func<bool> canExecute = null)
        {
            _execute = execute;
            _canExecute = canExecute;
        }

        public bool CanExecute(object parameter)
        {
            return _canExecute == null || _canExecute();
        }

        public void Execute(object parameter)
        {
            _execute();
        }

        public event EventHandler CanExecuteChanged;

        public void RaiseCanExecuteChanged()
        {
            CanExecuteChanged?.Invoke(this, EventArgs.Empty);
        }
    }
}
WMI 쿼리: ManagementObjectSearcher를 사용하여 Win32_SerialPort 클래스에서 COM 포트 정보를 가져옵니다. 이 클래스는 각 포트에 대한 DeviceID, Name, MaxBaudRate, ProviderType, Status, Parity, StopBits 등의 속성을 제공합니다.
ComPortDetails: ObservableCollection<string> 타입으로, 각 COM 포트의 세부 설정을 저장하여 ListBox와 바인딩됩니다.
LoadComPortSettingsCommand: 버튼을 클릭할 때 실행되는 명령입니다.
3. View와 ViewModel 연결
MainWindow.xaml.cs에서 DataContext를 MainViewModel로 설정합니다.

csharp
코드 복사
using System.Windows;

namespace ComPortViewer
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
            DataContext = new MainViewModel();
        }
    }
}
설명
Button을 클릭하면 LoadComPortSettingsCommand가 호출됩니다.
LoadComPortSettings 메서드는 WMI 쿼리를 사용하여 포트를 열지 않고 각 COM 포트의 세부 설정을 ComPortDetails에 추가합니다.