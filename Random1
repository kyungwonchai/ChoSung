 로드 시 리본 버튼과 관련된 초기화 작업이 누락된 경우, 적절한 초기화 함수를 호출해야 합니다. 폼 로드 시 필요한 작업은 리본 버튼의 데이터 로드, UI 초기화, 현재 사용자 설정입니다.

아래는 폼 로드 함수에 넣어야 할 작업 목록과 필요한 초기화 코드를 제공합니다.

폼 로드 함수 (Form_Load)
csharp
코드 복사
private void Form_Load(object sender, EventArgs e)
{
    try
    {
        // 1. 리본 버튼 초기화
        InitializeRibbonButtons();

        // 2. 사용자 ID 설정 (로그인 여부에 따라 초기화)
        SetCurrentUser(null); // 로그아웃 상태로 시작

        // 3. 버튼 상태 반영
        InitializeButtons();
    }
    catch (Exception ex)
    {
        Console.WriteLine($"[Error] Form_Load: {ex.Message}");
    }
}
1. 리본 버튼 초기화 (InitializeRibbonButtons)
리본 버튼의 데이터가 비어 있는 경우 이를 초기화해야 합니다.

csharp
코드 복사
private void InitializeRibbonButtons()
{
    // 버튼 딕셔너리 초기화 (Name -> BarButtonItem 매핑)
    buttonsDictionary.Clear();

    foreach (RibbonPage page in ribbonK.Pages)
    {
        foreach (RibbonPageGroup group in page.Groups)
        {
            foreach (BarItemLink link in group.ItemLinks)
            {
                if (link.Item is BarButtonItem button)
                {
                    buttonsDictionary[button.Name] = button;
                }
            }
        }
    }
}
2. 사용자 설정 (SetCurrentUser)
로그인 상태에 따라 데이터를 로드하거나 초기화합니다.

csharp
코드 복사
public void SetCurrentUser(string userId)
{
    try
    {
        currentUserId = userId;

        if (!string.IsNullOrWhiteSpace(currentUserId))
        {
            Console.WriteLine($"[Info] Logged in as User ID: {currentUserId}");
            LoadFavoritesFromDatabase(); // DB 데이터 로드
        }
        else
        {
            Console.WriteLine("[Info] Logged out. Using local favorites.");
            LoadFavoritesFromFile(); // 로컬 파일 데이터 로드
        }

        InitializeButtons(); // 버튼 UI 갱신
    }
    catch (Exception ex)
    {
        Console.WriteLine($"[Error] SetCurrentUser: {ex.Message}");
    }
}
3. 버튼 상태 반영 (InitializeButtons)
버튼의 상태를 즐겨찾기 데이터에 따라 반영합니다.

csharp
코드 복사
private void InitializeButtons()
{
    foreach (RibbonPage page in ribbonK.Pages)
    {
        foreach (RibbonPageGroup group in page.Groups)
        {
            group.ItemLinks.Clear(); // 기존 버튼 제거
        }
    }

    foreach (var buttonName in favoriteKeys)
    {
        if (buttonsDictionary.TryGetValue(buttonName, out var button))
        {
            ApplyFavoriteStyle(button);
            AddToFavorites(button, GetButtonGroupName(button));
        }
    }
}
폼 로드 함수 실행 흐름
리본 버튼 초기화:

InitializeRibbonButtons를 호출하여 리본의 버튼 목록을 준비.
사용자 설정:

SetCurrentUser를 호출하여 로그인/로그아웃 상태에 따라 즐겨찾기를 로드.
버튼 상태 반영:

InitializeButtons를 호출하여 즐겨찾기 데이터를 리본 UI에 반영.
예제 폼 로드 함수 (Form_Load)
csharp
코드 복사
private void Form_Load(object sender, EventArgs e)
{
    try
    {
        // 리본 버튼 초기화
        InitializeRibbonButtons();

        // 현재 사용자 초기화 (로그인 상태에 따라 로드)
        SetCurrentUser(null); // 기본적으로 로그아웃 상태

        // 버튼 상태 반영
        InitializeButtons();
    }
    catch (Exception ex)
    {
        Console.WriteLine($"[Error] Form_Load: {ex.Message}");
    }
}
예상 결과
폼 로드 시 리본 버튼이 초기화되고, 로컬 또는 DB 데이터에 따라 즐겨찾기가 로드됩니다.
로그아웃 상태에서는 favorites.txt 파일을 기준으로 버튼이 표시됩니다.