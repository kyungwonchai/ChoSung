'// 엑셀의 선택된 영역을 '탭으로 분리된' RAG 형식 텍스트로 변환하여 클립보드에 복사하는 매크로
Sub CopyRAGFormatToClipboard_Tab()

    '// 변수 선언
    Dim dataObj As Object ' 클립보드에 데이터를 넣기 위한 개체
    Dim finalText As String ' 최종적으로 클립보드에 저장될 전체 텍스트
    Dim rowText As String ' 한 행의 텍스트를 임시로 저장할 변수
    Dim selectedRange As Range ' 사용자가 선택한 셀 범위
    Dim rngRow As Range ' 행을 순회하기 위한 범위 변수
    Dim rngCell As Range ' 각 행의 셀을 순회하기 위한 범위 변수
    Dim cellText As String ' 셀의 값을 임시로 저장할 변수

    '// 현재 선택된 셀이 없으면 매크로 종료
    If Not TypeName(Selection) = "Range" Then
        MsgBox "셀을 먼저 선택해주세요.", vbExclamation
        Exit Sub
    End If
    
    Set selectedRange = Selection
    
    '// 클립보드 개체 생성 (Late Binding)
    Set dataObj = CreateObject("new:{1C3B4210-F441-11CE-B9EA-00AA006B1A69}")
    
    '// 선택한 범위의 각 행을 순회
    For Each rngRow In selectedRange.Rows
        rowText = "" ' 각 행을 시작할 때마다 행 텍스트 초기화
        
        '// 현재 행의 각 셀을 순회
        For Each rngCell In rngRow.Cells
            '// 셀 값에서 줄바꿈 문자(vbLf)를 띄어쓰기로 변경
            cellText = Replace(rngCell.Value, vbLf, " ")
            '// 혹시 모를 다른 종류의 줄바꿈(vbCr)도 변경
            cellText = Replace(cellText, vbCr, " ")
            '// 여러 개의 공백이 생겼을 경우 하나로 압축
            Do While InStr(cellText, "  ") > 0
                cellText = Replace(cellText, "  ", " ")
            Loop
            
            '// 첫 번째 열이 아니면 앞에 '탭' 구분자 추가
            If rowText <> "" Then
                rowText = rowText & vbTab ' ★★★ 이 부분이 수정되었습니다 ★★★
            End If
            
            '// 처리된 셀 텍스트를 현재 행 텍스트에 추가
            rowText = rowText & Trim(cellText)
        Next rngCell
        
        '// 첫 번째 행이 아니면 전체 텍스트에 줄바꿈 추가
        If finalText <> "" Then
            finalText = finalText & vbNewLine
        End If
        
        '// 완성된 한 행의 텍스트를 전체 텍스트에 추가
        finalText = finalText & rowText
    Next rngRow
    
    '// 최종 텍스트가 비어있지 않으면 클립보드에 복사
    If finalText <> "" Then
        dataObj.SetText finalText
        dataObj.PutInClipboard
        MsgBox "선택한 " & selectedRange.Rows.Count & "개 행의 데이터가 '탭으로 분리된' 형식으로 클립보드에 복사되었습니다.", vbInformation
    Else
        MsgBox "복사할 데이터가 없습니다.", vbExclamation
    End If

End Sub