해 데이터를 백업 테이블로 이동한 다음, 원본 테이블에서 일정 기간이 지난 레코드를 삭제하는 저장 프로시저를 작성해야 합니다. 백업 테이블은 'ipadd', 'szbarcode', 'filecreatetime'을 유니크 인덱스로 사용합니다. 이를 고려하여 SQL 저장 프로시저를 예로 들어 설명하겠습니다.

SQL 저장 프로시저 설계
중복 확인 - 백업 테이블에 이미 같은 레코드가 있는지 확인합니다.
데이터 이동 - 중복되지 않는 데이터만 백업 테이블로 이동합니다.
데이터 삭제 - 원본 테이블에서 특정 날짜 이전의 데이터를 삭제합니다.
SQL 예제
다음은 SQL Server의 T-SQL을 사용하여 요구 사항을 충족하는 저장 프로시저의 예입니다.

sql
Copy code
USE SMD_Cycletimes;
GO

-- 저장 프로시저 생성
CREATE PROCEDURE MoveAndDeleteOldRecords
AS
BEGIN
    SET NOCOUNT ON;

    -- 백업 테이블에 데이터를 이동
    INSERT INTO dbo.Table_SPI_bkup (ipadd, szbarcode, filecreatetime)
    SELECT ipadd, szbarcode, filecreatetime
    FROM dbo.Table_SPI
    WHERE filecreatetime < DATEADD(MONTH, -3, GETDATE())
    AND NOT EXISTS (
        SELECT 1
        FROM dbo.Table_SPI_bkup
        WHERE dbo.Table_SPI_bkup.ipadd = dbo.Table_SPI.ipadd
        AND dbo.Table_SPI_bkup.szbarcode = dbo.Table_SPI.szbarcode
        AND dbo.Table_SPI_bkup.filecreatetime = dbo.Table_SPI.filecreatetime
    );

    -- 원본 테이블에서 3개월 이전 데이터 삭제
    DELETE FROM dbo.Table_SPI
    WHERE filecreatetime < DATEADD(MONTH, -3, GETDATE());
END;
GO

-- 저장 프로시저 실행
EXEC MoveAndDeleteOldRecords;
이 SQL 스크립트는 다음과 같은 작업을 수행합니다:

DATEADD 함수를 사용하여 현재 날짜에서 3개월 전의 날짜를 계산합니다.
NOT EXISTS 절을 사용하여 백업 테이블에 동일한 레코드가 존재하지 않는 경우에만 원본 테이블에서 레코드를 선택하여 백업 테이블에 삽입합니다.
마지막으로, 원본 테이블에서 3개월 이전의 데이터를 삭제합니다.
이 프로시저를 실행하면 원본 테이블에서 오래된 레코드를 안전하게 삭제하면서 필요한 데