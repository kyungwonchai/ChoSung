ë„¤, Stored Procedureì—ì„œ ì¿¼ë¦¬ ê²°ê³¼ê°€ ì „ë¶€ 0ìœ¼ë¡œ ë‚˜ì˜¤ëŠ” ì´ìœ ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤:

ìµœì‹  ëª¨ë¸ì„ ì°¾ì§€ ëª»í–ˆê±°ë‚˜, í•´ë‹¹ ëª¨ë¸ê³¼ ì¼ì¹˜í•˜ëŠ” ìµœê·¼ 10ê°œì˜ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°

@ë§ˆì§€ë§‰ëª¨ë¸ ê°’ì´ NULLì´ë©´ RecentData CTEê°€ ë¹„ì–´ ìˆì–´ì„œ MIN() ê°’ë“¤ì´ ëª¨ë‘ NULLì´ ë˜ê³ , ISNULLì— ì˜í•´ 0ì´ ë¦¬í„´ë¨.
í”„ë¡œì‹œì €ì—ì„œ SELECTë¥¼ ì œëŒ€ë¡œ ì‹¤í–‰í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°

Stored Procedureì—ì„œ SELECTê°€ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©´ rsì— ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ì§€ ì•ŠìŒ.
âœ… í•´ê²° ë°©ë²•
ğŸ“Œ 1. í”„ë¡œì‹œì € ë‚´ SELECT ê²°ê³¼ í™•ì¸ì„ ìœ„í•œ ë””ë²„ê¹… ì¶”ê°€
sql
ì½”ë“œ ë³µì‚¬
ALTER PROCEDURE Get_Min_RecentData_ByModel
    @ë¼ì¸ëª… NVARCHAR(50)
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @ë§ˆì§€ë§‰ëª¨ë¸ NVARCHAR(255);
    DECLARE @ìµœì‹ ì‹œê°„ DATETIME;

    -- ê°€ì¥ ìµœê·¼ ëª¨ë¸ê³¼ time1 ê°’ ê°€ì ¸ì˜¤ê¸° (ë””ë²„ê¹… ì¶”ê°€)
    SELECT TOP 1 
        @ë§ˆì§€ë§‰ëª¨ë¸ = ëª¨ë¸,
        @ìµœì‹ ì‹œê°„ = time1
    FROM dbo.ExcelData
    WHERE ë¼ì¸ = @ë¼ì¸ëª…
    ORDER BY time1 DESC;

    -- ìµœì‹  ëª¨ë¸ ë””ë²„ê¹…ìš© ì¶œë ¥ (ì´ ê°’ì„ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”)
    PRINT 'ìµœì‹  ëª¨ë¸: ' + ISNULL(@ë§ˆì§€ë§‰ëª¨ë¸, 'NULL');
    PRINT 'ìµœì‹  ì‹œê°„: ' + ISNULL(CAST(@ìµœì‹ ì‹œê°„ AS NVARCHAR), 'NULL');

    -- ìµœì‹  ëª¨ë¸ì´ NULLì´ë©´ ì•„ë¬´ê²ƒë„ ì¡°íšŒë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì—ëŸ¬ ë°©ì§€
    IF @ë§ˆì§€ë§‰ëª¨ë¸ IS NULL
    BEGIN
        PRINT 'ERROR: í•´ë‹¹ ë¼ì¸ì˜ ìµœì‹  ëª¨ë¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ.';
        RETURN;
    END

    WITH RecentData AS (
        SELECT TOP 10 *
        FROM dbo.ExcelData
        WHERE ë¼ì¸ = @ë¼ì¸ëª… AND ëª¨ë¸ = @ë§ˆì§€ë§‰ëª¨ë¸
        ORDER BY time1 DESC
    )
    -- ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
    SELECT * FROM RecentData;  -- ğŸŸ¢ SQL ì‹¤í–‰ í›„ ê²°ê³¼ í™•ì¸ (ë””ë²„ê¹…ìš©)

    -- ìµœì¢… ê²°ê³¼ ë°˜í™˜
    SELECT 
        @ë¼ì¸ëª… AS ë¼ì¸,
        @ë§ˆì§€ë§‰ëª¨ë¸ AS ëª¨ë¸,
        @ìµœì‹ ì‹œê°„ AS ìµœì‹ ì‹œê°„,

        ISNULL(MIN(CASE WHEN BCT1_1 >= 1 THEN BCT1_1 ELSE NULL END), 0) AS BCT1_1,
        ISNULL(MIN(CASE WHEN BCT1_2 >= 1 THEN BCT1_2 ELSE NULL END), 0) AS BCT1_2,
        ISNULL(MIN(CASE WHEN BCT1_3 >= 1 THEN BCT1_3 ELSE NULL END), 0) AS BCT1_3,
        ISNULL(MIN(CASE WHEN BCT1_4 >= 1 THEN BCT1_4 ELSE NULL END), 0) AS BCT1_4,
        ISNULL(MIN(CASE WHEN BCT1_5 >= 1 THEN BCT1_5 ELSE NULL END), 0) AS BCT1_5,
        ISNULL(MIN(CASE WHEN BCT1_6 >= 1 THEN BCT1_6 ELSE NULL END), 0) AS BCT1_6,
        ISNULL(MIN(CASE WHEN BCT1_7 >= 1 THEN BCT1_7 ELSE NULL END), 0) AS BCT1_7,
        ISNULL(MIN(CASE WHEN BCT1_8 >= 1 THEN BCT1_8 ELSE NULL END), 0) AS BCT1_8
    FROM RecentData;
END;
ğŸ”¹ ì¶”ê°€ëœ ë””ë²„ê¹… ì½”ë“œ
PRINT ë¬¸ì„ ì¶”ê°€í•˜ì—¬ ìµœì‹  ëª¨ë¸ê³¼ ìµœì‹  ì‹œê°„ ê°’ì´ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒë˜ëŠ”ì§€ í™•ì¸
SELECT * FROM RecentData; ì‹¤í–‰í•˜ì—¬ RecentDataê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
âœ… 2. VBAì—ì„œ Recordset ë°›ì•„ì„œ ë©”ì‹œì§€ ë°•ìŠ¤ë¡œ ì¶œë ¥
ğŸ“Œ VBAì—ì„œ Stored Procedure ê²°ê³¼ë¥¼ ë©”ì‹œì§€ ë°•ìŠ¤ë¡œ í™•ì¸í•˜ëŠ” ì½”ë“œ
vba
ì½”ë“œ ë³µì‚¬
Sub ExecuteStoredProcedure(LineName As String)
    Dim conn As Object
    Dim rs As Object
    Dim sqlQuery As String
    Dim dbPath As String
    Dim result As String

    ' MSSQL ì—°ê²° ì„¤ì •
    dbPath = "Provider=SQLOLEDB;Data Source=ì„œë²„ì´ë¦„;Initial Catalog=DBì´ë¦„;User ID=ì‚¬ìš©ìì´ë¦„;Password=ë¹„ë°€ë²ˆí˜¸;"
    Set conn = CreateObject("ADODB.Connection")
    conn.Open dbPath

    ' í”„ë¡œì‹œì € ì‹¤í–‰ ì¿¼ë¦¬
    sqlQuery = "EXEC Get_Min_RecentData_ByModel '" & LineName & "'"

    ' Recordset ì—´ê¸°
    Set rs = conn.Execute(sqlQuery)

    ' ê²°ê³¼ ì¶œë ¥ (ë©”ì‹œì§€ ë°•ìŠ¤)
    If Not rs.EOF Then
        result = "ë¼ì¸: " & rs.Fields("ë¼ì¸").Value & vbCrLf
        result = result & "ëª¨ë¸: " & rs.Fields("ëª¨ë¸").Value & vbCrLf
        result = result & "ìµœì‹ ì‹œê°„: " & rs.Fields("ìµœì‹ ì‹œê°„").Value & vbCrLf

        Dim i As Integer
        For i = 3 To rs.Fields.Count - 1  ' BCT, TCT ë°ì´í„° ì¶œë ¥
            result = result & rs.Fields(i).Name & ": " & rs.Fields(i).Value & vbCrLf
        Next i

        MsgBox result, vbInformation, "Stored Procedure ê²°ê³¼"
    Else
        MsgBox "ë°ì´í„° ì—†ìŒ (ë¼ì¸: " & LineName & ")", vbCritical, "ì—ëŸ¬"
    End If

    ' ì¢…ë£Œ
    rs.Close
    conn.Close
    Set rs = Nothing
    Set conn = Nothing
End Sub
âœ… 3. ì‹¤í–‰ ë°©ë²•
ğŸ“Œ Immediate ì°½ (Ctrl + G)ì—ì„œ ì‹¤í–‰
vba
ì½”ë“œ ë³µì‚¬
ExecuteStoredProcedure "L1"
ë©”ì‹œì§€ ë°•ìŠ¤ë¡œ ê²°ê³¼ ì¶œë ¥
ë¼ì¸, ëª¨ë¸, ìµœì‹  ì‹œê°„, ìµœì†Œê°’(BCT, TCT ë“±) í™•ì¸ ê°€ëŠ¥
âœ… 4. ê²°ê³¼ ì˜ˆì‹œ
ğŸ“Œ VBA MsgBox ì¶œë ¥ ì˜ˆì‹œ
makefile
ì½”ë“œ ë³µì‚¬
ë¼ì¸: L1
ëª¨ë¸: A100
ìµœì‹ ì‹œê°„: 2025-03-18 14:10
BCT1_1: 9
BCT1_2: 4
BCT1_3: 6
...