이 문제를 해결하기 위해, 스캐너 포트에서 데이터를 읽어오고, 이를 다른 포트로 전달하며 로그에 기록하는 기능을 추가하겠습니다. 이 기능을 구현하기 위해 다음 단계를 수행합니다:

스캐너 포트에서 데이터 읽기: 스캐너 포트에서 데이터를 읽어와야 합니다. 이를 위해 SerialPort.DataReceived 이벤트를 사용합니다.
다른 포트로 데이터 전송: 스캐너 포트에서 읽은 데이터를 미리 설정한 타겟 포트들로 전송합니다.
로그 기록: 이 모든 작업이 수행될 때마다 로그에 기록합니다.
1. MainWindow.xaml.cs 수정
스캐너 포트에서 데이터를 읽어 타겟 포트로 전송하는 코드를 추가합니다.

csharp
코드 복사
using System;
using System.IO.Ports;
using System.Net;
using System.Windows;
using System.Windows.Controls;
using ZXing;

namespace ScanValueTrans
{
    public partial class MainWindow : Window
    {
        private SocketServer socketServer; // 소켓 서버 인스턴스
        private SettingsManager settingsManager;
        private SerialPortManager serialPortManager;

        public MainWindow()
        {
            InitializeComponent();
            Initialize();
        }

        private void Initialize()
        {
            try
            {
                // 설정 관리 클래스 초기화
                settingsManager = SettingsManager.Instance;

                // 소켓 서버 초기화
                socketServer = SocketServer.Instance;
                if (socketServer == null)
                {
                    throw new InvalidOperationException("소켓 서버 인스턴스를 초기화할 수 없습니다.");
                }
                socketServer.DataReceived += OnSocketDataReceived;

                // 시리얼 포트 매니저 초기화
                serialPortManager = new SerialPortManager();
                if (serialPortManager == null)
                {
                    throw new InvalidOperationException("시리얼 포트 매니저를 초기화할 수 없습니다.");
                }

                // IP 주소 가져오기 및 표시
                string ipAddress = GetLocalIPAddress();
                IpAddressTextBlock.Text = $"IP Address: {ipAddress}";

                // 포트 선택 콤보박스 초기화
                for (int i = 20000; i <= 65000; i++)
                {
                    PortComboBox.Items.Add(i.ToString());
                }

                // 포트 및 설정 불러오기
                PortComboBox.SelectedItem = settingsManager.GetSetting("Port");
                PortComboBox.SelectionChanged += PortComboBox_SelectionChanged;

                // 스캐너 및 타겟 포트 설정 초기화
                InitializePortSettings();
                LoadLastUsedPorts();

                // QR 코드 생성
                GenerateQRCode(ipAddress, PortComboBox.SelectedItem?.ToString() ?? string.Empty);

                // 포트 목록 갱신
                RefreshPorts();
            }
            catch (Exception ex)
            {
                LogMessage($"프로그램 초기화 실패: {ex.Message}");
            }
        }

        private void PortComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            try
            {
                string selectedPort = PortComboBox.SelectedItem?.ToString() ?? "20000";

                if (int.TryParse(selectedPort, out int portNumber))
                {
                    if (socketServer != null)
                    {
                        socketServer.Start(portNumber); // 포트 번호 변경 시 소켓 서버 재시작
                        settingsManager.SaveSetting("Port", selectedPort);
                    }
                    else
                    {
                        LogMessage("소켓 서버 인스턴스가 초기화되지 않았습니다.");
                    }
                }
                else
                {
                    LogMessage($"포트 번호가 유효하지 않습니다: {selectedPort}");
                }

                string ipAddress = GetLocalIPAddress();
                GenerateQRCode(ipAddress, selectedPort);
            }
            catch (Exception ex)
            {
                LogMessage($"포트 설정 중 오류 발생: {ex.Message}");
            }
        }

        private void OpenScannerPort(string portName, string baudRate, string parity, string dataBits, string stopBits)
        {
            try
            {
                if (serialPortManager == null)
                {
                    throw new InvalidOperationException("시리얼 포트 매니저가 초기화되지 않았습니다.");
                }

                if (serialPortManager.ScannerPort != null && serialPortManager.ScannerPort.IsOpen)
                {
                    serialPortManager.CloseScannerPort();
                }

                serialPortManager.OpenScannerPort(portName, int.Parse(baudRate), 
                    (Parity)Enum.Parse(typeof(Parity), parity), 
                    int.Parse(dataBits), 
                    (StopBits)Enum.Parse(typeof(StopBits), stopBits));

                // 스캐너 포트의 DataReceived 이벤트 핸들러 설정
                serialPortManager.ScannerPort.DataReceived += ScannerPort_DataReceived;

                LogMessage($"스캐너 포트 {portName}가 열렸습니다.");
            }
            catch (UnauthorizedAccessException ex)
            {
                LogMessage($"스캐너 포트 {portName} 접근 권한이 없습니다: {ex.Message}");
            }
            catch (IOException ex)
            {
                LogMessage($"스캐너 포트 {portName}에서 I/O 오류 발생: {ex.Message}");
            }
            catch (ArgumentException ex)
            {
                LogMessage($"스캐너 포트 설정이 잘못되었습니다: {ex.Message}");
            }
            catch (Exception ex)
            {
                LogMessage($"스캐너 포트 {portName}를 여는 데 실패했습니다: {ex.Message}");
            }
        }

        private void ScannerPort_DataReceived(object sender, SerialDataReceivedEventArgs e)
        {
            try
            {
                if (serialPortManager.ScannerPort != null && serialPortManager.ScannerPort.IsOpen)
                {
                    string data = serialPortManager.ScannerPort.ReadExisting();

                    // 타겟 포트로 데이터 전송
                    foreach (var targetPort in serialPortManager.TargetPorts)
                    {
                        if (targetPort != null && targetPort.IsOpen)
                        {
                            targetPort.Write(data);
                            LogMessage($"스캐너에서 받은 데이터를 타겟 포트로 전송: {data}");
                        }
                    }

                    // 로그에 데이터 기록
                    Dispatcher.Invoke(() => LogMessage($"스캐너 포트에서 받은 데이터: {data}"));
                }
            }
            catch (Exception ex)
            {
                Dispatcher.Invoke(() => LogMessage($"스캐너 포트 데이터 수신 중 오류 발생: {ex.Message}"));
            }
        }

        private void ScannerPortComboBox_SelectionChanged(object sender, SelectionChangedEventArgs e)
        {
            try
            {
                if (ScannerPortComboBox.SelectedItem != null)
                {
                    string selectedPort = ScannerPortComboBox.SelectedItem.ToString();
                    string baudRate = ScannerBaudRateComboBox.SelectedItem?.ToString() ?? "9600";
                    string parity = ScannerParityComboBox.SelectedItem?.ToString() ?? "None";
                    string dataBits = ScannerDataBitsComboBox.SelectedItem?.ToString() ?? "8";
                    string stopBits = ScannerStopBitsComboBox.SelectedItem?.ToString() ?? "One";

                    OpenScannerPort(selectedPort, baudRate, parity, dataBits, stopBits);

                    // 설정 저장
                    settingsManager.SaveSetting("LastUsedScannerPort", selectedPort);
                    settingsManager.SaveSetting("ScannerBaudRate", baudRate);
                    settingsManager.SaveSetting("ScannerParity", parity);
                    settingsManager.SaveSetting("ScannerDataBits", dataBits);
                    settingsManager.SaveSetting("ScannerStopBits", stopBits);
                }
            }
            catch (Exception ex)
            {
                LogMessage($"스캐너 포트 설정 중 오류 발생: {ex.Message}");
            }
        }

        private void ClearScannerPortSelection_Click(object sender, RoutedEventArgs e)
        {
            try
            {
                ComboBox comboBox = (ComboBox)((Button)sender).Tag;
                comboBox.SelectedItem = null;
                serialPortManager.CloseScannerPort();
            }
            catch (Exception ex)
            {
                LogMessage($"스캐너 포트 선택 해제 중 오류 발생: {ex.Message}");
            }
        }

        private void OnSocketDataReceived(object sender, SocketDataReceivedEventArgs e)
        {
            try
            {
                Dispatcher.Invoke(() => serialPortManager.SendData(e.Data));
                LogMessage($"Received and forwarded: {e.Data}");
            }
            catch (Exception ex)
            {
                LogMessage($"소켓 데이터 처리 중 오류 발생: {ex.Message}");
            }
        }

        private void LogMessage(string message)
        {
            Dispatcher.Invoke(() =>
            {
                string timestamp = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
                LogListBox.Items.Add($"{timestamp} - {message}");

                if (LogListBox.Items.Count > 100)
                {
                    LogListBox.Items.RemoveAt(0);
                }
            });
        }

        private void RefreshPorts_Click(object sender, RoutedEventArgs e)
        {
            RefreshPorts();
        }

        private void RefreshPorts()
        {
            try
            {
                string[] portNames = SerialPort.GetPortNames();

                ScannerPortComboBox.ItemsSource = portNames;

                for (int i = 0; i < 5; i++)
                {
                    var portControl = FindName($"TargetPortConfig{i + 1}") as PortConfigControl;
                    if (portControl != null)
                    {
                        portControl.RefreshPortList(portNames);
                    }
                }

                LogMessage("COM 포트 목록이 갱신되었습니다.");
            }
            catch (Exception ex)
            {
                LogMessage($"포트 목록 갱신 중 오류 발생: {ex.Message}");
            }
        }
    }
}
2. SerialPortManager.cs
이 클래스에서 스캐너 포트 및 타겟 포트들의 관리와 데이터 전송을 처리합니다.

csharp
코드 복사
using System;
using System.IO.Ports;
using System.Collections.Generic;

namespace ScanValueTrans
{
    public class SerialPortManager
    {
        public SerialPort ScannerPort { get; private set; }
        public List<SerialPort> TargetPorts { get; private set; }

        public SerialPortManager()
        {
            TargetPorts = new List<SerialPort>();
        }

        public void OpenScannerPort(string portName, int baudRate, Parity parity, int dataBits, StopBits stopBits)
        {
            try
            {
                ScannerPort = new SerialPort(portName, baudRate, parity, dataBits, stopBits);
                ScannerPort.Open();
            }
            catch (Exception ex)
            {
                throw new InvalidOperationException($"스캐너 포트 {portName}를 여는 데 실패했습니다: {ex.Message}");
            }
        }

        public void CloseScannerPort()
        {
            try
            {
                if (ScannerPort != null && ScannerPort.IsOpen)
                {
                    ScannerPort.Close();
                }
            }
            catch (Exception ex)
            {
                throw new InvalidOperationException($"스캐너 포트 닫는 중 오류 발생: {ex.Message}");
            }
        }

        public void AddTargetPort(string portName, int baudRate, Parity parity, int dataBits, StopBits stopBits)
        {
            try
            {
                SerialPort targetPort = new SerialPort(portName, baudRate, parity, dataBits, stopBits);
                targetPort.Open();
                TargetPorts.Add(targetPort);
            }
            catch (Exception ex)
            {
                throw new InvalidOperationException($"타겟 포트 {portName}를 여는 데 실패했습니다: {ex.Message}");
            }
        }

        public void CloseTargetPorts()
        {
            foreach (var port in TargetPorts)
            {
                try
                {
                    if (port != null && port.IsOpen)
                    {
                        port.Close();
                    }
                }
                catch (Exception ex)
                {
                    throw new InvalidOperationException($"타겟 포트 닫는 중 오류 발생: {ex.Message}");
                }
            }
        }

        public void SendData(string data)
        {
            foreach (var port in TargetPorts)
            {
                if (port != null && port.IsOpen)
                {
                    try
                    {
                        port.WriteLine(data);
                    }
                    catch (Exception ex)
                    {
                        throw new InvalidOperationException($"타겟 포트로 데이터 전송 중 오류 발생: {ex.Message}");
                    }
                }
            }
        }
    }
}
주요 기능 요약:
스캐너 포트에서 데이터 읽기: ScannerPort_DataReceived 이벤트 핸들러를 통해 스캐너 포트에서 데이터를 읽어옵니다.

타겟 포트로 데이터 전송: 읽어온 데이터를 SerialPortManager에 정의된 TargetPorts 리스트에 있는 모든 포트로 전송합니다.

로그 기록: 데이터를 수신하거나 전송할 때마다 로그에 해당 내용이 기록됩니다.

이제 이 코드로 인해 스캐너 포트에서 데이터를 읽어오고, 이를 타겟 포트로 전송하며, 로그도 남기는 작업이 제대로 이루어질 것입니다. 추가적인 문제가 발생하거나 다른 질문이 있으시면 언제든지 말씀해 주세요.