using System;
using System.Drawing;
using System.IO;
using System.Runtime.InteropServices;
using System.Windows.Forms;
using PowerPoint = Microsoft.Office.Interop.PowerPoint;

namespace PowerPointToImage
{
    class Program
    {
        static void Main(string[] args)
        {
            string pptxFilePath = "your_pptx_file_path.pptx";
            
            // PowerPoint application 생성
            PowerPoint.Application pptApp = new PowerPoint.Application();
            PowerPoint.Presentation presentation = null;

            try
            {
                // PPTX 파일 열기
                presentation = pptApp.Presentations.Open(pptxFilePath, MsoTriState.msoFalse, MsoTriState.msoFalse, MsoTriState.msoFalse);

                // 이미지 크기 설정 (예: 페이지 폭 800픽셀, 높이는 비율에 맞게 조정됨)
                int imageWidth = 800;
                int imageHeight = (int)(imageWidth * presentation.PageSetup.SlideHeight / presentation.PageSetup.SlideWidth);

                // 결과 이미지 생성
                Bitmap resultImage = new Bitmap(imageWidth, imageHeight * presentation.Slides.Count);
                Graphics resultGraphics = Graphics.FromImage(resultImage);
                resultGraphics.Clear(Color.White);

                // 각 페이지를 이미지로 그리고 결과 이미지에 추가
                int yOffset = 0;
                foreach (PowerPoint.Slide slide in presentation.Slides)
                {
                    slide.Export(Path.GetTempPath() + Guid.NewGuid().ToString() + ".png", "PNG", imageWidth, imageHeight);
                    using (Image slideImage = Image.FromFile(Path.GetTempPath() + "your_temp_image_path.png"))
                    {
                        resultGraphics.DrawImage(slideImage, new Rectangle(0, yOffset, imageWidth, imageHeight));
                    }
                    yOffset += imageHeight;
                }

                // 결과 이미지를 클립보드에 복사
                Clipboard.SetImage(resultImage);

                // 결과 이미지를 파일로 저장할 경우
                //resultImage.Save("result_image.png");
            }
            finally
            {
                // 사용이 끝난 리소스 정리
                if (presentation != null)
                {
                    presentation.Close();
                    Marshal.ReleaseComObject(presentation);
                }
                if (pptApp != null)
                {
                    pptApp.Quit();
                    Marshal.ReleaseComObject(pptApp);
                }
            }
        }
    }
}
