변수가 올바르게 할당되지 않은 부분을 수정하겠습니다. currentValue는 3행의 값을 저장하고, 이 값이 500 이하인 경우에만 나머지 행에 대한 처리를 진행해야 합니다. 코드를 다음과 같이 수정하겠습니다:

csharp
Copy code
using System;
using Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Application excelApp = (Application)System.Runtime.InteropServices.Marshal.GetActiveObject("Excel.Application");
        Workbook workbook = null;

        foreach (Workbook wb in excelApp.Workbooks)
        {
            if (wb.Name.Contains("SMD_검사기"))
            {
                workbook = wb;
                break;
            }
        }

        if (workbook != null)
        {
            Worksheet worksheet = workbook.Worksheets["Data"];
            Range usedRange = worksheet.UsedRange;
            int startColumn = worksheet.Columns["BQ"].Column;
            int totalRows = usedRange.Rows.Count;
            int totalColumns = usedRange.Columns.Count;

            for (int col = startColumn; col <= totalColumns; col++)
            {
                var thirdRowValue = worksheet.Cells[3, col].Value;
                if (thirdRowValue != null && double.TryParse(thirdRowValue.ToString(), out double currentValue) && currentValue <= 500)
                {
                    for (int row = 4; row <= totalRows; row++) // Start from row 4 since row 3 is already checked
                    {
                        if (worksheet.Cells[row, col].Interior.ColorIndex == 2) // ColorIndex 2 is usually white
                        {
                            var cellValue = worksheet.Cells[row, col].Value;
                            if (cellValue != null && double.TryParse(cellValue.ToString(), out double cellNumericValue))
                            {
                                double sumValue = cellNumericValue;
                                if (col < totalColumns)
                                {
                                    var nextCell = worksheet.Cells[row, col + 1];
                                    if (nextCell.Value == null)
                                    {
                                        if (col > 1 && worksheet.Cells[row, col - 1].Value != null)
                                        {
                                            sumValue += Convert.ToDouble(worksheet.Cells[row, col - 1].Value);
                                        }
                                    }
                                    else
                                    {
                                        sumValue += Convert.ToDouble(nextCell.Value);
                                    }
                                }
                                worksheet.Cells[row, col].Value = sumValue;
                            }
                        }
                    }
                }
            }
        }
        else
        {
            Console.WriteLine("해당하는 이름의 엑셀 파일이 열려있지 않습니다.");
        }
    }
}
이 코드는 3행의 값이 500 이하인 경우에만 나머지 행들에 대해 처리를 진행합니다. 3행의 값이 500 이하가 아니라면, 해당 열에 대한 처리는 건너뛰고 다