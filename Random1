import pandas as pd

def create_component_chunks(file_path: str, selected_columns: list, text_template: str) -> list:
    """
    CSV ë˜ëŠ” Excel íŒŒì¼ì—ì„œ ì§€ì •ëœ ì»¬ëŸ¼ì„ ì½ì–´,
    ì •í•´ì§„ í…œí”Œë¦¿ì— ë”°ë¼ í…ìŠ¤íŠ¸ ì²­í¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

    :param file_path: ë¶€í’ˆ ë°ì´í„° íŒŒì¼ ê²½ë¡œ (CSV ë˜ëŠ” Excel)
    :param selected_columns: ì‚¬ìš©í•  ì»¬ëŸ¼ ì´ë¦„ ë¦¬ìŠ¤íŠ¸
    :param text_template: í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•  ë¬¸ì¥ í…œí”Œë¦¿
    :return: ì „ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ ì²­í¬ ë¦¬ìŠ¤íŠ¸
    """
    try:
        # íŒŒì¼ í™•ì¥ìì— ë”°ë¼ ë‹¤ë¥´ê²Œ íŒŒì¼ì„ ì½ì–´ì˜´
        if file_path.endswith('.csv'):
            df = pd.read_csv(file_path, dtype=str)
        elif file_path.endswith('.xlsx'):
            df = pd.read_excel(file_path, dtype=str)
        else:
            print("âŒ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. (CSV ë˜ëŠ” XLSX íŒŒì¼ì„ ì‚¬ìš©í•˜ì„¸ìš”)")
            return []
    except FileNotFoundError:
        print(f"âŒ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {file_path}")
        return []

    # ë¹ˆ ê°’(NaN)ì„ ê³µë°± ë¬¸ìì—´('')ë¡œ ë³€í™˜
    df = df[selected_columns].fillna('')

    # í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ê° í–‰ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
    # f-stringì˜ format(**row)ë¥¼ ì‚¬ìš©í•˜ì—¬ í…œí”Œë¦¿ì˜ {ì»¬ëŸ¼ëª…} ë¶€ë¶„ì— ê°’ì„ ì±„ì›€
    processed_texts = [text_template.format(**row) for _, row in df.iterrows()]

    return processed_texts

# --- ğŸš€ ì„¤ì • ë¶€ë¶„ (ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤) ---

# 1. ë¶€í’ˆ ë°ì´í„° íŒŒì¼ ê²½ë¡œë¥¼ ì§€ì •í•˜ì„¸ìš”.
smd_file_path = 'smd_parts_library.csv'  # ì˜ˆì‹œ: 'C:/data/my_parts.xlsx'

# 2. ì‚¬ìš©í•  ì»¬ëŸ¼ ì´ë¦„ì„ ë¦¬ìŠ¤íŠ¸ë¡œ ì •í™•í•˜ê²Œ ì…ë ¥í•˜ì„¸ìš”.
#    (CSV íŒŒì¼ì˜ í—¤ë”(ì²« ì¤„)ì— ìˆëŠ” ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤.)
target_columns = [
    'PartNumber',
    'Type',
    'Package',
    'Value',
    'Tolerance',
    'Manufacturer'
]

# 3. ìµœì¢…ì ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ì€ ë¬¸ì¥ í˜•ì‹ì„ í…œí”Œë¦¿ìœ¼ë¡œ ë§Œë“œì„¸ìš”.
#    ì»¬ëŸ¼ ì´ë¦„ ì–‘ìª½ì— ì¤‘ê´„í˜¸ {} ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
#    "ì†ì„±: {ì»¬ëŸ¼ëª…}" í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ ë‚˜ì¤‘ì— ê²€ìƒ‰ ì„±ëŠ¥ì´ ì¢‹ìŠµë‹ˆë‹¤.
component_template = (
    "ë¶€í’ˆ ì¢…ë¥˜: {Type}, ë¶€í’ˆ ë²ˆí˜¸: {PartNumber}, íŒ¨í‚¤ì§€: {Package}, "
    "ì£¼ìš” ê°’: {Value}, í—ˆìš© ì˜¤ì°¨: {Tolerance}, ì œì¡°ì‚¬: {Manufacturer}"
)
# --- ì„¤ì • ë ---


if __name__ == '__main__':
    # í•¨ìˆ˜ ì‹¤í–‰
    component_chunks = create_component_chunks(
        file_path=smd_file_path,
        selected_columns=target_columns,
        text_template=component_template
    )

    # ê²°ê³¼ í™•ì¸
    if component_chunks:
        print(f"âœ… ì´ {len(component_chunks)}ê°œì˜ ë¶€í’ˆ ë°ì´í„°ê°€ í…ìŠ¤íŠ¸ ì²­í¬ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.")
        print("\n--- ë³€í™˜ ê²°ê³¼ ìƒ˜í”Œ (ì²« 3ê°œ) ---")