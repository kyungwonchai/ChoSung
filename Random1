from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_score
import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd
import numpy as np

# df['CT'] 컬럼을 기반으로 KMeans 군집화 수행
X = df[['CT']]  # 군집화에 사용할 데이터 준비
kmeans = KMeans(n_clusters=3, random_state=42)  # KMeans 객체 생성, n_clusters는 필요에 따라 조정
kmeans.fit(X)  # 군집화 수행

# 군집화 결과를 원본 DataFrame에 할당
df['Cluster'] = kmeans.labels_

# 군집화 결과 시각화
plt.figure(figsize=(10, 6))
sns.scatterplot(x=df.index, y='CT', hue='Cluster', data=df, palette='viridis', s=100, alpha=0.7)
plt.title('Clustering Visualization based on CT')
plt.xlabel('Index')
plt.ylabel('CT Value')
plt.legend(title='Cluster')
plt.show()

# 불균형 계수(실루엣 계수) 출력
silhouette_avg = silhouette_score(X, kmeans.labels_)
print(f'Silhouette Score: {silhouette_avg:.4f}')
