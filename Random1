전체 경로에 해당 패턴이 포함되어 있는지 확인하려면, 정규식을 파일 경로 전체에 대해 검사하도록 해야 합니다. 아래는 이를 반영한 업데이트된 코드입니다.

csharp
코드 복사
using System;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Timers;
using System.Windows;

namespace FolderCheckApp
{
    public partial class MainWindow : Window
    {
        private Timer timer;
        private readonly string[] folderPaths = {
            @"C:\Folder1",
            @"C:\Folder2",
            @"D:\Folder3",
            @"E:\Folder4",
            @"F:\Folder5"
        };
        private readonly Regex filePathPattern = new Regex(@".*(B?SM-.+_.+_.+_.+)\.jpg$", RegexOptions.IgnoreCase);

        public MainWindow()
        {
            InitializeComponent();
            InitializeTimer();
        }

        private void InitializeTimer()
        {
            timer = new Timer(3600000); // 1 hour interval in milliseconds
            timer.Elapsed += OnTimerElapsed;
            timer.AutoReset = true;
            timer.Start();
        }

        private void OnTimerElapsed(object sender, ElapsedEventArgs e)
        {
            foreach (var folderPath in folderPaths)
            {
                if (Directory.Exists(folderPath))
                {
                    var jpgFiles = Directory.GetFiles(folderPath, "*.jpg", SearchOption.AllDirectories)
                                            .Where(file => filePathPattern.IsMatch(file));
                    if (jpgFiles.Count() >= 20)
                    {
                        var recentFiles = jpgFiles.Where(file => File.GetCreationTime(file) > DateTime.Now.AddHours(-1));
                        if (recentFiles.Any())
                        {
                            // Folder is selected
                            Dispatcher.Invoke(() => PerformNextAction(folderPath));
                            return;
                        }
                    }
                }
            }
        }

        private void PerformNextAction(string selectedFolderPath)
        {
            // Implement the next action to be performed on the selected folder
            MessageBox.Show($"Selected Folder: {selectedFolderPath}");
        }
    }
}
이 코드에서는 filePathPattern 정규식을 사용하여 파일 경로 전체가 패턴과 일치하는지 확인합니다. 경로에 "BSM-" 또는 "SM-"으로 시작하고 밑줄로 구분된 네 개의 부분이 있는 파일 이름을 가진 JPG 파일이 포함되어 있는지 검사합니다. 조건에 맞는 파일이 20개 이상이고, 최근 1시간 이내에 생성된 파일이 있는 경우 해당 폴더를 선택합니다.

이렇게 하면 파일 전체 경로에 주어진 패턴이 포함된 경우를 필터링할 수 