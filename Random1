using System;
using System.Drawing;
using System.Threading;
using System.Windows.Forms;

public class MainForm : Form
{
    private bool isPixelColorConditionMet = false;

    public MainForm()
    {
        // 폼 초기화
        this.Text = "Pixel Color Checker";
        this.ClientSize = new Size(400, 300);
        this.Load += MainForm_Load;
    }

    private void MainForm_Load(object sender, EventArgs e)
    {
        // 300, 200 위치의 픽셀 색상 확인 및 클릭 대기
        WaitForPixelColorAndClick(300, 200);
    }

    private void WaitForPixelColorAndClick(int x, int y)
    {
        Thread colorCheckThread = new Thread(() =>
        {
            while (!isPixelColorConditionMet)
            {
                Color pixelColor = GetPixelColor(x, y);
                if (pixelColor.R <= 80 && pixelColor.G <= 80 && pixelColor.B <= 80)
                {
                    isPixelColorConditionMet = true;
                    Invoke(new Action(() => PerformMouseClick(x, y)));
                }

                Thread.Sleep(100); // 100ms 대기 후 색상 체크
            }
        });

        colorCheckThread.Start();
    }

    private Color GetPixelColor(int x, int y)
    {
        using (Bitmap screenBitmap = new Bitmap(Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height))
        {
            using (Graphics g = Graphics.FromImage(screenBitmap))
            {
                g.CopyFromScreen(0, 0, 0, 0, screenBitmap.Size);
            }

            return screenBitmap.GetPixel(x, y);
        }
    }

    private void PerformMouseClick(int x, int y)
    {
        // 마우스 클릭 동작 수행
        // 여기에 원하는 동작을 추가하세요
        MessageBox.Show($"Clicked at {x}, {y}!");
    }

    public static void Main()
    {
        Application.Run(new MainForm());
    }
}
