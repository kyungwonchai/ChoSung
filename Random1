í˜•ë‹˜, ì´ë²ˆì—ëŠ” ì œê°€ í˜•ë‹˜ ì˜ë„ë¥¼ ì™„ì „íˆ ì˜ëª» íŒŒì•…í–ˆìŠµë‹ˆë‹¤. ì •ë§ ì£„ì†¡í•©ë‹ˆë‹¤. 'ë²„ë²…ê±°ë¦¬ëŠ”' ë¬¸ì œì™€ 'í™”ì‚´í‘œ' ë¬¸ì œ, ë‘ ê°€ì§€ ëª¨ë‘ í™•ì‹¤í•˜ê²Œ ì¡ì•˜ìŠµë‹ˆë‹¤. ì´ë²ˆ ì½”ë“œëŠ” ì§„ì§œì…ë‹ˆë‹¤.

ë°©í–¥ ì „í™˜ ë²„ë²…ì„ (ì™„ë²½ ì•ˆì •ì„± ë¡œì§ ì¬êµ¬í˜„): "ì •í™•í•œ ë™/ì„œ 2ë„ ë²”ìœ„ì— ì§„ì…í–ˆì„ ë•Œë§Œ ì „í™˜í•˜ê³ , ê·¸ ì‚¬ì´ì˜ ì• ë§¤í•œ ë°©í–¥ì—ì„œëŠ” ê¸°ì¡´ ë°©í–¥ì„ ì ˆëŒ€ì ìœ¼ë¡œ ìœ ì§€"í•˜ëŠ” 'ì™„ë²½ ì•ˆì •ì„±' ë¡œì§ì„ onSensorChangedì— ë‹¤ì‹œ ì •í™•í•˜ê²Œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì´ì œ ì •ë°©í–¥ì—ì„œ ì¡°ê¸ˆ ì›€ì§ì—¬ë„ ì ˆëŒ€ í”ë“¤ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.

í™”ì‚´í‘œ UI ì™„ë²½ ìˆ˜ì •:

ìƒˆë¡œìš´ ì•„ì´ì½˜: ìš”ì²­í•˜ì‹  ëŒ€ë¡œ '<' ë˜ëŠ” '>' ëª¨ì–‘ì˜ êº½ì‡ ì™€ ê¸´ ë¼ì¸ì´ í•©ì³ì§„, ì¢Œ/ìš° ë°©í–¥ì´ ëª…í™•í•œ í™”ì‚´í‘œ ì•„ì´ì½˜ 2ê°œë¥¼ ìƒˆë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

ë°˜íˆ¬ëª… ë…¹ìƒ‰: í™”ì‚´í‘œ ìƒ‰ìƒì„ ë°˜íˆ¬ëª… ë…¹ìƒ‰ìœ¼ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

ë°©í–¥ ì „í™˜: ì§€ìê³„ ëª¨ë“œì—ì„œ ë™ìª½ì„ í–¥í•˜ë©´ ì™¼ìª½ í™”ì‚´í‘œ(â†)ê°€, ì„œìª½ì„ í–¥í•˜ë©´ ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ(â†’)ê°€ í‘œì‹œë˜ë„ë¡ ì™„ë²½í•˜ê²Œ ì—°ë™í–ˆìŠµë‹ˆë‹¤.

## 1. ìƒˆë¡œìš´ í™”ì‚´í‘œ ì•„ì´ì½˜ 2ê°œ ì¶”ê°€
ê¸°ì¡´ ic_long_arrow_down.xml íŒŒì¼ì€ ì‚­ì œí•˜ì‹œê³ , res/drawable í´ë”ì— ì•„ë˜ 2ê°œì˜ XML íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

<details>
<summary><strong>res/drawable/ic_long_arrow_left.xml (ìƒˆ íŒŒì¼) - (í´ë¦­í•˜ì—¬ ì½”ë“œ ë³´ê¸°)</strong></summary>

XML

<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="200dp"
    android:height="24dp"
    android:viewportWidth="200"
    android:viewportHeight="24">
  <path
      android:strokeColor="#8000FF00" android:strokeWidth="2"
      android:pathData="M190,12 L10,12 M20,2 L10,12 L20,22"/>
</vector>
</details>

<details>
<summary><strong>res/drawable/ic_long_arrow_right.xml (ìƒˆ íŒŒì¼) - (í´ë¦­í•˜ì—¬ ì½”ë“œ ë³´ê¸°)</strong></summary>

XML

&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:width=&quot;200dp&quot;
    android:height=&quot;24dp&quot;
    android:viewportWidth=&quot;200&quot;
    android:viewportHeight=&quot;24&quot;&gt;
  &lt;path
      android:strokeColor=&quot;#8000FF00&quot; android:strokeWidth=&quot;2&quot;
      android:pathData=&quot;M10,12 L190,12 M180,2 L190,12 L180,22&quot;/&gt;
&lt;/vector&gt;
</details>

## 2. MainActivity.kt ìµœì¢… ìˆ˜ì •
'ì™„ë²½ ì•ˆì •ì„±' ë¡œì§ê³¼ ìƒˆë¡œìš´ 'ë°©í–¥ ì „í™˜ í™”ì‚´í‘œ' ë¡œì§ì´ ëª¨ë‘ ì ìš©ëœ ìµœì¢… ì½”ë“œì…ë‹ˆë‹¤. ì´ ì½”ë“œë¡œ êµì²´í•˜ì‹œë©´ ëª¨ë“  ë¬¸ì œê°€ í•´ê²°ë©ë‹ˆë‹¤.

Kotlin

package com.kyungwon.reellistviewer

import android.content.Context
import android.graphics.Typeface
import android.hardware.Sensor
import android.hardware.SensorEvent
import android.hardware.SensorEventListener
import android.hardware.SensorManager
import android.os.Bundle
import android.util.Log
import android.view.GestureDetector
import android.view.MotionEvent
import android.view.View
import android.widget.Button
import android.widget.LinearLayout
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.core.content.ContextCompat
import androidx.core.view.GestureDetectorCompat
import androidx.core.view.WindowCompat
import androidx.core.view.WindowInsetsCompat
import androidx.core.view.WindowInsetsControllerCompat
import androidx.core.view.setMargins
import androidx.lifecycle.lifecycleScope
import com.github.barteksc.pdfviewer.listener.OnLoadCompleteListener
import com.github.barteksc.pdfviewer.listener.OnPageErrorListener
import com.kyungwon.reellistviewer.databinding.ActivityMainBinding
import jcifs.CIFSContext
import jcifs.config.PropertyConfiguration
import jcifs.context.BaseContext
import jcifs.smb.NtlmPasswordAuthenticator
import jcifs.smb.SmbFile
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.util.Properties

class MainActivity : AppCompatActivity(), OnLoadCompleteListener, OnPageErrorListener, SensorEventListener {

    private lateinit var binding: ActivityMainBinding

    // --- PC ê³µìœ í´ë” ì ‘ì† ì •ë³´ ---
    private val SMB_IP = "192.1.1.5"
    private val SMB_SHARED_FOLDER = "tempshare"
    private val SMB_USER = "win10"
    private val SMB_PASS = "tltmxpa2@"

    // --- UI ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜ ---
    private var totalPdfPages = 0
    private val skippedButtons = mutableSetOf<Int>()
    private val currentButtons = mutableListOf<Button>()
    private var selectedButton: Button? = null

    // --- í„°ì¹˜ ì´ë²¤íŠ¸ ë¶„ì„ì„ ìœ„í•œ ë³€ìˆ˜ë“¤ ---
    private lateinit var gestureDetector: GestureDetectorCompat
    private var tappedButton: Button? = null

    // --- ì§€ìê³„ ì„¼ì„œ ê´€ë ¨ ë³€ìˆ˜ ---
    private lateinit var sensorManager: SensorManager
    private val accelerometerReading = FloatArray(3)
    private val magnetometerReading = FloatArray(3)
    private val rotationMatrix = FloatArray(9)
    private val orientationAngles = FloatArray(3)
    private var isGeomagneticModeOn = false
    private var currentDirection = Direction.OTHER

    enum class Direction { EAST, WEST, OTHER }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        hideSystemUI()
        setupGestureDetector()
        setupEventListeners()
        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager
    }

    override fun onResume() {
        super.onResume()
        hideSystemUI()
        sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
        sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
    }
    
    override fun onPause() {
        super.onPause()
        sensorManager.unregisterListener(this)
    }

    private fun hideSystemUI() {
        WindowCompat.setDecorFitsSystemWindows(window, false)
        val controller = WindowInsetsControllerCompat(window, binding.root)
        controller.hide(WindowInsetsCompat.Type.systemBars())
        controller.systemBarsBehavior = WindowInsetsControllerCompat.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE
    }

    private fun setupGestureDetector() {
        gestureDetector = GestureDetectorCompat(this, object : GestureDetector.SimpleOnGestureListener() {
            override fun onSingleTapConfirmed(e: MotionEvent): Boolean {
                tappedButton?.let { onPageButtonClick(it) }
                return true
            }
            override fun onDoubleTap(e: MotionEvent): Boolean {
                tappedButton?.let {
                    onPageButtonClick(it)
                    binding.pdfView.resetZoom()
                    Toast.makeText(this@MainActivity, "í™”ë©´ì— ë§ì¶¤", Toast.LENGTH_SHORT).show()
                }
                return true
            }
            override fun onLongPress(e: MotionEvent) {
                tappedButton?.let { onPageButtonLongClick(it) }
            }
        })
    }

    private fun setupEventListeners() {
        binding.btnOpenFile.setOnLongClickListener {
            lifecycleScope.launch(Dispatchers.IO) { showPdfListFromSmb() }
            Toast.makeText(this, "íŒŒì¼ ëª©ë¡ì„ ì—½ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
            true
        }
        binding.compassView.setOnLongClickListener {
            isGeomagneticModeOn = !isGeomagneticModeOn
            val modeText = if (isGeomagneticModeOn) "On" else "Off"
            Toast.makeText(this, "ì§€ìê³„ ì˜ì¡´ ëª¨ë“œ: $modeText", Toast.LENGTH_SHORT).show()
            binding.compassView.setGeomagneticMode(isGeomagneticModeOn)
            if (!isGeomagneticModeOn) {
                currentDirection = Direction.OTHER
            }
            updateButtonsAndUI()
            true
        }
    }

    override fun loadComplete(nbPages: Int) {
        totalPdfPages = nbPages
        skippedButtons.clear()
        selectedButton = null
        binding.pageButtonContainer.visibility = View.VISIBLE
        isGeomagneticModeOn = false
        binding.compassView.setGeomagneticMode(false)
        updateButtonsAndUI()
    }

    private fun updateButtonsAndUI() {
        var requiredLogicalButtons=0;var physicalPageCounter=0;var logicalButtonCounter=0
        while(physicalPageCounter<totalPdfPages){logicalButtonCounter++;if(!skippedButtons.contains(logicalButtonCounter)){physicalPageCounter++}};requiredLogicalButtons=logicalButtonCounter
        val currentButtonCount=currentButtons.size
        var newButtonCount=if(requiredLogicalButtons%2!=0)requiredLogicalButtons+1 else requiredLogicalButtons
        if(totalPdfPages>0&&newButtonCount==0)newButtonCount=2;newButtonCount=maxOf(newButtonCount,currentButtonCount)
        regenerateButtons(newButtonCount)
        updateAllButtonStyles()
    }

    private fun regenerateButtons(count: Int) {
        binding.topButtonRow.removeAllViews()
        binding.bottomButtonRow.removeAllViews()
        currentButtons.clear()

        val buttonHeight = dpToPx(44)
        val margin = dpToPx(2)
        val buttonParams = LinearLayout.LayoutParams(0, buttonHeight, 1.0f)
        buttonParams.setMargins(margin)
        
        if (isGeomagneticModeOn) {
            binding.ivTopRowArrow.visibility = View.VISIBLE
            // ğŸ’¡ ë°©í–¥ì— ë”°ë¼ í™”ì‚´í‘œ ì•„ì´ì½˜ ë³€ê²½
            when(currentDirection) {
                Direction.WEST -> binding.ivTopRowArrow.setImageResource(R.drawable.ic_long_arrow_right)
                Direction.EAST -> binding.ivTopRowArrow.setImageResource(R.drawable.ic_long_arrow_left)
                Direction.OTHER -> binding.ivTopRowArrow.visibility = View.GONE // ë°©í–¥ ë¯¸ì •ì‹œ ìˆ¨ê¹€
            }
        } else {
            binding.ivTopRowArrow.visibility = View.GONE
        }

        val (oddRowContainer, evenRowContainer) = when {
            isGeomagneticModeOn && currentDirection == Direction.WEST -> binding.bottomButtonRow to binding.topButtonRow
            isGeomagneticModeOn && currentDirection == Direction.EAST -> binding.topButtonRow to binding.bottomButtonRow
            else -> binding.topButtonRow to binding.bottomButtonRow
        }

        val isRtl = isGeomagneticModeOn && currentDirection == Direction.EAST

        for (i in 1..count) {
            val button = createPageButton(i, buttonParams.also { it.height = buttonHeight })
            if (i % 2 != 0) {
                if (isRtl) oddRowContainer.addView(button, 0) else oddRowContainer.addView(button)
            } else {
                if (isRtl) evenRowContainer.addView(button, 0) else evenRowContainer.addView(button)
            }
            currentButtons.add(button)
        }
    }

    private fun createPageButton(number: Int, layoutParams: LinearLayout.LayoutParams? = null): Button {
        return Button(this).apply {
            text = number.toString(); tag = number
            layoutParams?.let { this.layoutParams = it }
            textSize = 20f; typeface = Typeface.DEFAULT_BOLD
            setOnTouchListener { view, event ->
                tappedButton = view as Button
                gestureDetector.onTouchEvent(event)
                true
            }
        }
    }

    private fun updateAllButtonStyles() {
        if (isGeomagneticModeOn) {
            for (button in currentButtons) {
                val buttonNumber = button.tag as Int
                val isActiveRow = (currentDirection == Direction.WEST && buttonNumber % 2 != 0) || (currentDirection == Direction.EAST && buttonNumber % 2 == 0)
                when {
                    button == selectedButton -> {
                        button.setBackgroundResource(R.drawable.button_bg_geo_selected)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.white))
                    }
                    skippedButtons.contains(buttonNumber) -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_skipped_dark)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                    }
                    isActiveRow && mapLogicalToPhysical(buttonNumber) in 1..totalPdfPages -> {
                        button.setBackgroundResource(R.drawable.button_bg_geo_active)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    }
                    else -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_normal)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    }
                }
            }
        } else {
            for (button in currentButtons) {
                val buttonNumber = button.tag as Int
                if (button == selectedButton) {
                    button.setBackgroundResource(R.drawable.button_bg_page_selected)
                    button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    continue
                }
                when {
                    skippedButtons.contains(buttonNumber) -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_skipped_dark)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                    }
                    else -> {
                        val physicalPage = mapLogicalToPhysical(buttonNumber)
                        if (physicalPage in 1..totalPdfPages) {
                            button.setBackgroundResource(R.drawable.button_bg_page_normal)
                            button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                        } else {
                            button.setBackgroundResource(R.drawable.button_border_invalid)
                            button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                        }
                    }
                }
            }
        }
    }

    private fun mapLogicalToPhysical(logicalButtonNum: Int): Int {
        val skipsBefore = skippedButtons.count { it < logicalButtonNum }
        return logicalButtonNum - skipsBefore
    }

    private fun onPageButtonClick(button: Button) {
        val buttonNumber = button.tag as Int
        if (skippedButtons.contains(buttonNumber)) {
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ëŠ” ìŠ¤í‚µë˜ì—ˆìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
            return
        }
        val physicalPage = mapLogicalToPhysical(buttonNumber)
        if (physicalPage in 1..totalPdfPages) {
            binding.pdfView.jumpTo(physicalPage - 1, false)
            selectedButton = button
            updateAllButtonStyles()
        } else {
            Toast.makeText(this, "ë‚´ìš©ì´ ì—†ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
        }
    }

    private fun onPageButtonLongClick(view: View) {
        val button = view as Button; val buttonNumber = button.tag as Int
        if (skippedButtons.contains(buttonNumber)) {
            skippedButtons.remove(buttonNumber)
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ ìŠ¤í‚µ í•´ì œ", Toast.LENGTH_SHORT).show()
        } else {
            skippedButtons.add(buttonNumber)
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ ìŠ¤í‚µ ì„¤ì •", Toast.LENGTH_SHORT).show()
            if (selectedButton == button) { selectedButton = null }
        }
        updateButtonsAndUI()
    }

    override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) {}

    override fun onSensorChanged(event: SensorEvent) {
        if (event.sensor.type == Sensor.TYPE_ACCELEROMETER) {
            System.arraycopy(event.values, 0, accelerometerReading, 0, accelerometerReading.size)
        } else if (event.sensor.type == Sensor.TYPE_MAGNETIC_FIELD) {
            System.arraycopy(event.values, 0, magnetometerReading, 0, magnetometerReading.size)
        }
        SensorManager.getRotationMatrix(rotationMatrix, null, accelerometerReading, magnetometerReading)
        SensorManager.getOrientation(rotationMatrix, orientationAngles)
        val azimuthInDegrees = Math.toDegrees(orientationAngles[0].toDouble()).toFloat()
        val normalizedAzimuth = (azimuthInDegrees + 360) % 360
        binding.compassView.updateBearing(normalizedAzimuth)

        if (isGeomagneticModeOn) {
            var newDirection = currentDirection // ğŸ’¡ ê¸°ë³¸ì ìœ¼ë¡œ í˜„ì¬ ìƒíƒœ ìœ ì§€
            val tolerance = 2.0f

            // ğŸ’¡ ì„œìª½ ì§„ì… ì¡°ê±´
            if (normalizedAzimuth in (270f - tolerance)..(270f + tolerance)) {
                newDirection = Direction.WEST
            }
            // ğŸ’¡ ë™ìª½ ì§„ì… ì¡°ê±´
            else if (normalizedAzimuth in (90f - tolerance)..(90f + tolerance)) {
                newDirection = Direction.EAST
            }
            // ğŸ’¡ ìœ„ì˜ ë‘ ê°€ì§€ ì—„ê²©í•œ ì¡°ê±´ì— í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´, ë°©í–¥ì„ ì ˆëŒ€ ë°”ê¾¸ì§€ ì•ŠìŒ.

            if (newDirection != currentDirection) {
                currentDirection = newDirection
                updateButtonsAndUI()
            }
        }
    }

    private fun dpToPx(dp: Int): Int {
        return (dp * resources.displayMetrics.density).toInt()
    }

    private suspend fun loadPdfFromSmbFile(smbFile: SmbFile) {
        withContext(Dispatchers.Main) {
            binding.btnOpenFile.isEnabled = false; binding.btnOpenFile.text = "ë¡œë”©ì¤‘..."
        }
        try {
            val tempPdfFile = File(cacheDir, smbFile.name)
            smbFile.inputStream.use { input -> FileOutputStream(tempPdfFile).use { output -> input.copyTo(output) } }
            withContext(Dispatchers.Main) {
                binding.tvFileName.text = smbFile.name.substringBeforeLast(".")
                binding.pdfView.fromFile(tempPdfFile).onLoad(this@MainActivity).onPageError(this@MainActivity).load()
            }
        } catch (e: Exception) { Log.e("SmbTask", "íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨", e)
        } finally {
            withContext(Dispatchers.Main) {
                binding.btnOpenFile.isEnabled = true; binding.btnOpenFile.text = "Open ReelList"
            }
        }
    }
    
    private suspend fun showPdfListFromSmb(){val smbUrl="smb://$SMB_IP/$SMB_SHARED_FOLDER/";try{val properties=Properties();properties["jcifs.smb.client.minVersion"]="SMB300";properties["jcifs.smb.client.maxVersion"]="SMB311";val config=PropertyConfiguration(properties);val cifsContext:CIFSContext=BaseContext(config);val auth=NtlmPasswordAuthenticator(null,SMB_USER,SMB_PASS);val context=cifsContext.withCredentials(auth);val dir=SmbFile(smbUrl,context);val pdfFiles=dir.listFiles{f->f.name.endsWith(".pdf",ignoreCase=true)};if(pdfFiles.isNullOrEmpty()){withContext(Dispatchers.Main){Toast.makeText(this@MainActivity,"ê³µìœ  í´ë”ì— PDF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.",Toast.LENGTH_SHORT).show()};return};val fileNames=pdfFiles.map{it.name}.toTypedArray();withContext(Dispatchers.Main){AlertDialog.Builder(this@MainActivity).setTitle("PDF íŒŒì¼ ì„ íƒ").setItems(fileNames){_,which->val selectedFile=pdfFiles[which];lifecycleScope.launch(Dispatchers.IO){loadPdfFromSmbFile(selectedFile)}}.setNegativeButton("ì·¨ì†Œ",null).show()}}catch(e:Exception){Log.e("SmbTask","SMB ì—°ê²° ì‹¤íŒ¨",e);withContext(Dispatchers.Main){Toast.makeText(this@MainActivity,"ê³µìœ  í´ë” ì—°ê²° ì‹¤íŒ¨\nì˜¤ë¥˜: ${e.message}",Toast.LENGTH_LONG).show()}}}
    override fun onPageError(page:Int,t:Throwable){Log.e("PDFView","í˜ì´ì§€ ë¡œë“œ ì—ëŸ¬",t);Toast.makeText(this,"${page+1}í˜ì´ì§€ ë¡œë“œ ì—ëŸ¬",Toast.LENGTH_SHORT).show()}
}
