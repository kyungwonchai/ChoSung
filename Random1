일을 여러 번 열지 않고, 한 번에 모든 파일을 읽고, 데이터를 정리하여 CSV 파일로 저장하도록 수정한 코드를 제공하겠습니다. 파일을 한 번 열고 나서 한 번에 데이터를 처리하여 저장합니다.

python
코드 복사
import os
import csv
from datetime import datetime

# Log file directory
log_directory = "c:/test"

# List to store the parsed log data
log_data = []

# Iterate through all files in the directory
for filename in os.listdir(log_directory):
    if "commandqueue" not in filename.lower():
        file_path = os.path.join(log_directory, filename)
        
        # Open and read the file once, process all lines at once
        with open(file_path, 'r', encoding='utf-8') as file:
            lines = file.readlines()
            for line in lines:
                # Extract time value enclosed in [] and the remaining part as SentValue
                if '[' in line and ']' in line:
                    start_idx = line.index('[')
                    end_idx = line.index(']', start_idx) + 1
                    time_value = line[start_idx:end_idx]  # Extract the time value with brackets
                    remaining_value = line[end_idx:].strip()  # Remaining part of the line as SentValue
                    
                    log_data.append([time_value, remaining_value])

# Sort the log data by the time value
log_data.sort(key=lambda x: x[0])

# Prepare the output directory
output_directory = "c:/test/csv2"
os.makedirs(output_directory, exist_ok=True)

# Create the output file name with the current timestamp
timestamp = datetime.now().strftime("%Y%m%d%H%M%S")
output_file = os.path.join(output_directory, f"{timestamp}_log_output.csv")

# Save the sorted data to a CSV file
with open(output_file, 'w', newline='', encoding='utf-8-sig') as csvfile:
    csvwriter = csv.writer(csvfile)
    # Write column headers
    csvwriter.writerow(["Time", "SentValue"])
    # Write all the data at once
    csvwriter.writerows(log_data)

print(f"CSV file has been saved as '{output_file}'.")
코드 설명
모든 파일을 한 번에 처리:
디렉토리 내에서 commandqueue가 포함되지 않은 파일들을 한 번에 열어서 모든 내용을 읽고 데이터를 수집합니다.
데이터 정리 및 저장:
파일을 읽은 후, 시간 값 (Time)과 나머지 값 (SentValue)을 추출하여 리스트에 저장한 뒤, 시간 순서로 정렬합니다.
CSV 파일에 한 번에 저장: