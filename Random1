penCVë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ìƒ‰ìƒì„ ê°€ì§„ ì‚¬ê°í˜•ì„ ì°¾ê³ , ë§ˆìš°ìŠ¤ í´ë¦­ ë° í‚¤ë³´ë“œ ì…ë ¥ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œì´ë‹¤.
RGB(ì •í™•íˆëŠ” OpenCVì˜ BGR) ë²”ìœ„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒ‰ìƒì„ í•„í„°ë§í•˜ë©°, ì „ì²´ ì›ë¦¬ë¥¼ ì£¼ì„ê³¼ í•¨ê»˜ ì„¤ëª…í•œë‹¤.

ğŸ”¹ ì „ì²´ ì½”ë“œ (ì™„ë²½í•œ ì£¼ì„ í¬í•¨)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Threading.Tasks;
using System.Windows.Forms;
using OpenCvSharp;
using OpenCvSharp.Extensions;

public partial class MainForm : Form
{
    private const int MaxLogCount = 500; // ListBox ìµœëŒ€ ë¡œê·¸ ê°œìˆ˜

    public MainForm()
    {
        InitializeComponent();
    }

    /// <summary>
    /// ë¹„ë™ê¸°ë¡œ íŠ¹ì • ì˜ì—­ì—ì„œ ìƒ‰ìƒì„ ê²€ìƒ‰í•˜ê³ , ì¡°ê±´ì´ ë§ìœ¼ë©´ ë§ˆìš°ìŠ¤ í´ë¦­ ë° í‚¤ë³´ë“œ ì…ë ¥ì„ ìˆ˜í–‰
    /// </summary>
    private async Task PerformAutomationAsync()
    {
        // 1. ìŠ¤ìº”í•  í™”ë©´ ì˜ì—­ (X, Y ì¢Œí‘œ ë²”ìœ„)
        int startX = 1200;
        int endX = 1500;
        int startY = 500;
        int endY = 600;

        // 2. í•´ë‹¹ ì˜ì—­ ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ í›„ OpenCV Mat ê°ì²´ë¡œ ë³€í™˜
        Bitmap screenshot = CaptureScreen(startX, startY, endX - startX, endY - startY);
        Mat src = BitmapConverter.ToMat(screenshot);

        // 3. ìƒ‰ìƒ ë²”ìœ„ ì§€ì • (OpenCVëŠ” BGR ìˆœì„œ)
        Scalar lower = new Scalar(10, 77, 100);  // B=10~50, G=77~88, R=100~120
        Scalar upper = new Scalar(50, 88, 120);

        /*
         * â¬‡ Cv2.InRange() ì‘ë™ ì›ë¦¬ â¬‡
         * ì§€ì •ëœ `lower`~`upper` ê°’ ì‚¬ì´ì— ìˆëŠ” ëª¨ë“  í”½ì…€ì„ í°ìƒ‰(255)ìœ¼ë¡œ ë§ˆìŠ¤í‚¹, ë‚˜ë¨¸ì§€ëŠ” ê²€ì€ìƒ‰(0) ì²˜ë¦¬
         * â†’ ê²°ê³¼ì ìœ¼ë¡œ íŠ¹ì • ìƒ‰ìƒ ë²”ìœ„ ë‚´ì˜ í”½ì…€ë§Œ ë‚¨ê¹€
         */
        Mat mask = new Mat();
        Cv2.InRange(src, lower, upper, mask); // ë§ˆìŠ¤í‚¹ëœ ì´ë¯¸ì§€ ìƒì„±

        /*
         * â¬‡ Cv2.FindContours() ì‘ë™ ì›ë¦¬ â¬‡
         * ë§ˆìŠ¤í¬ ì´ë¯¸ì§€(ì´ì§„ ì´ë¯¸ì§€)ì—ì„œ í°ìƒ‰(255) ì˜ì—­ì˜ ìœ¤ê³½ì„ ì„ ì°¾ìŒ
         * â†’ ê²€ì¶œëœ ìœ¤ê³½ì„  ë°ì´í„°ëŠ” `contours` ë°°ì—´ì— ì €ì¥ë¨
         */
        Cv2.FindContours(mask, out Point[][] contours, out _, RetrievalModes.External, ContourApproximationModes.ApproxSimple);

        foreach (var contour in contours)
        {
            // 4. ê²€ì¶œëœ ìœ¤ê³½ì„ ì˜ ì™¸ì ‘ ì‚¬ê°í˜• ê³„ì‚°
            Rect rect = Cv2.BoundingRect(contour);

            // 5. ì‚¬ê°í˜• í¬ê¸° ì¡°ê±´ í™•ì¸ (ë„ˆë¹„ 200 ì´ìƒ, ë†’ì´ 30 ì´ìƒ)
            if (rect.Width >= 200 && rect.Height >= 30)
            {
                int centerX = startX + rect.X + rect.Width / 2;  // ë²„íŠ¼ ì¤‘ì•™ X ì¢Œí‘œ
                int centerY = startY + rect.Y + rect.Height / 2; // ë²„íŠ¼ ì¤‘ì•™ Y ì¢Œí‘œ
                int topClickY = startY + rect.Y - 157; // ìƒë‹¨ í´ë¦­í•  Y ì¢Œí‘œ

                LogMessage($"ì°¾ì€ ë²„íŠ¼: X={centerX}, Y={centerY}, Width={rect.Width}, Height={rect.Height}");

                // 6. ë²„íŠ¼ ìœ„ìª½ íŠ¹ì • ì§€ì  í´ë¦­
                SetCursorPos(centerX, topClickY);
                mouse_event(MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_LEFTUP, (uint)centerX, (uint)topClickY, 0, 0);

                // 7. í‚¤ë³´ë“œ ì…ë ¥ ìˆ˜í–‰
                await Task.Delay(100);
                SendKeys.SendWait("kkkkbbbbb");
                await Task.Delay(100);
                SendKeys.SendWait("{TAB}");
                await Task.Delay(100);
                SendKeys.SendWait("aaaaabbbb");

                // 8. ë²„íŠ¼ì˜ ì¤‘ì•™ í´ë¦­
                await Task.Delay(100);
                SetCursorPos(centerX, centerY);
                mouse_event(MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_LEFTUP, (uint)centerX, (uint)centerY, 0, 0);

                LogMessage("ì…ë ¥ ë° ë²„íŠ¼ í´ë¦­ ì™„ë£Œ");
                return;
            }
        }

        LogMessage("ì¡°ê±´ì— ë§ëŠ” ì§ì‚¬ê°í˜•ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
    }

    /// <summary>
    /// ì§€ì •ëœ ì˜ì—­ì˜ ìŠ¤í¬ë¦°ìƒ·ì„ ìº¡ì²˜í•˜ì—¬ Bitmapìœ¼ë¡œ ë°˜í™˜
    /// </summary>
    private Bitmap CaptureScreen(int x, int y, int width, int height)
    {
        Bitmap bmp = new Bitmap(width, height);
        using (Graphics g = Graphics.FromImage(bmp))
        {
            g.CopyFromScreen(x, y, 0, 0, new System.Drawing.Size(width, height), CopyPixelOperation.SourceCopy);
        }
        return bmp;
    }

    /// <summary>
    /// ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ListBoxì— ì¶”ê°€ (500ê°œ ì´ˆê³¼ ì‹œ ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ)
    /// </summary>
    private void LogMessage(string message)
    {
        if (listBox1.InvokeRequired)
        {
            listBox1.Invoke(new Action(() => AddMessageToListBox(message)));
        }
        else
        {
            AddMessageToListBox(message);
        }
    }

    private void AddMessageToListBox(string message)
    {
        listBox1.Items.Add($"{DateTime.Now:HH:mm:ss} - {message}");

        if (listBox1.Items.Count > MaxLogCount)
        {
            listBox1.Items.RemoveAt(0);
        }

        listBox1.TopIndex = listBox1.Items.Count - 1;
    }

    // ë§ˆìš°ìŠ¤ ì´ë™ ë° í´ë¦­ì„ ìœ„í•œ WinAPI í•¨ìˆ˜
    [DllImport("user32.dll")]
    private static extern bool SetCursorPos(int X, int Y);

    [DllImport("user32.dll")]
    private static extern void mouse_event(uint dwFlags, uint dx, uint dy, uint dwData, int dwExtraInfo);

    private const uint MOUSEEVENTF_LEFTDOWN = 0x0002;
    private const uint MOUSEEVENTF_LEFTUP = 0x0004;
}
ğŸ”¹ í•µì‹¬ ê°œë… ë° ì‘ë™ ì›ë¦¬
1ï¸âƒ£ Cv2.InRange() ìƒ‰ìƒ í•„í„°ë§
ì›ë¦¬: íŠ¹ì • ë²”ìœ„ì˜ ìƒ‰ìƒë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ë¥¼ ì œê±°
BGR ê°’ ì‚¬ìš©: lower = (10, 77, 100), upper = (50, 88, 120)
ê²°ê³¼: í•´ë‹¹ ìƒ‰ìƒ ë²”ìœ„ì— í¬í•¨ë˜ëŠ” í”½ì…€ë§Œ í°ìƒ‰(255)ìœ¼ë¡œ í‘œì‹œ, ë‚˜ë¨¸ì§€ëŠ” ê²€ì€ìƒ‰(0)
2ï¸âƒ£ Cv2.FindContours() ìœ¤ê³½ì„  ì¶”ì¶œ
ì›ë¦¬: Cv2.InRange()ë¡œ ë§ˆìŠ¤í‚¹í•œ ê²°ê³¼ì—ì„œ í°ìƒ‰(255) ì˜ì—­ì„ ì°¾ì•„ ìœ¤ê³½ì„ ì„ ê²€ì¶œ
ê²°ê³¼: ê° ìœ¤ê³½ì„ ì´ contours ë°°ì—´ì— ì €ì¥ë¨
3ï¸âƒ£ Cv2.BoundingRect() ì‚¬ê°í˜• ì¶”ì¶œ
ì›ë¦¬: FindContours()ë¡œ ì°¾ì€ ìœ¤ê³½ì„ ì„ ê°ì‹¸ëŠ” ìµœì†Œ ì‚¬ê°í˜•ì„ êµ¬í•¨
ê²°ê³¼: ê° ìœ¤ê³½ì„ ì— ëŒ€í•´ Rect ê°ì²´(ìœ„ì¹˜, í¬ê¸° ì •ë³´)ë¥¼ ì–»ìŒ
4ï¸âƒ£ í¬ê¸° ì¡°ê±´ ì ìš© (200x30 ì´ìƒ)
rect.Width >= 200 && rect.Height >= 30 ì¡°ê±´ ê²€ì‚¬
ì¡°ê±´ ì¶©ì¡± ì‹œ â†’ ë§ˆìš°ìŠ¤ í´ë¦­ & í‚¤ë³´ë“œ ì…ë ¥ ì‹¤í–‰
5ï¸âƒ£ ListBox ë¡œê·¸ ê´€ë¦¬
ë¡œê·¸ ì¶”ê°€ í›„ 500ê°œ ì´ˆê³¼ ì‹œ ì˜¤ë˜ëœ í•­ëª© ì‚­ì œ
UIê°€ ë©ˆì¶”ì§€ ì•Šë„ë¡ InvokeRequired ê²€ì‚¬ í›„ ì—…ë°ì´íŠ¸
ğŸ“Œ ê²°ê³¼
ìƒ‰ìƒ í•„í„°ë§ í›„ ì¡°ê±´ ë§ëŠ” ë²„íŠ¼ë§Œ ì°¾ìŒ
í´ë¦­ í›„ í‚¤ë³´ë“œ ì…ë ¥ ìë™ ì‹¤í–‰
ListBoxì— ì²˜ë¦¬ ë¡œê·¸ ì¶”ê°€