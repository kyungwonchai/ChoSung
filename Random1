VBA에서 MSSQL에 값을 INSERT할 때, 현재 시간을 "yyyy-MM-dd HH:mm:00" 형식으로 변환하고, mm을 가까운 10분 단위로 반올림하여 저장하는 코드입니다.

✅ VBA 코드 (MSSQL INSERT with Time Rounding)
vba
코드 복사
Sub InsertIntoMSSQL()
    Dim conn As Object
    Dim cmd As Object
    Dim strSQL As String
    Dim connString As String
    Dim roundedTime As String
    
    ' 1. 현재 시간 가져오기
    Dim nowTime As Date
    nowTime = Now()
    
    ' 2. 분 단위 반올림 (10분 단위)
    Dim minutes As Integer
    minutes = Minute(nowTime)
    
    ' 3. 가장 가까운 10분 단위로 조정
    minutes = ((minutes \ 10) + 1) * 10
    If minutes = 60 Then
        nowTime = DateAdd("h", 1, nowTime) ' 한 시간 증가
        minutes = 0 ' 60분 -> 00분 처리
    End If
    
    ' 4. 최종 포맷 (yyyy-MM-dd HH:mm:00)
    roundedTime = Format(nowTime, "yyyy-MM-dd HH:" & Format(minutes, "00") & ":00")
    
    ' 5. SQL 연결 문자열 (필요에 맞게 변경)
    connString = "Provider=SQLOLEDB;Data Source=서버이름;Initial Catalog=DB이름;User ID=사용자ID;Password=비밀번호;"

    ' 6. MSSQL 연결 및 INSERT 실행
    Set conn = CreateObject("ADODB.Connection")
    Set cmd = CreateObject("ADODB.Command")
    
    On Error Resume Next
    conn.Open connString
    If Err.Number <> 0 Then
        MsgBox "데이터베이스 연결 오류: " & Err.Description, vbCritical
        Exit Sub
    End If
    
    ' 7. INSERT SQL 실행
    strSQL = "INSERT INTO TableName (TimeColumn) VALUES ('" & roundedTime & "')"
    
    cmd.ActiveConnection = conn
    cmd.CommandText = strSQL
    cmd.Execute
    
    ' 8. 연결 닫기
    conn.Close
    Set cmd = Nothing
    Set conn = Nothing
    
    ' 9. 완료 메시지
    MsgBox "데이터가 성공적으로 입력되었습니다: " & roundedTime, vbInformation
End Sub
🔹 설명
Now()로 현재 시간 가져오기.
Minute(Now)를 이용해 현재 분 확인.
10분 단위로 반올림:
예: 14:50 → 15:00, 15:10 → 15:20
60분이 되면 한 시간 증가 (15:60 → 16:00)
Format()을 사용해 "yyyy-MM-dd HH:mm:00" 형식으로 변환.
ADODB.Connection을 사용하여 MSSQL에 연결.
INSERT INTO TableName (TimeColumn) VALUES ('yyyy-MM-dd HH:mm:00') 실행.
✅ 예제 결과
현재 시간	저장되는 값
14:50:30	15:00:00
15:09:15	15:10:00