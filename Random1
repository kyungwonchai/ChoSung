QL 2014에서 ESC_CHECK_MIDDEL 테이블에 삭제 트리거를 추가하여 삭제된 데이터를 _backup 테이블로 이동시키는 전체 과정의 SQL 쿼리를 아래에 제공합니다. 여기에는 테이블 복제, 열 추가, 그리고 트리거 생성 코드가 포함되어 있습니다.

1. 원본 테이블 복제
먼저 ESC_CHECK_MIDDEL 테이블을 복제하여 _backup 테이블을 생성합니다.

sql
코드 복사
SELECT *
INTO ESC_CHECK_MIDDEL_backup
FROM ESC_CHECK_MIDDEL
WHERE 1 = 0;  -- 데이터는 복사하지 않음
2. _backup 테이블에 열 추가
ESC_CHECK_MIDDEL_backup 테이블에 필요한 열을 추가합니다.

sql
코드 복사
ALTER TABLE ESC_CHECK_MIDDEL_backup
ADD DELETED_TIME DATETIME;
3. 삭제 트리거 생성
삭제 트리거를 생성하여 삭제된 데이터를 _backup 테이블로 이동시킵니다.

sql
코드 복사
CREATE TRIGGER trgAfterDeleteOnESC_CHECK_MIDDEL
ON ESC_CHECK_MIDDEL
AFTER DELETE
AS
BEGIN
    INSERT INTO ESC_CHECK_MIDDEL_backup (USER_CARD_ID, USER_NAME, WORK_GROUP, ESC_CHECK_TF, UPDATE_TIME, INSERTED_TO_SOURCE, INSERTED_TIME, DELETED_TIME)
    SELECT USER_CARD_ID, USER_NAME, WORK_GROUP, ESC_CHECK_TF, UPDATE_TIME, INSERTED_TO_SOURCE, INSERTED_TIME, GETDATE()
    FROM DELETED;
END;
전체 코드
전체 SQL 스크립트를 한 번에 실행할 수 있도록 아래에 제공합니다.

sql
코드 복사
-- 1. 원본 테이블 복제
SELECT *
INTO ESC_CHECK_MIDDEL_backup
FROM ESC_CHECK_MIDDEL
WHERE 1 = 0;

-- 2. _backup 테이블에 열 추가
ALTER TABLE ESC_CHECK_MIDDEL_backup
ADD DELETED_TIME DATETIME;

-- 3. 삭제 트리거 생성
CREATE TRIGGER trgAfterDeleteOnESC_CHECK_MIDDEL
ON ESC_CHECK_MIDDEL
AFTER DELETE
AS
BEGIN
    INSERT INTO ESC_CHECK_MIDDEL_backup (USER_CARD_ID, USER_NAME, WORK_GROUP, ESC_CHECK_TF, UPDATE_TIME, INSERTED_TO_SOURCE, INSERTED_TIME, DELETED_TIME)
    SELECT USER_CARD_ID, USER_NAME, WORK_GROUP, ESC_CHECK_TF, UPDATE_TIME, INSERTED_TO_SOURCE, INSERTED_TIME, GETDATE()
    FROM DELETED;
END;
이 스크립트를 실행하면 ESC_CHECK_MIDDEL 테이블에서 삭제된 데이터가 자동으로 _backup 테이블로 이동되며, 