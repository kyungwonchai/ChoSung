
수정된 Settings 클래스
csharp
코드 복사
using System;
using System.IO;
using System.Text;

public class Settings
{
    private readonly string _filePath;

    // 설정 파일 경로를 지정합니다.
    public Settings()
    {
        _filePath = @"C:\agent\routeracrmiddleware\setting.ini";
    }

    // COM 포트 값을 파일에 저장하는 함수
    public void SaveSettings(string comPort)
    {
        try
        {
            // 폴더 경로를 추출합니다.
            string directoryPath = Path.GetDirectoryName(_filePath);

            // 폴더가 없는 경우 폴더를 생성합니다.
            if (!Directory.Exists(directoryPath))
            {
                Directory.CreateDirectory(directoryPath);
            }

            // 설정 파일이 없는 경우 파일을 생성합니다.
            if (!File.Exists(_filePath))
            {
                File.Create(_filePath).Dispose();
            }

            // 파일에 COM 포트 값을 저장합니다.
            using (StreamWriter writer = new StreamWriter(_filePath, false, Encoding.UTF8))
            {
                writer.WriteLine($"COM_PORT={comPort}");
            }
        }
        catch (Exception ex)
        {
            // 에러 발생 시 로그 또는 예외 처리
            Console.WriteLine($"Error saving settings: {ex.Message}");
        }
    }

    // COM 포트 값을 파일에서 불러오는 함수
    public string LoadSettings()
    {
        try
        {
            // 파일이 존재하는지 확인하고 존재하면 내용을 읽어옵니다.
            if (File.Exists(_filePath))
            {
                using (StreamReader reader = new StreamReader(_filePath, Encoding.UTF8))
                {
                    string line;
                    while ((line = reader.ReadLine()) != null)
                    {
                        // "COM_PORT="로 시작하는 줄을 찾고 값을 반환합니다.
                        if (line.StartsWith("COM_PORT="))
                        {
                            return line.Substring("COM_PORT=".Length).Trim();
                        }
                    }
                }
            }
            else
            {
                // 파일이 없는 경우 기본값 "COM4"로 설정하고 파일을 생성
                SaveSettings("COM4");
                return "COM4";
            }
        }
        catch (Exception ex)
        {
            // 에러 발생 시 로그 또는 예외 처리
            Console.WriteLine($"Error loading settings: {ex.Message}");
        }

        // 파일이 없거나 값을 찾지 못한 경우 빈 문자열 반환
        return string.Empty;
    }
}
수정된 코드 설명
폴더 생성:

SaveSettings 함수에서 파일 경로에서 폴더 경로(directoryPath)를 추출하고, 폴더가 존재하지 않으면 Directory.CreateDirectory(directoryPath)를 사용하여 폴더를 생성합니다.
파일 생성: