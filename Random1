 ë¬¼ë¡ ì…ë‹ˆë‹¤. ë°”ì˜ì‹  ìƒí™©ì„ ê³ ë ¤í•˜ì—¬, ì•ì„œ ì œê³µí•´ ë“œë¦° .NET 4.8 ê¸°ë°˜ì˜ WPF í”„ë¡œì íŠ¸ ì „ì²´ í´ë” êµ¬ì¡°ì™€ íŒŒì¼ë“¤ì„ í•œ ë²ˆì— ìƒì„±í•´ ì£¼ëŠ” Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

í”„ë¡œì íŠ¸ ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ğŸ“
ì•„ë˜ Python ì½”ë“œë¥¼ create_wpf_agent.pyì™€ ê°™ì€ ì´ë¦„ì˜ íŒŒì¼ë¡œ ì €ì¥í•˜ì‹  í›„, í„°ë¯¸ë„ì´ë‚˜ ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì—ì„œ ì‹¤í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

ì‚¬ìš© ë°©ë²•
ì•„ë˜ì˜ ì „ì²´ Python ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ create_wpf_agent.py íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

ì›í•˜ëŠ” ìœ„ì¹˜ì—ì„œ í„°ë¯¸ë„ì„ ì—´ê³  python create_wpf_agent.py ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ í˜„ì¬ ìœ„ì¹˜ì— LogUploaderAgentë¼ëŠ” í´ë”ê°€ ìƒì„±ë˜ê³ , ê·¸ ì•ˆì— ëª¨ë“  í”„ë¡œì íŠ¸ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤.

Python ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ ì½”ë“œ
Python

import os

print("WPF LogUploaderAgent í”„ë¡œì íŠ¸ íŒŒì¼ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...")

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë” ì´ë¦„
PROJECT_ROOT = "LogUploaderAgent"

# ìƒì„±í•  íŒŒì¼ê³¼ ë‚´ìš©ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ì •ì˜
# Key: íŒŒì¼ ê²½ë¡œ, Value: íŒŒì¼ ë‚´ìš©
project_files = {
    "App.xaml": """<Application x:Class="LogUploaderAgent.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:LogUploaderAgent">
    </Application>
""",

    "App.xaml.cs": """using System.Windows;
using LogUploaderAgent.Services;
using LogUploaderAgent.Utils;
using LogUploaderAgent.ViewModels;
using LogUploaderAgent.Views;

namespace LogUploaderAgent
{
    public partial class App : Application
    {
        private NotifyIconWrapper _notifyIcon;
        private MainViewModel _mainViewModel;
        private SettingsService _settingsService;
        private DatabaseService _databaseService;
        private LogProcessingService _logProcessingService;

        protected override async void OnStartup(StartupEventArgs e)
        {
            base.OnStartup(e);

            // MainWindowë¥¼ ìƒì„±í•˜ì§€ë§Œ ë³´ì—¬ì£¼ì§€ëŠ” ì•ŠìŒ
            MainWindow = new MainWindow();
            
            // ì„œë¹„ìŠ¤ ë° ë·°ëª¨ë¸ ì´ˆê¸°í™”
            _settingsService = new SettingsService();
            _databaseService = new DatabaseService();
            _mainViewModel = new MainViewModel(_settingsService);
            _logProcessingService = new LogProcessingService(_settingsService, _databaseService);

            // íŠ¸ë ˆì´ ì•„ì´ì½˜ ì„¤ì •
            _notifyIcon = new NotifyIconWrapper();
            _notifyIcon.SettingsClicked += (s, a) => ShowSettings();
            _notifyIcon.ExitClicked += (s, a) => ShutdownApp();

            // ì„¤ì • ë¡œë“œ
            await _mainViewModel.LoadSettingsAsync();

            if (_mainViewModel.HasSettings())
            {
                // ì„¤ì •ì´ ìˆìœ¼ë©´ ë°”ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì‹œì‘
                _logProcessingService.Start();
            }
            else
            {
                // ì„¤ì •ì´ ì—†ìœ¼ë©´ ì„¤ì •ì°½ ë¨¼ì € í‘œì‹œ
                ShowSettings(true);
            }
        }

        private void ShowSettings(bool isFirstRun = false)
        {
            var settingsWindow = new SettingsWindow(_mainViewModel);
            var result = settingsWindow.ShowDialog();

            // ì„¤ì • ì°½ì—ì„œ ì €ì¥ì„ ëˆŒë €ê³ , í´ë”ê°€ 1ê°œ ì´ìƒ ì„¤ì •ë˜ì—ˆë‹¤ë©´
            if (result == true && _mainViewModel.HasSettings())
            {
                // ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ ì‹œì‘ (ë˜ëŠ” ì¬ì‹œì‘)
                _logProcessingService.Stop();
                _logProcessingService.Start();
            }
            // ì²« ì‹¤í–‰ì¸ë° ì„¤ì •ì„ ì•ˆ í•˜ê³  ì°½ì„ ë‹«ìœ¼ë©´ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
            else if (isFirstRun && !_mainViewModel.HasSettings())
            {
                ShutdownApp();
            }
        }

        private void ShutdownApp()
        {
            _logProcessingService.Stop();
            _notifyIcon.Dispose();
            Shutdown();
        }
    }
}
""",

    "MainWindow.xaml": """<Window x:Class="LogUploaderAgent.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Log Agent" Height="0" Width="0" WindowStyle="None" ShowInTaskbar="False" Opacity="0">
</Window>
""",

    "MainWindow.xaml.cs": """using System.Windows;

namespace LogUploaderAgent
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }
    }
}
""",

    "Views/SettingsWindow.xaml": """<Window x:Class="LogUploaderAgent.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="í´ë” ì„¤ì • (Folder Settings)" Height="450" Width="600"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <TextBlock Grid.Row="0" Text="ëª¨ë‹ˆí„°ë§í•  í´ë” ëª©ë¡ (ìµœëŒ€ 5ê°œ)" FontWeight="Bold" Margin="0,0,0,10"/>

        <ListBox Grid.Row="1" ItemsSource="{Binding MonitoredFolders}" Name="FolderListBox">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding}" Margin="2"/>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="ì¶”ê°€ (Add)" Width="100" Margin="5" Click="AddButton_Click"/>
            <Button Content="ì œê±° (Remove)" Width="100" Margin="5" Click="RemoveButton_Click"/>
            <Button Content="ì €ì¥ (Save)" Width="100" Margin="5" Click="SaveButton_Click" IsDefault="True"/>
            <Button Content="ì·¨ì†Œ (Cancel)" Width="100" Margin="5" Click="CancelButton_Click" IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
""",

    "Views/SettingsWindow.xaml.cs": """using System.Windows;
using System.Windows.Forms;
using LogUploaderAgent.ViewModels;

namespace LogUploaderAgent.Views
{
    public partial class SettingsWindow : Window
    {
        private readonly MainViewModel _viewModel;

        public SettingsWindow(MainViewModel viewModel)
        {
            InitializeComponent();
            _viewModel = viewModel;
            DataContext = _viewModel;
        }

        private void AddButton_Click(object sender, RoutedEventArgs e)
        {
            if (_viewModel.MonitoredFolders.Count >= 5)
            {
                System.Windows.MessageBox.Show("ìµœëŒ€ 5ê°œì˜ í´ë”ë§Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "ì œí•œ", MessageBoxButton.OK, MessageBoxImage.Warning);
                return;
            }

            using (var dialog = new FolderBrowserDialog())
            {
                if (dialog.ShowDialog() == System.Windows.Forms.DialogResult.OK)
                {
                    if (!_viewModel.MonitoredFolders.Contains(dialog.SelectedPath))
                    {
                        _viewModel.MonitoredFolders.Add(dialog.SelectedPath);
                    }
                }
            }
        }

        private void RemoveButton_Click(object sender, RoutedEventArgs e)
        {
            if (FolderListBox.SelectedItem is string selectedFolder)
            {
                _viewModel.MonitoredFolders.Remove(selectedFolder);
            }
        }

        private async void SaveButton_Click(object sender, RoutedEventArgs e)
        {
            await _viewModel.SaveSettingsAsync();
            DialogResult = true;
            Close();
        }

        private void CancelButton_Click(object sender, RoutedEventArgs e)
        {
            DialogResult = false;
            Close();
        }
    }
}
""",

    "ViewModels/MainViewModel.cs": """using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Linq;
using System.Threading.Tasks;
using System.Windows;
using LogUploaderAgent.Services;

namespace LogUploaderAgent.ViewModels
{
    public class MainViewModel : INotifyPropertyChanged
    {
        private readonly SettingsService _settingsService;
        public ObservableCollection<string> MonitoredFolders { get; }

        public MainViewModel(SettingsService settingsService)
        {
            _settingsService = settingsService;
            MonitoredFolders = new ObservableCollection<string>();
        }

        public async Task LoadSettingsAsync()
        {
            var folders = await _settingsService.LoadMonitoredFoldersAsync();
            MonitoredFolders.Clear();
            foreach (var folder in folders)
            {
                MonitoredFolders.Add(folder);
            }
        }

        public async Task SaveSettingsAsync()
        {
            await _settingsService.SaveMonitoredFoldersAsync(MonitoredFolders);
        }

        public bool HasSettings()
        {
            return MonitoredFolders.Any();
        }

        public event PropertyChangedEventHandler PropertyChanged;
        protected void OnPropertyChanged(string propertyName)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }
    }
}
""",

    "Services/DatabaseService.cs": """using System;
using System.Data.SqlClient;
using System.Threading.Tasks;
using LogUploaderAgent.Models;

namespace LogUploaderAgent.Services
{
    public class DatabaseService
    {
        // !!! ì¤‘ìš”: ë³¸ì¸ í™˜ê²½ì— ë§ëŠ” SQL Server ì—°ê²° ë¬¸ìì—´ë¡œ ë³€ê²½í•˜ì„¸ìš”. !!!
        private readonly string _connectionString = "Server=YOUR_SERVER_NAME;Database=YOUR_DATABASE;User Id=YOUR_USER;Password=YOUR_PASSWORD;";

        public async Task UploadLogAsync(LogEntry logEntry)
        {
            try
            {
                using (var connection = new SqlConnection(_connectionString))
                {
                    await connection.OpenAsync();
                    string query = @"
                        INSERT INTO LogEntries (FileModifiedUTC, FolderName, ProjectName, LogContent)
                        VALUES (@FileModifiedUTC, @FolderName, @ProjectName, @LogContent)";

                    using (var command = new SqlCommand(query, connection))
                    {
                        command.Parameters.AddWithValue("@FileModifiedUTC", logEntry.FileModifiedUTC);
                        command.Parameters.AddWithValue("@FolderName", logEntry.FolderName);
                        command.Parameters.AddWithValue("@ProjectName", logEntry.ProjectName);
                        command.Parameters.AddWithValue("@LogContent", (object)logEntry.LogContent ?? DBNull.Value);

                        await command.ExecuteNonQueryAsync();
                    }
                }
            }
            catch (Exception ex)
            {
                // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” íŒŒì¼ ë¡œê·¸ ë“±ìœ¼ë¡œ ì—ëŸ¬ë¥¼ ê¸°ë¡í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
                Console.WriteLine($"[DB Error] {ex.Message}");
                // ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ ì²˜ë¦¬ ë¡œì§ì´ ì¤‘ë‹¨ë˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                // throw; 
            }
        }
    }
}
""",

    "Services/SettingsService.cs": """using System;
using System.Collections.Generic;
using System.IO;
using System.Text.Json;
using System.Threading.Tasks;

namespace LogUploaderAgent.Services
{
    public class SettingsService
    {
        private readonly string _configFilePath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "appsettings.json");
        private const string HistoryFileName = "agent_history.log"; // ì´ë ¥ íŒŒì¼ëª…

        // ì „ì—­ ì„¤ì •: ëª¨ë‹ˆí„°ë§í•  í´ë” ëª©ë¡ ë¡œë“œ
        public async Task<List<string>> LoadMonitoredFoldersAsync()
        {
            if (!File.Exists(_configFilePath))
            {
                return new List<string>();
            }
            var json = await File.ReadAllTextAsync(_configFilePath);
            return JsonSerializer.Deserialize<List<string>>(json) ?? new List<string>();
        }

        // ì „ì—­ ì„¤ì •: ëª¨ë‹ˆí„°ë§í•  í´ë” ëª©ë¡ ì €ì¥
        public async Task SaveMonitoredFoldersAsync(IEnumerable<string> folders)
        {
            var json = JsonSerializer.Serialize(folders, new JsonSerializerOptions { WriteIndented = true });
            await File.WriteAllTextAsync(_configFilePath, json);
        }

        // í´ë”ë³„ ì´ë ¥: ë§ˆì§€ë§‰ ì²˜ë¦¬ ì‹œê°„ ë¡œë“œ
        public DateTime GetLastProcessedTime(string monitoredFolderPath)
        {
            string historyFilePath = Path.Combine(monitoredFolderPath, HistoryFileName);
            if (!File.Exists(historyFilePath))
            {
                // ì´ë ¥ íŒŒì¼ì´ ì—†ìœ¼ë©´ ì•„ì£¼ ì˜¤ë˜ëœ ì‹œê°„ì„ ë°˜í™˜í•˜ì—¬ ëª¨ë“  í´ë”ë¥¼ ê²€ì‚¬í•˜ë„ë¡ í•¨
                return DateTime.MinValue;
            }
            // ISO 8601 í˜•ì‹ (YYYY-MM-DDTHH:mm:ss.fffffffZ)ìœ¼ë¡œ ì €ì¥ëœ ì‹œê°„ ì½ê¸°
            var content = File.ReadAllText(historyFilePath);
            return DateTime.Parse(content, null, System.Globalization.DateTimeStyles.RoundtripKind);
        }

        // í´ë”ë³„ ì´ë ¥: ë§ˆì§€ë§‰ ì²˜ë¦¬ ì‹œê°„ ì €ì¥
        public void SetLastProcessedTime(string monitoredFolderPath, DateTime time)
        {
            string historyFilePath = Path.Combine(monitoredFolderPath, HistoryFileName);
            // ì‹œê°„ì„ UTCë¡œ, ê·¸ë¦¬ê³  ì¬íŒŒì‹±ì´ ìš©ì´í•œ ISO 8601 í˜•ì‹ìœ¼ë¡œ ì €ì¥
            File.WriteAllText(historyFilePath, time.ToUniversalTime().ToString("o"));
        }
    }
}
""",

    "Services/LogProcessingService.cs": """using System;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using LogUploaderAgent.Models;

namespace LogUploaderAgent.Services
{
    public class LogProcessingService
    {
        private readonly SettingsService _settingsService;
        private readonly DatabaseService _databaseService;
        private CancellationTokenSource _cancellationTokenSource;

        public LogProcessingService(SettingsService settingsService, DatabaseService databaseService)
        {
            _settingsService = settingsService;
            _databaseService = databaseService;
        }

        public void Start()
        {
            _cancellationTokenSource = new CancellationTokenSource();
            Task.Run(() => ProcessLoopAsync(_cancellationTokenSource.Token));
        }

        public void Stop()
        {
            _cancellationTokenSource?.Cancel();
        }

        private async Task ProcessLoopAsync(CancellationToken token)
        {
            while (!token.IsCancellationRequested)
            {
                var monitoredFolders = await _settingsService.LoadMonitoredFoldersAsync();

                foreach (var folderPath in monitoredFolders)
                {
                    if (token.IsCancellationRequested) break;
                    if (!Directory.Exists(folderPath)) continue;

                    try
                    {
                        await ProcessMonitoredFolderAsync(folderPath, token);
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"Error processing folder {folderPath}: {ex.Message}");
                    }
                }
                // ëª¨ë“  í´ë”ë¥¼ ìˆœíšŒí•œ í›„ ì ì‹œ ëŒ€ê¸°
                await Task.Delay(TimeSpan.FromSeconds(10), token);
            }
        }

        private async Task ProcessMonitoredFolderAsync(string monitoredPath, CancellationToken token)
        {
            var lastProcessedTime = _settingsService.GetLastProcessedTime(monitoredPath);

            var subDirectories = Directory.EnumerateDirectories(monitoredPath, "*", SearchOption.TopDirectoryOnly)
                .Select(path => new DirectoryInfo(path))
                .Where(di => di.LastWriteTime > lastProcessedTime) // ë§ˆì§€ë§‰ ì²˜ë¦¬ ì‹œê°„ ì´í›„ ìˆ˜ì •ëœ í´ë”ë§Œ
                .OrderBy(di => di.LastWriteTime) // ìˆ˜ì • ì‹œê°„ ì˜¤ë¦„ì°¨ìˆœ (ê³¼ê±°ë¶€í„°)
                .ToList();

            if (!subDirectories.Any()) return;

            var lastDirectory = subDirectories.Last();

            // ë§ˆì§€ë§‰ í´ë”ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í´ë” ì²˜ë¦¬
            foreach (var dir in subDirectories.Where(d => d.FullName != lastDirectory.FullName))
            {
                if (token.IsCancellationRequested) return;
                await ProcessSingleDirectoryAsync(dir, false, token);
                _settingsService.SetLastProcessedTime(monitoredPath, dir.LastWriteTime);
            }

            // ë§ˆì§€ë§‰ í´ë” íŠ¹ë³„ ì²˜ë¦¬
            await ProcessSingleDirectoryAsync(lastDirectory, true, token);
            _settingsService.SetLastProcessedTime(monitoredPath, lastDirectory.LastWriteTime);
        }

        private async Task ProcessSingleDirectoryAsync(DirectoryInfo targetDirectory, bool isLatest, CancellationToken token)
        {
            // 1. .proj íŒŒì¼ ê²€ì‚¬
            var projFile = targetDirectory.EnumerateFiles("*.proj")
                .OrderByDescending(f => f.LastWriteTime)
                .FirstOrDefault();

            if (projFile == null) return; // .proj íŒŒì¼ ì—†ìœ¼ë©´ ì²˜ë¦¬ ëŒ€ìƒ ì•„ë‹˜

            // 2. Histories í´ë” ë° bot_engine.log íŒŒì¼ ê²€ì‚¬
            var historiesDir = Path.Combine(targetDirectory.FullName, "Histories");
            if (!Directory.Exists(historiesDir)) return;

            var logFile = Directory.EnumerateDirectories(historiesDir)
                .Select(subDir => Path.Combine(subDir, "bot_engine.log"))
                .FirstOrDefault(File.Exists);

            if (logFile == null) return; // bot_engine.log íŒŒì¼ ì—†ìœ¼ë©´ ì²˜ë¦¬ ëŒ€ìƒ ì•„ë‹˜

            // 3. ë¡œê·¸ ì²˜ë¦¬
            if (isLatest)
            {
                await HandleLatestLogAsync(logFile, targetDirectory, projFile.Name, token);
            }
            else
            {
                await HandleNormalLogAsync(logFile, targetDirectory, projFile.Name);
            }
        }

        private async Task HandleNormalLogAsync(string logFilePath, DirectoryInfo directory, string projectName)
        {
            string contentToUpload = await ExtractStoppingContentAsync(logFilePath);
            if (!string.IsNullOrEmpty(contentToUpload))
            {
                await UploadData(logFilePath, directory, projectName, contentToUpload);
            }
        }

        private async Task HandleLatestLogAsync(string logFilePath, DirectoryInfo directory, string projectName, CancellationToken token)
        {
            while (!token.IsCancellationRequested)
            {
                // 1. ë‹¤ìŒ í´ë”ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
                var parentDir = directory.Parent.FullName;
                var nextDirExists = Directory.EnumerateDirectories(parentDir)
                                        .Any(d => new DirectoryInfo(d).LastWriteTime > directory.LastWriteTime);

                // 2. ì¢…ë£Œ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                var hasShutdownMessage = await CheckForShutdownMessageAsync(logFilePath);

                if (nextDirExists || hasShutdownMessage)
                {
                    // ë§ˆë¬´ë¦¬ ì‘ì—… ìˆ˜í–‰
                    string contentToUpload = await ExtractStoppingContentAsync(logFilePath);
                    if (!string.IsNullOrEmpty(contentToUpload))
                    {
                        await UploadData(logFilePath, directory, projectName, contentToUpload);
                    }
                    return; // ì²˜ë¦¬ ì™„ë£Œ í›„ ë£¨í”„ ì¢…ë£Œ
                }

                // ì¡°ê±´ ë¯¸ì¶©ì¡± ì‹œ 1ë¶„ ëŒ€ê¸°
                await Task.Delay(TimeSpan.FromMinutes(1), token);
            }
        }
        
        private async Task<string> ExtractStoppingContentAsync(string logFilePath)
        {
            try
            {
                // ì½ê¸°/ì“°ê¸° ê³µìœ  ëª¨ë“œë¡œ íŒŒì¼ ì—´ê¸°
                using (var fs = new FileStream(logFilePath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
                using (var sr = new StreamReader(fs, Encoding.UTF8))
                {
                    string fileContent = await sr.ReadToEndAsync();
                    const string marker = "### STATE:Stopping";
                    int index = fileContent.IndexOf(marker, StringComparison.Ordinal);

                    if (index != -1)
                    {
                        return fileContent.Substring(index);
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"[FileReadError] {logFilePath}: {ex.Message}");
            }
            return null;
        }

        private async Task<bool> CheckForShutdownMessageAsync(string logFilePath)
        {
            string lastLine = null;
            try
            {
                // ì½ê¸°/ì“°ê¸° ê³µìœ  ëª¨ë“œë¡œ íŒŒì¼ ì—´ê¸°
                using (var fs = new FileStream(logFilePath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
                using (var sr = new StreamReader(fs, Encoding.UTF8))
                {
                    string line;
                    while ((line = await sr.ReadLineAsync()) != null)
                    {
                        if (!string.IsNullOrWhiteSpace(line))
                        {
                            lastLine = line;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"[FileReadError] {logFilePath}: {ex.Message}");
                return false;
            }

            return lastLine?.Trim() == "Exit - Shutdown Engine BOT";
        }
        
        private async Task UploadData(string logFilePath, DirectoryInfo directory, string projectName, string content)
        {
            var logEntry = new LogEntry
            {
                FileModifiedUTC = File.GetLastWriteTimeUtc(logFilePath),
                FolderName = directory.Name,
                ProjectName = projectName,
                LogContent = content
            };
            await _databaseService.UploadLogAsync(logEntry);
            Console.WriteLine($"Uploaded log for: {directory.Name}");
        }
    }
}
""",

    "Models/LogEntry.cs": """using System;

namespace LogUploaderAgent.Models
{
    public class LogEntry
    {
        public DateTime FileModifiedUTC { get; set; }
        public string FolderName { get; set; }
        public string ProjectName { get; set; }
        public string LogContent { get; set; }
    }
}
""",

    "Utils/NotifyIconWrapper.cs": """using System;
using System.Drawing;
using System.Windows;
using System.Windows.Forms;

namespace LogUploaderAgent.Utils
{
    public class NotifyIconWrapper : IDisposable
    {
        private readonly NotifyIcon _notifyIcon;

        public NotifyIconWrapper()
        {
            _notifyIcon = new NotifyIcon();
            _notifyIcon.Icon = SystemIcons.Information; // ì•„ì´ì½˜ì„ ì›í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥
            _notifyIcon.Visible = true;

            var contextMenu = new ContextMenuStrip();
            contextMenu.Items.Add("ì„¤ì • (Settings)", null, OnSettingsClicked);
            contextMenu.Items.Add("ì¢…ë£Œ (Exit)", null, OnExitClicked);
            _notifyIcon.ContextMenuStrip = contextMenu;
        }

        public event EventHandler SettingsClicked;
        public event EventHandler ExitClicked;

        private void OnSettingsClicked(object sender, EventArgs e)
        {
            SettingsClicked?.Invoke(this, EventArgs.Empty);
        }

        private void OnExitClicked(object sender, EventArgs e)
        {
            ExitClicked?.Invoke(this, EventArgs.Empty);
        }

        public void Dispose()
        {
            _notifyIcon.Dispose();
        }
    }
}
"""
}

# --- ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë¡œì§ ---
if __name__ == "__main__":
    # í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë” ìƒì„±
    if not os.path.exists(PROJECT_ROOT):
        os.makedirs(PROJECT_ROOT)

    # ì •ì˜ëœ íŒŒì¼ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° íŒŒì¼ ìƒì„±
    for file_path, content in project_files.items():
        full_path = os.path.join(PROJECT_ROOT, file_path)
        
        # íŒŒì¼ì´ ìœ„ì¹˜í•  ë””ë ‰í† ë¦¬ ìƒì„± (ì˜ˆ: Views, Services ë“±)
        directory = os.path.dirname(full_path)
        if not os.path.exists(directory):
            os.makedirs(directory)
            print(f"  ë””ë ‰í† ë¦¬ ìƒì„±: {directory}")

        # íŒŒì¼ ì“°ê¸° (UTF-8 ì¸ì½”ë”©)
        with open(full_path, "w", encoding="utf-8") as f:
            f.write(content)
        print(f"  íŒŒì¼ ìƒì„± ì™„ë£Œ: {full_path}")
    
    print("\nâœ… ëª¨ë“  íŒŒì¼ì´ 'LogUploaderAgent' í´ë” ë‚´ì— ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print("\në‹¤ìŒ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ì„¸ìš”:")
    print("1. Visual Studioì—ì„œ 'ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°' -> 'WPF ì•±(.NET Framework)' ì„ íƒ -> í”„ë¡œì íŠ¸ ì´ë¦„ 'LogUploaderAgent'ë¡œ ì„¤ì •.")
    print("2. ìƒì„±ëœ í”„ë¡œì íŠ¸ í´ë”ì˜ ë‚´ìš©ì„, ì´ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë§Œë“  'LogUploaderAgent' í´ë”ì˜ íŒŒì¼ë“¤ë¡œ ëª¨ë‘ ë®ì–´ì“°ê¸° í•˜ì„¸ìš”.")
    print("3. Visual Studioì˜ ì†”ë£¨ì…˜ íƒìƒ‰ê¸°ì—ì„œ 'ëª¨ë“  íŒŒì¼ í‘œì‹œ'ë¥¼ ì¼  í›„, ì¶”ê°€ëœ íŒŒì¼ë“¤ì„ ìš°í´ë¦­ -> 'í”„ë¡œì íŠ¸ì— í¬í•¨'ì„ ì„ íƒí•˜ì„¸ìš”.")
    print("4. [ì¤‘ìš”] NuGet íŒ¨í‚¤ì§€ ê´€ë¦¬ìì—ì„œ 'System.Data.SqlClient', 'System.Text.Json'ì„ ì„¤ì¹˜í•˜ì„¸ìš”.")
    print("5. [ì¤‘ìš”] ì†”ë£¨ì…˜ íƒìƒ‰ê¸° -> 'ì°¸ì¡°' ìš°í´ë¦­ -> 'ì°¸ì¡° ì¶”ê°€' -> 'System.Windows.Forms'ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì²´í¬í•˜ê³  ì¶”ê°€í•˜ì„¸ìš”.")
    print("6. 'Services/DatabaseService.cs' íŒŒì¼ì˜ ì—°ê²° ë¬¸ìì—´ì„ ìì‹ ì˜ DB í™˜ê²½ì— ë§ê²Œ ìˆ˜ì • í›„ ë¹Œë“œ/ì‹¤í–‰í•˜ì„¸ìš”.")
ìƒì„±ëœ íŒŒì¼ ì‚¬ìš© ê°€ì´ë“œ ğŸ› ï¸
ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„, ìƒì„±ëœ LogUploaderAgent í´ë”ë¥¼ Visual Studio .NET 4.8 í”„ë¡œì íŠ¸ë¡œ ë¡œë“œí•˜ëŠ” ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±: Visual Studio 2022 ë“±ì—ì„œ WPF ì•±(.NET Framework) í…œí”Œë¦¿ì„ ì„ íƒí•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤. ì´ë•Œ í”„ë¡œì íŠ¸ ì´ë¦„ì€ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±í•œ í´ë”ëª…ê³¼ ë™ì¼í•œ **LogUploaderAgent**ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

íŒŒì¼ ë®ì–´ì“°ê¸°: íŒŒì¼ íƒìƒ‰ê¸°ë¥¼ ì—´ì–´ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±í•œ LogUploaderAgent í´ë” ì•ˆì˜ ëª¨ë“  íŒŒì¼ê³¼ í´ë”ë¥¼ ë³µì‚¬í•œ í›„, ë°©ê¸ˆ Visual Studioê°€ ìƒì„±í•œ í”„ë¡œì íŠ¸ í´ë”ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ì–´ ëª¨ë“  íŒŒì¼ì„ ë®ì–´ì”ë‹ˆë‹¤.

í”„ë¡œì íŠ¸ì— íŒŒì¼ í¬í•¨: Visual Studioë¡œ ëŒì•„ì™€ ì†”ë£¨ì…˜ íƒìƒ‰ê¸° ìƒë‹¨ì˜ ëª¨ë“  íŒŒì¼ í‘œì‹œ ì•„ì´ì½˜ì„ í´ë¦­í•©ë‹ˆë‹¤. íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œëœ íŒŒì¼ ë° í´ë”ë“¤ì„ ëª¨ë‘ ì„ íƒí•˜ê³  ë§ˆìš°ìŠ¤ ìš°í´ë¦­ í›„ **í”„ë¡œì íŠ¸ì— í¬í•¨**ì„ ì„ íƒí•©ë‹ˆë‹¤.

ì°¸ì¡° ì¶”ê°€ ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜:

NuGet íŒ¨í‚¤ì§€: ë„êµ¬ > NuGet íŒ¨í‚¤ì§€ ê´€ë¦¬ì > ì†”ë£¨ì…˜ìš© NuGet íŒ¨í‚¤ì§€ ê´€ë¦¬...ë¡œ ì´ë™í•˜ì—¬ ë‹¤ìŒ ë‘ íŒ¨í‚¤ì§€ë¥¼ ê²€ìƒ‰í•˜ê³  ì„¤ì¹˜í•©ë‹ˆë‹¤.

System.Data.SqlClient

System.Text.Json

ì–´ì…ˆë¸”ë¦¬ ì°¸ì¡°: ì†”ë£¨ì…˜ íƒìƒ‰ê¸°ì—ì„œ ì°¸ì¡° í•­ëª©ì„ ë§ˆìš°ìŠ¤ ìš°í´ë¦­ > ì°¸ì¡° ì¶”ê°€...ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ì™¼ìª½ì˜ ì–´ì…ˆë¸”ë¦¬ íƒ­ì—ì„œ **System.Windows.Forms**ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì²´í¬í•˜ê³  í™•ì¸ì„ ëˆ„ë¦…ë‹ˆë‹¤.