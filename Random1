using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Windows.Forms;

namespace WakeOnLANApp
{
    public partial class MainForm : Form
    {
        private const int WOL_PORT = 9;
        private const string MAC_ADDRESS = "00:11:22:33:44:55"; // 대상 컴퓨터의 MAC 주소

        public MainForm()
        {
            InitializeComponent();
        }

        private void btnWake_Click(object sender, EventArgs e)
        {
            SendWakeOnLanPacket(MAC_ADDRESS);
        }

        private void SendWakeOnLanPacket(string macAddress)
        {
            try
            {
                byte[] macBytes = ParseMacAddress(macAddress);
                byte[] magicPacket = CreateMagicPacket(macBytes);

                UdpClient udpClient = new UdpClient();
                udpClient.Send(magicPacket, magicPacket.Length, new IPEndPoint(IPAddress.Broadcast, WOL_PORT));
                udpClient.Close();

                MessageBox.Show("WOL 패킷을 성공적으로 전송했습니다.");
            }
            catch (Exception ex)
            {
                MessageBox.Show("WOL 패킷 전송 중 오류가 발생했습니다: " + ex.Message);
            }
        }

        private byte[] ParseMacAddress(string macAddress)
        {
            byte[] macBytes = new byte[6];
            string[] hexValues = macAddress.Split(':');

            for (int i = 0; i < 6; i++)
            {
                macBytes[i] = Convert.ToByte(hexValues[i], 16);
            }

            return macBytes;
        }

        private byte[] CreateMagicPacket(byte[] macBytes)
        {
            byte[] magicPacket = new byte[102];

            for (int i = 0; i < 6; i++)
            {
                magicPacket[i] = 0xFF;
            }

            for (int i = 6; i < 102; i += 6)
            {
                Array.Copy(macBytes, 0, magicPacket, i, 6);
            }

            return magicPacket;
        }
    }
}
