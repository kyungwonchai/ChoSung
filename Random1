using DevExpress.XtraRichEdit;
using System;
using System.Data;
using System.Drawing;
using System.Threading.Tasks;
using System.Windows.Forms;

// 백그라운드 작업을 위한 비동기 메서드
private async Task UpdateRichEditControlAsync(DataTable dataTable, RichEditControl richEditControl)
{
    // DataTable의 내용을 표 형태로 변환하여 HTML 생성
    string tableHtml = ConvertDataTableToHtml(dataTable);

    // 백그라운드에서 RichEditControl 업데이트
    await Task.Run(() =>
    {
        richEditControl.Invoke(new MethodInvoker(() =>
        {
            // RichEditControl에 표 형태의 내용 설정
            richEditControl.Document.BeginUpdate();
            richEditControl.Document.HtmlText = tableHtml;

            // 추가적인 스타일 적용
            DocumentRange range = richEditControl.Document.Range;
            CharacterProperties cp = richEditControl.Document.BeginUpdateCharacters(range);
            cp.FontName = "Arial";
            cp.FontSize = 10;
            richEditControl.Document.EndUpdateCharacters(cp);
            richEditControl.Document.Paragraphs.Last.Alignment = ParagraphAlignment.Center;

            // 테이블 데이터 스타일 설정
            for (int rowIndex = 1; rowIndex <= dataTable.Rows.Count; rowIndex++)
            {
                TableRow row = richEditControl.Document.Tables[0].Rows[rowIndex];
                int secondColValue = Convert.ToInt32(dataTable.Rows[rowIndex - 1][1]);
                int fourthColValue = Convert.ToInt32(dataTable.Rows[rowIndex - 1][3]);
                if (secondColValue < fourthColValue)
                {
                    foreach (TableCell cell in row.Cells)
                    {
                        cell.BackColor = Color.Yellow;
                    }
                }
            }

            richEditControl.Document.EndUpdate();
        }));
    });
}

// DataTable을 HTML 표 형태로 변환하는 메서드
private string ConvertDataTableToHtml(DataTable dataTable)
{
    string html = "<table style=\"border-collapse: collapse;\">";

    // 테이블 헤더 생성
    html += "<tr style=\"background-color: #ADD8E6;\">";
    foreach (DataColumn column in dataTable.Columns)
    {
        html += "<th style=\"border: 1px solid #000; padding: 8px;\">" + column.ColumnName + "</th>";
    }
    html += "</tr>";

    // 테이블 데이터 생성
    foreach (DataRow row in dataTable.Rows)
    {
        html += "<tr>";
        foreach (object item in row.ItemArray)
        {
            html += "<td style=\"border: 1px solid #000; padding: 8px;\">" + item.ToString() + "</td>";
        }
        html += "</tr>";
    }

    html += "</table>";

    return html;
}

// 예시로 사용하는 메서드
private async void LoadDataInBackground()
{
    // 예시로 DataTable 생성
    DataTable dataTable = new DataTable();
    dataTable.Columns.Add("Name", typeof(string));
    dataTable.Columns.Add("Age", typeof(int));
    dataTable.Columns.Add("Date", typeof(string));
    dataTable.Columns.Add("Remaining Days", typeof(int));
    dataTable.Rows.Add("John Doe", 30, "2021-09-01", 5);
    dataTable.Rows.Add("Jane Smith", 25, "2021-09-02", 10);

    // RichEditControl 업데이트를 백그라운드로 실행
    await UpdateRichEditControlAsync(dataTable, richEditControl1);
}
