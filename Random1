import pymysql
from datetime import datetime, timedelta

# MySQL 연결 정보 설정
db_config = {
    "host": "your_mysql_host",   # MySQL 서버 주소
    "user": "your_username",      # 사용자명
    "password": "your_password",  # 비밀번호
    "database": "smd",            # 데이터베이스명
    "charset": "utf8mb4"
}

# 최근 7일 기준 날짜 계산
seven_days_ago = (datetime.now() - timedelta(days=7)).strftime('%Y-%m-%d %H:%M:%S')

# SQL 쿼리 작성
query = """
SELECT barcode, model, point 
FROM repair_instock
WHERE insertedtime >= %s
AND modelchk IS NULL
"""

# MySQL 데이터 조회 및 반복 처리
try:
    conn = pymysql.connect(**db_config)
    cursor = conn.cursor()

    # SQL 실행
    cursor.execute(query, (seven_days_ago,))

    # 결과를 하나씩 가져와서 처리
    for row in cursor.fetchall():
        barcode, model, point = row
        print(f"Processing barcode: {barcode}")  # 각 행에 대해 처리 진행
        print(f"Model: {model}, Point: {point}")
        
        # 여기에 추가적인 데이터 처리 로직을 넣을 수 있음
        # 예: 특정 로직 적용, API 호출, 파일 저장 등

except Exception as e:
    print(f"Error: {e}")

finally:
    # 연결 종료
    cursor.close()
    conn.close()
