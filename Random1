í˜•ë‹˜, ì œê°€ ì¤‘ìš”í•œ ë””í…Œì¼ì„ ë†“ì³¤êµ°ìš”. ì£„ì†¡í•©ë‹ˆë‹¤! ìš”ì²­í•˜ì‹  ë‚´ìš©ì„ ëª…í™•íˆ ì¸ì§€í–ˆìŠµë‹ˆë‹¤.

í™”ì‚´í‘œ ìˆ˜ì •: 'í™”ë©´ ì „ì²´ë¥¼ ê°€ë¡œì§€ë¥´ëŠ” ê¸´ í™”ì‚´í‘œ'ë¥¼ ì›í•˜ì‹ ë‹¤ëŠ” ë§ì”€ì´ì…¨ë„¤ìš”. ê¸°ì¡´ì˜ ic_thick_arrow ì•„ì´ì½˜ ëŒ€ì‹ , í™”ë©´ ì¤‘ì•™ì— ê¸¸ê²Œ ê°€ë¡œì§€ë¥´ëŠ” í˜•íƒœë¡œ ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤. ê¸°ì¡´ êº½ì‡  ëª¨ì–‘ì´ ì•„ë‹ˆë¼ ê¸´ ì§ì„  í™”ì‚´í‘œë¡œìš”.

í™”ë©´ íšŒì „ ì‹œ í° í™”ë©´ ë¬¸ì œ: ê¸°ê¸° íšŒì „(ë°©í–¥ ì „í™˜) ì‹œ PDF ë·°ê°€ ê¹œë¹¡ì´ê±°ë‚˜ í•˜ì–—ê²Œ ë³€í•˜ëŠ” í˜„ìƒì€, ë³´í†µ Activityê°€ ì¬ì‹œì‘ë˜ë©´ì„œ PDF ë·°ì˜ ìƒíƒœê°€ ì´ˆê¸°í™”ë  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

ë‘ ê°€ì§€ ë¬¸ì œ ëª¨ë‘ í™•ì‹¤íˆ ìˆ˜ì •í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## 1. 'í™”ë©´ ê°€ë¡œì§€ë¥´ëŠ” ê¸´ í™”ì‚´í‘œ' ì•„ì´ì½˜ ì¶”ê°€
ê¸°ì¡´ ic_thick_arrow.xml íŒŒì¼ì€ ì‚­ì œí•˜ê³ , res/drawable í´ë”ì— ic_long_arrow_down.xml íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“¤ì–´ ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì´ ì•„ì´ì½˜ì€ í™”ë©´ì˜ íš¡ìœ¼ë¡œ ê¸¸ê²Œ ë»—ì€ í™”ì‚´í‘œì…ë‹ˆë‹¤.

<details>
<summary><strong>res/drawable/ic_long_arrow_down.xml (ìƒˆ íŒŒì¼) - (í´ë¦­í•˜ì—¬ ì½”ë“œ ë³´ê¸°)</strong></summary>

XML

<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="200dp" android:height="24dp"
    android:viewportWidth="200" android:viewportHeight="24">
    <path
        android:fillColor="#FFFFFF"
        android:pathData="M100,20 L100,4 L190,12 L100,20 M10,12 L180,12" />
</vector>
</details>

ì°¸ê³ : 200dpë¡œ ë„ˆë¹„ë¥¼ ì§€ì •í–ˆì§€ë§Œ, activity_main.xmlì—ì„œ layout_width="match_parent"ë¥¼ ì§€ì •í•˜ì—¬ ì‹¤ì œë¡œëŠ” í™”ë©´ ê°€ë“ ì±„ì›Œì§€ê²Œ ë©ë‹ˆë‹¤.

## 2. activity_main.xml í™”ì‚´í‘œ ì´ë¯¸ì§€ë·° ìˆ˜ì •
í™”ì‚´í‘œ ì´ë¯¸ì§€ë·°ê°€ í™”ë©´ ë„ˆë¹„ì— ë§ì¶° ê¸¸ê²Œ ëŠ˜ì–´ë‚˜ë„ë¡ layout_widthë¥¼ match_parentë¡œ ë°”ê¾¸ê³ , ìƒˆë¡œìš´ ì•„ì´ì½˜ì„ ì ìš©í•©ë‹ˆë‹¤.

activity_main.xml íŒŒì¼ ì „ì²´ë¥¼ ì•„ë˜ ì½”ë“œë¡œ êµì²´í•´ì£¼ì„¸ìš”.

XML

<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="8dp"
    tools:context=".MainActivity">

    <com.kyungwon.reellistviewer.CompassView
        android:id="@+id/compassView"
        android:layout_width="50dp"
        android:layout_height="50dp"
        android:layout_alignParentTop="true"
        android:layout_alignParentEnd="true"
        android:clickable="true"
        android:focusable="true" />
    <Button
        android:id="@+id/btnOpenFile"
        android:layout_width="wrap_content"
        android:layout_height="40dp"
        android:layout_alignParentTop="true"
        android:layout_marginTop="5dp"
        android:layout_marginEnd="8dp"
        android:layout_toStartOf="@id/compassView"
        android:background="@drawable/button_gradient_purple"
        android:paddingHorizontal="16dp"
        android:text="Open ReelList"
        android:textColor="@android:color/white" />
    <TextView
        android:id="@+id/tvFileName"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_alignParentStart="true"
        android:layout_alignParentTop="true"
        android:layout_centerVertical="true"
        android:layout_marginTop="12dp"
        android:layout_toStartOf="@id/btnOpenFile"
        android:ellipsize="end"
        android:maxLines="1"
        android:textSize="16sp"
        android:textStyle="bold"
        tools:text="ì—´ë¦° íŒŒì¼ ì´ë¦„" />

    <LinearLayout
        android:id="@+id/pageButtonContainer"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_below="@id/btnOpenFile"
        android:layout_marginTop="8dp"
        android:orientation="vertical"
        android:visibility="gone"
        tools:visibility="visible">

        <FrameLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content">

            <LinearLayout
                android:id="@+id/topButtonRow"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal" />

            <ImageView
                android:id="@+id/ivTopRowArrow"
                android:layout_width="match_parent" android:layout_height="wrap_content"
                android:layout_gravity="center_vertical"
                android:src="@drawable/ic_long_arrow_down" android:visibility="gone"
                android:clickable="false"
                android:focusable="false"
                tools:visibility="visible"/>

        </FrameLayout>

        <LinearLayout
            android:id="@+id/bottomButtonRow"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal" />
    </LinearLayout>

</RelativeLayout>
## 3. AndroidManifest.xml íšŒì „ ì‹œ Activity ì¬ì‹œì‘ ë°©ì§€
í™”ë©´ íšŒì „ ì‹œ Activityê°€ ì¬ì‹œì‘ë˜ëŠ” ê²ƒì„ ë§‰ê³ , Activityê°€ ì§ì ‘ ë³€ê²½ ì‚¬í•­ì„ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ PDF ë·°ê°€ ë‹¤ì‹œ ë¡œë“œë˜ì§€ ì•Šì•„ í° í™”ë©´ì´ ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AndroidManifest.xml íŒŒì¼ì˜ MainActivity ì •ì˜ ë¶€ë¶„ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ì„¸ìš”.

XML

<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" android:maxSdkVersion="28" />
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />
    <uses-permission android:name="android.permission.READ_MEDIA_VIDEO" />
    <uses-permission android:name="android.permission.READ_MEDIA_AUDIO" />

    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.ReelListViewer"
        android:usesCleartextTraffic="true"
        tools:targetApi="31">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:configChanges="orientation|screenSize|screenLayout|keyboardHidden|smallestScreenSize" android:launchMode="singleTask">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>

</manifest>
ìˆ˜ì •ëœ ë¶€ë¶„: <activity> íƒœê·¸ ì•ˆì— android:configChanges="orientation|screenSize|screenLayout|keyboardHidden|smallestScreenSize" ì†ì„±ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ ì†ì„±ì€ í™”ë©´ ë°©í–¥, í¬ê¸° ë“±ì˜ ë³€ê²½ì´ ë°œìƒí–ˆì„ ë•Œ Activityë¥¼ ì¬ì‹œì‘í•˜ëŠ” ëŒ€ì‹ , onConfigurationChanged() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì‹œìŠ¤í…œì— ì•Œë¦½ë‹ˆë‹¤.

## 4. MainActivity.kt í™”ì‚´í‘œ ê°€ì‹œì„± ë° ìƒ‰ìƒ ì¡°ì •
ì´ì œ regenerateButtons í•¨ìˆ˜ì—ì„œ í™”ì‚´í‘œì˜ ê°€ì‹œì„±ë§Œ ì œì–´í•˜ë©´ ë©ë‹ˆë‹¤. (ì´ì „ MainActivity.kt ë¡œì§ì—ì„œëŠ” í™”ì‚´í‘œì˜ tintë¥¼ ë³€ê²½í•˜ëŠ” ë¶€ë¶„ì´ ì—†ì—ˆìœ¼ë¯€ë¡œ, í™”ì‚´í‘œ fillColorë¥¼ í°ìƒ‰(@android:color/white)ìœ¼ë¡œ ì§ì ‘ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ .tint ì†ì„±ì„ ì¡°ì •í•˜ì—¬ ìƒ‰ìƒì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

MainActivity.kt íŒŒì¼ ì „ì²´ë¥¼ ì•„ë˜ ì½”ë“œë¡œ êµì²´í•´ì£¼ì„¸ìš”.

Kotlin

package com.kyungwon.reellistviewer

import android.content.Context
import android.graphics.Typeface
import android.hardware.Sensor
import android.hardware.SensorEvent
import android.hardware.SensorEventListener
import android.hardware.SensorManager
import android.os.Bundle
import android.util.Log
import android.view.GestureDetector
import android.view.MotionEvent
import android.view.View
import android.widget.Button
import android.widget.LinearLayout
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.core.content.ContextCompat
import androidx.core.view.GestureDetectorCompat
import androidx.core.view.WindowCompat
import androidx.core.view.WindowInsetsCompat
import androidx.core.view.WindowInsetsControllerCompat
import androidx.core.view.setMargins
import androidx.lifecycle.lifecycleScope
import com.github.barteksc.pdfviewer.listener.OnLoadCompleteListener
import com.github.barteksc.pdfviewer.listener.OnPageErrorListener
import com.kyungwon.reellistviewer.databinding.ActivityMainBinding
import jcifs.CIFSContext
import jcifs.config.PropertyConfiguration
import jcifs.context.BaseContext
import jcifs.smb.NtlmPasswordAuthenticator
import jcifs.smb.SmbFile
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.util.Properties

class MainActivity : AppCompatActivity(), OnLoadCompleteListener, OnPageErrorListener, SensorEventListener {

    private lateinit var binding: ActivityMainBinding
    private val SMB_IP = "192.1.1.5"
    private val SMB_SHARED_FOLDER = "tempshare"
    private val SMB_USER = "win10"
    private val SMB_PASS = "tltmxpa2@"
    private var totalPdfPages = 0
    private val skippedButtons = mutableSetOf<Int>()
    private val currentButtons = mutableListOf<Button>()
    private var selectedButton: Button? = null
    private lateinit var gestureDetector: GestureDetectorCompat
    private var tappedButton: Button? = null
    private lateinit var sensorManager: SensorManager
    private val accelerometerReading = FloatArray(3)
    private val magnetometerReading = FloatArray(3)
    private val rotationMatrix = FloatArray(9)
    private val orientationAngles = FloatArray(3)
    private var isGeomagneticModeOn = false
    private var currentDirection = Direction.OTHER

    enum class Direction { EAST, WEST, OTHER }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        hideSystemUI()
        setupGestureDetector()
        setupEventListeners()
        sensorManager = getSystemService(Context.SENSOR_SERVICE) as SensorManager
    }

    override fun onResume() {
        super.onResume()
        hideSystemUI()
        sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
        sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD)?.also {
            sensorManager.registerListener(this, it, SensorManager.SENSOR_DELAY_UI)
        }
    }

    override fun onPause() {
        super.onPause()
        sensorManager.unregisterListener(this)
    }

    private fun hideSystemUI() {
        WindowCompat.setDecorFitsSystemWindows(window, false)
        val controller = WindowInsetsControllerCompat(window, binding.root)
        controller.hide(WindowInsetsCompat.Type.systemBars())
        controller.systemBarsBehavior = WindowInsetsControllerCompat.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE
    }

    private fun setupGestureDetector() {
        gestureDetector = GestureDetectorCompat(this, object : GestureDetector.SimpleOnGestureListener() {
            override fun onSingleTapConfirmed(e: MotionEvent): Boolean {
                tappedButton?.let { onPageButtonClick(it) }
                return true
            }
            override fun onDoubleTap(e: MotionEvent): Boolean {
                tappedButton?.let {
                    onPageButtonClick(it)
                    binding.pdfView.resetZoom()
                    Toast.makeText(this@MainActivity, "í™”ë©´ì— ë§ì¶¤", Toast.LENGTH_SHORT).show()
                }
                return true
            }
            override fun onLongPress(e: MotionEvent) {
                tappedButton?.let { onPageButtonLongClick(it) }
            }
        })
    }

    private fun setupEventListeners() {
        binding.btnOpenFile.setOnLongClickListener {
            lifecycleScope.launch(Dispatchers.IO) { showPdfListFromSmb() }
            Toast.makeText(this, "íŒŒì¼ ëª©ë¡ì„ ì—½ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
            true
        }
        binding.compassView.setOnLongClickListener {
            isGeomagneticModeOn = !isGeomagneticModeOn
            val modeText = if (isGeomagneticModeOn) "On" else "Off"
            Toast.makeText(this, "ì§€ìê³„ ì˜ì¡´ ëª¨ë“œ: $modeText", Toast.LENGTH_SHORT).show()
            binding.compassView.setGeomagneticMode(isGeomagneticModeOn)
            if (!isGeomagneticModeOn) {
                currentDirection = Direction.OTHER
            }
            updateButtonsAndUI()
            true
        }
    }

    override fun loadComplete(nbPages: Int) {
        totalPdfPages = nbPages
        skippedButtons.clear()
        selectedButton = null
        binding.pageButtonContainer.visibility = View.VISIBLE
        isGeomagneticModeOn = false
        binding.compassView.setGeomagneticMode(false)
        updateButtonsAndUI()
    }

    private fun updateButtonsAndUI() {
        var requiredLogicalButtons=0;var physicalPageCounter=0;var logicalButtonCounter=0
        while(physicalPageCounter<totalPdfPages){logicalButtonCounter++;if(!skippedButtons.contains(logicalButtonCounter)){physicalPageCounter++}};requiredLogicalButtons=logicalButtonCounter
        val currentButtonCount=currentButtons.size
        var newButtonCount=if(requiredLogicalButtons%2!=0)requiredLogicalButtons+1 else requiredLogicalButtons
        if(totalPdfPages>0&&newButtonCount==0)newButtonCount=2;newButtonCount=maxOf(newButtonCount,currentButtonCount)
        regenerateButtons(newButtonCount)
        updateAllButtonStyles()
    }

    private fun regenerateButtons(count: Int) {
        binding.topButtonRow.removeAllViews()
        binding.bottomButtonRow.removeAllViews()
        currentButtons.clear()

        val buttonHeight = dpToPx(44)
        val margin = dpToPx(2)
        val buttonParams = LinearLayout.LayoutParams(0, buttonHeight, 1.0f)
        buttonParams.setMargins(margin)
        
        // ğŸ’¡ ì§€ìê³„ ëª¨ë“œ ONì¼ ë•Œë§Œ í™”ì‚´í‘œ í‘œì‹œ
        binding.ivTopRowArrow.visibility = if (isGeomagneticModeOn) View.VISIBLE else View.GONE
        
        // ğŸ’¡ í˜„ì¬ ë°©í–¥ì— ë”°ë¼ í™€ìˆ˜/ì§ìˆ˜ ë²„íŠ¼ì´ ë“¤ì–´ê°ˆ í–‰ì„ ê²°ì •
        // LTR(ì„œìª½) ë°©í–¥ì¼ ë•Œ: í™€ìˆ˜ í–‰ì´ ì•„ë˜ (bottomButtonRow), ì§ìˆ˜ í–‰ì´ ìœ„ (topButtonRow)
        // RTL(ë™ìª½) ë°©í–¥ì¼ ë•Œ: ì§ìˆ˜ í–‰ì´ ì•„ë˜ (bottomButtonRow), í™€ìˆ˜ í–‰ì´ ìœ„ (topButtonRow)
        val (oddRowContainer, evenRowContainer) = when {
            isGeomagneticModeOn && currentDirection == Direction.WEST -> binding.bottomButtonRow to binding.topButtonRow
            isGeomagneticModeOn && currentDirection == Direction.EAST -> binding.topButtonRow to binding.bottomButtonRow
            else -> binding.topButtonRow to binding.bottomButtonRow // ì§€ìê³„ OFF ë˜ëŠ” OTHER ë°©í–¥ì¼ ë•ŒëŠ” ê¸°ë³¸ê°’ (í™€ìˆ˜ ìœ„, ì§ìˆ˜ ì•„ë˜)
        }

        // ğŸ’¡ ë°©í–¥ì— ë”°ë¥¸ ì •ë ¬ ë°©ì‹ ê²°ì •
        val isRtl = isGeomagneticModeOn && currentDirection == Direction.EAST

        for (i in 1..count) {
            val button = createPageButton(i, buttonParams.also { it.height = buttonHeight })
            if (i % 2 != 0) { // í™€ìˆ˜ ë²„íŠ¼
                if (isRtl) oddRowContainer.addView(button, 0) else oddRowContainer.addView(button)
            } else { // ì§ìˆ˜ ë²„íŠ¼
                if (isRtl) evenRowContainer.addView(button, 0) else evenRowContainer.addView(button)
            }
            currentButtons.add(button)
        }
    }

    private fun createPageButton(number: Int, layoutParams: LinearLayout.LayoutParams? = null): Button {
        return Button(this).apply {
            text = number.toString(); tag = number
            layoutParams?.let { this.layoutParams = it }
            textSize = 20f; typeface = Typeface.DEFAULT_BOLD
            setOnTouchListener { view, event ->
                tappedButton = view as Button
                gestureDetector.onTouchEvent(event)
                true
            }
        }
    }

    private fun updateAllButtonStyles() {
        if (isGeomagneticModeOn) {
            for (button in currentButtons) {
                val buttonNumber = button.tag as Int
                val isActiveRow = when {
                    currentDirection == Direction.WEST -> buttonNumber % 2 != 0 // ì„œìª½ì¼ ë•Œ í™€ìˆ˜ í–‰ í™œì„±
                    currentDirection == Direction.EAST -> buttonNumber % 2 == 0 // ë™ìª½ì¼ ë•Œ ì§ìˆ˜ í–‰ í™œì„±
                    else -> false // ê·¸ ì™¸ ë°©í–¥ì—ì„œëŠ” í™œì„± í–‰ ì—†ìŒ (ê¸°ë³¸ ìŠ¤íƒ€ì¼)
                }

                when {
                    button == selectedButton -> {
                        button.setBackgroundResource(R.drawable.button_bg_geo_selected)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.white))
                    }
                    skippedButtons.contains(buttonNumber) -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_skipped_dark)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                    }
                    isActiveRow && mapLogicalToPhysical(buttonNumber) in 1..totalPdfPages -> {
                        button.setBackgroundResource(R.drawable.button_bg_geo_active)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    }
                    else -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_normal)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    }
                }
            }
        } else { // ì§€ìê³„ ëª¨ë“œ OFF (ì´ì „ê³¼ ë™ì¼)
            for (button in currentButtons) {
                val buttonNumber = button.tag as Int
                if (button == selectedButton) {
                    button.setBackgroundResource(R.drawable.button_bg_page_selected)
                    button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                    continue
                }
                when {
                    skippedButtons.contains(buttonNumber) -> {
                        button.setBackgroundResource(R.drawable.button_bg_page_skipped_dark)
                        button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                    }
                    else -> {
                        val physicalPage = mapLogicalToPhysical(buttonNumber)
                        if (physicalPage in 1..totalPdfPages) {
                            button.setBackgroundResource(R.drawable.button_bg_page_normal)
                            button.setTextColor(ContextCompat.getColor(this, android.R.color.black))
                        } else {
                            button.setBackgroundResource(R.drawable.button_border_invalid)
                            button.setTextColor(ContextCompat.getColor(this, android.R.color.darker_gray))
                        }
                    }
                }
            }
        }
    }

    private fun mapLogicalToPhysical(logicalButtonNum: Int): Int {
        val skipsBefore = skippedButtons.count { it < logicalButtonNum }
        return logicalButtonNum - skipsBefore
    }

    private fun onPageButtonClick(button: Button) {
        val buttonNumber = button.tag as Int
        if (skippedButtons.contains(buttonNumber)) {
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ëŠ” ìŠ¤í‚µë˜ì—ˆìŠµë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
            return
        }
        val physicalPage = mapLogicalToPhysical(buttonNumber)
        if (physicalPage in 1..totalPdfPages) {
            binding.pdfView.jumpTo(physicalPage - 1, false)
            selectedButton = button
            updateAllButtonStyles()
        } else {
            Toast.makeText(this, "ë‚´ìš©ì´ ì—†ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.", Toast.LENGTH_SHORT).show()
        }
    }

    private fun onPageButtonLongClick(view: View) {
        val button = view as Button; val buttonNumber = button.tag as Int
        if (skippedButtons.contains(buttonNumber)) {
            skippedButtons.remove(buttonNumber)
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ ìŠ¤í‚µ í•´ì œ", Toast.LENGTH_SHORT).show()
        } else {
            skippedButtons.add(buttonNumber)
            Toast.makeText(this, "$buttonNumber í˜ì´ì§€ ìŠ¤í‚µ ì„¤ì •", Toast.LENGTH_SHORT).show()
            if (selectedButton == button) { selectedButton = null }
        }
        updateButtonsAndUI()
    }

    override fun onAccuracyChanged(sensor: Sensor?, accuracy: Int) {}

    override fun onSensorChanged(event: SensorEvent) {
        if (event.sensor.type == Sensor.TYPE_ACCELEROMETER) {
            System.arraycopy(event.values, 0, accelerometerReading, 0, accelerometerReading.size)
        } else if (event.sensor.type == Sensor.TYPE_MAGNETIC_FIELD) {
            System.arraycopy(event.values, 0, magnetometerReading, 0, magnetometerReading.size)
        }
        SensorManager.getRotationMatrix(rotationMatrix, null, accelerometerReading, magnetometerReading)
        SensorManager.getOrientation(rotationMatrix, orientationAngles)
        val azimuthInDegrees = Math.toDegrees(orientationAngles[0].toDouble()).toFloat()
        val normalizedAzimuth = (azimuthInDegrees + 360) % 360
        binding.compassView.updateBearing(normalizedAzimuth)
        if (isGeomagneticModeOn) {
            var newDirection = currentDirection
            val tolerance = 2.0f
            if (normalizedAzimuth in (270f - tolerance)..(270f + tolerance)) { // ì„œìª½ ë°©í–¥ (ì™¼ìª½ -> ì˜¤ë¥¸ìª½)
                newDirection = Direction.WEST
            } else if (normalizedAzimuth in (90f - tolerance)..(90f + tolerance)) { // ë™ìª½ ë°©í–¥ (ì˜¤ë¥¸ìª½ -> ì™¼ìª½)
                newDirection = Direction.EAST
            } else {
                newDirection = Direction.OTHER // ê·¸ ì™¸ ë°©í–¥
            }

            if (newDirection != currentDirection) {
                currentDirection = newDirection
                updateButtonsAndUI()
            }
        }
    }

    private fun dpToPx(dp: Int): Int {
        return (dp * resources.displayMetrics.density).toInt()
    }

    private suspend fun loadPdfFromSmbFile(smbFile: SmbFile) {
        withContext(Dispatchers.Main) {
            binding.btnOpenFile.isEnabled = false; binding.btnOpenFile.text = "ë¡œë”©ì¤‘..."
        }
        try {
            val tempPdfFile = File(cacheDir, smbFile.name)
            smbFile.inputStream.use { input -> FileOutputStream(tempPdfFile).use { output -> input.copyTo(output) } }
            withContext(Dispatchers.Main) {
                binding.tvFileName.text = smbFile.name.substringBeforeLast(".")
                binding.pdfView.fromFile(tempPdfFile).onLoad(this@MainActivity).onPageError(this@MainActivity).load()
            }
        } catch (e: Exception) { Log.e("SmbTask", "íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨", e)
        } finally {
            withContext(Dispatchers.Main) {
                binding.btnOpenFile.isEnabled = true; binding.btnOpenFile.text = "Open ReelList"
            }
        }
    }
    
    private suspend fun showPdfListFromSmb(){val smbUrl="smb://$SMB_IP/$SMB_SHARED_FOLDER/";try{val properties=Properties();properties["jcifs.smb.client.minVersion"]="SMB300";properties["jcifs.smb.client.maxVersion"]="SMB311";val config=PropertyConfiguration(properties);val cifsContext:CIFSContext=BaseContext(config);val auth=NtlmPasswordAuthenticator(null,SMB_USER,SMB_PASS);val context=cifsContext.withCredentials(auth);val dir=SmbFile(smbUrl,context);val pdfFiles=dir.listFiles{f->f.name.endsWith(".pdf",ignoreCase=true)};if(pdfFiles.isNullOrEmpty()){withContext(Dispatchers.Main){Toast.makeText(this@MainActivity,"ê³µìœ  í´ë”ì— PDF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.",Toast.LENGTH_SHORT).show()};return};val fileNames=pdfFiles.map{it.name}.toTypedArray();withContext(Dispatchers.Main){AlertDialog.Builder(this@MainActivity).setTitle("PDF íŒŒì¼ ì„ íƒ").setItems(fileNames){_,which->val selectedFile=pdfFiles[which];lifecycleScope.launch(Dispatchers.IO){loadPdfFromSmbFile(selectedFile)}}.setNegativeButton("ì·¨ì†Œ",null).show()}}catch(e:Exception){Log.e("SmbTask","SMB ì—°ê²° ì‹¤íŒ¨",e);withContext(Dispatchers.Main){Toast.makeText(this@MainActivity,"ê³µìœ  í´ë” ì—°ê²° ì‹¤íŒ¨\nì˜¤ë¥˜: ${e.message}",Toast.LENGTH_LONG).show()}}}
    override fun onPageError(page:Int,t:Throwable){Log.e("PDFView","í˜ì´ì§€ ë¡œë“œ ì—ëŸ¬",t);Toast.makeText(this,"${page+1}í˜ì´ì§€ ë¡œë“œ ì—ëŸ¬",Toast.LENGTH_SHORT).show()}