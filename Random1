<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>깔끔한 코드 블록 (복사 기능 포함)</title>
    <style>
        body {
            font-family: sans-serif;
            background-color: #f0f2f5; /* 전체 페이지 배경 (이미지와 유사하게 밝은 회색) */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center; /* 페이지 중앙 정렬 */
            align-items: flex-start; /* 페이지 상단부터 시작 */
            min-height: 100vh;
        }

        .content-wrapper { /* 실제 콘텐츠가 들어갈 영역 */
            background-color: #ffffff; /* 콘텐츠 영역 배경 (흰색) */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px; /* 최대 너비 설정 */
        }

        h3 { /* 예시 제목 스타일 */
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .code-block-container {
            position: relative; /* 복사 버튼 위치 기준 */
            background-color: #2d2d2d; /* 코드 블록 배경 (어둡게) */
            border-radius: 6px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            overflow: hidden; /* 내부 pre의 배경이 튀어나오지 않도록 */
        }

        .code-block-container pre {
            margin: 0; /* pre 태그의 기본 마진 제거 */
            padding: 20px;
            color: #e0e0e0; /* 코드 텍스트 색상 (밝게) */
            font-family: 'Consolas', 'Monaco', 'Menlo', monospace; /* 고정폭 폰트 */
            font-size: 0.9em;
            line-height: 1.6;
            overflow-x: auto; /* 가로 스크롤 */
            white-space: pre; /* 공백 및 줄바꿈 유지 */
            background-color: transparent; /* pre 자체 배경은 투명하게 하여 컨테이너 배경색 사용 */
        }

        .code-block-container code {
            /* code 태그는 특별한 스타일 추가 안 함. pre에서 대부분 처리 */
            display: block; /* 줄 단위로 선택되도록 */
        }

        /* 코드 내 주석, 키워드 등 간단한 스타일링 (실제 구문 분석은 아님) */
        .code-block-container .code-comment { color: #70a870; } /* 초록색 계열 */
        .code-block-container .code-keyword { color: #569cd6; } /* 파란색 계열 */
        .code-block-container .code-string { color: #ce9178; } /* 주황색 계열 */


        .copy-code-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #4a4a4a;
            color: #e0e0e0;
            border: 1px solid #606060;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            opacity: 0.7; /* 평소에는 약간 투명하게 */
            transition: opacity 0.2s, background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .code-block-container:hover .copy-code-button {
            opacity: 1; /* 마우스 올리면 완전 불투명 */
        }

        .copy-code-button:hover {
            background-color: #5e5e5e;
        }

        .copy-code-button svg { /* SVG 아이콘 스타일 */
            width: 14px;
            height: 14px;
            margin-right: 5px;
            fill: currentColor;
        }

    </style>
</head>
<body>
    <div class="content-wrapper">
        <h3>3. 엑셀 VBA와 COM의 연동 예시 (복사 버튼 추가됨)</h3>
        <p>아래는 VBA 코드 예시입니다. 코드 블록 우측 상단의 복사 버튼을 사용하여 코드를 복사할 수 있습니다.</p>

        <div class="code-block-container" id="vbaCodeBlock1">
            <button class="copy-code-button" title="코드 복사">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                </svg>
                복사
            </button>
            <pre><code class="language-vba">' VBA 코드 예시: COM을 통해 엑셀 객체 제어
<span class="code-keyword">Sub</span> CreateChart()
    <span class="code-keyword">Dim</span> ws <span class="code-keyword">As</span> Worksheet
    <span class="code-keyword">Set</span> ws = ThisWorkbook.Sheets(<span class="code-string">"Sheet1"</span>) <span class="code-comment">' COM 객체 참조</span>

    <span class="code-comment">' 차트 생성 (COM 인터페이스 호출)</span>
    <span class="code-keyword">Dim</span> chrt <span class="code-keyword">As</span> Chart
    <span class="code-keyword">Set</span> chrt = Charts.Add
    chrt.ChartType = xlColumnClustered
    chrt.SetSourceData Source:=ws.Range(<span class="code-string">"A1:B10"</span>)

    <span class="code-comment">' 포인터: 현재 사용 후 메모리 해제 (COM 참조 카운팅)</span>
    <span class="code-keyword">Set</span> chrt = Nothing
    <span class="code-keyword">Set</span> ws = Nothing
<span class="code-keyword">End Sub</span>

aabbccdd
<span class="code-comment">' --- 선택 복사 구간 시작 ---</span>
<span class="code-keyword">Sub</span> SelectiveCopyExample()
    MsgBox <span class="code-string">"이 부분만 복사됩니다."</span>
<span class="code-keyword">End Sub</span>
<span class="code-comment">' --- 선택 복사 구간 끝 ---</span>
eeffgghh
</code></pre>
        </div>

        <p>다른 내용들...</p>

    </div>

    <script>
        document.querySelectorAll('.copy-code-button').forEach(button => {
            button.addEventListener('click', () => {
                const codeBlockContainer = button.closest('.code-block-container');
                const codeElement = codeBlockContainer.querySelector('pre code');
                
                if (codeElement) {
                    const fullCodeText = codeElement.textContent || codeElement.innerText; // textContent 사용 권장
                    let textToActuallyCopy = fullCodeText;
                    let copyFeedbackMessage = ' 전체 복사됨!';

                    const markerStartText = "aabbccdd";
                    const markerEndText = "eeffgghh";

                    const lines = fullCodeText.split('\n');
                    let markerStartLine = -1;
                    let markerEndLine = -1;

                    for (let i = 0; i < lines.length; i++) {
                        if (lines[i].trim() === markerStartText) {
                            if (markerStartLine === -1) markerStartLine = i;
                        }
                        if (lines[i].trim() === markerEndText) {
                            if (markerStartLine !== -1 && i >= markerStartLine) {
                                markerEndLine = i;
                            }
                        }
                    }

                    if (markerStartLine !== -1 && markerEndLine !== -1 && markerStartLine <= markerEndLine) {
                        textToActuallyCopy = lines.slice(markerStartLine, markerEndLine + 1).join('\n');
                        copyFeedbackMessage = ' 지정 구간 복사됨!';
                    }

                    navigator.clipboard.writeText(textToActuallyCopy).then(() => {
                        const originalButtonText = button.innerHTML;
                        // 아이콘 SVG를 유지하면서 텍스트만 변경
                        const svgIcon = button.querySelector('svg') ? button.querySelector('svg').outerHTML : '';
                        button.innerHTML = svgIcon + copyFeedbackMessage;
                        setTimeout(() => {
                            button.innerHTML = svgIcon + ' 복사'; // 원래 버튼 텍스트 (아이콘 포함)
                        }, 2000);
                    }).catch(err => {
                        console.error('코드 복사 실패:', err);
                        const originalButtonText = button.innerHTML;
                        const svgIcon = button.querySelector('svg') ? button.querySelector('svg').outerHTML : '';
                        button.innerHTML = svgIcon + ' 복사 실패';
                        setTimeout(() => {
                            button.innerHTML = svgIcon + ' 복사';
                        }, 2000);
                    });
                }
            });
        });
    </script>
</body>
</html>