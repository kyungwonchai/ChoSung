using Excel = Microsoft.Office.Interop.Excel;
using System;
using System.Data.SqlClient;
using System.Text.RegularExpressions;

class Program
{
    static void Main(string[] args)
    {
        // 엑셀 애플리케이션 초기화
        Excel.Application xlApp = new Excel.Application();
        Excel.Workbook xlWorkbook = xlApp.Workbooks.Open("C:\\path\\to\\your\\file.xlsx");
        Excel.Worksheet xlWorksheet = xlWorkbook.Sheets[1];

        // 정규식 패턴
        string pattern = "[some_regex_pattern_here]";

        // 엑셀에서 컬럼 이름 읽기
        var columns = new List<string>();
        for (int i = 2; i <= 10; i++) // Assumed 10 columns
        {
            var cellValue = xlWorksheet.Cells[2, i].Value.ToString();
            var result = Regex.Replace(cellValue, pattern, "-");
            var columnName = "C_" + result;
            if (columnName.StartsWith("C_"))
            {
                columns.Add(columnName);
            }
        }

        // SQL 연결
        using (SqlConnection conn = new SqlConnection("your_connection_string_here"))
        {
            conn.Open();
            SqlCommand cmd = new SqlCommand();
            cmd.Connection = conn;

            DateTime current_time = DateTime.Now;
            string formatted_time = current_time.ToString("yyyy-MM-dd HH:mm:ss");
            int numbb = 1;

            for (int row = 3; row <= 10; row++) // Assumed 10 rows
            {
                var rowValues = new List<string>();
                for (int col = 2; col <= 10; col++) // Assumed 10 columns
                {
                    rowValues.Add(xlWorksheet.Cells[row, col].Value.ToString());
                }

                if (String.IsNullOrEmpty(rowValues[2])) continue;

                var data = new Dictionary<string, string>();
                for (int i = 0; i < columns.Count; i++)
                {
                    data.Add(columns[i], rowValues[i]);
                }

                var dataWithQuotes = string.Join(",", data.Values.Select(v => $"'{v}'"));
                string insertQuery = $"INSERT INTO T_메인확정 ({string.Join(",", columns)}, N_number, N_time) VALUES ({dataWithQuotes}, {numbb}, '{formatted_time}')";
                cmd.CommandText = insertQuery;
                cmd.ExecuteNonQuery();
                numbb++;
            }
        }

        // 엑셀 파일 닫기
        xlWorkbook.Close();
        xlApp.Quit();
    }
}
