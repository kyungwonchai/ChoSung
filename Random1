using DevExpress.XtraPivotGrid;

// PivotGrid 컨트롤 생성
PivotGridControl pivotGrid = new PivotGridControl();

// PivotGrid 설정
pivotGrid.BeginUpdate();
pivotGrid.DataSource = table_rpa_runlog; // 테이블 조회 결과를 바인딩
pivotGrid.Fields.Add(field => {
    field.FieldName = "rpastart"; // 날짜 필드
    field.Caption = "날짜";
    field.Area = PivotArea.RowArea;
    field.GroupInterval = PivotGroupInterval.Date; // 날짜별 그룹화
});
pivotGrid.Fields.Add(field => {
    field.FieldName = "mailok"; // 성공 여부 필드
    field.Caption = "성공 여부";
    field.Area = PivotArea.DataArea;
    field.SummaryType = PivotSummaryType.Count; // 총 횟수
});
pivotGrid.Fields.Add(field => {
    field.FieldName = "mailok"; // 성공 여부 필드
    field.Caption = "성공 횟수";
    field.Area = PivotArea.DataArea;
    field.SummaryType = PivotSummaryType.Count; // 성공 횟수
    field.FilterValues.Add(true); // 성공인 경우 필터링
});
pivotGrid.Fields.Add(field => {
    field.FieldName = "mailok"; // 성공 여부 필드
    field.Caption = "성공율";
    field.Area = PivotArea.DataArea;
    field.SummaryType = PivotSummaryType.Custom; // 사용자 정의 집계
    field.CustomSummary += (sender, e) => {
        if (e.DataField.FieldName == "성공율") {
            int totalCount = Convert.ToInt32(e.GetCellValue(field1)); // 총 횟수 필드
            int successCount = Convert.ToInt32(e.GetCellValue(field2)); // 성공 횟수 필드
            if (totalCount > 0) {
                e.CustomValue = (double)successCount / totalCount; // 성공율 계산
            }
        }
    };
});

pivotGrid.EndUpdate();
