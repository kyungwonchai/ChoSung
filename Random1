import os
import csv

# Log file directory
log_directory = "c:/test"

# List to store the parsed log data
log_data = []

# Read all files in the directory
for filename in os.listdir(log_directory):
    if "commandqueue" in filename.lower():
        file_path = os.path.join(log_directory, filename)
        
        # Open and read the file
        with open(file_path, 'r', encoding='utf-8') as file:
            lines = file.readlines()
            for line in lines:
                # Split the line by '|'
                parts = line.strip().split('|')
                if len(parts) == 7:  # Only process if all required fields are present
                    log_data.append(parts)

# Sort the data by time
log_data.sort(key=lambda x: x[0])

# Save the sorted data to a CSV file
output_file = "output.csv"
with open(output_file, 'w', newline='', encoding='utf-8') as csvfile:
    csvwriter = csv.writer(csvfile)
    # Write column headers
    csvwriter.writerow(["Time", "SentValue", "ResponseValue", "Result", "Result2", "Retry", "Speed"])
    # Write data rows
    csvwriter.writerows(log_data)
