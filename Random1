래는 VBA 코드로, 요청한 기능을 구현하는 코드입니다. 이 코드는 Dup = 1인 데이터에서 Date1이 11월 4일 이후인 데이터만 사용하여 Date1별 Shift1의 개수를 차트로 표시하고, Line1의 값에 따라 필터링 및 카운트를 수행합니다. 폼에는 선택한 Line1에 대한 필터링 및 Machine1, Lane1의 횟수를 표시하는 기능이 추가됩니다.

VBA 코드
시트에 차트를 추가하는 코드
폼을 추가하여 Line1 값에 따라 필터링하고 Machine1, Lane1별 카운트를 표시
1. 시트에 차트를 추가하는 코드
이 코드는 Dup = 1이면서 Date1이 11월 4일 이후인 데이터만을 사용해 날짜별 Shift1의 개수를 집계하여 차트를 추가합니다.

vba
코드 복사
Sub CreateShift1Chart()
    Dim ws As Worksheet
    Dim chart As ChartObject
    Dim lastRow As Long
    Dim dateRange As Range, shiftRange As Range, countRange As Range
    
    Set ws = ThisWorkbook.Sheets("Data") ' 데이터가 있는 시트 이름
    
    ' 데이터 범위 설정 (Date1이 11월 4일 이후이고 Dup = 1인 데이터만 필터링)
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    ws.Range("A1").AutoFilter Field:=7, Criteria1:=">=2024-11-04"
    ws.Range("A1").AutoFilter Field:=10, Criteria1:="1"
    
    ' Date1과 Shift1 기준으로 개수 집계
    ws.Range("K1").Value = "Date1"
    ws.Range("L1").Value = "Shift1"
    ws.Range("M1").Value = "Count"
    
    ws.Range("K2").FormulaArray = _
        "=UNIQUE(FILTER(R7C7:R" & lastRow & "C7, (R7C7:R" & lastRow & "C7>=""2024-11-04"")*(R7C10:R" & lastRow & "C10=1)))"
    ws.Range("L2").FormulaArray = _
        "=UNIQUE(R7C8:R" & lastRow & "C8)"
    ws.Range("M2").FormulaArray = _
        "=COUNTIFS(R7C7:R" & lastRow & "C7, K2, R7C8:R" & lastRow & "C8, L2)"
    
    ' 차트 생성
    Set chart = ws.ChartObjects.Add(Left:=100, Width:=375, Top:=50, Height:=300)
    With chart.Chart
        .SetSourceData Source:=ws.Range("K2:M" & ws.Cells(ws.Rows.Count, "K").End(xlUp).Row)
        .ChartType = xlColumnClustered
        .HasTitle = True
        .ChartTitle.Text = "Date1별 Shift1의 개수"
    End With
    
    ' 필터 해제
    ws.AutoFilterMode = False
End Sub
이 코드는 시트에 차트를 추가하여, Date1과 Shift1별 개수를 표시합니다.

2. 폼 코드
이제, Line1 값에 따라 필터링하고 Machine1, Lane1별로 카운트를 표시하는 폼을 추가하는 코드입니다.

VBA에서 사용자 폼을 추가: UserForm을 생성하고, 콤보박스와 레이블을 추가합니다.

콤보박스 (cmbLine1): Line1 값을 선택합니다.
레이블 (lblResult): Machine1과 Lane1 카운트를 표시합니다.
폼에 필요한 코드를 추가

vba
코드 복사
Private Sub UserForm_Initialize()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim uniqueLine As Collection
    Dim cell As Range
    
    Set ws = ThisWorkbook.Sheets("Data") ' 데이터가 있는 시트 이름
    Set uniqueLine = New Collection
    
    ' 중복 없이 Line1 값을 콤보박스에 추가
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    On Error Resume Next
    For Each cell In ws.Range("A2:A" & lastRow)
        uniqueLine.Add cell.Value, CStr(cell.Value)
    Next cell
    On Error GoTo 0
    
    For Each Item In uniqueLine
        Me.cmbLine1.AddItem Item
    Next Item
End Sub

Private Sub cmbLine1_Change()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim line1Filter As String
    Dim machineCount As Long, laneCount As Long
    
    Set ws = ThisWorkbook.Sheets("Data") ' 데이터가 있는 시트 이름
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    ' 선택된 Line1에 따라 필터링 및 카운트 계산
    line1Filter = Me.cmbLine1.Value
    machineCount = WorksheetFunction.CountIfs(ws.Range("A2:A" & lastRow), line1Filter, ws.Range("G2:G" & lastRow), "day")
    laneCount = WorksheetFunction.CountIfs(ws.Range("A2:A" & lastRow), line1Filter, ws.Range("G2:G" & lastRow), "night")
    
    ' 결과 표시
    Me.lblResult.Caption = "Machine1 (Day): " & machineCount & vbNewLine & _
                           "Lane1 (Night): " & laneCount
End Sub
코드 설명
폼 초기화 (UserForm_Initialize): 데이터 시트에서 중복 없는 Line1 값을 콤보박스(cmbLine1)에 추가합니다.