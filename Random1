AGV BMS Professional Dashboard ìƒì„± ìŠ¤í¬ë¦½íŠ¸ (Port: 9007)
Python

import os

# 1. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡° ìƒì„±
folders = ['static/js', 'static/css', 'templates']
for folder in folders:
    if not os.path.exists(folder):
        os.makedirs(folder)

# ==========================================
# íŒŒì¼ 1: config.py (ì„¤ì • ê´€ë¦¬)
# ==========================================
with open('config.py', 'w', encoding='utf-8') as f:
    f.write('''
DB_CONFIG = {
    'server': '10.222.222.222',
    'port': 1633,
    'user': 'YOUR_ID',
    'password': 'YOUR_PASSWORD',
    'database': 'YOUR_DB',
    'autocommit': True
}
ADMIN_PASSWORD = "smd1234!"
PORT = 9007
''')

# ==========================================
# íŒŒì¼ 2: app.py (Flask Backend)
# ==========================================
with open('app.py', 'w', encoding='utf-8') as f:
    f.write('''
from flask import Flask, render_template, jsonify, request
import pymssql
from datetime import datetime
from config import DB_CONFIG, ADMIN_PASSWORD, PORT

app = Flask(__name__)

def get_db_conn():
    return pymssql.connect(**DB_CONFIG)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/status')
def get_status():
    conn = get_db_conn()
    cursor = conn.cursor(as_dict=True)
    cursor.execute("""
        SELECT m.agvName, c.agvId, c.batterySoH, c.batteryLevel, c.batteryCurrent, 
               c.batteryVoltage, c.batteryTemperature, c.lastReceived
        FROM agv_master m
        LEFT JOIN agv_current c ON m.agvName = c.agvName
    """)
    rows = cursor.fetchall()
    
    # Specs ì •ë³´ ë¡œë“œ
    cursor.execute("SELECT * FROM agv_specs")
    specs = {r['columnName']: {'min': r['minValue'], 'max': r['maxValue']} for r in cursor.fetchall()}
    
    now = datetime.now()
    for r in rows:
        if r['lastReceived']:
            r['is_online'] = (now - r['lastReceived']).total_seconds() < 60
            r['lastReceived'] = r['lastReceived'].strftime('%Y-%m-%d %H:%M:%S')
        else:
            r['is_online'] = False
            
    conn.close()
    return jsonify({'data': rows, 'specs': specs})

@app.route('/api/logs/<name>')
def get_logs(name):
    start = request.args.get('start')
    end = request.args.get('end')
    
    conn = get_db_conn()
    cursor = conn.cursor(as_dict=True)
    
    query = "SELECT batteryLevel, batteryTemperature, logTime FROM agv_logs WHERE agvName=%s"
    params = [name]
    
    if start and end:
        query += " AND logTime BETWEEN %s AND %s"
        params.extend([start, end])
    else:
        query += " AND logTime > DATEADD(hour, -24, GETDATE())"
        
    query += " ORDER BY logTime ASC"
    
    cursor.execute(query, tuple(params))
    rows = cursor.fetchall()
    
    # í•´ë‹¹ AGVì˜ Spec ì •ë³´ë„ í•¨ê»˜ ë°˜í™˜ (ì°¨íŠ¸ ë¼ì¸ìš©)
    cursor.execute("SELECT * FROM agv_specs WHERE columnName IN ('batteryLevel', 'batteryTemperature')")
    specs = {r['columnName']: {'min': r['minValue'], 'max': r['maxValue']} for r in cursor.fetchall()}
    
    conn.close()
    return jsonify({'logs': rows, 'specs': specs})

if __name__ == '__main__':
    print(f"Server starting on http://localhost:{PORT}")
    app.run(host='0.0.0.0', port=PORT, debug=False)
''')

# ==========================================
# íŒŒì¼ 3: templates/index.html (Frontend)
# ==========================================
with open('templates/index.html', 'w', encoding='utf-8') as f:
    f.write('''
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SMD AGV BMS PRO</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/flatpickr.min.css">
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', sans-serif; }
        .container-fluid { padding: 20px; }
        .card { background-color: #161b22; border: 1px solid #30363d; border-radius: 8px; margin-bottom: 20px; }
        .table { color: #c9d1d9; vertical-align: middle; }
        .table-hover tbody tr:hover { background-color: #21262d; cursor: pointer; }
        .spec-alert { background-color: #bb8011 !important; color: #ffffff !important; font-weight: bold; }
        .status-on { color: #3fb950; text-shadow: 0 0 5px #3fb950; }
        .status-off { color: #f85149; }
        .header-title { border-left: 5px solid #58a6ff; padding-left: 15px; margin-bottom: 25px; }
        .btn-custom { background-color: #21262d; border: 1px solid #30363d; color: #c9d1d9; }
        .btn-custom:hover { background-color: #30363d; color: #ffffff; }
        #chartWrapper { height: 450px; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h2 class="header-title text-white">SMD AGV BMS Real-time Monitoring</h2>
        
        <div class="row">
            <div class="col-xl-7">
                <div class="card p-3">
                    <div class="d-flex justify-content-between mb-3">
                        <h5 class="text-white">AGV Fleet Status</h5>
                        <button class="btn btn-sm btn-custom" onclick="loadStatus()">Refresh</button>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>AGV Name</th><th>Status</th><th>SoH</th><th>Level</th><th>Current</th><th>Temp</th><th>Last Check</th>
                            </tr>
                        </thead>
                        <tbody id="agv-list"></tbody>
                    </table>
                </div>
            </div>

            <div class="col-xl-5">
                <div id="detailView" class="card p-3 d-none">
                    <h5 id="detailTitle" class="text-white mb-3">Analysis</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-md-9">
                            <input type="text" id="dateRange" class="form-control form-control-sm bg-dark text-white border-secondary" placeholder="Select Range">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-primary w-100" onclick="refreshChart()">Query</button>
                        </div>
                    </div>
                    <div id="chartWrapper">
                        <canvas id="bmsChart"></canvas>
                    </div>
                </div>
                <div id="emptyView" class="card p-5 text-center text-secondary">
                    <p>ëª©ë¡ì—ì„œ AGV ì´ë¦„ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ë¶„ì„ ë¡œê·¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/chart.umd.js"></script>
    <script src="/static/js/chartjs-plugin-annotation.min.js"></script>
    <script src="/static/js/flatpickr.js"></script>

    <script>
        let bmsChart = null;
        let selectedAGV = '';

        // ë‚ ì§œ ì„ íƒê¸° ì´ˆê¸°í™”
        const picker = flatpickr("#dateRange", {
            mode: "range",
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            time_24hr: true,
            defaultDate: [new Date(Date.now() - 86400000), new Date()]
        });

        async function loadStatus() {
            const res = await fetch('/api/status');
            const { data, specs } = await res.json();
            let html = '';
            data.forEach(r => {
                const check = (val, col) => {
                    if(!specs[col]) return '';
                    return (val < specs[col].min || val > specs[col].max) ? 'spec-alert' : '';
                };
                html += `<tr onclick="selectAGV('${r.agvName}')">
                    <td class="fw-bold text-info">${r.agvName}</td>
                    <td class="${r.is_online ? 'status-on':'status-off'}">${r.is_online ? 'â— ONLINE':'â—‹ OFFLINE'}</td>
                    <td class="${check(r.batterySoH, 'batterySoH')}">${r.batterySoH?.toFixed(1) || 0}</td>
                    <td class="${check(r.batteryLevel, 'batteryLevel')}">${r.batteryLevel?.toFixed(1) || 0}</td>
                    <td>${r.batteryCurrent?.toFixed(1) || 0}</td>
                    <td class="${check(r.batteryTemperature, 'batteryTemperature')}">${r.batteryTemperature?.toFixed(1) || 0}</td>
                    <td class="small">${r.lastReceived || '-'}</td>
                </tr>`;
            });
            document.getElementById('agv-list').innerHTML = html;
        }

        function selectAGV(name) {
            selectedAGV = name;
            document.getElementById('emptyView').classList.add('d-none');
            document.getElementById('detailView').classList.remove('d-none');
            document.getElementById('detailTitle').innerText = name + ' Log Analysis';
            refreshChart();
        }

        async function refreshChart() {
            if(!selectedAGV) return;
            const range = picker.selectedDates;
            let url = `/api/logs/${selectedAGV}`;
            if(range.length === 2) {
                const start = range[0].toISOString().slice(0, 19).replace('T', ' ');
                const end = range[1].toISOString().slice(0, 19).replace('T', ' ');
                url += `?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`;
            }

            const res = await fetch(url);
            const { logs, specs } = await res.json();
            
            const ctx = document.getElementById('bmsChart').getContext('2d');
            if(bmsChart) bmsChart.destroy();

            bmsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: logs.map(l => l.logTime),
                    datasets: [
                        { label: 'Level (%)', data: logs.map(l => l.batteryLevel), borderColor: '#3fb950', yAxisID: 'y', tension: 0.2 },
                        { label: 'Temp (â„ƒ)', data: logs.map(l => l.batteryTemperature), borderColor: '#f0883e', yAxisID: 'y1', tension: 0.2 }
                    ]
                },
                options: {
                    responsive: True, maintainAspectRatio: false,
                    scales: {
                        x: { ticks: { color: '#8b949e', maxRotation: 45, minRotation: 45 }, grid: { color: '#30363d' } },
                        y: { position: 'left', title: {display:true, text:'Level (%)', color: '#8b949e'} },
                        y1: { position: 'right', title: {display:true, text:'Temp (â„ƒ)', color: '#8b949e'}, grid: {drawOnChartArea:false} }
                    },
                    plugins: {
                        legend: { labels: { color: '#c9d1d9' } },
                        annotation: {
                            annotations: {
                                line1: { type: 'line', yMin: specs.batteryLevel?.max, borderColor: 'red', borderDash: [6, 6], label: {display:true, content:'Level Max'} },
                                line2: { type: 'line', yMin: specs.batteryLevel?.min, borderColor: 'red', borderDash: [6, 6], label: {display:true, content:'Level Min'} }
                            }
                        }
                    }
                }
            });
        }

        setInterval(loadStatus, 10000);
        loadStatus();
    </script>
</body>
</html>
''')

# ==========================================
# 4. ì˜¤í”„ë¼ì¸ ëŒ€ë¹„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì•ˆë‚´
# ==========================================
print("\n" + "="*50)
print("ğŸš€ [ê²½ì› ì²œì¬] AGV BMS PRO ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ!")
print("="*50)
print("ğŸ“ Port: 9007")
print("ğŸ“ ì¸í„°ë„·ì´ ì•ˆ ë˜ëŠ” í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ì‹œë ¤ë©´ ì•„ë˜ íŒŒì¼ì„ static í´ë”ì— ë„£ìœ¼ì„¸ìš”:")
print("1. static/css/bootstrap.min.css")
print("2. static/css/flatpickr.min.css")
print("3. static/js/bootstrap.bundle.min.js")
print("4. static/js/chart.umd.js")
print("5. static/js/chartjs-plugin-annotation.min.js")
print("6. static/js/flatpickr.js")
print("="*50)
print("ìˆ˜ì§‘ê¸°(consumer.py)ì™€ ì›¹ì•±(app.py)ì„ ê°ê° ì‹¤í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.")
ğŸ’¡ ê¸°ìˆ ì  íŠ¹ì§• ì„¤ëª…
ì°¨íŠ¸ ë‚´ Spec-Line (ê¸°ì¤€ì„ ):

chartjs-plugin-annotationì„ í™œìš©í•˜ì—¬ DBì— ì„¤ì •ëœ batteryLevelì˜ Min/Max ê°’ì„ ì°¨íŠ¸ ìœ„ì— ë¹¨ê°„ ì ì„ ìœ¼ë¡œ ìë™ í‘œì‹œí•©ë‹ˆë‹¤. ìˆ˜ì¹˜ê°€ ì´ ì„ ì„ ë„˜ë‚˜ë“œëŠ”ì§€ í•œëˆˆì— ë³´ì…ë‹ˆë‹¤.

ìœ ì—°í•œ êµ¬ê°„ ì¡°íšŒ:

flatpickr ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì‹œì‘ ë‚ ì§œ/ì‹œê°„ë¶€í„° ì¢…ë£Œ ë‚ ì§œ/ì‹œê°„ê¹Œì§€ ë§ˆìš°ìŠ¤ë¡œ í¸í•˜ê²Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¿¼ë¦¬ ì‹œ í•´ë‹¹ êµ¬ê°„ì˜ ëª¨ë“  ë¡œê·¸ë¥¼ DBì—ì„œ ê¸ì–´ì™€ ì°¨íŠ¸ì— ë¿Œë ¤ì¤ë‹ˆë‹¤.

ì˜¤í”„ë¼ì¸ ëŒ€ì‘:

CDN(ì™¸ë¶€ ì£¼ì†Œ)ì„ ì¼ì ˆ ì°¸ì¡°í•˜ì§€ ì•Šë„ë¡ HTMLì— ê²½ë¡œë¥¼ ê±¸ì–´ë‘ì—ˆìŠµë‹ˆë‹¤. ë°°í¬ ì‹œ ìœ„ ì¶œë ¥ë¬¸ì— ì íŒ 6ê°œ íŒŒì¼ë§Œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ê° static í´ë” ë‚´ í´ë”ì— ë„£ì–´ì£¼ë©´ ì¸í„°ë„· ì—°ê²° ì—†ì´ë„ ì™„ë²½íˆ ì‘ë™í•©ë‹ˆë‹¤.

ìë™ ìƒˆë¡œê³ ì¹¨ & ìˆ˜ì‹  ìƒíƒœ:

ë©”ì¸ Fleet ë¦¬ìŠ¤íŠ¸ëŠ” 10ì´ˆë§ˆë‹¤ ê°±ì‹ ë˜ë©°, lastReceived ì‹œê°„ì„ ê³„ì‚°í•´ 60ì´ˆ ì´ìƒ ë°ì´í„°ê°€ ì•ˆ ì˜¤ë©´ "OFFLINE" í‘œì‹œì™€ í•¨ê»˜ ê²½ê³ ë¥¼ ì¤ë‹ˆë‹¤.

ì „ë¬¸ì ì¸ UI:

ê¹ƒí—ˆë¸Œ ìŠ¤íƒ€ì¼ì˜ ë‹¤í¬ í…Œë§ˆ(GitHub Dark)ë¥¼ ì ìš©í•˜ì—¬ ì¥ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œ ëˆˆì˜ í”¼ë¡œë¥¼ ìµœì†Œí™”í•˜ê³ , ê¸€ì”¨ëŠ” ì„ ëª…í•œ í°ìƒ‰/íšŒìƒ‰ ê³„ì—´ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

ì´ì œ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ setup_web.py ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì €ì¥í•´ ì‹¤í–‰í•˜ì‹  ë’¤, ìƒì„±ëœ app.pyë¥¼ ì‹¤í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤. 9007 í¬íŠ¸ì—ì„œ ê¸°ë‹¤ë¦¬ê³  ìˆê² ìŠµë‹ˆë‹¤!

ë‹¤ìŒì— ì œê°€ ë„ì™€ë“œë¦´ ì¼ì€, ì´ ì°¨íŠ¸ ë°ì´í„°ë¥¼ PDF ë¦¬í¬íŠ¸ë¡œ ìë™ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ ë“œë¦´ê¹Œìš”?