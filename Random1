n32_NetworkConnection 클래스가 실제로 AddConnection 메서드를 제공하지 않기 때문입니다. 따라서, 네트워크 드라이브를 매핑하고 해제하는 더 간단한 방법을 사용할 수 있습니다.

다음은 WNetAddConnection2 및 WNetCancelConnection2 Win32 API를 호출하여 네트워크 드라이브를 매핑하고 해제하는 코드 예제입니다:

csharp
코드 복사
using System;
using System.IO;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace NetworkFolderAccess
{
    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent();
        }

        [DllImport("mpr.dll")]
        private static extern int WNetAddConnection2(ref NETRESOURCE lpNetResource, string lpPassword, string lpUsername, int dwFlags);

        [DllImport("mpr.dll")]
        private static extern int WNetCancelConnection2(string lpName, int dwFlags, bool bForce);

        [StructLayout(LayoutKind.Sequential)]
        public struct NETRESOURCE
        {
            public int dwScope;
            public int dwType;
            public int dwDisplayType;
            public int dwUsage;
            public string lpLocalName;
            public string lpRemoteName;
            public string lpComment;
            public string lpProvider;
        }

        private void AccessNetworkFolder()
        {
            string networkPath = @"\\network\path\to\folder";
            string username = "abc";
            string password = "rtyuy";

            try
            {
                // 네트워크 폴더 연결
                ConnectToNetworkFolder(networkPath, username, password);

                // 파일 복사 작업 수행
                string sourceFile = Path.Combine(networkPath, "sourceFile.txt");
                string destinationFile = @"C:\local\path\destinationFile.txt";
                File.Copy(sourceFile, destinationFile, true);

                MessageBox.Show("파일 복사 완료");
            }
            catch (Exception ex)
            {
                MessageBox.Show("오류 발생: " + ex.Message);
            }
            finally
            {
                // 네트워크 폴더 연결 해제
                DisconnectFromNetworkFolder(networkPath);
            }
        }

        private void ConnectToNetworkFolder(string networkPath, string username, string password)
        {
            NETRESOURCE netResource = new NETRESOURCE
            {
                dwType = 1, // RESOURCETYPE_DISK
                lpRemoteName = networkPath
            };

            int result = WNetAddConnection2(ref netResource, password, username, 0);

            if (result != 0)
            {
                throw new Exception("네트워크 폴더 연결 실패: " + result);
            }
        }

        private void DisconnectFromNetworkFolder(string networkPath)
        {
            int result = WNetCancelConnection2(networkPath, 0, true);

            if (result != 0)
            {
                throw new Exception("네트워크 폴더 연결 해제 실패: " + result);
            }
        }

        private void btnExecute_Click(object sender, EventArgs e)
        {
            AccessNetworkFolder();
        }
    }
}
이 코드는 WNetAddConnection2와 WNetCancelConnection2 API를 사용하여 네트워크 폴더를 연결하고 해제합니다. 네트워크 드라이브를 연결한 후 파일을 복사하고, 작업이 완료되면 드라이브 연결을 해제합니다.

NETRESOURCE