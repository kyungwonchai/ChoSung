아래는 최상단 차트를 BoxPlot으로 구현하여 라인별 데이터를 표시하고, 클릭 시 하단의 디테일 차트가 업데이트되는 기능을 포함한 전체 코드입니다.

C# 코드 (MainWindow.xaml.cs)
csharp
코드 복사
using System;
using System.Collections.ObjectModel;
using System.Data.SqlClient;
using System.Linq;
using System.Windows;
using DevExpress.Xpf.Charts;

namespace RouterAlaskaResultViewer
{
    public partial class MainWindow : Window
    {
        // BoxPlot 데이터
        public ObservableCollection<BoxPlotData> BoxPlotChartData { get; set; } = new ObservableCollection<BoxPlotData>();

        // Detail 차트 데이터 (MP1~MP5)
        public ObservableCollection<DetailData> DetailChartData { get; set; } = new ObservableCollection<DetailData>();

        // EMA 데이터
        public ObservableCollection<EmaData> EmaChartData { get; set; } = new ObservableCollection<EmaData>();

        public MainWindow()
        {
            InitializeComponent();
            DataContext = this;

            // BoxPlot 데이터 로드
            LoadBoxPlotData();
        }

        /// <summary>
        /// BoxPlot 데이터를 데이터베이스에서 로드
        /// </summary>
        private void LoadBoxPlotData()
        {
            try
            {
                var connectionString = "YourConnectionString"; // 데이터베이스 연결 문자열
                using (var connection = new SqlConnection(connectionString))
                {
                    connection.Open();
                    var query = @"SELECT LineName, MP1DATA, MP2DATA, MP3DATA, MP4DATA, MP5DATA
                                  FROM View_InspectionResult WHERE LineName IS NOT NULL";

                    using (var command = new SqlCommand(query, connection))
                    using (var reader = command.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            var lineName = reader.GetString(0); // LineName
                            var mpData = new[]
                            {
                                reader.GetDouble(1),
                                reader.GetDouble(2),
                                reader.GetDouble(3),
                                reader.GetDouble(4),
                                reader.GetDouble(5)
                            };

                            // BoxPlot 데이터 추가
                            BoxPlotChartData.Add(new BoxPlotData
                            {
                                LineName = lineName,
                                MinValue = mpData.Min(),
                                MaxValue = mpData.Max(),
                                MedianValue = CalculateMedian(mpData),
                                LowerQuartile = CalculatePercentile(mpData, 25),
                                UpperQuartile = CalculatePercentile(mpData, 75)
                            });
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Error loading BoxPlot data: {ex.Message}");
            }
        }

        /// <summary>
        /// BoxPlot에서 선택된 라인 데이터를 기반으로 Detail 차트를 업데이트
        /// </summary>
        private void BoxPlotChart_MouseDown(object sender, System.Windows.Input.MouseButtonEventArgs e)
        {
            var hitInfo = BoxPlotChart.Diagram.CalcHitInfo(e.GetPosition(BoxPlotChart));
            if (hitInfo.InSeries)
            {
                var seriesPoint = hitInfo.SeriesPoint;
                if (seriesPoint != null)
                {
                    var selectedLineName = seriesPoint.Argument.ToString();
                    LoadDetailChartData(selectedLineName);
                }
            }
        }

        /// <summary>
        /// Detail 차트 데이터를 데이터베이스에서 로드
        /// </summary>
        private void LoadDetailChartData(string lineName)
        {
            try
            {
                DetailChartData.Clear();
                var connectionString = "YourConnectionString";

                using (var connection = new SqlConnection(connectionString))
                {
                    connection.Open();
                    var query = @"SELECT Timestamp, MP1DATA, MP2DATA, MP3DATA, MP4DATA, MP5DATA
                                  FROM View_InspectionResult
                                  WHERE LineName = @lineName
                                  ORDER BY Timestamp DESC";

                    using (var command = new SqlCommand(query, connection))
                    {
                        command.Parameters.AddWithValue("@lineName", lineName);

                        using (var reader = command.ExecuteReader())
                        {
                            while (reader.Read())
                            {
                                DetailChartData.Add(new DetailData
                                {
                                    Timestamp = reader.GetDateTime(0),
                                    MP1 = reader.GetDouble(1),
                                    MP2 = reader.GetDouble(2),
                                    MP3 = reader.GetDouble(3),
                                    MP4 = reader.GetDouble(4),
                                    MP5 = reader.GetDouble(5)
                                });
                            }
                        }
                    }
                }

                // EMA 데이터 계산
                CalculateEma();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"Error loading DetailChart data: {ex.Message}");
            }
        }

        /// <summary>
        /// EMA 데이터 계산
        /// </summary>
        private void CalculateEma()
        {
            EmaChartData.Clear();
            const double smoothing = 2.0;
            double ema = 0;

            var allData = DetailChartData
                .SelectMany(d => new[]
                {
                    new { d.Timestamp, Value = d.MP1 },
                    new { d.Timestamp, Value = d.MP2 },
                    new { d.Timestamp, Value = d.MP3 },
                    new { d.Timestamp, Value = d.MP4 },
                    new { d.Timestamp, Value = d.MP5 }
                })
                .OrderBy(d => d.Timestamp)
                .ToList();

            for (int i = 0; i < allData.Count; i++)
            {
                if (i == 0)
                {
                    ema = allData[i].Value;
                }
                else
                {
                    ema = (allData[i].Value - ema) * (smoothing / (1 + i)) + ema;
                }

                EmaChartData.Add(new EmaData
                {
                    Timestamp = allData[i].Timestamp,
                    EmaValue = ema
                });
            }
        }

        /// <summary>
        /// 중앙값 계산
        /// </summary>
        private double CalculateMedian(double[] values)
        {
            var sorted = values.OrderBy(v => v).ToArray();
            int mid = sorted.Length / 2;

            return (sorted.Length % 2 != 0) ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2.0;
        }

        /// <summary>
        /// 특정 퍼센트 계산 (Lower/Upper Quartile)
        /// </summary>
        private double CalculatePercentile(double[] values, int percentile)
        {
            var sorted = values.OrderBy(v => v).ToArray();
            double k = (percentile / 100.0) * (sorted.Length - 1);
            int f = (int)Math.Floor(k);
            int c = (int)Math.Ceiling(k);

            return (f == c) ? sorted[f] : sorted[f] + (k - f) * (sorted[c] - sorted[f]);
        }
    }

    /// <summary>
    /// BoxPlot 데이터 모델
    /// </summary>
    public class BoxPlotData
    {
        public string LineName { get; set; }
        public double MinValue { get; set; }
        public double MaxValue { get; set; }
        public double MedianValue { get; set; }
        public double LowerQuartile { get; set; }
        public double UpperQuartile { get; set; }
    }

    /// <summary>
    /// Detail 차트 데이터 모델
    /// </summary>
    public class DetailData
    {
        public DateTime Timestamp { get; set; }
        public double MP1 { get; set; }
        public double MP2 { get; set; }
        public double MP3 { get; set; }
        public double MP4 { get; set; }
        public double MP5 { get; set; }
    }

    /// <summary>
    /// EMA 데이터 모델
    /// </summary>
    public class EmaData
    {
        public DateTime Timestamp { get; set; }
        public double EmaValue { get; set; }
    }
}
XAML 코드 (MainWindow.xaml)
xml
코드 복사
<Window x:Class="RouterAlaskaResultViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
        Title="Router Alaska Result Viewer" Height="800" Width="1200">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="2*" />
            <RowDefinition Height="3*" />
        </Grid.RowDefinitions>

        <!-- BoxPlot Chart -->
        <dxc:ChartControl Grid.Row="0" x:Name="BoxPlotChart" MouseDown="BoxPlotChart_MouseDown">
            <dxc:ChartControl.Diagram>
                <dxc:XYDiagram2D>
                    <dxc:XYDiagram2D.AxisX>
                        <dxc:AxisX2D>
                            <dxc:AxisX2D.Title>
                                <dxc:AxisTitle Content="Line Name" Visibility="Visible" Alignment="Center" />
                            </dxc:AxisX2D.Title>
                        </dxc:AxisX2D>
                    </dxc:XYDiagram2D.AxisX>
                    <dxc:XYDiagram2D.AxisY>
                        <dxc:AxisY2D>
                            <dxc:AxisY2D.Title>
                                <dxc:AxisTitle Content="Values" Visibility="Visible" Alignment="Center" />
                            </dxc:AxisY2D.Title>
                        </dxc:XYDiagram2D.AxisY>

                    <!-- BoxPlot Series -->
                    <dxc:BoxPlotSeries2D DataSource="{Binding BoxPlotChartData}"
                                         ArgumentDataMember="LineName"
                                         MinValueDataMember="MinValue"
                                         MaxValueDataMember="MaxValue"
                                         MedianValueDataMember="MedianValue"
                                         LowerQuartileValueDataMember="LowerQuartile"
                                         UpperQuartileValueDataMember="UpperQuartile" />
                </dxc:XYDiagram2D>
            </dxc:ChartControl.Diagram>
        </dxc:ChartControl>

        <!-- Detail + EMA Chart -->
        <dxc:ChartControl Grid.Row="1">
            <dxc:ChartControl.Diagram>
                <dxc:XYDiagram2D>
                    <dxc:XYDiagram2D.AxisX>
                        <dxc:AxisX2D>
                            <dxc:AxisX2D.Title>
                                <dxc:AxisTitle Content="Timestamp" Visibility="Visible" Alignment="Center" />
                            </dxc:AxisX2D.Title>
                        </dxc:AxisX2D>
                    </dxc:XYDiagram2D.AxisX>
                    <dxc:XYDiagram2D.AxisY>
                        <dxc:AxisY2D>
                            <dxc:AxisY2D.Title>
                                <dxc:AxisTitle Content="Values" Visibility="Visible" Alignment="Center" />
                            </dxc:AxisY2D.Title>
                        </dxc:XYDiagram2D.AxisY>

                    <!-- EMA Line -->
                    <dxc:LineSeries2D DisplayName="EMA"
                                      DataSource="{Binding EmaChartData}"
                                      ArgumentDataMember="Timestamp"
                                      ValueDataMember="EmaValue"
                                      MarkerVisible="False" />

                    <!-- Scatter Points for MP1 ~ MP5 -->
                    <dxc:PointSeries2D DisplayName="MP1"
                                       DataSource="{Binding DetailChartData}"
                                       ArgumentDataMember="Timestamp"
                                       ValueDataMember="MP1" />
                    <dxc:PointSeries2D DisplayName="MP2"
                                       DataSource="{Binding DetailChartData}"
                                       ArgumentDataMember="Timestamp"
                                       ValueDataMember="MP2" />
                    <dxc:PointSeries2D DisplayName="MP3"
                                       DataSource="{Binding DetailChartData}"
                                       ArgumentDataMember="Timestamp"
                                       ValueDataMember="MP3" />
                    <dxc:PointSeries2D DisplayName="MP4"
                                       DataSource="{Binding DetailChartData}"
                                       ArgumentDataMember="Timestamp"
                                       ValueDataMember="MP4" />
                    <dxc:PointSeries2D DisplayName="MP5"
                                       DataSource="{Binding DetailChartData}"
                                       ArgumentDataMember="Timestamp"
                                       ValueDataMember="MP5" />
                </dxc:XYDiagram2D>
            </dxc:ChartControl.Diagram>
        </dxc:ChartControl>
    </Grid>
</Window>
주요 변경 사항
BoxPlot (최상단 차트):

각 라인의 데이터를 BoxPlot으로 표시.
Min, Max, Median, Lower Quartile, Upper Quartile 값을 계산하여 시각화.
클릭 시 하단 차트 업데이트.
Detail Chart (하단 차트):

MP1~MP5 데이터를 점으로 표시.
모든 데이터를 기반으로 Exponential Moving Average(EMA)를 계산하여 선으로 표시.
상호작용:
