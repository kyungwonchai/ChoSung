해했습니다. 하나의 QR 값을 공용으로 사용하여 여러 데이터베이스에서 조회하고, 그 값을 기반으로 여러 개의 functionA를 호출하여 각각의 결과를 동적으로 표시하는 방식으로 다시 구현하겠습니다.

요구 사항:
QR 값은 하나로 공용으로 사용됩니다.
여러 데이터베이스에서 여러 쿼리를 실행하여 결과를 얻고, 그 결과를 테이블 형식으로 UI에 출력합니다.
모든 쿼리 실행과 결과 처리는 비동기로 진행됩니다.
쿼리 결과는 각 쿼리마다 별도의 테이블로 UI에 동적으로 표시됩니다.
전체 코드
1. Flask 애플리케이션 (Python)
python
코드 복사
from flask import Flask, render_template, request, jsonify
import mymssql
import asyncio

app = Flask(__name__)

# MSSQL 데이터베이스 연결 함수
def fetch_data_from_db(connection_string, query, qr_value):
    """
    SQL Server 데이터베이스에 연결하여 주어진 쿼리와 QR 값을 실행한 후 결과를 반환하는 함수.
    connection_string: 데이터베이스 연결 문자열
    query: 실행할 SQL 쿼리
    qr_value: QR 값으로 쿼리 파라미터 사용
    """
    try:
        # mymssql을 사용하여 데이터베이스 연결
        conn = mymssql.connect(connection_string)
        cursor = conn.cursor()

        # QR 값을 쿼리 파라미터로 전달
        cursor.execute(query, (qr_value,))  # QR 값을 쿼리 파라미터로 전달

        # 컬럼명 가져오기
        columns = [column[0] for column in cursor.description]

        # 쿼리 결과 가져오기
        rows = cursor.fetchall()

        # 결과가 있으면 데이터를 테이블 형식으로 변환하여 반환
        if len(rows) > 0:
            data = [dict(zip(columns, row)) for row in rows]
            return data
        else:
            return None
    except Exception as e:
        return str(e)

# 함수 A: 커넥션 스트링과 쿼리, QR 값을 받아 데이터를 조회
def functionA(connection_string, query, qr_value):
    """
    fetch_data_from_db 함수를 호출하여 데이터를 조회하는 함수.
    여러 데이터베이스와 쿼리에서 동일한 QR 값을 사용하여 결과를 조회
    """
    result = fetch_data_from_db(connection_string, query, qr_value)
    return result

# 함수 B: QR 값을 받아 여러 개의 functionA를 실행
async def functionB(connection_string, queries, qr_value):
    """
    함수 B는 여러 개의 쿼리를 받아 비동기적으로 함수 A를 여러 번 실행하는 함수.
    각 쿼리의 결과를 리스트로 반환
    """
    # 함수 A를 비동기로 여러 번 실행
    results = []
    for query in queries:
        # 비동기적으로 함수A를 호출하여 결과를 받아옵니다.
        data = await asyncio.to_thread(functionA, connection_string, query, qr_value)
        results.append(data)
    return results

@app.route('/')
def index():
    # 기본 페이지로 이동 (입력 폼)
    return render_template('index.html')

@app.route('/get_data', methods=['POST'])
async def get_data():
    """
    사용자가 입력한 QR 값과 쿼리들을 받아 함수 B를 실행한 후 결과를 렌더링.
    """
    # 사용자가 입력한 값을 받음
    connection_string = request.form['connection_string']
    qr_value = request.form['qr_value']  # 공용 QR 값
    query1 = request.form['query1']
    query2 = request.form['query2']
    query3 = request.form['query3']
    
    # 쿼리들을 리스트에 저장
    queries = [query1, query2, query3]
    
    # 함수 B 실행: 여러 개의 쿼리를 비동기로 실행
    data = await functionB(connection_string, queries, qr_value)
    
    # 결과 처리: 데이터가 없으면 "없음" 메시지 출력
    if any(d is None for d in data):
        return jsonify({'status': 'No data', 'message': 'No data found for one or more queries.'})
    else:
        # 결과를 테이블 형식으로 렌더링
        return render_template('table.html', data=data)

if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0', port=5000)
2. HTML 템플릿 (입력 폼 - templates/index.html)
html
코드 복사
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Query</title>
</head>
<body>
    <h1>SQL 쿼리 실행</h1>
    <form action="/get_data" method="POST">
        <label for="connection_string">Connection String:</label><br>
        <input type="text" id="connection_string" name="connection_string" required><br><br>

        <label for="qr_value">QR Value:</label><br>
        <input type="text" id="qr_value" name="qr_value" required><br><br>

        <label for="query1">SQL Query 1:</label><br>
        <textarea id="query1" name="query1" required></textarea><br><br>

        <label for="query2">SQL Query 2:</label><br>
        <textarea id="query2" name="query2" required></textarea><br><br>

        <label for="query3">SQL Query 3:</label><br>
        <textarea id="query3" name="query3" required></textarea><br><br>

        <input type="submit" value="Run Queries">
    </form>
</body>
</html>
3. 결과 테이블 (HTML - templates/table.html)
html
코드 복사
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query Results</title>
</head>
<body>
    <h1>Query Results</h1>

    {% for result in data %}
        {% if result %}
            <h2>Results:</h2>
            <table border="1">
                <thead>
                    <tr>
                        {% for column in result[0].keys() %}
                            <th>{{ column }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in result %}
                        <tr>
                            {% for value in row.values() %}
                                <td>{{ value }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>해당 쿼리의 결과가 없습니다.</p>
        {% endif %}
    {% endfor %}
    
    <br>
    <a href="/">다시 실행</a>
</body>
</html>
코드 설명
fetch_data_from_db:

connection_string, query, qr_value를 받아 SQL Server에 연결하고, 주어진 쿼리를 실행하여 데이터를 가져옵니다.
쿼리 결과가 있으면 데이터를 딕셔너리 형태로 반환하고, 결과가 없으면 None을 반환합니다.
functionA:

fetch_data_from_db를 호출하여 데이터를 조회합니다. 이 함수는 여러 쿼리에서 동일한 QR 값을 사용하여 결과를 조회하는 역할을 합니다.
functionB:

functionA를 비동기적으로 여러 번 실행하여 각 쿼리 결과를 results 리스트에 저장합니다.
QR 값을 파라미터로 넘겨주어 각 쿼리에서 해당 값을 사용할 수 있게 합니다.
HTML 템플릿:

index.html: 사용자가 connection_string, qr_value와 여러 개의 SQL 쿼리를 입력할 수 있는 폼을 제공합니다.
table.html: functionB의 실행 결과를 테이블 형식으로 출력합니다. 각 쿼리마다 결과가 있다면 테이블로 출력하고, 없으면 "결과가 없습니다."라는 메시지를 표시합니다.
실행 방법
필요한 라이브러리 설치:

bash
코드 복사
pip install mymssql Flask
앱 실행:

bash
코드 복사
python app.py
브라우저에서 테스트: 브라우저에서 http://localhost:5000으로 접속하여 SQL 쿼리와 QR 값을 입력하고 결과를 확인할 수 있습니다.
