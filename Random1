Sub CheckIfWorkbookIsOpenThenStop()
    Dim fd As FileDialog
    Dim fileNames As Variant
    Dim i As Integer
    Dim isOpen As Boolean

    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .AllowMultiSelect = True
        .Title = "두 개의 엑셀 파일 선택"
        .Filters.Clear
        .Filters.Add "Excel Files", "*.xlsx, *.xls"

        If .Show = True Then
            fileNames = .SelectedItems
        Else
            MsgBox "파일이 선택되지 않았습니다."
            Exit Sub
        End If
    End With

    For i = 1 To UBound(fileNames)
        isOpen = IsWorkbookOpen(fileNames(i))
        If isOpen Then
            MsgBox "파일이 이미 열려 있습니다: " & fileNames(i)
            Exit Sub
        End If
    Next i

    ' 파일 처리 로직 ...
    ' 예: Workbooks.Open fileNames(i)

End Sub

Function IsWorkbookOpen(fileName As String) As Boolean
    Dim wb As Workbook
    On Error Resume Next
    Set wb = Workbooks(GetFileNameFromPath(fileName))
    On Error GoTo 0
    If Not wb Is Nothing Then
        IsWorkbookOpen = True
    Else
        IsWorkbookOpen = False
    End If
End Function

Function GetFileNameFromPath(filePath As String) As String
    GetFileNameFromPath = Mid(filePath, InStrRev(filePath, "\") + 1)
End Function
