UPDATE smd.tbl_history AS h
JOIN smd.tbl_modelchange AS m ON COALESCE(h.m8, h.m7) = m.ind
SET h.stab8_b = CASE
  WHEN TIME_TO_SEC(TIMEDIFF(m.stabilizedtime_b, m.stabilizedtime_b_start)) BETWEEN -3020399 AND 3020399
  THEN TIMEDIFF(m.stabilizedtime_b, m.stabilizedtime_b_start)
  ELSE NULL
END;
