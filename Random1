using System.Drawing;
using System.Windows.Forms;
using Microsoft.Web.WebView2.Core;
using Microsoft.Web.WebView2.WinForms;

namespace WebView2CaptureExample
{
    public partial class MainForm : Form
    {
        public MainForm()
        {
            InitializeComponent();
            InitializeWebView2();
        }

        private async void InitializeWebView2()
        {
            // WebView2 컨트롤 초기화 코드 생략 (위 예제 참조)

            // 웹 페이지 로딩
            webView21.CoreWebView2.Navigate("https://www.example.com");
        }

        private void CaptureImageButton_Click(object sender, EventArgs e)
        {
            CaptureWebView2ContentsAndCopyToClipboard();
        }

        private async void CaptureWebView2ContentsAndCopyToClipboard()
        {
            // WebView2 컨트롤의 크기에 맞는 Bitmap 생성
            Bitmap bitmap = new Bitmap(webView21.Width, webView21.Height);

            // WebView2 컨트롤의 화면을 렌더링하여 Bitmap에 그림
            await webView21.CoreWebView2.CapturePreviewAsync(CoreWebView2CapturePreviewImageFormat.Png, bitmap);

            // 캡쳐한 이미지를 클립보드에 복사
            Clipboard.SetImage(bitmap);

            // PictureBox에 캡쳐한 이미지 표시
            pictureBox1.Image = bitmap;
        }
    }
}
