WITH RankedTable AS (
    SELECT 
        ipadd, 
        기변로그_행시간값,
        TB구분,
        모델명_요약,
        ROW_NUMBER() OVER(PARTITION BY TB구분, ipadd ORDER BY 기변로그_행시간값 ASC) AS rn
    FROM PAOI_ChangeDetect
)
SELECT 
    a.ipadd,
    a.기변로그_행시간값,
    a.TB구분,
    a.모델명_요약 AS Current_모델명_요약,
    b.모델명_요약 AS Previous_모델명_요약
FROM RankedTable a
JOIN RankedTable b ON a.TB구분 = b.TB구분 AND a.ipadd = b.ipadd AND a.rn = b.rn + 1
WHERE a.모델명_요약 != b.모델명_요약
ORDER BY a.TB구분, a.ipadd, a.기변로그_행시간값 ASC;
