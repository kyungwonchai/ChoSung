서 BQ 열부터 시작하여 2행에 값이 있는 마지막 열까지 순회하면서, 각 열의 2행 값이 10자리이고, 3행 값이 500 이하일 때, 3행의 우측 셀이 비어 있으면 좌측 셀의 숫자와 합치고, 우측 셀이 비어 있지 않으면 우측 셀의 숫자와 합치는 작업을 수행하는 코드를 작성하겠습니다. 이 과정은 각 열의 모든 행에 대해 셀 배경색이 흰색일 때만 처리됩니다.

아래는 수정된 C# 코드 예시입니다:

csharp
Copy code
using System;
using Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Application excelApp = (Application)System.Runtime.InteropServices.Marshal.GetActiveObject("Excel.Application");
        Workbook workbook = null;

        foreach (Workbook wb in excelApp.Workbooks)
        {
            if (wb.Name.Contains("SMD_검사기"))
            {
                workbook = wb;
                break;
            }
        }

        if (workbook != null)
        {
            Worksheet worksheet = workbook.Worksheets["Data"];
            Range usedRange = worksheet.UsedRange;
            int startColumn = worksheet.Columns["BQ"].Column;
            int totalRows = usedRange.Rows.Count;
            int totalColumns = usedRange.Columns.Count;

            for (int col = startColumn; col <= totalColumns; col++)
            {
                if ((worksheet.Cells[2, col] as Range).Text.ToString().Length == 10)
                {
                    for (int row = 3; row <= totalRows; row++)
                    {
                        var cellColor = (worksheet.Cells[row, col] as Range).Interior.Color;
                        if (cellColor == XlRgbColor.rgbWhite)
                        {
                            if (double.TryParse((worksheet.Cells[row, col] as Range).Text, out double currentValue) && currentValue <= 500)
                            {
                                if (col < totalColumns && string.IsNullOrEmpty((worksheet.Cells[row, col + 1] as Range).Text))
                                {
                                    if (double.TryParse((worksheet.Cells[row, col - 1] as Range).Text, out double previousValue))
                                    {
                                        worksheet.Cells[row, col] = currentValue + previousValue;
                                    }
                                }
                                else if (col < totalColumns)
                                {
                                    int nextCol = col + 1;
                                    if (double.TryParse((worksheet.Cells[row, nextCol] as Range).Text, out double nextValue))
                                    {
                                        worksheet.Cells[row, col] = currentValue + nextValue;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        else
        {
            Console.WriteLine("해당하는 이름의 엑셀 파일이 열려있지 않습니다.");
        }
    }
}
이 코드는 다음과 같은 작업을 수행합니다:

실행 중인 Excel 인스턴스에 접근하여 "SMD_검사기"가 포함된 파일명을 가진 워크북을 찾습니다.
"Data" 시트에서 BQ 열부터 시작하여 2행에 값이 있는 마지막 열까지 순회합니다.
각 열의 2행 값이 10자리인 경우, 해당 열의 모든 행을 순회합니다.
각 행의 셀 배경색이 흰색일 때, 3행 값이 500 이하인 경우, 우측 셀이 비어 있으면 좌측 셀의 숫