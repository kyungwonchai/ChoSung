는 요청하신 조건을 만족하는 엑셀 VBA 코드입니다. 이 코드는 주차2_시트 시트에서 작업을 수행합니다. 주어진 조건을 확인한 후, 배경색을 변경하는 코드를 작성했습니다.

vba
코드 복사
Sub HighlightMergedCells()
    Dim ws As Worksheet
    Dim rng As Range
    Dim cell As Range
    Dim mergeArea As Range
    Dim b4Color As Long
    Dim hasSum As Boolean
    Dim checkRange As Range
    Dim checkCell As Range
    
    ' 시트 변수 설정
    Set ws = ThisWorkbook.Sheets("주차2_시트")
    
    ' B3 셀의 CurrentRegion 설정
    Set rng = ws.Range("B3").CurrentRegion
    
    ' B4 셀의 배경색 가져오기
    b4Color = ws.Range("B4").Interior.Color
    
    ' C열과 D열에 대해 병합된 셀 확인
    For Each cell In rng.Columns("C:D").Cells
        ' 병합된 셀인지 확인
        If cell.MergeCells Then
            Set mergeArea = cell.MergeArea
            
            ' 병합된 셀의 배경색이 B4와 같은지 확인
            If mergeArea.Interior.Color = b4Color Then
                ' 병합 영역에 "합계"가 포함되어 있는지 확인
                hasSum = False
                For Each checkCell In mergeArea
                    If InStr(1, checkCell.Value, "합계", vbTextCompare) > 0 Then
                        hasSum = True
                        Exit For
                    End If
                Next checkCell
                
                ' "합계"가 없다면 배경색을 노랑으로 변경
                If Not hasSum Then
                    mergeArea.Interior.Color = RGB(255, 255, 0) ' 노랑색
                End If
            End If
        End If
    Next cell
    
    MsgBox "작업이 완료되었습니다.", vbInformation
End Sub
코드 설명
시트 변수 설정: 주차2_시트라는 시트를 작업 대상으로 설정합니다.
CurrentRegion 설정: B3 셀과 연결된 셀 영역(CurrentRegion)을 가져옵니다.
B4 배경색 가져오기: B4 셀의 배경색을 비교 기준으로 사용합니다.
C열과 D열 병합 확인: C열과 D열의 모든 셀을 확인하며 병합된 영역만 작업 대상으로 합니다.
배경색 비교: 병합된 영역의 배경색이 B4와 같을 때만 작업을 진행합니다.