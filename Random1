네, USB 경로를 /media/pi/smd로 고정하고, python 명령어를 쳤을 때 자동으로 3.9 버전이 실행되도록 심볼릭 링크(바로가기)를 강제로 수정하는 로직을 추가하겠습니다.

또한 /home/pi/.local/bin/pip에 있는 패키지들도 /home/pi 전체를 복사하면 그대로 따라가지만, 시스템 전역에서 pip 명령어를 쳤을 때도 3.9 버전에 맞게 동작하도록 연결해 드리겠습니다.

아래 두 스크립트를 각각 **기존 라즈베리파이(Export)**와 **새 라즈베리파이(Import)**에서 실행하시면 됩니다.

1. (기존 라즈베리파이용) 백업 스크립트 (export_pi.sh)
USB 경로를 /media/pi/smd로 고정했습니다.

Bash

#!/bin/bash
# export_pi.sh
# 설명: /home/pi 전체를 /media/pi/smd USB로 백업

set -e

# 1. USB 경로 고정
USB_PATH="/media/pi/smd"
BACKUP_FILE="$USB_PATH/pi_home_full_backup.tar.gz"

echo "=== [1/3] 백업 준비 ==="
echo "USB 경로: $USB_PATH"

if [ ! -d "$USB_PATH" ]; then
    echo "에러: USB 경로($USB_PATH)가 존재하지 않습니다. USB를 연결했는지 확인하세요."
    exit 1
fi

echo "=== [2/3] /home/pi 전체 압축 중... (오래 걸릴 수 있음) ==="
# 권한 유지(p), 상세 출력(v-생략), 압축(z), 파일지정(f)
# /home/pi 내용을 통째로 압축
tar -czpf "$BACKUP_FILE" --directory / home/pi

echo "=== [3/3] 백업 완료 ==="
echo "저장된 파일: $BACKUP_FILE"
echo "이제 USB를 새 라즈베리파이로 옮기세요."
2. (새 라즈베리파이용) 복원 및 설정 스크립트 (import_pi.sh)
이 스크립트는 복원 후 python 명령어를 Python 3.9로 강제 연결합니다.

Bash

#!/bin/bash
# import_pi.sh
# 설명: 날짜 설정, 데이터 복원, Python 3.9 설치 및 명령어 연결(python -> 3.9)

set +e # 에러가 나도 멈추지 않고 진행 (삭제 과정 등을 위해)

# 1. USB 경로 고정
USB_PATH="/media/pi/smd"
BACKUP_FILE="$USB_PATH/pi_home_full_backup.tar.gz"

# 루트 권한 체크
if [ "$EUID" -ne 0 ]; then
  echo "에러: sudo로 실행해주세요. (예: sudo ./import_pi.sh)"
  exit 1
fi

echo "=== [1/6] 날짜 및 시간 설정 ==="
date -s "2025-12-15 13:30:00"
echo "현재 시간: $(date)"

if [ ! -f "$BACKUP_FILE" ]; then
    echo "에러: USB 경로에 백업 파일이 없습니다 ($BACKUP_FILE)"
    exit 1
fi

echo "=== [2/6] 기존 /home/pi 데이터 삭제 ==="
# 숨김 파일(.local 등) 포함하여 싹 비움
find /home/pi -mindepth 1 -delete
echo "/home/pi 폴더를 비웠습니다."

echo "=== [3/6] 백업 데이터 복원 ==="
tar -xzpf "$BACKUP_FILE" -C /
echo "복원 완료."

echo "=== [4/6] 소유권 및 권한 복구 ==="
# 복사해온 파일들이 pi 유저 소유가 되도록 강제 설정
chown -R pi:pi /home/pi

echo "=== [5/6] Python 3.9 설치 (Source Build) ==="
PYTHON_SRC_DIR="/home/pi/Python-3.9.18"

if [ -d "$PYTHON_SRC_DIR" ]; then
    echo "Python 소스 폴더 발견. 설치를 진행합니다..."
    cd "$PYTHON_SRC_DIR"
    
    # 인터넷이 없으므로 기존 빌드된 파일을 믿고 설치 (altinstall 사용)
    # altinstall은 원래 python3 명령어를 덮어쓰지 않지만, 아래 6단계에서 우리가 강제로 덮어쓸 것입니다.
    make altinstall
    
    if [ $? -eq 0 ]; then
        echo "Python 3.9 바이너리 설치 완료 (/usr/local/bin/python3.9)"
    else
        echo "경고: make install 중 오류가 발생했으나 계속 진행합니다."
    fi
else
    echo "경고: Python-3.9.18 폴더가 없어 설치를 건너뜁니다."
fi

echo "=== [6/6] 명령어 강제 연결 (Link Python to 3.9) ==="
# 질문하신 내용: "python --version 하면 3.9가 나오게 해줘"
# 이를 위해 /usr/bin/python 과 /usr/bin/python3 심볼릭 링크를 새로 설치한 3.9로 변경합니다.

# 1. python 명령어 연결
if [ -f "/usr/local/bin/python3.9" ]; then
    echo "python -> python3.9 로 연결 중..."
    rm -f /usr/bin/python
    ln -s /usr/local/bin/python3.9 /usr/bin/python
    
    # 2. python3 명령어 연결 (기존 sudo python3 --version 대응)
    echo "python3 -> python3.9 로 연결 중..."
    rm -f /usr/bin/python3
    ln -s /usr/local/bin/python3.9 /usr/bin/python3
    
    # 3. pip 명령어 연결
    echo "pip -> pip3.9 로 연결 중..."
    rm -f /usr/bin/pip
    ln -s /usr/local/bin/pip3.9 /usr/bin/pip
    
    echo "설정 완료!"
    echo "이제 'python --version' 결과: "
    /usr/bin/python --version
else
    echo "에러: Python 3.9 설치가 제대로 되지 않아 링크를 걸 수 없습니다."
fi

echo ""
echo "!!! 작업 끝. 리부팅 권장 (sudo reboot) !!!"
변경 사항 및 설명
USB 경로 고정 (/media/pi/smd):

스크립트 내에 USB_PATH 변수로 박아두었습니다. USB 이름이 smd라면 꽂는 순간 이 경로로 인식될 것입니다.

명령어 자동 연결 (python -> 3.9):

원래 make altinstall은 기존 시스템 보호를 위해 python3.9라는 명령어로만 설치됩니다.

6단계에 추가한 ln -s 명령어들이 기존의 python, python3, pip 연결을 끊고, 방금 설치한 python3.9로 강제 연결합니다.

이제 터미널에서 python --version을 치면 Python 3.9.18이 나올 것입니다.

pip와 .local 폴더 처리:

/home/pi/.local 폴더는 3단계에서 통째로 복사되므로, 기존에 pip install --user로 설치했던 라이브러리들은 그대로 남아있습니다.

제가 추가한 ln -s ... /usr/bin/pip 덕분에, 어느 경로에서든 pip list를 치면 설치된 패키지들을 볼 수 있게 됩니다.

실행 방법 (새 라즈베리파이에서):

Bash

# USB 연결 후
cd /media/pi/smd
sudo ./import_pi.sh
이렇게 하면 원하시는 대로 기존 환경이 그대로 이식되고 명령어 문제도 해결됩니다.