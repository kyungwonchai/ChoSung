dd a Bar Chart Below the Table in Streamlit
Goal:
Display a table with BOT CT and TOP CT values.
Generate a bar chart below the table.
Ensure labels match MC1 ~ MC8.
Use matplotlib or altair for visualization in Streamlit.
✅ 📌 Explanation:
Step 1: Fetch data using pymssql (already done).
Step 2: Convert BOT CT and TOP CT values into a Pandas DataFrame.
Step 3: Use matplotlib or altair to create a grouped bar chart.
Step 4: Display the chart in Streamlit.
✅ 🔹 Updated Streamlit Code (with Bar Chart)
python
코드 복사
import streamlit as st
import pymssql
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np

# 📌 MSSQL connection settings
DB_CONFIG = {
    "server": "your_server",
    "user": "your_username",
    "password": "your_password",
    "database": "your_database"
}

# 📌 Fetch model-wise latest min values for a specific line
def get_recent_models_min_data(line_name):
    conn = pymssql.connect(**DB_CONFIG)
    cursor = conn.cursor(as_dict=True)

    cursor.execute("EXEC Get_Min_Data_By_Recent_Models %s", (line_name,))
    data = cursor.fetchall()
    conn.close()

    return data

# 📌 Fetch available lines
def get_lines():
    conn = pymssql.connect(**DB_CONFIG)
    cursor = conn.cursor()
    cursor.execute("SELECT DISTINCT 라인 FROM ExcelData ORDER BY 라인")
    lines = [row[0] for row in cursor.fetchall()]
    conn.close()
    return lines

# 📌 Streamlit UI
st.title("Line-Based Model Data Analysis")

# 📌 Line selection
lines = get_lines()
selected_line = st.sidebar.selectbox("Select Line", lines)

# 📌 Fetch and display data
if selected_line:
    data = get_recent_models_min_data(selected_line)

    if data:
        for row in data:
            model_name = row["모델"]
            latest_time = row["최신시간"]

            # 📌 Convert data into DataFrame format for table
            table_data = {
                "Category": ["BOT CT", "TOP CT"],
                "MC1": [row["BCT1_1"], row["TCT1_1"]],
                "MC2": [row["BCT1_2"], row["TCT1_2"]],
                "MC3": [row["BCT1_3"], row["TCT1_3"]],
                "MC4": [row["BCT1_4"], row["TCT1_4"]],
                "MC5": [row["BCT1_5"], row["TCT1_5"]],
                "MC6": [row["BCT1_6"], row["TCT1_6"]],
                "MC7": [row["BCT1_7"], row["TCT1_7"]],
                "MC8": [row["BCT1_8"], row["TCT1_8"]],
            }
            df = pd.DataFrame(table_data)

            # 📌 Display table
            st.subheader(f"Model: {model_name} | Latest Time: {latest_time}")
            st.table(df)

            # 📌 Convert DataFrame to NumPy array for chart plotting
            labels = ["MC1", "MC2", "MC3", "MC4", "MC5", "MC6", "MC7", "MC8"]
            bot_ct_values = np.array(df.iloc[0, 1:])  # BOT CT values
            top_ct_values = np.array(df.iloc[1, 1:])  # TOP CT values

            # 📌 Bar chart
            fig, ax = plt.subplots(figsize=(8, 5))

            x = np.arange(len(labels))
            width = 0.35  # Bar width

            # 📌 Plot BOT CT and TOP CT values
            ax.bar(x - width / 2, bot_ct_values, width, label="BOT CT")
            ax.bar(x + width / 2, top_ct_values, width, label="TOP CT")

            # 📌 Chart settings
            ax.set_xlabel("MC Machines")
            ax.set_ylabel("CT Values")
            ax.set_title(f"BOT CT vs TOP CT for Model {model_name}")
            ax.set_xticks(x)
            ax.set_xticklabels(labels)
            ax.legend()

            # 📌 Display chart
            st.pyplot(fig)

    else:
        st.warning("No data available for the selected line.")
✅ 📌 Explanation of the Changes:
Convert the table values (BOT CT, TOP CT) into a NumPy array for plotting.
Use matplotlib to create a grouped bar chart with two sets:
BOT CT (Blue bars)
TOP CT (Orange bars)
Set proper labels:
X-axis → MC1 to MC8
Y-axis → CT Values
Title → "BOT CT vs TOP CT for Model XYZ"
Use st.pyplot(fig) to display the chart below the table.
✅ 📌 How to Run the Updated Code
bash
코드 복사
pip install streamlit pymssql pandas matplotlib numpy
streamlit run app.py
Open browser → http://localhost:8501
Select a Line
See the Table and the Bar Chart Below It
✅ 📌 Example Output
Table Output
Category	MC1	MC2	MC3	MC4	MC5	MC6	MC7	MC8
BOT CT	10	5	8	12	6	9	4	7
TOP CT	9	4	7	11	8	6	5	7
Bar Chart Output
X-axis: MC1 ~ MC8
Y-axis: BOT CT & TOP CT values