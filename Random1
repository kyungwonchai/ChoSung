래의 SQL 쿼리는 특정 값('%abc%')을 포함하는 행을 찾은 후, 해당 행을 기준으로 이전 3개 행과 이후 3개 행을 가져오는 방식입니다.

📌 SQL 쿼리
sql
코드 복사
WITH CTE AS (
    SELECT 
        szmodelname, 
        szbarcode, 
        no1,
        ROW_NUMBER() OVER (ORDER BY no1) AS rn
    FROM MergedTable
),
TargetRow AS (
    -- 검색값('%abc%')을 포함하는 행 중 no1 기준으로 가장 첫 번째 값을 찾음
    SELECT TOP 1 no1, rn 
    FROM CTE 
    WHERE szmodelname LIKE '%abc%' 
    ORDER BY no1
)
-- 해당 행의 no1을 기준으로 상위 3개, 하위 3개 포함하여 조회
SELECT CTE.*
FROM CTE
JOIN TargetRow ON CTE.rn BETWEEN TargetRow.rn - 3 AND TargetRow.rn + 3
ORDER BY CTE.no1;
📌 설명
WITH CTE AS (...)

ROW_NUMBER() OVER (ORDER BY no1)을 사용하여 no1 기준 정렬된 **행 번호 (rn)**를 부여합니다.
TargetRow AS (...)

szmodelname에 %abc%가 포함된 첫 번째 행을 찾아 no1 값과 rn 값을 저장합니다.
SELECT CTE.* FROM CTE JOIN TargetRow

TargetRow.rn - 3부터 TargetRow.rn + 3까지 이전 3개 행과 이후 3개 행을 포함하여 조회합니다.
ORDER BY CTE.no1로 원래 순서를 유지합니다.
📌 실행 예시
💡 MergedTable이 아래와 같다고 가정

szmodelname	szbarcode	no1
model001	1234567	10
model002	2345678	20
abc001	3456789	30
model004	4567890	40
model005	5678901	50
model006	6789012	60
model007	7890123	70
🎯 결과 ('%abc%' 포함된 no1 = 30 행을 기준으로 위 3개, 아래 3개 가져오기)

szmodelname	szbarcode	no1
model001	1234567	10
model002	2345678	20
abc001	3456789	30
model004	4567890	40
model005	5678901	50
model006	6789012	60
📌 만약 검색 결과가 여러 개라면?
여러 개의 행이 %abc%를 포함할 경우, 첫 번째 no1을 가진 행만 기준으로 합니다.
만약 여러 개 검색된 행들을 각각의 기준으로 before/after 3개를 가져오고 싶다면, TOP 1을 제거하면 됩니다.
📌 저장 프로시저 (Stored Procedure)
SQL Server에서 저장 프로시저를 만들고 사용할 수도 있습니다.

sql
코드 복사
CREATE PROCEDURE GetSurroundingRows
    @searchValue NVARCHAR(100)
AS
BEGIN
    SET NOCOUNT ON;
    
    WITH CTE AS (
        SELECT 
            szmodelname, 
            szbarcode, 
            no1,
            ROW_NUMBER() OVER (ORDER BY no1) AS rn
        FROM MergedTable
    ),
    TargetRow AS (
        SELECT TOP 1 no1, rn 
        FROM CTE 
        WHERE szmodelname LIKE '%' + @searchValue + '%'
        ORDER BY no1
    )
    SELECT CTE.*
    FROM CTE
    JOIN TargetRow ON CTE.rn BETWEEN TargetRow.rn - 3 AND TargetRow.rn + 3
    ORDER BY CTE.no1;
END;
📌 실행 방법
sql
코드 복사