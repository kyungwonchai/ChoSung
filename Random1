 VBA에서 MSSQL 2014의 내용을 조회하고, 프로시저를 사용하여 파라미터 3개를 문자열로 넘겨받는 예제 코드를 작성해보겠습니다. 프로시저를 호출하고, 결과를 Recordset으로 받아 처리하는 방법을 보여드리겠습니다.

1. MSSQL에서 프로시저 작성
먼저 MSSQL에서 사용할 프로시저를 작성합니다. 이 프로시저는 세 개의 문자열 파라미터를 받아서 결과를 반환하는 역할을 합니다.

sql
코드 복사
CREATE PROCEDURE GetRecordsByParameters
    @Param1 NVARCHAR(50),
    @Param2 NVARCHAR(50),
    @Param3 NVARCHAR(50)
AS
BEGIN
    SELECT * 
    FROM YourTableName
    WHERE Column1 = @Param1 AND Column2 = @Param2 AND Column3 = @Param3;
END
2. 엑셀 VBA 코드 작성
엑셀 VBA에서 이 프로시저를 호출하고 결과를 처리하는 코드를 작성합니다.

vba
코드 복사
Sub GetRecordsFromSQL()
    Dim conn As Object
    Dim rs As Object
    Dim cmd As Object
    Dim connectionString As String
    Dim sql As String
    Dim param1 As String
    Dim param2 As String
    Dim param3 As String

    ' Set your parameter values
    param1 = "Value1"
    param2 = "Value2"
    param3 = "Value3"

    ' Set the connection string
    connectionString = "Provider=SQLOLEDB;Data Source=YourServerName;Initial Catalog=YourDatabaseName;User ID=YourUsername;Password=YourPassword;"

    ' Create the connection and command objects
    Set conn = CreateObject("ADODB.Connection")
    Set cmd = CreateObject("ADODB.Command")
    Set rs = CreateObject("ADODB.Recordset")

    ' Open the connection
    conn.Open connectionString

    ' Configure the command object
    With cmd
        .ActiveConnection = conn
        .CommandText = "GetRecordsByParameters"
        .CommandType = adCmdStoredProc
        .Parameters.Append .CreateParameter("@Param1", adVarChar, adParamInput, 50, param1)
        .Parameters.Append .CreateParameter("@Param2", adVarChar, adParamInput, 50, param2)
        .Parameters.Append .CreateParameter("@Param3", adVarChar, adParamInput, 50, param3)
    End With

    ' Execute the command and open the recordset
    Set rs = cmd.Execute

    ' Process the recordset
    If Not rs.EOF Then
        Do While Not rs.EOF
            ' Your code to process each record
            Debug.Print rs.Fields("YourColumnName").Value
            rs.MoveNext
        Loop
    End If

    ' Clean up
    rs.Close
    conn.Close
    Set rs = Nothing
    Set cmd = Nothing
    Set conn = Nothing
End Sub
설명
프로시저 생성: GetRecordsByParameters라는 프로시저를 생성하고 세 개의 파라미터를 받아 조건에 맞는 레코드를 조회합니다.
VBA 코드 설정: 엑셀 VBA에서 MSSQL 서버와의 연결을 설정합니다. ADODB.Connection, ADODB.Command, ADODB.Recordset 객체를 사용합니다.
파라미터 설정: cmd 객체에 프로시저 이름과 파라미터를 설정합니다.
프로시저 실행: cmd.Execute 메서드를 사용하여 프로시저를 실행하고, 결과를 rs 객체로 받아서 처리합니다.
레코드셋 처리: rs 객체를 사용하여 각 레코드를 순회하며 필요한 작업을 수행합니다.
이 코드를 실행하면 지정한 파라미터로 프로시저를 호출하여 결과를 조회하고 처리할 수 있습니다. 추가적인 질문이 있으