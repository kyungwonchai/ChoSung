 ì—†ì´ ìœˆë„ìš° APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥ ê°ì§€í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë‹¤ì‹œ ì„¤ê³„í•˜ê² ìŠµë‹ˆë‹¤.
í›„í‚¹ì´ í•„ìš” ì—†ëŠ” ë°©ì‹ìœ¼ë¡œ í›¨ì”¬ ê°€ë³ê³ , ê¸°ì—… í™˜ê²½ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•œ ì•ˆì „í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

âœ… í•´ê²° ë°©ë²•
ìœˆë„ìš° API GetLastInputInfo í™œìš©

í‚¤ë³´ë“œ/ë§ˆìš°ìŠ¤ ì…ë ¥ì´ ì–¸ì œ ìˆì—ˆëŠ”ì§€ í™•ì¸
ì‹œìŠ¤í…œ ì „ì²´ì˜ ë§ˆì§€ë§‰ ì…ë ¥ ì‹œê°„ì„ ê°€ì ¸ì˜´ (ì „ì—­ í›„í‚¹ ë¶ˆí•„ìš”)
íƒ€ì´ë¨¸ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ ì…ë ¥ì´ ì—†ìœ¼ë©´ ëª¨ë‹ˆí„°ë¥¼ ë”
ëª¨ë‹ˆí„° ON/OFF ì œì–´ (SendMessage)

SC_MONITORPOWER ë©”ì‹œì§€ë¥¼ SendMessageë¡œ ì§ì ‘ ì „ë‹¬
PostMessageê°€ ì•„ë‹Œ SendMessage(GetDesktopWindow()) ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì  ì‹¤í–‰
íŠ¸ë ˆì´ ì•„ì´ì½˜ ìœ ì§€

UIê°€ ì—†ì–´ë„ íŠ¸ë ˆì´ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •
ğŸš€ ì™„ì „í•œ ì†ŒìŠ¤ ì½”ë“œ (í›„í‚¹ ì—†ì´ êµ¬í˜„)
csharp
ì½”ë“œ ë³µì‚¬
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows.Forms;

namespace MonitorAutoControl
{
    static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new AppContext());
        }
    }

    public class AppContext : ApplicationContext
    {
        private static readonly int WM_SYSCOMMAND = 0x0112;
        private static readonly int SC_MONITORPOWER = 0xF170;
        private static readonly int MONITOR_ON = -1;
        private static readonly int MONITOR_OFF = 2;
        private static readonly int IDLE_TIME_LIMIT = 60 * 1000; // 1ë¶„ (1000ms * 60)

        private System.Threading.Timer _idleTimer;
        private NotifyIcon _trayIcon;

        public AppContext()
        {
            // 1ì´ˆë§ˆë‹¤ ì…ë ¥ ê°ì§€
            _idleTimer = new System.Threading.Timer(CheckIdleState, null, 1000, 1000);

            // íŠ¸ë ˆì´ ì•„ì´ì½˜ ì„¤ì •
            _trayIcon = new NotifyIcon
            {
                Icon = SystemIcons.Application,
                Visible = true,
                ContextMenuStrip = new ContextMenuStrip()
                {
                    Items = { new ToolStripMenuItem("ì¢…ë£Œ", null, (s, e) => ExitApplication()) }
                }
            };

            Application.ApplicationExit += (s, e) => CleanUp();
        }

        private void CheckIdleState(object state)
        {
            int idleTime = GetIdleTime();
            if (idleTime > IDLE_TIME_LIMIT)
            {
                TurnMonitorOff();
            }
            else
            {
                TurnMonitorOn();
            }
        }

        private int GetIdleTime()
        {
            LASTINPUTINFO lastInputInfo = new LASTINPUTINFO();
            lastInputInfo.cbSize = Marshal.SizeOf(typeof(LASTINPUTINFO));

            if (GetLastInputInfo(ref lastInputInfo))
            {
                return Environment.TickCount - lastInputInfo.dwTime;
            }
            return 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜
        }

        private void TurnMonitorOn()
        {
            SendMessage(GetDesktopWindow(), WM_SYSCOMMAND, (IntPtr)SC_MONITORPOWER, (IntPtr)MONITOR_ON);
        }

        private void TurnMonitorOff()
        {
            SendMessage(GetDesktopWindow(), WM_SYSCOMMAND, (IntPtr)SC_MONITORPOWER, (IntPtr)MONITOR_OFF);
        }

        private void ExitApplication()
        {
            CleanUp();
            Application.Exit();
        }

        private void CleanUp()
        {
            _trayIcon.Dispose();
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct LASTINPUTINFO
        {
            public int cbSize;
            public int dwTime;
        }

        [DllImport("user32.dll")]
        private static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr GetDesktopWindow();

        [DllImport("user32.dll", SetLastError = true)]
        private static extern IntPtr SendMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam);
    }
}
ğŸ” ì½”ë“œ ì„¤ëª…
ë§ˆìš°ìŠ¤/í‚¤ë³´ë“œ ì…ë ¥ ê°ì§€ (GetLastInputInfo)

GetLastInputInfo()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì§€ë§‰ ì‚¬ìš©ì ì…ë ¥ ì‹œê°„ì„ ê°€ì ¸ì˜´.
í˜„ì¬ ì‹œê°„(Environment.TickCount)ê³¼ ë¹„êµí•˜ì—¬ ì…ë ¥ ê°„ê²©ì„ ê³„ì‚°.
ì „ì—­ í›„í‚¹ì´ ë¶ˆí•„ìš”í•˜ë©°, ì‹œìŠ¤í…œ ì „ì²´ì—ì„œ ì‘ë™.
ëª¨ë‹ˆí„° ON/OFF (SendMessage)

WM_SYSCOMMAND ë©”ì‹œì§€ë¥¼ GetDesktopWindow()ì— ì§ì ‘ ë³´ëƒ„.
MONITOR_OFF(2), MONITOR_ON(-1) ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê²Œ ìŠ¤ìœ„ì¹­.
ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

ApplicationContext ì‚¬ìš© â†’ UI ì—†ì´ íŠ¸ë ˆì´ì—ì„œ ì‹¤í–‰ë¨.
íŠ¸ë ˆì´ ì•„ì´ì½˜ ìœ ì§€, ìš°í´ë¦­ìœ¼ë¡œ ì¢…ë£Œ ê°€ëŠ¥.
âœ… ìµœì¢… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
 í‚¤ë³´ë“œ/ë§ˆìš°ìŠ¤ ì…ë ¥ ê°ì§€ ì •ìƒ ì‘ë™
 1ë¶„ í›„ ìë™ìœ¼ë¡œ ëª¨ë‹ˆí„° OFF í™•ì¸
 ì…ë ¥ ë°œìƒ ì‹œ ëª¨ë‹ˆí„° ON í™•ì¸
 íŠ¸ë ˆì´ ì•„ì´ì½˜ ì •ìƒ ì‘ë™ í™•ì¸