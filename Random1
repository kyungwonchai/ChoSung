편을 드려 죄송합니다. 파일의 전체 경로에서 특정 패턴을 포함하는지 확인하는 코드를 제공하겠습니다. 아래의 코드는 전체 파일 경로가 주어진 패턴을 포함하는지 확인하는 방식으로 작성되었습니다.

다시 한 번 정확하게 조건을 반영하여 코드를 작성하겠습니다.

csharp
코드 복사
using System;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Timers;
using System.Windows;

namespace FolderCheckApp
{
    public partial class MainWindow : Window
    {
        private Timer timer;
        private readonly string[] folderPaths = {
            @"C:\Folder1",
            @"C:\Folder2",
            @"D:\Folder3",
            @"E:\Folder4",
            @"F:\Folder5"
        };
        private readonly Regex filePathPattern = new Regex(@"B?SM-.+_.+_.+_.+.*\.jpg$", RegexOptions.IgnoreCase);

        public MainWindow()
        {
            InitializeComponent();
            InitializeTimer();
        }

        private void InitializeTimer()
        {
            timer = new Timer(3600000); // 1 hour interval in milliseconds
            timer.Elapsed += OnTimerElapsed;
            timer.AutoReset = true;
            timer.Start();
        }

        private void OnTimerElapsed(object sender, ElapsedEventArgs e)
        {
            foreach (var folderPath in folderPaths)
            {
                if (Directory.Exists(folderPath))
                {
                    var jpgFiles = Directory.GetFiles(folderPath, "*.jpg", SearchOption.AllDirectories)
                                            .Where(file => filePathPattern.IsMatch(file));
                    if (jpgFiles.Count() >= 20)
                    {
                        var recentFiles = jpgFiles.Where(file => File.GetCreationTime(file) > DateTime.Now.AddHours(-1));
                        if (recentFiles.Any())
                        {
                            // Folder is selected
                            Dispatcher.Invoke(() => PerformNextAction(folderPath));
                            return;
                        }
                    }
                }
            }
        }

        private void PerformNextAction(string selectedFolderPath)
        {
            // Implement the next action to be performed on the selected folder
            MessageBox.Show($"Selected Folder: {selectedFolderPath}");
        }
    }
}
이 코드는 다음과 같은 방식으로 동작합니다:

주어진 경로의 모든 폴더를 검색합니다.
각 폴더 내의 모든 JPG 파일을 검색합니다.
파일 전체 경로에서 "B?SM-.+.+.+_.+.*.jpg$" 패턴을 만족하는 파일을 찾습니다.
조건에 맞는 파일이 20개 이상인 폴더를 선택합니다.
선택된 폴더 내의 최근 1시간 이내에 생성된 파일이 있는지 확인합니다.
조건을 만족하면 후속 작업을 수행합니다.
정규식 @"B?SM-.+_.+_.+_.+.*\.jpg$"는 다음과 같은 구조를 갖습니다:

B?: B는 선택적으로 포함될 수 있습니다.
SM-: 반드시 포함되는 패턴입니다.
.+_: 임의의 문자로 채워진 블록입니다.
.+_.+_.+_: 위와 같은 블록이 세 번 반복됩니다.
.*\.jpg$: 마지막으로 ".jpg"로 끝나는 패턴입니다.
이 코드를 사용하면 파일의 전체 경로에 주어진 패턴이 포함되어 있는지 확인할 수 있습