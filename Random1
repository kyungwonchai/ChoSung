<dx:ThemedWindow
    x:Class="LockerManagementApp.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:local="clr-namespace:LockerManagementApp.Views"
    xmlns:viewmodels="clr-namespace:LockerManagementApp.ViewModels"
    xmlns:models="clr-namespace:LockerManagementApp.Models"
    Title="사물함 관리 프로그램 (DevExpress MVVM - .NET 8)" Height="700" Width="1200"
    >
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <RowDefinition Height="*"/>    <RowDefinition Height="Auto"/> </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="LightGray" Padding="5"> <StackPanel Orientation="Horizontal">
                <Button Content="🔄 로드/새로고침" Margin="3" Command="{Binding LoadDataCommand}" ToolTip="데이터베이스에서 최신 정보를 불러옵니다."/>
                <Button Content="💾 변경 사항 저장" Margin="3" Command="{Binding SaveChangesCommand}" ToolTip="그리드에서 변경된 내용을 데이터베이스에 저장합니다."/>
                <Button Content="➕ 새 사물함 추가" Margin="3" Command="{Binding AddNewCommand}" ToolTip="새로운 사물함 정보를 추가합니다 (새 행이 추가되며 직접 편집)."/>
                <Button Content="❌ 선택 항목 삭제" Margin="3" Command="{Binding DeleteCommand}" ToolTip="선택된 사물함 정보를 데이터베이스에서 삭제합니다."/>
                <Button Content="🧹 배정 해제" Margin="3,3,15,3" Command="{Binding ClearAssignmentCommand}" ToolTip="선택된 사물함의 사용자 배정 정보(이름, ID 등)를 제거합니다."/>
            </StackPanel>
        </Border>

        <dxg:GridControl Grid.Row="1"
                         ItemsSource="{Binding LockerAssignments}"
                         SelectedItem="{Binding SelectedAssignment, Mode=TwoWay}"
                         AutoGenerateColumns="None"
                         EnableSmartColumnsGeneration="False"
                         SelectionMode="Row"
                         >
            <dxg:GridControl.View>
                <dxg:TableView AllowPerPixelScrolling="True"
                               ShowTotalSummary="False"
                               ShowGroupPanel="True"
                               AllowEditing="True"
                               NavigationStyle="Cell"
                               ShowAutoFilterRow="True"
                               NewItemRowPosition="None"
                               ShowIndicator="True"
                               ShowSearchPanelMode="Always"
                               ShowSearchPanelFindButton="True"
                               ShowSearchPanelCloseButton="True"
                               SearchPanelHighlightResults="True"
                               >
                     <dxg:TableView.RowCellMenuCustomizations>
                         <dxb:BarButtonItem Content="선택 항목 배정 해제"
                                            Command="{Binding View.DataContext.ClearAssignmentCommand}"
                                            Glyph="{dx:DXImage Svg/Actions/DeleteList.svg}"/>
                         <dxb:BarItemSeparator/>
                         <dxb:BarButtonItem Content="선택 행 삭제"
                                            Command="{Binding View.DataContext.DeleteCommand}"
                                            Glyph="{dx:DXImage Svg/Actions/Delete.svg}"/>
                     </dxg:TableView.RowCellMenuCustomizations>
                </dxg:TableView>
            </dxg:GridControl.View>

            <dxg:GridControl.Columns>
                <dxg:GridColumn FieldName="LockerType" Header="종류" Width="100" Fixed="Left">
                    <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.LockerTypes, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}}"
                                                  IsTextEditable="False"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                 <dxg:GridColumn FieldName="Floor" Header="층" Width="60">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Floors, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}}"
                                                  IsTextEditable="False"/>
                    </dxg:GridColumn.EditSettings>
                 </dxg:GridColumn>
                <dxg:GridColumn FieldName="Zone" Header="구역" Width="80">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Zones, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="SpecificLocation" Header="세부 위치" Width="120"/>
                <dxg:GridColumn FieldName="UserName" Header="성명" Width="100"/>
                <dxg:GridColumn FieldName="KnoxId" Header="Knox ID" Width="100"/>
                <dxg:GridColumn FieldName="SubPart" Header="소파트" Width="120">
                     <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.SubParts, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                 <dxg:GridColumn FieldName="Administrator" Header="관리 담당자" Width="120">
                      <dxg:GridColumn.EditSettings>
                        <dxe:ComboBoxEditSettings ItemsSource="{Binding DataContext.Administrators, RelativeSource={RelativeSource AncestorType={dx:ThemedWindow}}}"
                                                  IsTextEditable="True"/>
                    </dxg:GridColumn.EditSettings>
                 </dxg:GridColumn>
                <dxg:GridColumn FieldName="LastUpdated" Header="최종 수정일시" Width="150" AllowEditing="False" ReadOnly="True">
                     <dxg:GridColumn.EditSettings>
                        <dxe:DateEditSettings MaskType="DateTime" Mask="yyyy-MM-dd HH:mm:ss" MaskUseAsDisplayFormat="True"/>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="Id" Header="ID" Visible="False" ReadOnly="True"/>
            </dxg:GridControl.Columns>

        </dxg:GridControl>

        <StatusBar Grid.Row="2" Background="LightGray"> <StatusBarItem>
                <TextBlock Text="{Binding StatusBarText}" Margin="5,0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
