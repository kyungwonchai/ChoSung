ê²°ë¡ ë¶€í„° ë§ì”€ë“œë¦¬ë©´, Graphics.FromImage()ëŠ” WPFì˜ BitmapImageì— ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‘ ê°ì²´ëŠ” ì„œë¡œ ë‹¤ë¥¸ ê·¸ë˜í”½ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

System.Windows.Media.Imaging.BitmapImage: WPF ì „ìš© ì´ë¯¸ì§€ ê°ì²´ì…ë‹ˆë‹¤.

System.Drawing.Graphics: GDI+ (Windows Forms) ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê·¸ë˜í”½ ê°ì²´ì…ë‹ˆë‹¤.

BitmapImageì— ë¬´ì–¸ê°€ë¥¼ ê·¸ë¦¬ë ¤ë©´ WPFì—ì„œ ê¶Œì¥í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ë‘ í˜•ì‹ ê°„ì— ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

âœ… ë°©ë²• 1: WPF ë„¤ì´í‹°ë¸Œ ë°©ì‹ RenderTargetBitmap ì‚¬ìš© (ê¶Œì¥)
WPFì—ì„œëŠ” UI ìš”ì†Œë“¤ì„ ì¡°í•©í•˜ê³ , ì´ ì¡°í•©ëœ ê²°ê³¼ë¬¼ì„ ë¹„íŠ¸ë§µìœ¼ë¡œ "ë Œë”ë§"í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì´ ê°€ì¥ íš¨ìœ¨ì ì´ê³  ê¶Œì¥ë˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ì›ë¦¬:

Gridë‚˜ Canvas ê°™ì€ ì»¨í…Œì´ë„ˆ ìœ„ì— ì›ë³¸ Imageë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤.

ê·¸ ìœ„ì— ê·¸ë¦¬ê³ ì í•˜ëŠ” ë„í˜•(Line, Rectangle)ì´ë‚˜ í…ìŠ¤íŠ¸(TextBlock)ë¥¼ ì¶”ê°€ë¡œ ë°°ì¹˜í•©ë‹ˆë‹¤.

ì»¨í…Œì´ë„ˆ ì „ì²´ë¥¼ RenderTargetBitmapì„ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë¡œ ë§Œë“­ë‹ˆë‹¤.

ì½”ë“œ ì˜ˆì‹œ:

C#

/// <summary>
/// WPFì˜ RenderTargetBitmapì„ ì‚¬ìš©í•´ BitmapSourceì— ë„í˜•ì„ ê·¸ë¦½ë‹ˆë‹¤.
/// </summary>
/// <param name="originalSource">ê·¸ë¦¼ì„ ê·¸ë¦´ ì›ë³¸ BitmapSource</param>
/// <returns>ê·¸ë¦¬ê¸° ì‘ì—…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ BitmapSource</p
private BitmapSource DrawOnBitmap(BitmapSource originalSource)
{
    // 1. ê·¸ë¦¬ê¸° ì‘ì—…ì„ í•  ì»¨í…Œì´ë„ˆ(Canvas) ìƒì„±
    var drawingCanvas = new Canvas
    {
        Width = originalSource.PixelWidth,
        Height = originalSource.PixelHeight
    };

    // 2. ì»¨í…Œì´ë„ˆì— ì›ë³¸ ì´ë¯¸ì§€ ë°°ì¹˜
    var originalImage = new Image { Source = originalSource };
    drawingCanvas.Children.Add(originalImage);
    Canvas.SetLeft(originalImage, 0);
    Canvas.SetTop(originalImage, 0);
    
    // 3. ê·¸ë¦¬ê³ ì í•˜ëŠ” ë„í˜•ì´ë‚˜ í…ìŠ¤íŠ¸ ì¶”ê°€ (ì˜ˆ: ëŒ€ê°ì„ )
    var lineToDraw = new System.Windows.Shapes.Line
    {
        X1 = 0,
        Y1 = 0,
        X2 = originalSource.PixelWidth,
        Y2 = originalSource.PixelHeight,
        Stroke = Brushes.Red,
        StrokeThickness = 5
    };
    drawingCanvas.Children.Add(lineToDraw);

    // 4. ì»¨í…Œì´ë„ˆì˜ í¬ê¸°ë¥¼ ê°•ì œë¡œ ì¸¡ì •í•˜ê³  ë°°ì¹˜
    drawingCanvas.Measure(new Size(originalSource.PixelWidth, originalSource.PixelHeight));
    drawingCanvas.Arrange(new Rect(new Size(originalSource.PixelWidth, originalSource.PixelHeight)));

    // 5. ì»¨í…Œì´ë„ˆì˜ ì‹œê°ì  ê²°ê³¼ë¬¼ì„ ìƒˆë¡œìš´ ë¹„íŠ¸ë§µìœ¼ë¡œ ë Œë”ë§
    var renderTargetBitmap = new RenderTargetBitmap(
        originalSource.PixelWidth,
        originalSource.PixelHeight,
        originalSource.DpiX,
        originalSource.DpiY,
        PixelFormats.Pbgra32);
        
    renderTargetBitmap.Render(drawingCanvas);
    renderTargetBitmap.Freeze(); // ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ Freeze

    return renderTargetBitmap;
}

// ì‚¬ìš© ì˜ˆì‹œ
private void YourButton_Click(object sender, RoutedEventArgs e)
{
    // ê¸°ì¡´ì— ë¡œë“œí•´ ë‘” originalBitmapImage ì‚¬ìš©
    BitmapSource newImageSource = DrawOnBitmap(this.originalBitmapImage);
    yourImageControl.Source = newImageSource;
}
âš ï¸ ë°©ë²• 2: BitmapImage â†” System.Drawing.Bitmap ë³€í™˜ (ê¸°ì¡´ ì½”ë“œ í™œìš© ì‹œ)
ê¸°ì¡´ì— System.Drawing.Graphicsë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œê°€ ë°˜ë“œì‹œ í•„ìš”í•˜ë‹¤ë©´, WPF BitmapImageë¥¼ GDI+ Bitmapìœ¼ë¡œ ë³€í™˜í•œ í›„, ì‘ì—…ì´ ëë‚˜ë©´ ë‹¤ì‹œ WPF BitmapSourceë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ë³€í™˜ ì˜¤ë²„í—¤ë“œê°€ ìˆì–´ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì›ë¦¬:

[WPF â†’ GDI+]: BitmapImageë¥¼ ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ì— PngBitmapEncoder ë“±ìœ¼ë¡œ ì¸ì½”ë”©í•©ë‹ˆë‹¤.

ì´ ìŠ¤íŠ¸ë¦¼ì„ ì´ìš©í•´ System.Drawing.Bitmap ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

[GDI+ ì‘ì—…]: Graphics.FromImage()ë¡œ Graphics ê°ì²´ë¥¼ ì–»ì–´ì™€ ê·¸ë¦¼ì„ ê·¸ë¦½ë‹ˆë‹¤.

[GDI+ â†’ WPF]: ì‘ì—…ì´ ì™„ë£Œëœ System.Drawing.Bitmapì„ ë‹¤ì‹œ ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ì— ì €ì¥í•©ë‹ˆë‹¤.

ì´ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ìƒˆë¡œìš´ BitmapImageë¥¼ ë§Œë“¤ì–´ UIì— í‘œì‹œí•©ë‹ˆë‹¤.

ì½”ë“œ ì˜ˆì‹œ:

C#

/// <summary>
/// BitmapSourceë¥¼ System.Drawing.Bitmapìœ¼ë¡œ ë³€í™˜ í›„ GDI+ë¡œ ê·¸ë¦¬ê³ , ë‹¤ì‹œ BitmapSourceë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
/// </summary>
/// <param name="source">ê·¸ë¦¼ì„ ê·¸ë¦´ ì›ë³¸ BitmapSource</param>
/// <returns>ê·¸ë¦¬ê¸° ì‘ì—…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ BitmapSource</returns>
private BitmapSource DrawWithGdi(BitmapSource source)
{
    // 1. [WPF -> GDI+] ë³€í™˜
    System.Drawing.Bitmap gdiBitmap;
    using (var outStream = new System.IO.MemoryStream())
    {
        // BitmapSourceë¥¼ PNG í˜•ì‹ìœ¼ë¡œ ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ì— ì¸ì½”ë”©
        BitmapEncoder enc = new PngBitmapEncoder();
        enc.Frames.Add(BitmapFrame.Create(source));
        enc.Save(outStream);
        
        // ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° GDI+ Bitmap ìƒì„±
        gdiBitmap = new System.Drawing.Bitmap(outStream);
    }

    // 2. [GDI+ ì‘ì—…] Graphics ê°ì²´ë¥¼ ì‚¬ìš©í•´ ê·¸ë¦¼ ê·¸ë¦¬ê¸°
    using (var g = System.Drawing.Graphics.FromImage(gdiBitmap))
    {
        var pen = new System.Drawing.Pen(System.Drawing.Color.Blue, 5);
        g.DrawLine(pen, 0, 0, gdiBitmap.Width, gdiBitmap.Height);
        pen.Dispose();
    }

    // 3. [GDI+ -> WPF] ë³€í™˜
    using (var memory = new System.IO.MemoryStream())
    {
        // ìˆ˜ì •ëœ GDI+ Bitmapì„ ë©”ëª¨ë¦¬ ìŠ¤íŠ¸ë¦¼ì— ì €ì¥
        gdiBitmap.Save(memory, System.Drawing.Imaging.ImageFormat.Png);
        memory.Position = 0;

        // ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° WPF BitmapImage ìƒì„±
        var bitmapImage = new BitmapImage();
        bitmapImage.BeginInit();
        bitmapImage.StreamSource = memory;
        bitmapImage.CacheOption = BitmapCacheOption.OnLoad;
        bitmapImage.EndInit();
        bitmapImage.Freeze();
        
        return bitmapImage;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
private void YourButton_Click(object sender, RoutedEventArgs e)
{
    BitmapSource newImageSource = DrawWithGdi(this.originalBitmapImage);
    yourImageControl.Source = newImageSource;
}
ğŸ’¡ ê²°ë¡ 
ìƒˆë¡œìš´ WPF í”„ë¡œì íŠ¸ë¼ë©´ ì„±ëŠ¥ê³¼ ì•„í‚¤í…ì²˜ë¥¼ ìœ„í•´ ë°©ë²• 1 (RenderTargetBitmap) ì„ ì‚¬ìš©í•˜ì„¸ìš”.