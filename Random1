SSQL 2014에서 특정 테이블을 참조하는 모든 데이터베이스의 모든 프로시저를 확인하는 쿼리는 다음과 같습니다. 이 쿼리는 INFORMATION_SCHEMA.ROUTINES 및 sys.sql_modules 뷰를 사용하여 프로시저 정의 내에서 특정 테이블 이름을 검색합니다.

sql
코드 복사
-- 검색할 테이블 이름 설정
DECLARE @TableName NVARCHAR(MAX) = '테이블_이름' -- 확인하려는 테이블 이름

-- 모든 데이터베이스에서 프로시저 참조 검색
DECLARE @SQL NVARCHAR(MAX) = '';

-- 동적 SQL 생성
SELECT @SQL = @SQL + 
    'USE [' + name + ']; ' +
    'SELECT ''' + name + ''' AS DatabaseName, ' +
    '       OBJECT_NAME(m.object_id) AS ProcedureName, ' +
    '       m.definition AS Definition ' +
    'FROM sys.sql_modules m ' +
    'INNER JOIN sys.objects o ON m.object_id = o.object_id ' +
    'WHERE m.definition LIKE ''%' + @TableName + '%'' ' +
    'AND o.type = ''P''; ' +
    CHAR(13) + CHAR(10)
FROM sys.databases
WHERE state_desc = 'ONLINE'; -- 오프라인 상태 DB 제외

-- 동적 SQL 실행
EXEC sp_executesql @SQL;
주요 설명:
@TableName: 검색하려는 테이블 이름을 지정합니다. 테이블 이름이 dbo.TableName 형식이라면 dbo.까지 포함해야 합니다.
sys.databases: 서버의 모든 데이터베이스를 확인합니다.
sys.sql_modules.definition: 프로시저, 함수 등의 SQL 정의를 가져옵니다.
LIKE 연산자: 특정 테이블 이름이 SQL 정의에 포함되어 있는지 확인합니다.
sys.objects: 오브젝트 유형(type)을 확인하여 프로시저(P)만 필터링합니다.
결과:
DatabaseName: 테이블을 참조하는 데이터베이스 이름
ProcedureName: 테이블을 참조하는 프로시저 이름
Definition: 프로시저의 SQL 정의
주의사항:
동적 SQL로 실행되므로 관리 권한이 필요합니다.
성능이 느려질 수 있으므로 테스트 환경에서 실행하거나 제한적으로 사용하세요.